/*
 * HotDocs Browser Interview Script - dialog.js
 * Version: 11.1.140121.1229
 * Copyright © HotDocs Limited 1992 - 2014. All rights reserved.
 */
/*!
* This is a HotDocs adaptation of Microsoft's System.Windows.Controls.DataGrid.
* The .NET DataGrid is licensed under the Microsoft Public License:
*
* (c) Copyright Microsoft Corporation.
* This source is subject to the Microsoft Public License (Ms-PL).
* Please see http://go.microsoft.com/fwlink/?LinkID=131993 for details.
* All other rights reserved.
*
*/
define("system/frameworkelement",["hdmain/jq"],function(a,b){return a.widget("hd.FrameworkElement",{options:{Bindings:{}},SetBinding:function(a,b){this.options.Bindings[a]=b},IsEnabled:function(a){return a===b?this.options.IsEnabled:(this._setOption("IsEnabled",a),void 0)}}),a.hd.FrameworkElement}),define("system/control",["hdmain/jq","system/frameworkelement","hdmain/system"],function(a,b,c){return a.widget("hd.Control",b,{_create:function(){b.prototype._create.apply(this,arguments),this.element.on("focus",function(){a(this).trigger("GotFocus")}).on("blur",function(){a(this).trigger("LostFocus")})},_setOption:function(a,d){switch(b.prototype._setOption.apply(this,arguments),a){case"IsTabStop":this.element.attr("tabIndex",d?1:"");break;case"Style":"string"==typeof d?this.element.removeClass().addClass(d):"string"==typeof d.c&&this.element.removeClass().addClass(d.c),d.s&&this.option(d.s);break;case"Visibility":this.element[d==c.Windows.Visibility.Visible?"show":"hide"]()}}}),a.hd.Control}),define("system/jquery.hd.datepicker",["hdmain/system","system/control","hdmain/jq"],function(a,b,c,d){var e,f=HOTDOC$,g=c.proxy,h="hd-datepicker",i="DatePicker",j="mouseup";return c.widget("hd."+i,b,{options:{mon:5,yr:1990,IsEnabled:!0,calVis:!1},_create:function(){this.element.css("position","relative"),this._wrap=c('<div class="hd-input-date-wrapper"/>').appendTo(this.element),this._textBox=c('<input type="text" class="hd-input hd-input-date"/>').attr("tabIndex",1).attr("placeholder","<"+f.Lc._GetProp("shortDateFormat")+">").appendTo(this._wrap),f.iOS&&this._textBox.attr("pattern","[0-9]*"),this._button=c('<div class="hd-img hd-cal-calendar"/>').on("click",g(this._button_Clicked,this)).appendTo(this.element),this.option(this.options),this.element.parent().length>0&&this._wrap.css("padding-left",this.element.siblings("div").width())},_setOption:function(a,b){switch(c.Widget.prototype._setOption.apply(this,arguments),a){case"IsEnabled":this._textBox.prop("disabled",!b).toggleClass("hd-input-readonly GrayField",!b).parents(".hd-cell-input").toggleClass("GrayText",!b),this._button.toggleClass("hd-img",b).toggleClass("hd-img-g",!b).prop("disabled",!b);break;case"yr":case"mon":this._updateCal();break;case"selDay":case"selMon":case"selYr":null!=this._curSelDate()&&(this._setOption("SelectedDate",this._curSelDate()),this._updateCal());break;case"SelectedDate":this._textBox.val(b?f.Lc.FormatDate(b.getDate(),b.getMonth()+1,b.getFullYear()):null),this.element.trigger("SelectedDateChanged");break;case"calVis":if(this._renderCal(),b){if(this._textBox.disabled)return;datval=f.Lc.ParseDate(this._textBox.val()),null!=datval&&"err"!=datval?this.option({mon:datval.getMonth(),yr:datval.getFullYear(),selDay:datval.getDate(),selMon:datval.getMonth(),selYr:datval.getFullYear()}):(datval=new Date,this.option({selDay:d,selMon:d,selYr:d,mon:datval.getMonth(),yr:datval.getFullYear()})),e.css({top:this._textBox.offset().top+this._textBox.outerHeight(!0),left:this._wrap.offset().left}).show(),c(document.body).on("mousedown."+i,g(function(a){0==c(a.target).parents("."+h).length&&(this._showCal(!1),c(document.body).off("."+i))},this))}else e.hide()}},_button_Clicked:function(){var a=this.options;return a.IsEnabled?(this._setOption("calVis",!a.calVis),void 0):!1},_changeYear:function(a){this._setOption("yr",this.options.yr+a.data)},_changeMonth:function(a){var b=this.options,c=b.mon+a.data,d=b.yr;0>c?(c=11,d--):c>11&&(c=0,d++),this.option({yr:d,mon:c})},_curSelDate:function(){var a=this.options,b=a.selDay,c=a.selMon,d=a.selYr,e="undefined"!=typeof b&&"undefined"!=typeof c&&"undefined"!=typeof d;return e?new Date(d,c,b):null},_showCal:function(a){this.options.calVis=a,a?e.show():e.hide()},_renderCal:function(){var a,b,d,i,k,l,m,n,o,p,q;if(!e){for(e=c("<div/>").addClass(h).hide(),a=f.Lc,b=this.options.mon,d=this.options.yr,i=a.FirstDayOfWeek(),i=0>i?0:i%7,m=c("<table cellpadding=0 cellspacing=0></table>").appendTo(e).addClass(h+"-grid"),n=c("<tr/>").appendTo(m),o=c('<td class="'+h+'-titlebar" colspan=7></td>').appendTo(n),p=c("<table cellpadding=0 cellspacing=1 border=0></table>").appendTo(o),q=c("<tr/>").appendTo(p),this._titleBtn("py").appendTo(q),this._titleBtn("pm").appendTo(q),c('<td class="'+h+'-title"/>').appendTo(q).text(a.GetMonthName(b,!1)+" "+d),this._titleBtn("nm").appendTo(q),this._titleBtn("ny").appendTo(q),l=c('<tr class="'+h+'-days"/>').appendTo(m),k=0;7>k;k++)c('<td class="'+h+"-day "+h+'-label">'+a.GetWeekdayName((k+i)%7,!0).substr(0,2)+"</td>").appendTo(l);c("<tr/>").appendTo(m)}e.find(".hd-cal-py").off(j).on(j,null,-1,g(this._changeYear,this)),e.find(".hd-cal-pm").off(j).on(j,null,-1,g(this._changeMonth,this)),e.find(".hd-cal-nm").off(j).on(j,null,1,g(this._changeMonth,this)),e.find(".hd-cal-ny").off(j).on(j,null,1,g(this._changeYear,this)),e.appendTo("#hdMainDiv")},_updateCal:function(){var a,b,d,i,j,k,l,m,n,o,p,q=f.Lc,r=this.options,s=r.mon,t=r.yr,u=new Date,v=this._curSelDate(),w=q.FirstDayOfWeek(),x=q._GetProp("calWeekend"),y=q.DaysInMonth(s,t);for(w=0>w?0:w%7,x||(x=[0,6]),a=new Date(t,s,1),a.dayOfWeek=a.getDay(),b=t==u.getFullYear()&&s==u.getMonth()?u.getDate():255,d=v&&t==r.selYr&&s==r.selMon?v.getDate():255,e||this._renderCal(),n=e.children("table"),n.find("."+h+"-title").text(q.GetMonthName(s,!1)+" "+t),o=c("."+h+"-days").next(),o.empty(),i=1;42>=i;i++){for(j=(i+w+6)%7,k=i+w-a.dayOfWeek,w>a.dayOfWeek&&(k-=7),l=0;l<x.length&&j!=x[l];l++);if(m=l<x.length,p=c("<td/>").appendTo(o),p.addClass(h+"-day"+(m?" "+h+"-weekend":"")),(k==d||k==b)&&p.addClass(k==d?h+"-selected":h+"-today"),k>0&&y>=k?p.on("click",null,k,g(this._select,this)).css("cursor","pointer").text(k):p.text(" "),i%7==0&&36>i){if(i>=28&&k>=y)break;o=o.next(),o.length<=0&&(o=c("<tr/>").appendTo(n)),o.empty()}}o.next().length>0&&o.next().remove()},_select:function(a){this._showCal(!1),this._setOption("selDay",a.data);var b=f.Lc.FormatDate(a.data,this.options.mon+1,this.options.yr);this._textBox.val(b).focus()},_titleBtn:function(a){return c('<td><div class="hd-img hd-cal-'+a+'"/></td>')},SetFocus:function(){this._textBox.focus()},DisplayDate:function(){return a.String.IsNullOrEmpty(this._textBox.val())?"":f.Lc._localeHelper.InterpretDate(this._textBox.val())}}),c.hd[i]}),define("dialog/answerdatepicker",["hdmain/jq","system/jquery.hd.datepicker"],function(a,b,c){var d=HOTDOC$,e=a.proxy,f="AnswerDatePicker",g="TextChanged.DateInputControl";return a.widget("hd."+f,b,{_textBox:null,_create:function(){this.element.on("Loaded",e(this.AnswerDatePicker_Loaded,this)).on("Unloaded",e(this.AnswerDatePicker_Unloaded,this)).on("SelectedDateChanged",e(this.AnswerDatePicker_SelectedDateChanged,this)),b.prototype._create.apply(this,arguments)},OnApplyTemplate:function(){null!=this.RawText()&&this._textBox.val(this.RawText())},AnswerDatePicker_Loaded:function(){null!=this._textBox&&this._textBox.on(g,e(this._textBox_TextChanged,this))},AnswerDatePicker_Unloaded:function(){null!=this._textBox&&this._textBox.off(g,this._textBox_TextChanged)},SynchText:function(){this.RawText(this._textBox.val())},OnKeyDown:function(a){(9==a.which||33==a.which||34==a.which||36==a.which||35==a.which)&&this.SynchText(),b.prototype.OnKeyDown.apply(this,arguments)},_textBox_TextChanged:function(){this.SynchText()},AnswerDatePicker_SelectedDateChanged:function(){this.RawText(this.options.SelectedDate?d.Lc._localeHelper.FormatDate(this.options.SelectedDate.getDate(),this.options.SelectedDate.getMonth()+1,this.options.SelectedDate.getFullYear()):"")},RawText:function(a){return a===c?this._textBox.val():(this._textBox.val(a),void 0)}}),a.hd[f]}),define("system/jquery.hd.childwindow",["hdmain/jq"],function(a){var b=a.ui.dialog.prototype;return a.widget("hd.ChildWindow",a.ui.dialog,{options:{dialogClass:"hd-interview-base hd-popup",overlay:{backgroundColor:"#000CCC",opacity:.5},autoOpen:!1,resizable:!1,draggable:!0,modal:!0,show:"scale",hide:"scale",hdClose:[]},_create:function(){b._create.apply(this,arguments),this._setOption("close",a.proxy(function(){this.element.trigger("Closed")},this)),this.option(this.options)},open:function(){b.open.apply(this,arguments),this.element.resize()},close:function(){b.close.apply(this,arguments);var c=this;a.each(this.options.hdClose,function(a,b){b.apply(c,arguments)})},DialogResult:function(a){return"boolean"!=typeof a?"boolean"!=typeof this._dialogResult?null:this._dialogResult:(this._dialogResult="boolean"==typeof a?a:null,b.isOpen.apply(this)===!0&&this.close(),void 0)}}),a.hd.ChildWindow}),define("dialog/answersourcevalueconverter",["hdmain/system"],function(a){function b(){}return a.ExtendClass(b,null,{Convert:function(a){if(null==a)return"";switch(typeof a){case"string":case"boolean":return a;case"object":if(a instanceof Date)return HOTDOC$.Lc.FormatDateVal(a,"d MMM yyyy");if(a.length)return a.join("|");default:return a.toString()}},ConvertBack:function(){}}),b}),define("system/contentcontrol",["system/control","hdmain/jq"],function(a,b){return b.widget("hd.ContentControl",a,{_setOption:function(b,c){switch(b){case"Content":this.OnContentChanged(this.options[b],c);break;case"ContentTemplate":}a.prototype._setOption.apply(this,arguments)},OnContentChanged:function(a,b){"object"!=typeof b?this.element.children("span").html(b):(this.element.children().detach(),b.appendTo(this.element).trigger("Loaded"))}}),b.hd.ContentControl}),define("system/exception",[],function(){function a(a,b){this.message=a,this.InnerException=b}return a}),define("system/exception/systemexception",["hdmain/system","system/exception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("system/exception/argumentexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("system/jq.datagrid/datagridlength",["hdmain/system","system/exception/argumentexception"],function(a,b,c){function d(a,d){if(d===c&&(d=f.Pixel),isNaN(a)||!isFinite(a)||0>a)throw new b("DataGridLength: invalid value");if(d!=f.Auto&&d!=f.Pixel)throw new b("DataGridLength: invalid type");this.Value=d==f.Auto?g:a,this.T=d}var e,f={Auto:0,Pixel:1},g=1;return e=new d(g,f.Auto),a.ExtendClass(d,null,{IsAbsolute:function(){return this.T==f.Pixel},IsAuto:function(){return this.T==f.Auto}},{Auto:function(){return e}}),d}),define("system/jq.datagrid/datagridcolumnheader",["system/contentcontrol","hdmain/jq","system/jq.datagrid/datagridlength"],function(a,b,c,d){function e(){x=s.None,l=null,o=null,k=null}function f(a){if(1==a.which){var c,d,e,f,j,q,u,w=this.options;null==w.OwningColumn||a.Handled||this.element.is(":disabled")||(b(document).on(t,p(g,this)),this.element.closest("tr").on(v,p(h,this)),j={X:a.clientX,Y:a.clientY},q={v:a.Handled},!q.v&&null!=this.OwningGrid()&&(x=s.MouseDown,k=j,u=j.X,c=u-this.element.offset().left,d=this.element.offset().left+this.element.outerWidth()-u,e=w.OwningColumn,f=null,f=this.OwningGrid().options.Columns.GetPreviousVisibleColumn(e),x==s.MouseDown&&null==l&&r>=d?q.v=i(e):x==s.MouseDown&&null==l&&r>=c&&null!=f&&(q.v=i(f)),x==s.Resize&&null!=l&&(o=k,n=l.ActualWidth(),m=n,q.v=!0)),a.Handled=q.v)}}function g(a){if(this.element.closest("tr").off(v,h),b(document).off(t,p(g,this)),null!=this.options.OwningColumn&&!a.Handled&&!this.element.is(":disabled")){var c={v:a.Handled};c.v||(this.element.trigger(w),c.v=!0),a.Handled=c.v}}function h(a){if(null!=this.options.OwningColumn&&!this.element.is(":disabled")){var b,d,e,f,g,h,i={X:a.clientX,Y:a.clientY},j={v:!1};j.v||(b=d=i,e=i.X,f=this.element.offset().left+this.element.outerWidth()-e,j.v||x==s.Resize&&null!=l&&null!=o&&(g=d.X-o.X,h=n+g,m>=l.MinWidth()&&h!=m&&(h=Math.max(h,0),l.Width(new c(h)),m=h),j.v=!0),k=d),a.preventDefault()}}function i(a){return l=a,x=s.Resize,!0}var j=HOTDOC$;this.DEBUG===d&&(this.DEBUG=j.DEBUG);var k,l,m,n,o,p=b.proxy,q="DataGridColumnHeader",r=5,s={None:0,MouseDown:1,Resize:3},t="mouseup.DataGrid",u="mousedown.DataGrid",v="mousemove.DataGrid",w="LostMouseCapture",x=s.None;return b.widget("hd."+q,a,{_create:function(){a.prototype._create.apply(this,arguments),this.element.disableSelection().addClass("hd-grid-col-title hd-grid-line").on(w,e).on(u,p(f,this)),b("<span/>").appendTo(this.element),b('<div class="hd-grid-col-splitter"/>').appendTo(this.element)},_setOption:function(b){switch(a.prototype._setOption.apply(this,arguments),b){case"Visibility":this.options.OwningColumn.OwningGrid._rowsPresenter.find(".hd-grid-row-cells").children(":nth-child("+(this.element.index()+1)+")").hide()}},ColumnIndex:function(){var a=this.options;return null==a.OwningColumn?-1:a.OwningColumn.Index},OwningGrid:function(){var a=this.options;return null!=a.OwningColumn&&null!=a.OwningColumn.OwningGrid?a.OwningColumn.OwningGrid:null}}),b.hd[q]}),define("system/exception/argumentnullexception",["hdmain/system","system/exception/argumentexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("system/jq.datagrid/datagridcolumn",["hdmain/system","hdmain/jq","system/contentcontrol","system/jq.datagrid/datagridcolumnheader","system/jq.datagrid/datagridlength","system/exception/argumentnullexception"],function(a,b,c,d,e,f,g){function h(){this._desiredWidth=0,this._width=null,this._visibility=a.Windows.Visibility.Visible,this._displayIndex=-1}var i=HOTDOC$,j="DataGridColumnHeader";return this.DEBUG===g&&(this.DEBUG=i.DEBUG),a.ExtendClass(h,null,{ActualWidth:function(){if(null==this.OwningGrid)return 0;var a=this.EffectiveWidth().IsAbsolute()?this.EffectiveWidth().Value:this.DesiredWidth();return Math.min(Math.max(a,this.ActualMinWidth()),this.ActualMaxWidth())},DisplayIndex:function(a){return a===g?this._displayIndex:(this._displayIndex!=a&&(this._displayIndex=null!=this.OwningGrid?a:a),void 0)},HeaderStyle:function(a){return a===g?this._headerStyle:(this._headerStyle!=a&&(this._headerStyle=a,null!=this._headerCell&&(this._headerCell.Style=a)),void 0)},Header:function(a){return a===g?this._header:(this._header!=a&&(this._header=a,null!=this._headerCell&&this._headerCell[j]({Content:this._header})),void 0)},IsReadOnly:function(a){return a===g?null==this.OwningGrid?null!=this._isReadOnly?this._isReadOnly:!1:null!=this._isReadOnly?this._isReadOnly||this.OwningGrid.IsReadOnly():!1:(a!=this._isReadOnly&&(this._isReadOnly=a),void 0)},MaxWidth:function(a){return a===g?null!=this._maxWidth?this._maxWidth:1/0:((null==this._maxWidth||this._maxWidth!=a)&&(this._maxWidth=a,null!=this.OwningGrid&&this._maxWidth<this.ActualWidth()&&this.OwningGrid.OnColumnWidthChanged(this)),void 0)},MinWidth:function(a){return a===g?null!=this._minWidth?this._minWidth:0:((null==this._minWidth||this._minWidth!=a)&&(this._minWidth=a,null!=this.OwningGrid&&this._minWidth>this.ActualWidth()&&this.OwningGrid.OnColumnWidthChanged(this)),void 0)},Visibility:function(a){return a===g?this._visibility:(a!=this.Visibility()&&(this._visibility=a,null!=this._headerCell&&this._headerCell[j]({Visibility:this._visibility})),void 0)},Width:function(a){return a===g?null!=this._width?this._width:null!=this.OwningGrid?this.OwningGrid.options.ColumnWidth:e.Auto():((null==this._width||this._width!=a)&&(this._width=a,a.IsAbsolute()&&this.DesiredWidth(a),null!=this.OwningGrid&&this.OwningGrid.OnColumnWidthChanged(this)),void 0)},ActualMaxWidth:function(){return this._maxWidth?this._maxWidth:null!=this.OwningGrid?this.OwningGrid.options.MaxColumnWidth:1/0},ActualMinWidth:function(){return this._minWidth?this._minWidth:null!=this.OwningGrid?this.OwningGrid.options.MinColumnWidth:0},DesiredWidth:function(a){if(a===g)return this._desiredWidth;if(this._desiredWidth!=a){var b=this.ActualWidth();this._desiredWidth=a,null!=this.OwningGrid&&b!=this.ActualWidth()&&this.OwningGrid.OnColumnWidthChanged(this)}},EffectiveWidth:function(){return this._width?this._width:this.OwningGrid.options.ColumnWidth},HeaderCell:function(){if(null==this._headerCell){this._headerCell=b("<div/>")[j]();var a=this.HeaderStyle();null==a&&null!=this.OwningGrid&&(a=this.OwningGrid.options.ColumnHeaderStyle),null!=a&&this._headerCell[j]({Style:a}),this._headerCell[j]({OwningColumn:this,Content:this._header})}return this._headerCell},GetCellContent:function(b){var c,d,e;if(null==b)throw new f("dataGridRow/dataItem");if(null==a.Cast(b,"DataGridRow")){if(c=b,d=this.OwningGrid.GetRowFromItem(c),null==d)return null}else d=b;return d.DataGridRow("option","OwningGrid")==this.OwningGrid&&(e=d.DataGridRow("option","Cells").get(this.Index),null!=e)?e.DataGridCell("option","Content"):null},RefreshCellContent:function(){}}),h}),define("system/jq.datagrid/datagridboundcolumn",["hdmain/system","hdmain/jq","system/jq.datagrid/datagridcolumn"],function(a,b,c,d){function e(){}function f(){f.baseConstructor.apply(this,arguments)}var g=HOTDOC$;return this.DEBUG===d&&(this.DEBUG=g.DEBUG),a.ExtendClass(e,null,{Convert:function(a){return a},ConvertBack:function(a,b){return null!=b&&b.IsNullableType()&&""==a.toString()?null:a}}),a.ExtendClass(f,c,{Binding:function(b){if(b===d)return this._binding;if(this._binding!=b){if(null!=this.OwningGrid&&!this.OwningGrid.CommitEdit(a.Windows.Controls.DataGridEditingUnit.Row,!0))throw"CommitFailedCannotCompleteOperation";this._binding=b,null!=this._binding&&(a.String.IsNullOrEmpty(this._binding.Path)||(this._binding.Mode=a.Windows.Data.BindingMode.TwoWay),null==this._binding.Converter&&(this._binding.Converter=new e))}},ElementStyle:function(a){return a===d?this._elementStyle:(this._elementStyle!=a&&(this._elementStyle=a),void 0)}}),f}),define("system/textblock",["hdmain/jq","system/frameworkelement"],function(a,b,c){return a.widget("hd.TextBlock",b,{_create:function(){b.prototype._create.apply(this,arguments),this.option(this.options)},_setOption:function(a,b){switch(a){case"Text":"INPUT"==this.element.prop("tagName")?this.element.val(b?b:""):this.element.text(b?b:"")}},Text:function(a){return a===c?this.options.Text:(this._setOption("Text",a),void 0)},Foreground:function(a){this.element.removeClass().addClass(a).prop("disabled",a.indexOf("-gray")>0||a.indexOf("-readonly")>0)}}),a.hd.TextBlock}),define("system/jq.datagrid/datagridtextcolumn",["hdmain/system","hdmain/jq","system/jq.datagrid/datagridboundcolumn","system/textblock"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}return a.ExtendClass(d,c,{GenerateElement:function(){var a=b("<div/>").TextBlock().html("&nbsp;");return a.TextBlock("SetBinding","Text",this.Binding()),a},RefreshCellContent:function(){}}),d}),define("system/jquery.hd.togglebutton",["hdmain/system","system/contentcontrol","hdmain/jq"],function(a,b,c,d){var e="ToggleButton",f="IsChecked";return c.widget("hd."+e,b,{options:{Style:"hd-input-tf"},_create:function(){c.Widget.prototype._create.apply(this,arguments),this.element.attr("tabIndex",1).change(function(a){c(a.target).trigger("focus").trigger(a.target.checked?"Checked":"Unchecked"),"radio"==a.target.type&&c('input[name="'+a.target.name+'"]').not(a.target).each(function(){c(this).trigger(this.checked?"Checked":"Unchecked")})}),this.option(this.options)},_setOption:function(b,d){switch(c.Widget.prototype._setOption.apply(this,arguments),b){case"Style":this.element.removeClass().addClass(d);break;case"Content":var e=a.Guid.NewGuid();d.attr("for",e).insertAfter(this.element),this.element.attr("id",e);break;case f:this.element.prop("checked",d);break;case"IsEnabled":this.element.attr("disabled",!d)}},IsChecked:function(a){return a===d?this.options[f]:(this._setOption(f,a),void 0)}}),c.hd[e]}),define("system/checkbox",["hdmain/jq","system/jquery.hd.togglebutton"],function(a,b){return a.widget("hd.CheckBox",b,{}),a.hd.CheckBox}),define("system/jq.datagrid/datagridcheckboxcolumn",["hdmain/system","hdmain/jq","system/jq.datagrid/datagridboundcolumn","system/exception/argumentnullexception","system/checkbox"],function(a,b,c,d,e,f){function g(){g.baseConstructor.apply(this,arguments)}var h=HOTDOC$;return this.DEBUG===f&&(this.DEBUG=h.DEBUG),a.ExtendClass(g,c,{GenerateElement:function(){var a=b('<input type="checkbox"/>').CheckBox().addClass("hd-input-tf-readonly").on("click",function(){return!1}).CheckBox("SetBinding","IsChecked",this.Binding);return a},RefreshCellContent:function(a){if(null==a)throw new d("element")}}),g}),define("system/jq.datagrid/datagridtemplatecolumn",["system/jq.datagrid/datagridcolumn","hdmain/system"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}return this.DEBUG===c&&(this.DEBUG=HOTDOC$.DEBUG),b.ExtendClass(d,a,{GenerateElement:function(){return this.CellTemplate.LoadContent()}}),d}),define("system/jq.datagrid/datagridbeginningediteventargs",[],function(){function a(a,b,c){this.Column=a,this.Row=b,this.EditingEventArgs=c}return a}),define("system/jq.datagrid/datagridpreparingcellforediteventargs",[],function(){function a(a,b,c,d){this.Column=a,this.Row=b,this.EditingEventArgs=c,this.EditingElement=d}return a}),define("system/jq.datagrid/datagridroweventargs",[],function(){function a(a){this.Row=a}return a}),define("system/jq.datagrid/datagridcellcoordinates",["hdmain/system"],function(a){function b(a,c){a instanceof b?(this.C=a.C,this.R=a.R):(this.C=a,this.R=c)}return a.ExtendClass(b,null,{Equals:function(a){return a instanceof b?a.C==this.C&&a.R==this.R:!1}}),b}),define("system/jq.datagrid/datagriddataconnection",["hdmain/system","hdmain/jq"],function(a,b,c){function d(a){this._owner=a}function e(a,b){var c,d;switch(b.Action){case"Add":if(c=b.NewItems,null==c)return;this._owner.InsertRow(b.NewStartingIndex);break;case"Remove":if(c=b.OldItems,null==c||b.OldStartingIndex<0)return;for(d=0;d<b.OldItems.length;d++)this._owner.RemoveRowAt(b.OldStartingIndex,b.OldItems[d])}}var f=HOTDOC$;this.DEBUG===c&&(this.DEBUG=f.DEBUG);var g=b.proxy;return a.ExtendClass(d,null,{Count:function(){var a,b,c,d=this.List(),e=0;if(null!=d)return"number"==typeof d.length?d.length:d.c.length;if(a=this.DataSource,null!=a)return a.Count;if(b=this.DataSource,null!=b&&(c=b.GetEnumerator(),null!=c))for(;c.MoveNext();)e++;return e},DataType:function(){return null==this._owner.options.ItemsSource?null:this._owner.options.ItemsSource.GetItemType()},List:function(){return this.DataSource},BeginEdit:function(a){if(null==a)return!1;var b=a;return null!=b?!0:!0},EndEdit:function(a){var b=a;return null!=b?!0:!0},GetDataItem:function(a){var b,c,d,e=this.List(),f=-1;if(null!=e)return"number"==typeof e.length?a<e.length?e[a]:null:a<e.c.length?e.c[a]:null;if(b=this.DataSource,null!=b)return b.GetItemAt(a);if(c=this.DataSource,null!=c)for(d=c.GetEnumerator();d.MoveNext()&&a>f;)if(f++,f==a)return d.Current;return null},IndexOf:function(a){var b=this.List();return null!=b?"number"==typeof b.length?b.indexOf(a):b.c?b.c.indexOf(a):b.IndexOf(a):void 0},UnWireEvents:function(a){null!=a&&b(a).off("CollectionChanged",e)},WireEvents:function(a){null!=a&&b(a).on("CollectionChanged",g(e,this))}}),d}),define("system/jq.datagrid/range",["hdmain/system"],function(a){function b(a,b,c){this.L=a,this.U=b,this.V=c}return a.ExtendClass(b,null,{Count:function(){return this.U-this.L+1},ContainsIndex:function(a){return this.L<=a&&this.U>=a},ContainsValue:function(a){return null==this.V?null==a:this.V==a}}),b}),define("system/jq.datagrid/indextovaluetable",["hdmain/system","system/jq.datagrid/range"],function(a,b,c){function d(){this._list=[]}function e(a,c,d,e){var h,i,k,l,m=a+c-1,n=new b(a,m,d);if(0==this._list.length)this._list.push(n);else{for(h=null!=e?e:f.call(this,a),i=0>h?null:this._list[h],null==i?(0>h&&(h=0),this._list.splice(h,0,n)):i.V!=d&&i.U>=a?(i.U>m&&this._list.splice(h+1,0,new b(m+1,i.U,i.V)),i.U=a-1,j.call(this,i,h)||h++,this._list.splice(h,0,n)):(this._list.splice(h+1,0,n),g.call(this,h)||h++),k=h+1;k<this._list.length&&this._list[k].U<m;)this._list.splice(k,1);k<this._list.length&&(l=this._list[k],l.L<=m&&(l.L=m+1,j.call(this,l,k)),g.call(this,h))}}function f(a){if(0==this._list.length)return-1;for(var b,c=0,d=this._list.length-1,e=null;d>c;)if(b=Math.floor((c+d)/2),e=this._list[b],e.U<a)c=b+1;else{if(!(e.L>a))return b;d=b-1}return c==d?(e=this._list[c],e.ContainsIndex(a)||e.U<a?c:c-1):d}function g(a){var b,c,d=a+1;return a>=0&&d<this._list.length&&(b=this._list[a],c=this._list[d],b.U+1>=c.L&&b.V==c.V)?(b.U=Math.max(b.U,c.U),this._list.splice(d,1),!0):!1}function h(a,c,d){var e,f,g=d>=0?d:0;for(e=g;e<this._list.length;e++){if(f=this._list[e],f.L>=a)f.L+=c;else if(f.U>=a){e++,this._list.splice(e,0,new b(a,f.U+c,f.V)),f.U=a-1;continue}f.U>=a&&(f.U+=c)}}function i(a,b){return-1!=a&&this._list[a].ContainsIndex(b)}function j(a,b){return a.U<a.L?(this._list.splice(b,1),!0):!1}return this.DEBUG===c&&(this.DEBUG=HOTDOC$.DEBUG),a.ExtendClass(d,null,{IndexCount:function(){var a,b=0;for(a=0;a<this._list.length;a++)b+=this._list[a].Count();return b},IsEmpty:function(){return 0==this._list.length},RangeCount:function(){return this._list.length},SingleIndex:function(){return this._list[0].L},AddValue:function(a,b){this.AddValues(a,1,b)},AddValues:function(a,b,c){e.call(this,a,b,c,null)},Clear:function(){this._list=[]},Contains:function(a){return i.call(this,f.call(this,a),a)},ContainsAll:function(a,b){var c,d,e=-1,f=-1;for(c=0;c<this._list.length;c++)if(d=this._list[c],-1==e&&d.U>=a){if(a<d.L)return!1;if(e=a,f=d.U,f>=b)return!0}else if(-1!=e){if(d.L>f+1)return!1;if(f=d.U,f>=b)return!0}return!1},ContainsIndexAndValue:function(a,b){var c=f.call(this,a);return i.call(this,c,a)&&this._list[c].ContainsValue(b)},GetIndexCount:function(a,b,c){if(0==this._list.length)return 0;var d=0,e=f.call(this,a);for(i.call(this,e,a)&&this._list[e].ContainsValue(c)&&(d+=this._list[e].U-a),e++;e<this._list.length&&this._list[e].U<b;)this._list[e].ContainsValue(c)&&(d+=this._list[e].length),e++;return e<this._list.length&&i.call(this,e,b)&&this._list[e].ContainsValue(c)&&(d+=b-this._list[e].L),d},GetIndexes:function(){var a,b,c,d=[];for(a=0;a<this._list.length;a++)for(b=this._list[a],c=b.L;c<=b.U;c++)d.push(c);return d},GetValueAt:function(a,b){b===c&&(b={});var d=f.call(this,a);return i.call(this,d,a)?(b.v=!0,this._list[d].V):(b.v=!1,null)},IndexOf:function(a){var b,c,d=0;for(b=0;b<this._list.length;b++){if(c=this._list[b],d+c.Count()>a)return c.L+a-d;d+=c.Count()}return-1},InsertIndex:function(a){this.InsertIndexes(a,1)},InsertIndexAndValue:function(a,b){this.InsertIndexesAndValues(a,1,b)},InsertIndexes:function(a,b){h.call(this,a,b,f.call(this,a))},InsertIndexesAndValues:function(a,b,c){var d=f.call(this,a);h.call(this,a,b,d),e.call(this,a,b,c,d)},RemoveIndex:function(a){this.RemoveIndexes(a,1)},RemoveIndexAndValue:function(a){this.RemoveIndexesAndValues(a,1)},RemoveIndexes:function(a,c){var d,e,h,i=f.call(this,a);for(0>i&&(i=0),d=i;d<this._list.length;)e=this._list[d],e.U>=a&&(e.L>=a+c?(e.L-=c,e.U-=c):(h=d,e.L<=a?(e.U>=a+c&&(d++,this._list.splice(d,0,new b(a,e.U-c,e.V))),e.U=a-1):(e.L=a,e.U-=c),j.call(this,e,h)&&d--)),d++;g.call(this,i)||g.call(this,i+1)},RemoveIndexesAndValues:function(a,b){this.RemoveValues(a,b),this.RemoveIndexes(a,b)},RemoveValue:function(a){this.RemoveValues(a,1)},RemoveValues:function(a,c){var d=f.call(this,a);for(0>d&&(d=0);d<this._list.length&&this._list[d].U<a;)d++;if(!(d>=this._list.length)){for(this._list[d].L<a&&(this._list.splice(d,0,new b(this._list[d].L,a-1,this._list[d].V)),d++),this._list[d].L=a+c,j.call(this,this._list[d],d)||d++;d<this._list.length&&this._list[d].U<a+c;)this._list.splice(d,1);d<this._list.length&&this._list[d].U>=a+c&&this._list[d].L<a+c&&(this._list[d].L=a+c,j.call(this,this._list[d],d))}}}),d}),define("system/jq.datagrid/datagridselecteditemscollection",["hdmain/system","system/jq.datagrid/indextovaluetable"],function(a,b,c){function d(a){this.OwningGrid=a,this._selectedItemsTable=new b}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,null,{get:function(a){var b=this._selectedItemsTable.IndexOf(a);return this.OwningGrid.DataConnection.GetDataItem(b)},IsReadOnly:function(){return!1},Contains:function(a){if("number"==typeof a)return this.Contains_int(a);var b=this.OwningGrid.DataConnection.IndexOf(a);return-1==b?!1:this.Contains_int(b)},Contains_int:function(a){return this._selectedItemsTable.Contains(a)},IndexOf:function(a){var b,c=this.OwningGrid.DataConnection.IndexOf(a),d=0;if(-1==c)return-1;for(b in this._selectedItemsTable){if(b.U>=c)return b.L<=c?d+c-b.L:-1;d+=b.Count}return-1},Count:function(){return this._selectedItemsTable.IndexCount()},ClearRows:function(){for(var a in this._selectedItemsTable.GetIndexes())this.OwningGrid.OnRemovedSelectedItem(a);this._selectedItemsTable.Clear()},Delete:function(a,b){this.OwningGrid.OnRemovedSelectedItem(a,b),this._selectedItemsTable.RemoveIndex(a)},GetIndexes:function(){return this._selectedItemsTable.GetIndexes()},InsertIndexes:function(a,b){this._selectedItemsTable.InsertIndexes(a,b)},SelectRow:function(a,b){b?(this.OwningGrid.OnAddedSelectedItem(a),this._selectedItemsTable.AddValue(a,!0)):(this.OwningGrid.OnRemovedSelectedItem(a),this._selectedItemsTable.RemoveValue(a))}}),d}),define("system/jq.datagrid/datagridcolumncollection",["hdmain/system","system/exception/argumentnullexception"],function(a,b,c){function d(a){this._owningGrid=a,this.ItemsInternal=[],this.CollectionChanged=[]}var e=HOTDOC$,f=a.Windows.Visibility;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,null,{Count:function(){return this.ItemsInternal.length},Add:function(a){this.InsertItem(this.ItemsInternal.length,a)},get:function(a){return this.ItemsInternal[a]},FirstColumn:function(){return this.GetFirstColumn(null,null,null)},FirstVisibleColumn:function(){return this.GetFirstColumn(!0,null,null)},VisibleColumnCount:function(){var a,b=0;for(a=0;a<this.ItemsInternal.length;a++)this.ItemsInternal[a].Visibility()==f.Visible&&b++;return b},InsertItem:function(a,c){if(null==c)throw new b("dataGridColumn");var d,e,f=c.DisplayIndex();-1==f&&c.DisplayIndex(a);try{d=this._owningGrid.OnInsertingColumn(a,c)}finally{c._displayIndex=f}for(this._sortedColumns=null,this.ItemsInternal.splice(a,0,c),c.Index=a,c.OwningGrid=this._owningGrid,this._owningGrid.OnInsertedColumn_PreNotification(c),this._owningGrid.OnColumnCollectionChanged_PreNotification(!0),e=0;e<this.CollectionChanged.length;e++)this.CollectionChanged[e]();this._owningGrid.OnInsertedColumn_PostNotification(d)},GetFirstColumn:function(a,b,c){null==this._sortedColumns&&this.UpdateColumnOrderCache();for(var d,e=0;e<this._sortedColumns.length;){if(d=this._sortedColumns[e],!(null!=a&&d.Visibility()==f.Visible!=a||null!=c&&d.IsReadOnly()!=c)&&this._owningGrid.element.is(":visible"))return d;e++}return null},GetLastColumn:function(a,b,c){null==this._sortedColumns&&this.UpdateColumnOrderCache();for(var d,e=this._sortedColumns.length-1;e>=0;){if(d=this._sortedColumns[e],!(null!=a&&d.Visibility()==f.Visible!=a||null!=c&&d.IsReadOnly()!=c))return d;e--}return null},GetNextColumn:function(a,b,d,e){b===c&&(b=null,d=null,e=null),null==this._sortedColumns&&this.UpdateColumnOrderCache();var g,h,i,j=this.GetColumnSortedIndex(a);if(-1==j){for(g=!1,h=Int32.MaxValue,displayIndexMin=Int32.MaxValue,j=0;j<this.ItemsInternal.length;j++)i=this.ItemsInternal[j],(null==b||i.Visibility()==f.Visible==b)&&(null==e||i.IsReadOnly()==e)&&(i.DisplayIndex()>a.DisplayIndex()||i.DisplayIndex()==a.DisplayIndex()&&i.Index>a.Index)&&(i.DisplayIndex()<displayIndexMin||i.DisplayIndex()==displayIndexMin&&i.Index<h)&&(h=j,displayIndexMin=i.DisplayIndex,g=!0);return g?this.ItemsInternal[h]:null}for(j++;j<this._sortedColumns.length;){if(i=this._sortedColumns[j],!(null!=b&&i.Visibility()==f.Visible!=b||null!=e&&i.IsReadOnly()!=e))return i;j++}return null},GetNextVisibleColumn:function(a){return this.GetNextColumn(a,!0,null,null)},GetPreviousColumn:function(a,b,c,d){null==this._sortedColumns&&this.UpdateColumnOrderCache();var e,g,h,i=this.GetColumnSortedIndex(a);if(-1==i){for(e=!1,g=-1,displayIndexMax=-1,i=0;i<this.ItemsInternal.length;i++)h=this.ItemsInternal[i],(null==b||h.Visibility()==f.Visible==b)&&(null==d||h.IsReadOnly()==d)&&(h.DisplayIndex()<a.DisplayIndex||h.DisplayIndex()==a.DisplayIndex&&h.Index<a.Index)&&(h.DisplayIndex()>displayIndexMax||h.DisplayIndex()==displayIndexMax&&h.Index>g)&&(g=i,displayIndexMax=h.DisplayIndex,e=!0);
return e?this.ItemsInternal[g]:null}for(i--;i>=0;){if(h=this._sortedColumns[i],!(null!=b&&h.Visibility()==f.Visible!=b||null!=d&&h.IsReadOnly()!=d))return h;i--}return null},GetPreviousVisibleColumn:function(a){return this.GetPreviousColumn(a,!0,null,null)},GetColumnSortedIndex:function(a){for(var b=0;b<this._sortedColumns.length;){if(a.Index==this._sortedColumns[b].Index)return b;b++}return-1},UpdateColumnOrderCache:function(){this._sortedColumns=this.ItemsInternal.slice(0)}}),d}),define("system/jq.datagrid/datagridrowheader",["hdmain/jq"],function(a){var b=a.proxy;return a.widget("hd.DataGridRowHeader",{_create:function(){a.Widget.prototype._create.apply(this,arguments),a("<div/>").addClass("hd-grid-arrow hd-img").appendTo(this.element),this.label=a("<div/>").addClass("hd-grid-rh-num").appendTo(this.element),this.element.addClass("hd-grid-rh").on("mousedown",b(function(a){if(1==a.which){var b=this.OwningGrid();null!=b&&(null!=this.options.OwningRow&&b.UpdateStateOnMouseLeftButtonDown(a,-1,this.RowIndex())&&a.stopPropagation(),b.options.IsTabStop&&b.element.focus())}},this)),this.option(this.options)},_setOption:function(c,d){switch(a.Widget.prototype._setOption.apply(this,arguments),c){case"Content":d.PropertyChanged.push(b(function(a){switch(a.PropertyName){case"RowNumber":this.label.text(d[a.PropertyName]())}},this))}},OwningGrid:function(){return null==this.options.OwningRow?null:this.options.OwningRow.options.OwningGrid},RowIndex:function(){return null==this.options.OwningRow?-1:this.options.OwningRow.element.index()}}),a.hd.DataGridRowHeader}),define("system/jq.datagrid/datagridcelleventargs",[],function(a){function b(a){this.Cell=a}return this.DEBUG===a&&(this.DEBUG=HOTDOC$.DEBUG),b}),define("system/jq.datagrid/datagridcell",["system/contentcontrol","hdmain/jq"],function(a,b){function c(a){null!=this.options.OwningRow&&this.OwningGrid().UpdateStateOnMouseLeftButtonDown(a,this.ColumnIndex(),this.RowIndex())&&a.stopPropagation()}return b.widget("hd.DataGridCell",a,{_create:function(){a.prototype._create.apply(this,arguments),this.element.addClass("hd-grid-cell hd-grid-line").on("mousedown",b.proxy(c,this))},ColumnIndex:function(){var a=this.options;return null==a.OwningColumn?-1:a.OwningColumn.Index},OwningGrid:function(){var a=this.options;return null!=a.OwningRow&&null!=a.OwningRow.options.OwningGrid?a.OwningRow.options.OwningGrid:null!=a.OwningColumn?a.OwningColumn.OwningGrid:null},RowIndex:function(){var a=this.options;return null==a.OwningRow?-1:a.OwningRow.element.index()}}),b.hd.DataGridCell}),define("system/jq.datagrid/datagridcellcollection",["system/jq.datagrid/datagridcelleventargs","hdmain/system","system/jq.datagrid/datagridcell"],function(a,b,c,d){function e(a,b,c){this._owningRow=a,this._cells=[],this.CellAdded=b,this.CellRemoved=c}var f=HOTDOC$;return this.DEBUG===d&&(this.DEBUG=f.DEBUG),b.ExtendClass(e,null,{IndexOf:function(a){return this._cells.indexOf(a)},Insert:function(b,c){c.DataGridCell({OwningRow:this._owningRow}),this._cells.splice(b,0,c),null!=this.CellAdded&&this.CellAdded(this,new a(c))},RemoveAt:function(b){var c=this._cells[b];this._cells.splice(b,1),c.DataGridCell({OwningRow:null}),null!=this.CellRemoved&&this.CellRemoved(this,new a(c))},get:function(a){return this._cells[a]},Clear:function(){this._cells=[]},Contains:function(a){return this._cells.indexOf(a)>-1},Count:function(){return this._cells.length},IsReadOnly:function(){return!1},Remove:function(a){var b,c=-1,d=this._cells.length;for(b=0;d>b;++b)if(this._cells[b]==a){c=b;break}return-1==c?!1:(this.RemoveAt(c),!0)}}),e}),define("system/jq.datagrid/datagridrow",["hdmain/jq","system/jq.datagrid/datagridrowheader","system/jq.datagrid/datagridcellcollection"],function(a,b,c){function d(a,b){null!=this._cellsElement&&b.Cell.appendTo(this._cellsElement)}function e(a,b){null!=this._cellsElement&&this._cellsElement.Children.Remove(b.Cell)}function f(a){null!=this.options.OwningGrid&&this.options.OwningGrid.UpdateStateOnMouseLeftButtonDown(a,-1,this.element.index())&&a.stopPropagation()}var g=a.proxy,h=a.Widget.prototype,i="DataGridRowHeader";return a.widget("hd.DataGridRow",{_create:function(){h._create.apply(this,arguments);var b=this.options;this.element.addClass("hd-grid-row").on("mousedown",g(f,this)),b.Cells=new c(this,g(d,this),g(e,this)),this._headerElement=a("<div/>").prependTo(this.element)[i]({OwningRow:this}),this._cellsElement=a("<div/>").addClass("hd-grid-row-cells").appendTo(this.element),this.option(b)},_setOption:function(a,b){switch(h._setOption.apply(this,arguments),a){case"Header":null!=this._headerElement&&this._headerElement[i]({Content:b});break;case"HeaderStyle":null!=b&&null!=this._headerElement&&this._headerElement[i]("option","Style")!=b&&this._headerElement[i]({Style:b})}}}),a.hd.DataGridRow}),define("system/jq.datagrid/datagrid",["hdmain/jq","hdmain/system","system/control","system/jq.datagrid/datagridtemplatecolumn","system/jq.datagrid/datagridboundcolumn","system/jq.datagrid/datagridbeginningediteventargs","system/jq.datagrid/datagridpreparingcellforediteventargs","system/jq.datagrid/datagridroweventargs","system/jq.datagrid/datagridcellcoordinates","system/jq.datagrid/datagriddataconnection","system/jq.datagrid/datagridlength","system/jq.datagrid/datagridselecteditemscollection","system/jq.datagrid/datagridcolumncollection","system/jq.datagrid/datagridrow","system/jq.datagrid/datagridcell"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){var a,b,c=this.options,d=c.Columns;for(c.RowWidth=this.element.find(".hd-grid-left").outerWidth(),a=0;a<d.ItemsInternal.length;a++)b=d.ItemsInternal[a],b.Visibility()==U.Visible&&(c.RowWidth+=b.ActualWidth()+2);this.InvalidateColumnHeadersMeasure(),this.InvalidateRowsMeasure()}function r(a,b){return null==this._editingRow?!0:(a&&(this.DataConnection.EndEdit(this._editingRow[O]("option","DataContext")),b||this.DataConnection.BeginEdit(this._editingRow[O]("option","DataContext"))),b&&(this._editingRow=null),!0)}function s(a){return a>=this.ColumnsItemsInternal().length||0>a}function t(a,b){return s.call(this,a)||u.call(this,b)}function u(a){return a>=this.options.RowCount||-1>a}function v(a,b,c,e,f){var g,h,i,j,k,l,m,n,o=null,p=W(c,d);if(null!=p){if(a||p.CellTemplate!=p.CellEditingTemplate)g=null,b?(g=p.CellEditingTemplate,null==g&&(g=p.CellTemplate)):(g=p.CellTemplate,null==g&&(g=p.CellEditingTemplate)),o=g.LoadContent().attr("tabIndex",1);else if(b)return B.call(this,f.DataGridCell("option","Content")),void 0;if(h=e[O]("option","DataContext").Cells[c.Index],null!=g.Control.Bindings)for(h.PropertyChanged.push(L(function(a){var b,c;for(b=0;b<this.Bindings.length;b++)if(this.Bindings[b].Path==a.PropertyName){c=W(o,Q),null!=c&&c[this.Bindings[b].Property](h[this.Bindings[b].Path]());break}},g.Control)),i=0;i<g.Control.Bindings.length;i++){j=g.Control.Bindings[i];for(var q=0;q<h.PropertyChanged.length;q++)h.PropertyChanged[q]({PropertyName:j.Path});"IsChecked"==j.Property&&o.on("Checked",function(){h[j.Path](!0)}).on("Unchecked",function(){h[j.Path](!1)})}if(l=f.DataGridCell("option","Content"),null!=l){if(n=null,m=W(l,"AnswerDatePicker"),null!=m)null!=h._editControl&&h.SaveAnswer(m.RawText()),n=m.RawText();else if(l.children("input").length>0)n=l.children("input").val();else if(null!=W(l,"MultChoiceComboBox")){var r=l.MultChoiceComboBox("SelectedItem");null!=r&&(n=r.Prompt())}else n=l.val();null!=n&&(null!=W(o,"MultChoiceEditableComboBoxControl")?o.children("input").val(n):o.val(n))}}else k=c,o=c.GenerateElement(f,e[O]("option","DataContext")),null!=o&&null!=k&&null!=k.ElementStyle()&&null==o.Style&&(o.Style=k.ElementStyle());f.DataGridCell({Content:o}),b&&null!=o&&B.call(this,o)}function w(){var b=this.options;b.RowCount>0&&(C.call(this,-1,-1,!1),this.ClearRowSelection(!0),b.DisplayData=[],null!=this._rowsPresenter&&this._rowsPresenter.children().each(function(){var b=a(this);b.Visibility==U.Visible&&this.OnUnloadingRow(new h(b))}),this._rowsPresenter.children().empty()),b.RowCount=0}function x(b){var c,d,e,f,g,i,j,l,m,n,o,p,q,r,s,t=this.options,u=a("#hdMainDiv"),w=a("<div/>")[O]({RowHeaderStyle:t.RowHeaderStyle,OwningGrid:this,DataContext:this.DataConnection.GetDataItem(b)});if(f=w[O]("option","Cells").Count(),this.ColumnsItemsInternal().length>f)for(g=f;g<this.ColumnsItemsInternal().length;g++)j=this.ColumnsItemsInternal()[g],r=a("<div/>").DataGridCell(),v.call(this,!0,!1,j,w,r),null!=w[O]("option","OwningGrid")&&r.DataGridCell({OwningColumn:j,Visibility:j.Visibility()}),w[O]("option","Cells").Insert(j.Index,r);for(t.LoadingOrUnloadingRow=!0,this.element.trigger("LoadingRow",new h(w)),t.LoadingOrUnloadingRow=!1,c=w[O]("option","DataContext"),d=0;d<w[O]("option","Cells").Count();d++)try{if(i=w[O]("option","Cells").get(d),j=i.DataGridCell("option","OwningColumn"),l=W(i.DataGridCell("option","Content"),Q),s="function"==typeof j.Binding,s&&(m=j.Binding().Path,c.a[m]))for(e in l.options.Bindings)l._setOption(e,j.Binding().Converter.Convert(c.a[m]));(j.Width().IsAuto()||s)&&(p=j._headerCell.clone().appendTo(u),q=i.clone().hide().appendTo(u).css("width","auto"),q.children().css({display:"block",height:"auto",width:"auto"}),n=o=Math.max(j.Width().Value,p.width()),o=Math.max(o,q.outerWidth()),(o>n||1==j.Width().Value)&&(s?j.Width(new k(o)):j._headerCell.width(o)),p.remove(),q.remove()),i.width(j._headerCell.outerWidth())}catch(x){}return w}function y(a,b,c){try{if(!C.call(this,a,b))return!1;if(t.call(this,a,b))return!1;if(!this.GetRowSelection(b))if(c)F.call(this,b,!0),this._selectionChanged=!0;else{if(1==this.options.SelectedItems.Count()){var d=this.DataConnection.IndexOf(this.SelectedItem);if(d!=b)return!0}F.call(this,b,!0),this._selectionChanged=!0}}catch(e){}return!0}function z(a){return this.DataConnection.BeginEdit(a[O]("option","DataContext"))?(this._editingRow=a,!0):!1}function A(a){if(-1==this[M]()||!this.GetRowSelection(this.CurrentRowIndex()))return!1;var b,c,d,e=this.options;return-1!=e.EditingColumnIndex?!0:(b=this._editingRow,null==b&&(b=e.DisplayData[this.CurrentRowIndex()]),c=b[O]("option","Cells").get(this[M]()),d=new f(this.CurrentColumn(),b,a),this.element.trigger("BeginningEdit",d),d.Cancel?!1:null!=this._editingRow||z.call(this,b)?(e.EditingColumnIndex=this[M](),this._editingEventArgs=a,v.call(this,!1,!0,this.CurrentColumn(),b,c),!0):!1)}function B(a){if(-1!=this.options.EditingColumnIndex&&-1!=this[M]()&&this._editingRow[O]("option","Cells").get(this[M]()).children()[0]==a[0]){0==a.closest(".hd-grid-cell").prev().length&&this._rowsPresenter.scrollLeft(0),window.setTimeout(function(){a.focus()});var b=this.CurrentColumn();this.OnPreparingCellForEdit(new g(b,this._editingRow,this._editingEventArgs,a))}}function C(a,b,c){var d,e,f,g=this.options;if(c===p&&(c=!0),a==this[M]()&&b==this.CurrentRowIndex())return!0;if(e=null,f=new i(g.CurrentCellCoordinates),this[M]()>-1){if(!this._tmpReset&&(d=this.ContainsFocus,c)){if(!this.EndCellEdit(!0,!0,d))return!1;if(-1!=a&&-1!=b&&t.call(this,a,b)||t.call(this,f.C,f.R))return!1;if(f.R!=b&&!r.call(this,!0,!0))return!1}t.call(this,f.C,f.R)||(e=g.DisplayData[f.R])}return this[M](a),this.CurrentRowIndex(b),this._tmpReset&&-1!=a&&(this._tmpReset=!1),!this._tmpReset&&-1!=g.EditingColumnIndex&&(g.EditingColumnIndex=a),this.element.trigger("CurrentCellChanged"),!0}function D(a,b){var c,d=this.options,e=Math.max(0,a),f=Math.min(d.DisplayData.length-1,b);if(e>=0)for(c=e;f>=c;c++)d.DisplayData[c].toggleClass("hd-grid-row-alt",c%2==0)}function E(a,b){null!=this._rowsPresenter&&(b[O]("option","IsRecycled")?b[O]({Visibility:U.Visible}):this._rowsPresenter.children().length>=a+1?b.insertBefore(this._rowsPresenter.children().eq(a)):b.appendTo(this._rowsPresenter)),this.options.DisplayData.splice(a,0,b)}function F(a,b){var c,d=this.options;d.SelectedItems.SelectRow(a,b),c=d.DisplayData[a],c.addClass("hd-grid-selected").siblings().removeClass("hd-grid-selected")}function G(b){var c,e,f,g,h=this.options;for(this.ContainsFocus||(this._focusedRow=null,this.ContainsFocus=!0,c=a(b.target),c.length>0&&c[0]!=this.element[0]&&(e=this.GetOwningCell(c),null!=e&&e.options.OwningColumn instanceof d&&(this._editingTemplateControl=c)),D.call(this,0,h.DisplayData.length-1)),f=null,g=b.OriginalSource;null!=g;){if(f=g,null!=f&&f.OwningGrid==this){this._focusedRow=f;break}g=VisualTreeHelper.GetParent(g)}}function H(){this.ContainsFocus&&(this.ContainsFocus=!1,D.call(this,0,this.options.DisplayData.length-1))}function I(b){var c=a(b.target),d=this.options,e=currentColumn=this.CurrentColumn(),f=currentRowIndex=d.CurrentCellCoordinates.R,g="text"==b.target.type?c.caret():null;switch(b.which){case 37:(null==g||0==g.start)&&(e=d.Columns.GetPreviousVisibleColumn(currentColumn));break;case 39:(null==g||g.end==c.val().length)&&(e=d.Columns.GetNextVisibleColumn(currentColumn));break;case 38:(null!=g||"checkbox"==b.target.type||d.IsReadOnly)&&currentRowIndex>0&&f--;break;case 40:(null!=g||d.IsReadOnly)&&currentRowIndex<d.RowCount-1&&f++}null!=e&&e!=currentColumn&&(d.DisplayData[currentRowIndex][O]("option","DataContext").SetCurrentCell(e.Index,!0,null),b.preventDefault()),f!=currentRowIndex&&(this.UpdateStateOnMouseLeftButtonDown(b,currentColumn?currentColumn.Index:-1,f),b.preventDefault())}function J(){var b=a("<div/>").css({display:"hidden",overflow:"scroll"}).appendTo(document.body),c=b[0].offsetHeight-b[0].clientHeight;return b.remove(),c}var K=HOTDOC$;this.DEBUG===p&&(this.DEBUG=K.DEBUG);var L=a.proxy,M="CurrentColumnIndex",N="DataGrid",O=N+"Row",P="hd-grid",Q="FrameworkElement",R="AddedSelectedItems",S="RemovedSelectedItems",T="CommitFailedCannotCompleteOperation",U=b.Windows.Visibility,V=b.Windows.Controls.DataGridEditingUnit,W=b.Cast,X=J();return a.widget("hd.DataGrid",c,{options:{IsReadOnly:!1,RowCount:0,SelectedIndex:-1,AnchorRowIndex:-1,VerticalScrollBarVisibility:"auto",RowWidth:0,EditingColumnIndex:-1,MaxColumnWidth:1/0,MinColumnWidth:20},_create:function(){a.hd.Control.prototype._create.apply(this,arguments);var b,c=this.options;this.element.attr("tabIndex",1).addClass(P).on("GotFocus",L(G,this)).on("LostFocus",L(H,this)).on("keydown",L(I,this)).on("LayoutUpdated",L(q,this)),this.DataConnection=new j(this),this.option({DisplayData:[],AddedSelectedItems:[],RemovedSelectedItems:[],Columns:new m(this),CurrentCellCoordinates:new i(-1,-1)}),b=a("<table/>").appendTo(this.element),a("<colgroup><col></col><col></col></colgroup>").appendTo(b),a('<tr class="hd-grid-header hd-grid-line"><td class="hd-grid-left hd-grid-line"/><td class="hd-grid-right"/></tr>').appendTo(b),a('<tr class="hd-grid-body"><td colspan="2"><div style="position:relative; overflow:hidden;"/></td></tr>').appendTo(b),this.chp=a("<div/>").appendTo(b.find(".hd-grid-header > .hd-grid-right")),this._rowsPresenter=a('<div style="overflow:scroll;"/>').appendTo(b.find(".hd-grid-body").children("td").children("div")).on("scroll",L(function(b){var c=a(b.target).scrollLeft();this.chp.css("left",-c),this.rowHdrs.css("left",c)},this)),this.option({ColumnWidth:k.Auto(),SelectedItems:new l(this)}),this.option(c)},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments);var d,e,f,g=this.options;switch(b){case"ItemsSource":this.DataConnection.UnWireEvents(this.DataConnection.DataSource),this.DataConnection.DataSource=c,null!=c&&this.DataConnection.WireEvents(c),w.call(this),this.RefreshRows();break;case"Height":this._rowsPresenter.height(c+X),q.call(this);break;case"SelectedItem":if(e=null==c?-1:this.DataConnection.IndexOf(c),-1==e){if(!this.CommitEdit(V.Row,!0))throw T;this.ClearRowSelection(!0)}else{if(g.SelectedIndex=e,e!=this.CurrentRowIndex()){if(!this.CommitEdit(V.Row,!0))throw T;if(u.call(this,e))return}try{if(this.ClearRowSelection(e,!0),d=this[M](),-1==d&&(d=null==g.Columns.FirstVisibleColumn()?-1:g.Columns.FirstVisibleColumn().Index),-1==d||u.call(this,e))return;C.call(this,d,e)}catch(h){}}break;case"VerticalScrollBarVisibility":this._rowsPresenter.css({"overflow-y":c});break;case"ColumnWidth":q.call(this);break;case"IsReadOnly":if(c&&!this.CommitEdit(V.Row,!0))throw T;break;case"SelectedIndex":f=c,this._setOption("SelectedItem",0>f?null:this.DataConnection.GetDataItem(f))}},CurrentColumn:function(a){var b,c,d=this.options;if(a===p)return-1==this[M]()?null:d.Columns.get(this[M]());if(b=a,this.CurrentColumn()!=b){if(c=-1!=d.EditingColumnIndex,!this.EndCellEdit(!0,!0,this.ContainsFocus))throw T;C.call(this,b.Index,this.CurrentRowIndex()),c&&-1==d.EditingColumnIndex&&-1!=this.CurrentRowIndex()&&-1!=this[M]()&&this[M]()==b.Index&&b.OwningGrid==this&&A.call(this)}},ColumnsItemsInternal:function(){return this.options.Columns.ItemsInternal},CurrentColumnIndex:function(a){var b=this.options;return a===p?b.CurrentCellCoordinates.C:(b.CurrentCellCoordinates.C=a,void 0)},CurrentRowIndex:function(a){var b=this.options;return a===p?b.CurrentCellCoordinates.R:(b.CurrentCellCoordinates.R=a,a>=0?b.SelectedItem=this.DataConnection.GetDataItem(a):this._editingRow=null,void 0)},BeginEdit:function(a){return a===p&&(a=null),-1!=this[M]()&&this.GetRowSelection(this.CurrentRowIndex())?A.call(this,a):!1},CommitEdit:function(a,b){return this.EndCellEdit(!0,b,this.ContainsFocus)?a==V.Row?r.call(this,!0,b):!0:!1},OnPreparingCellForEdit:function(a){b.CallAsync(L(function(){this.element.trigger("PreparingCellForEdit",a)},this))},OnSelectionChanged:function(a){var b=null,c=-1,d=this.options;d.SelectedItems.Count()>0&&(b=d.SelectedItems.get(0)),d.SelectedItem=b,null!=b&&(c=this.DataConnection.IndexOf(b)),d.SelectedIndex=c,this._selectionChanged=!1,this.element.trigger("SelectionChanged",a)},OnUnloadingRow:function(a){var b=this.options;b.LoadingOrUnloadingRow=!0,this.element.trigger("UnloadingRow",a),b.LoadingOrUnloadingRow=!1},GetOwningCell:function(a){for(var b=W(a,"DataGridCell");null!=a&&a.length>0&&null==b;)a=a.parent(),b=W(a,"DataGridCell");return b},OnAddedSelectedItem:function(a){var b,c,d=this.DataConnection.GetDataItem(a),e=this.options;if(e[S].indexOf(d)>-1){for(b=[],c=0;c<e[S].length;c++)e[S][c]!=d&&b.push(e[S][c]);e[S]=b}else!e.SelectedItems.Contains(a)&&!e[R].indexOf(d)>-1&&e[R].push(d)},OnRemovedSelectedItem:function(a){var b,c,d=arguments.length>1?arguments[1]:this.DataConnection.GetDataItem(a),e=this.options;if(e[R].indexOf(d)>-1){for(b=[],c=0;c<e[R].length;c++)e[R][c]!=d&&b.push(e[R][c]);e[R]=b}else e.SelectedItems.Contains(a)&&!e[S].indexOf(d)>-1&&e[S].push(d)},ScrollIntoView:function(){},UpdateStateOnMouseLeftButtonDown:function(a,b,c){var d,e,f,g=this.options;if(e=-1!=g.EditingColumnIndex,this.CurrentRowIndex()!=c&&!this.CommitEdit(V.Row,!0))return!0;if(u.call(this,c))return!0;try{if(this.ClearRowSelection(c,!0),u.call(this,c)||-1!=b&&s.call(this,b))return!0;d=!g.IsReadOnly&&this.CurrentRowIndex()==c&&-1!=b&&(e||this[M]()==b),(this.CurrentRowIndex()!=c||this[M]()!=b&&-1!=b)&&(-1==b&&(-1!=this[M]()?b=this[M]():(f=g.Columns.FirstVisibleColumn(),null!=f&&(b=f.Index))),-1!=b&&C.call(this,b,c))}catch(h){}return d&&A.call(this,a),!0},InvalidateColumnHeadersMeasure:function(){var a=this.options.RowWidth;null!=this.chp&&this.chp.width(a)},InvalidateRowsMeasure:function(){if(null!=this._rowsPresenter){var b,c,d,e,f=this._rowsPresenter.parents(".hd-grid-body").children("td").outerWidth(),g=Math.max(this.options.RowWidth,f);this._rowsPresenter.children().each(function(){b=a(this),b.width(g),c=b.find(".hd-grid-cell"),c.each(function(){d=a(this),e=d.DataGridCell("option","OwningColumn").Width().Value,d.width(e)})})}},EndCellEdit:function(a,b){var c,d,f,g=this.options;if(-1==g.EditingColumnIndex||null==this._editingRow)return!0;if(c=this.CurrentRowIndex(),d=this[M](),c!=this.CurrentRowIndex()||d!=this[M]())return!0;if(b&&(g.EditingColumnIndex=-1,this._editingTemplateControl=null,this._setOption("IsTabStop",!0)),b||a){if(null==this._editingRow&&!1,f=this._editingRow[O]("option","Cells").get(this[M]()),null!=f){var h=W(f.find(".hd-input-mc.active"),"EditableComboBox");null!=h&&h._togglelist()}this.CurrentColumn()instanceof e||v.call(this,!1,!b,this.CurrentColumn(),this._editingRow,f)}return!0},OnColumnCollectionChanged_PreNotification:function(a){a&&1==this.ColumnsItemsInternal().length&&this.RefreshRows()},OnColumnWidthChanged:function(a){a._headerCell.width(a.Width().Value),a.Visibility()==U.Visible&&q.call(this)},OnInsertedColumn_PostNotification:function(a){-1!=a.C&&y.call(this,a.C,a.R,1==this.options.Columns.VisibleColumnCount())},OnInsertedColumn_PreNotification:function(a){(-1==a.DisplayIndex()||a.DisplayIndex()>=this.ColumnsItemsInternal().length)&&(a._displayIndex=a.Index),null!=this.chp&&(a.HeaderCell()[a.Visibility()==U.Visible?"show":"hide"](),a.HeaderCell().attr("Tag",a.DisplayIndex()).appendTo(this.chp),b.CallAsync(L(function(){this.options.ColumnHeaderLoaded&&this.options.ColumnHeaderLoaded(a.HeaderCell())},this))),a.Visibility()==U.Visible&&q.call(this)},OnInsertingColumn:function(a){var b;if(-1!=this.CurrentColumnIndex()){if(b=new i(a<=this.CurrentColumnIndex()?this.CurrentColumnIndex()+1:this.CurrentColumnIndex(),this.CurrentRowIndex()),-1!=this[M]()&&!C.call(this,-1,-1))throw T}else b=new i(-1,-1);return b},ClearRowSelection:function(a,b){var c,d,e,f,g,h=this.options;if(b===p){if(c=a,c&&(h.AnchorRowIndex=-1),h.SelectedItems.Count()>0)try{for(d=0;d<=h.DisplayData.length-1;d++)h.SelectedItems.Contains(d)&&F.call(this,d,!1);h.SelectedItems.ClearRows(),this._selectionChanged=!0}catch(i){}}else try{if(e=!1,h.SelectedItems.Count()>0){for(d=0;d<=h.DisplayData.length-1;d++)a!=d&&h.SelectedItems.Contains(d)&&(F.call(this,d,!1),this._selectionChanged=!0);e=h.SelectedItems.Contains(a),f=h.SelectedItems.Count(),f>0&&(f>1?this._selectionChanged=!0:(g=h.SelectedItems.GetIndexes()[0],g!=a&&(this._selectionChanged=!0)),h.SelectedItems.ClearRows())}e?(h.SelectedItems.SelectRow(a,!0),b&&(h.AnchorRowIndex=a)):this.SetRowSelection(a,!0,b)}catch(i){}},GetRowFromItem:function(a){var b=this.DataConnection.IndexOf(a);return 0>b?null:this.options.DisplayData[b]},GetRowSelection:function(a){return this.options.SelectedItems.Contains(a)},RefreshRows:function(){if(w.call(this),null!=this.DataConnection&&this.ColumnsItemsInternal().length>0)for(var a,b=this.DataConnection.Count(),c=0;b>c;)a=x.call(this,c),E.call(this,c,a,!0),this.options.RowCount++,this.OnRowsChanged(!0),c++},RemoveRowAt:function(a,b){var c=this.OnRemovingRow(a,b);this.options.RowCount--,this.OnRemovedRow(a,c),this.OnRowsChanged(!1)},SetRowSelection:function(a,b,c){var d,e=this.options;try{b&&e.SelectedItems.Count()>0&&(d=e.SelectedItems.GetIndexes()[0],d!=a&&(F.call(this,d,!1),this._selectionChanged=!0)),e.SelectedItems.Contains(a)!=b&&(F.call(this,a,b),this._selectionChanged=!0),c&&(e.AnchorRowIndex=a)}catch(f){}},InsertRow:function(a){var b,c={v:new i(-1,-1)},d=this.options;-1!=this.CurrentRowIndex()&&a<=this.CurrentRowIndex()?(c.v=new i(this.CurrentColumnIndex(),this.CurrentRowIndex()+1),this._tmpReset=!0,C.call(this,-1,-1)):c.v=new i(-1,-1),d.SelectedItems.InsertIndexes(a,1),a<=d.SelectedIndex&&(d.SelectedIndex+=1),b=x.call(this,a),b[O]({OwningGrid:this}),E.call(this,a,b,!0),d.RowCount++,-1!=c.v.R&&y.call(this,c.v.C,c.v.R,1==d.RowCount),D.call(this,a,a),this.OnRowsChanged(!0)},OnRemovedRow:function(a,b){var c=null,d=this.options;a<=d.DisplayData.length-1&&a>=0&&(c=d.DisplayData[a],this.OnUnloadingRow(new h(c)),c.detach(),d.DisplayData.splice(a,1)),-1!=b.R&&y.call(this,b.C,b.R,!1),this._selectionChanged&&(this.OnSelectionChanged({A:d[R],R:d[S]}),d[R]=[],d[S]=[])},OnRemovingRow:function(a,b){var c,d,e,f,g=this.options;return this._tmpReset=!1,c=new i(-1,-1),-1!=this.CurrentRowIndex()&&a<=this.CurrentRowIndex()&&(a==this.CurrentRowIndex()?(e=a-1,f=a==g.RowCount-1?-1:a+1,d=f>-1?f-1:e):d=this.CurrentRowIndex()-1,c=new i(this.CurrentColumnIndex(),d),a==this.CurrentRowIndex()?C.call(this,-1,-1,!1):(this._tmpReset=!0,C.call(this,-1,-1))),g.SelectedItems.Contains(a)&&(this._selectionChanged=!0),g.SelectedItems.Delete(a,b),a<g.SelectedIndex&&(g.SelectedIndex=g.SelectedIndex-1),c},OnRowsChanged:function(){var a=this.rowHdrs=this.element.find(".hd-grid-rh"),b=25+10*(a.length+"").length;a.outerWidth(b).css({"float":"left"}),this.element.find("col").eq(0).width(b-1),this.element.find(".hd-grid-row-cells").css({"margin-left":b,width:"auto"}),q.call(this)}}),a.hd.DataGrid}),define("dialog/stringformatter",["hdmain/system"],function(a){function b(a,b){this._text=a,this._textWrapping=b}return a.ExtendClass(b,null,{PreParse:function(){},PostParse:function(){},WriteText:function(a,b){this._text.Append(b)},WriteLineBreak:function(){this._text.Append(this._textWrapping==a.Windows.TextWrapping.NoWrap?" ":"\n")},WriteWebLink:function(a,b,c){this._text.Append(c)}}),b}),define("engine/stringparsersource",["hdmain/system"],function(a){function b(a){this._text=a}return a.ExtendClass(b,null,{SourceString:function(){return this._text}}),b}),define("runtime/numbervalidationresult",[],{Valid:0,ErrorNotANumber:1,ErrorTooBig:2,ErrorTooSmall:3,ErrorOutOfRange:4}),define("engine/datasourceloadresult",[],function(){function a(a,b,c){this.Nodes=a,this.Rows=b,this.Error=c}return a}),define("system/exception/invalidoperationexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("engine/formattingcontext",[],{PlainText:0,OutlineText:1,RichText:2}),define("engine/interviewnodeoutlinefontflags",[],{None:0,Bold:1,Italic:2,Underline:4}),define("system/exception/notimplementedexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),e.NotImplementedException=d,d}),define("engine/dotcode",["system/exception/notimplementedexception","engine/formattingcontext","engine/interviewnodeoutlinefontflags"],function(a,b,c){function d(a,d,e){return a?a.indexOf("«")<0?a:(d==b.PlainText?a=g.PreProcessForPlainText(a):d==b.OutlineText&&(e.val=c.None,a=g.PreProcessForOutlineText(a,e)),a):""}function e(b,d,e){if(e=c.None,b.indexOf("«")<0)return b;throw new a}function f(a,b){a=a.replace(/««/gi,"{{FQ}}");for(var d,e=0,f=0,g=0,h=/«\s*\.(\w{1,2})\b\s*([^»]*)»/g,i=h.exec(a);null!=i;){if(3==i.length){switch(d=!0,i[1].toLowerCase()){case"b":e++;break;case"be":e--;break;case"i":f++;break;case"ie":f--;break;case"u":g++;break;case"ue":g--;break;case"f":break;case"fe":break;case"h":break;case"he":break;case"s":break;case"se":break;case"w":break;case"we":break;case"x":break;case"xe":break;case"z":break;case"ze":break;default:d=!1}d&&(a=a.substr(0,i.index)+a.substr(i.index+i[0].length),h.lastIndex=i.index)}i=h.exec(a)}return b&&(b.val=c.None,e>0&&(b.val|=c.Bold),f>0&&(b.val|=c.Italic),g>0&&(b.val|=c.Underline)),a=a.replace(/{{FQ}}/gi,"«")}var g={DefaultProcessor:d,HTMLProcessor:e,PreProcessForPlainText:function(a){return f(a)},PreProcessForOutlineText:function(a,b){return f(a,b)}};return g}),define("engine/interviewnodetype",[],{Root:0,Dialog:1,DefaultDialog:2,Repeat:3,Iteration:4}),define("system/exception/ArgumentNullException",["hdmain/system","system/exception/argumentexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("engine/answeredstatus",[],{Unanswered:0,PartiallyAnswered:1,Answered:2}),define("engine/answeredstatustabulator",["hdmain/system","./answeredstatus"],function(a,b){function c(){this._flags=0,this._explicitlyAnswered=0,this._implicitlyAnswered=0,this._unanswered=0}function d(a,b){a._explicitlyAnswered+=b._explicitlyAnswered,a._implicitlyAnswered+=b._implicitlyAnswered,a._flags|=b._flags&(e.O|e.I),b._unanswered>0&&(a._unanswered+=b._unanswered,b.IsUnansweredRequired()&&(a._flags|=e.D))}var e={N:0,O:1,I:2,R:4,D:8,E:16,DE:32};return a.ExtendClass(c,null,{Reset:function(){this._flags=0,this._explicitlyAnswered=this._implicitlyAnswered=this._unanswered=0},IncAnswered:function(a,b,c){a||b?c?this._implicitlyAnswered++:this._explicitlyAnswered++:this._flags|=c?e.I:e.O},IncUnanswered:function(a,b){(a||b)&&(this._unanswered++,b&&(this._flags|=e.R))},SetError:function(){this._flags|=e.E},ClearRequired:function(){this._flags&=~e.R},ClearError:function(){this._flags&=~e.E},IsAnswered:function(){return this._explicitlyAnswered>0||0!=(this._flags&e.O)},Status:function(){return 0==this._unanswered?b.Answered:this._explicitlyAnswered>0||this._implicitlyAnswered>0||0!=(this._flags&(e.O|e.I))?b.PartiallyAnswered:b.Unanswered},IsAllAnswered:function(){return 0==this._unanswered},IsUnansweredRequired:function(){return 0!=(this._flags&(e.R|e.D))},IsThisUnansweredRequired:function(){return 0!=(this._flags&e.R)},IsHasErrorText:function(){return 0!=(this._flags&(e.E|e.DE))},IsThisHasErrorText:function(){return 0!=(this._flags&e.E)},UnansweredCount:function(){return this._unanswered},AnsweredCount:function(){return this._explicitlyAnswered+this._implicitlyAnswered},TotalCount:function(){return this.AnsweredCount()+this.UnansweredCount()}},{Aggregate:d}),c}),define("engine/interviewnodelist",["hdmain/system","engine/interviewnodetype","engine/dialogupdateflags"],function(a,b,c,d){function e(a){this._list=[],this._parent=a,this._updatedCount=0}var f=HOTDOC$;return this.DEBUG===d&&(this.DEBUG=f.DEBUG),a.ExtendClass(e,null,{FindExisting:function(a,b,c,d){for(var e=null,f=this._updatedCount;f<this._list.length&&(this._list[f].Variable().name!=a||this._list[f].Owner()!=c||this._list[f].TemplateOfOrigin()!=d);)f++;return f<this._list.length&&(e=this._list[f],!1),e},PrepareToUpdate:function(a){"number"==typeof a?this._updatedCount=a:(this._updatedCount=f.jq.inArray(a,this._list),!1)},FinishUpdating:function(){this._updatedCount=this._list.length},IndexOf:function(a,b,c){if("object"==typeof a){if(b)return this._list.IndexOf(a,b,c);for(var d=0;d<this._list.length;d++)if(this._list[d]==a)return d}else if("string"==typeof a)for(d=0;d<this._list.length;d++)if(this._list[d].Variable().name==a)return d;return-1},IndexOfID:function(a){var b,c=Count;for(b=0;c>b;b++)if(this._list[b]._id==a)return b;return-1},get:function(a){return"number"==typeof a?this._list[a]:(a=this.IndexOf(a),a>=0?this._list[a]:null)},Add:function(a){(this._updatedCount==this.Count()||this.get(this._updatedCount)!=a)&&(this._list.splice(this._updatedCount,0,a),a.SetUpdateFlags(c.NewlyAdded|c.ScriptAnswer),a.NotifyParentOfChildCountChange(!1)),this._parent.Type()==b.Root?this._updatedCount>0&&!this._list[this._updatedCount-1].Enabled()&&a.Enabled(!1):this._parent.Enabled()||a.Enabled(!1),this._updatedCount++,a.SendUpdateFlagsUpstream(c.All,!1)},Insert:function(a,d){var e;if(this._list.splice(a,0,d),this._parent.Type()==b.Repeat)for(e=a+1;e<this._list.length;e++)this._list[e].OffsetIndex(1,d.Indices().length-1);d.SetUpdateFlags(c.NewlyAdded),d.NotifyParentOfChildCountChange(!1),this._updatedCount++,d.SendUpdateFlagsUpstream(c.All,!1)},Move:function(a,c){var d=this._list[a];if(this._list.splice(a,1),this._list.splice(c,0,d),d.NotifyParentOfChildCountChange(!1),this._parent.Type()==b.Repeat){this._list[c].OffsetIndex(c-a,d.Indices().length-1);for(var e=c>a?-1:1,f=c+e;f!=a+e;f+=e)this._list[f].OffsetIndex(e,d.Indices().length-1)}},Remove:function(a){if(null==a)return!1;var b=this.IndexOf(a);return-1==b?!1:(this.RemoveAt(b),!0)},RemoveAt:function(a){var c,d={startIndex:0,endIndex:0},e=this._list[a],f=e.Indices().length-1;for(e.Children().Clear(),e.FindNodesAskedImplicitly(d);d.startIndex<d.endIndex;)this._parent._interview.Root().Children().RemoveAt(d.startIndex),d.endIndex--;if(e.NotifyParentOfChildCountChange(!1),e.Type()!=b.Repeat&&this._parent._interview.UnregisterNode(e),this._list.splice(a,1),this._parent.Type()==b.Repeat)for(c=a;c<this._list.length;c++)this._list[c].OffsetIndex(-1,f);a<this._updatedCount&&this._updatedCount--},RemoveUntil:function(a){for(;this._list[this._updatedCount]!=a;)this.RemoveAt(this._updatedCount)},Trim:function(){for(;this._updatedCount<this._list.length;)this.RemoveAt(this._list.length-1)
},TrimUnanswered:function(){for(;this._updatedCount>0&&!this._list[this._updatedCount-1].AnsStatus().IsAnswered();)this._updatedCount--,this._parent._interview.DecRpt()},Clear:function(){for(;this._list.length>0;)this.RemoveAt(this._list.length-1);this.ClearUpdated()},ClearUpdated:function(){this._updatedCount=0},Contains:function(a){return this.IndexOf(a)>=0},CopyTo:function(a,b){for(var c=0;c<this._list.length;c++)a.splice(b+c,0,this._list[c])},Count:function(){return this._list.length},UpdatedCount:function(){return this._updatedCount},IsReadOnly:function(){return!1},toString:function(){var b=this.Count();return a.String.Format("{0} child{1} of {2}",b.toString(),1==b?"":"ren",this._parent.toString())}}),e}),define("engine/baseinterviewnode",["hdmain/system","system/exception/notimplementedexception","system/exception/ArgumentNullException","engine/answeredstatustabulator","engine/interviewnodetype","engine/dialogupdateflags","require","engine/interviewnodelist"],function(a,b,c,d,e,f,g,h,i){function j(a,b,c){switch(this._interview=a,this._type=b,this._parent=c,this._updateFlags=f.None,this._descendantUpdateFlags=f.None,this._answeredStatus=new d,this._enabled=!0,b){case e.DefaultDialog:this._children=g("engine/defaultdialognode")._emptyChildren();break;case e.Repeat:this._children=new h(this,8);break;default:this._children=new h(this)}}function k(){var a;return a=this.Type()==e.Root?[]:k.call(this._parent),a.push(this),a}function l(b){b.WriteStartElement(a.Enum.GetName(e,this._type))}function m(a){a.WriteEndElement()}var n=HOTDOC$,o=a.Cast,p=a.String.IsNullOrEmpty;return a.ExtendClass(j,null,{DoAnswerSync:function(){this._interview.DoAnswerSync()},InitializeId:function(){this._id=this._interview.GetIdForNode(this)},Enabled:function(a){return a===i?this._enabled:(this._enabled!=a&&(this._enabled=a,this.SetUpdateFlags(f.NodeEnabled)),void 0)},InitUpdate:function(){this._children.ClearUpdated()},GetResourceString:function(a){return n.Lc.GetStr(a)},GetResourceButtonCaption:function(){var a=this._interview.PreferenceCache().ResourceButtonText();return p(a)&&(a=n.Lc.GetStr("rs_bcap")),a},InterviewImageUrl:function(){return this._interview._engine.InterviewImageUrl()},SinglePageMode:function(){return this._interview.IsSinglePage()},UpdateFlags:function(){return this._updateFlags},DescendantUpdateflags:function(){return this._descendantUpdateFlags},SetUpdateFlags:function(a){var b,c;this._updateFlags|=a,this._type==e.Repeat&&(b=a&(f.RepeatAnswer|f.ChildCount|f.NodeChildCount),0!=b&&this.SetDescendantUpdateFlags(b,!1)),c=f.AnswerRelated,this._interview.InRebuild()||(c|=f.NodeChildCount|f.ChildCount,this.SinglePageMode()&&(c|=f.AddButtonRefresh)),0!=(a&c)&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(a&c,!0)},SetUpdateFlagsCascading:function(a){var b,c;for(b=0;b<this._children.Count();b++)c=this._children.get(b),0!=(a&(f.NodeChildCount|f.ChildCount))?c.Children().Count()>0?c.SetUpdateFlagsCascading(a):c.SetUpdateFlagsCascading(a^(f.NodeChildCount|f.ChildCount)):c.SetUpdateFlagsCascading(a);this.SetUpdateFlags(a)},NotifyParentOfChildCountChange:function(a){null!=this._parent&&(this._parent.Type()==e.Repeat&&this._parent.SetUpdateFlags(f.RepeatAnswer),this._parent.SetDescendantUpdateFlags(f.NodeChildCount|f.ChildCount,a))},SendUpdateFlagsUpstream:function(a,b){var c=(this._updateFlags|this._descendantUpdateFlags)&a&~f.NewlyAdded;c!=f.None&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(c,b)},SetDescendantUpdateFlags:function(a,b){this._descendantUpdateFlags|=a,b&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(a,!0)},ClearUpdateFlags:function(a){var b,c=a^f.All,d=this.Children();for(this._updateFlags&=c,this._descendantUpdateFlags&=c,b=0;b<d.Count();b++)d.get(b).ClearUpdateFlags(a)},AnsStatus:function(){return this._answeredStatus},NeedsAnsweredStatusUpdate:function(){return 0!=(this._updateFlags&(f.AnswerRelated|f.Required|f.NodeError))||0!=(this._descendantUpdateFlags&f.StatusRelated)},UpdateAnsweredStatus:function(a){var b=g("engine/interviewnode");if(a||0!=(this._descendantUpdateFlags&(f.AnswerRelated|f.Required|f.NodeError))||0!=((this._updateFlags|this._descendantUpdateFlags)&f.NodeChildCount)||!this.Enabled()&&null==this._interview.RequiredNode()||this.Enabled()&&null!=this._interview.RequiredNode()||0!=(this._updateFlags&f.AnswerRelated)&&this._type==e.Iteration){var c=this._interview;n.jq.each(this.Children()._list,function(b,d){d.UpdateAnsweredStatus(a||null!=c._reqNodeOld&&null==c.RequiredNode()&&c._reqNodeOld.IsDescendantOf(d))})}this.NeedsAnsweredStatusUpdate()&&this.TabulateAnsweredStatus(),this._answeredStatus.IsThisUnansweredRequired()&&null==this._interview.RequiredNode()?(this._interview.SetRequiredNode(o(this,b)),this.Enabled(!0)):(null!=this._interview.RequiredNode()||null!=this._interview._reqNodeOld)&&(this.Enabled(null==this._interview.RequiredNode()||this.ContainsDescendant(this._interview.RequiredNode())),this==this._interview._reqNodeOld&&null==this._interview.RequiredNode()&&this._interview.SetRequiredNode(null)),this._answeredStatus.IsThisHasErrorText()&&null==this._interview.ErrorNode()?(this._interview.SetErrorNode(o(this,b)),this.Enabled(!0)):(null!=this._interview.ErrorNode()||null!=this._interview._errNodeOld)&&(this.Enabled(null==this._interview.ErrorNode()||this.ContainsDescendant(this._interview.ErrorNode())),this==this._interview._errNodeOld&&null==this._interview.ErrorNode()&&this._interview.SetErrorNode(null)),null!=this._parent&&0!=((this._updateFlags|this._descendantUpdateFlags)&f.StatusRelated)&&this.SendUpdateFlagsUpstream(f.StatusRelated,!1)},DoAnsweredStatusTabulation:function(){throw new b},TabulateAnsweredStatus:function(){var a,b=this._answeredStatus.Status(),c=this._answeredStatus.IsUnansweredRequired(),d=this._answeredStatus.TotalCount(),e=this._answeredStatus.AnsweredCount();this.DoAnsweredStatusTabulation(),a=f.None,(b!=this._answeredStatus.Status()||c!=this._answeredStatus.IsUnansweredRequired())&&(a=f.NodeAnsStatus|f.AnsweredStatus),this._interview.WantProgressNotifications()&&(e!=this._answeredStatus.AnsweredCount()||d!=this._answeredStatus.TotalCount())&&(a|=f.Progress),a!=f.None&&this.SetUpdateFlags(a)},IsDescendantOf:function(a){if(null==a)throw new c("ancestor");if(this.Type()==e.Root)return!1;for(var b=this._parent;null!=b;){if(b==a)return!0;b=b._parent}return!1},ContainsDescendant:function(a){return a.IsDescendantOf(this)},OutlineParent:function(){var a=g("engine/interviewnode");return o(this._parent,a)},Type:function(){return this._type},Children:function(){return this._children},OutlineChildren:function(){return this._children._list},OutlineChildrenReverse:function(){var a,b=[];for(a=this._children.Count()-1;a>=0;a--)b.push(this._children.get(a));return b},New:function(){return!1},IsHiddenNew:function(){return!1},UserExtendible:function(){return!0},NewIterationNode:function(){var a=g("engine/iterationnode"),b=this,c=null;do b.Type()==e.Iteration&&b.New()&&(c=o(b,a)),b=b._parent;while(b.Type()!=e.Root);return c},AllNew:function(){for(var a=!1,b=this;b.Type()!=e.Root;){if(b.Type()==e.Iteration){if(!b.New()){a=!1;break}a=!0}b=b._parent}return a},Active:function(){return!0},AvailableForNavigation:function(){return!1},HasVisibleChildren:function(){var a,b=this.OutlineChildren();for(a=0;a<b.length;a++)if(b[a].ShowInOutline())return!0;return!1},OnSinglePage:function(){return this._parent._type==e.Root?!0:!1},HasAncestorOnSinglePage:function(a){var b,c,d=!1,e=g("engine/interviewnode");if(!this.OnSinglePage()){d=!0,b=this;do b=b._parent;while(null!=b&&!b.OnSinglePage());c=o(b,e),null!=c&&(a.v=c._id)}return d},DirtySinglePage:function(){if(this.OnSinglePage()){this.SetUpdateFlags(f.All);var a,b;for(a=0;a<this._children.Count();a++)b=this._children.get(a),b.DirtySinglePage()}},ComesAfter:function(a){if(null==a)return!1;if(this==a)return!1;for(var b,c,d=g("engine/interviewnode"),e=k.call(this),f=k.call(a),h=1,i=Math.min(e.length,f.length);i>h&&e[h]==f[h];)h++;return h==i?!1:(b=e[h-1].Children().IndexOf(o(e[h],d)),c=f[h-1].Children().IndexOf(o(f[h],d)),b>c)},Serialize:function(a){l.call(this,a),this.SerializeAttributes(a),this.SerializeElements(a),m(a)},SerializeAttributes:function(a){this._enabled||a.WriteAttributeString("Enabled",this._enabled.toString()),this._answeredStatus.IsThisUnansweredRequired()?a.WriteAttributeString("Required","true"):this._answeredStatus.IsUnansweredRequired()&&a.WriteAttributeString("Required","child"),this._answeredStatus.IsThisHasErrorText()?a.WriteAttributeString("ErrorText","true"):this._answeredStatus.IsHasErrorText()&&a.WriteAttributeString("ErrorText","child"),a.WriteAttributeString("Status",this._answeredStatus.Status().toString())},SerializeElements:function(a){var b,c;if(null!=this._children&&(b=this._children.Count(),b>0)){for(a.WriteStartElement("Children"),c=0;b>c;c++)this._children.get(c).Serialize(a);a.WriteEndElement()}},toString:function(){return a.String.Format("{0} Node",this.Type().toString())}}),j}),define("engine/interviewnode",["hdmain/jq","runtime/numbervalidationresult","hdmain/system","engine/datasourceloadresult","system/exception","system/exception/invalidoperationexception","engine/formattingcontext","engine/interviewnodeoutlinefontflags","engine/dotcode","engine/interviewnodetype","engine/baseinterviewnode","engine/dialogupdateflags","require"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b,c,d,e){o.baseConstructor.call(this,a,b,c),this._autoHidden=!1,this._active=!0,this.EmptyItemNodes=new q.DialogItemNodeList(0),this._template=a.CurrentTemplate(),this._dialog=d,this._indices=e,this._owner=a.InRebuild()&&a.CurrentBuildNode()!=c?x(a.CurrentBuildNode(),o):null,this._itemNodes=this.EmptyItemNodes,this._focusedItem=-1}function p(){}var q=HOTDOC$;this.DEBUG===n&&(this.DEBUG=q.DEBUG);var r=a.proxy,s="IsSpreadsheetRowInSpreadsheet",t=q.FocusDirection={Forward:0,Reverse:1},u=q.FocusOperation={ReassertOnly:0,AdvanceIfNecessary:1,Advance:2},v=c.String.IsNullOrEmpty,w=c.String.Format,x=c.Cast,y=q.Lc;return c.ExtendClass(o,k,{Variable:function(){return this._dialog},TemplateOfOrigin:function(){return this._template},Indices:function(){return null!=this._indices?this._indices:[]},OutlineChildren:function(){var a,b,c,d=[];for(a=0;a<this._children.Count();a++)if(c=this._children.get(a),c.IsOnParent())for(b=0;b<c.OutlineChildren().length;b++)d.push(c.OutlineChildren()[b]);else d.push(c);return d},OutlineChildrenReverse:function(){var a,b,c,d=[];for(a=this._children.Count()-1;a>=0;a--)if(c=this._children.get(a),c.IsOnParent())for(b=0;b<c.OutlineChildrenReverse().length;b++)d.push(c.OutlineChildrenReverse()[b]);else d.push(c);return d},AskedImplicitly:function(){return null!=this._owner},Owner:function(){return this._owner},IsSpreadsheetRow:function(){return this.Type()==j.Iteration&&"S"==this._dialog.rType},IsSpreadsheetRowInEditMode:function(){return this.IsSpreadsheetRow()&&this._parent.EditRowMode()},IsSpreadsheetRowInSpreadsheet:function(){return this.IsSpreadsheetRow()&&!this._parent.EditRowMode()},IsOnParent:function(){return this._dialog.onPar?this._parent.Type()==j.Root?!1:this._parent.Type()==j.Iteration&&this._parent[s]()?!1:!0:!1},OnSinglePage:function(){return this.IsOnParent()?this._parent.OnSinglePage():o.baseclass.OnSinglePage.call(this)},ClearUpdateFlags:function(a){0!=(a&l.DialogContentRelated)&&this._itemNodes.ClearUpdateFlags(),o.baseclass.ClearUpdateFlags.apply(this,arguments)},SetIndex:function(a){var b,c,d=m("engine/iterationnode");if(!q.RepeatIndices.AreRelated(a,this._indices))for((this._type==j.Iteration&&!this[s]()||this._parent.Type()==j.Iteration&&x(this._parent,d)[s]())&&this.SetUpdateFlags(l.Title|l.NodeTitle),this._indices=q.RepeatIndices.SetBaseIndices(this._indices,a),b=0;b<this._children.Count();b++)c=this._children.get(b),c.SetIndex(a)},OffsetIndex:function(a,b){var c,d=m("engine/iterationnode");for(this._indices[b]+=a,(this._type==j.Iteration&&!this[s]()||this._parent.Type()==j.Iteration&&x(this._parent,d)[s]())&&this.SetUpdateFlags(l.Title|l.NodeTitle),this._interview.OffsetIndicesForId(this._id,a,b),c=0;c<this._children.Count();c++)child=this._children.get(c),child.OffsetIndex(a,b)},GetCaption:function(a,b,c){return c=h.None,this._parent.Type()==j.Iteration&&this._parent[s]()?this._parent.New()?y.GetStr("ui_new")+": "+(v(this._title)?this._dialog.name:b(o.FixAmpersands(this._title,!1),a,c)):q.RepeatIndices.ToPrefixString(this._indices)+(v(this._title)?this._dialog.name:b(o.FixAmpersands(this._title,!1),a,c)):null==this._title||""==this._title?this.Variable().name:b(o.FixAmpersands(this._title,!1),a,c)},New:function(){var a=m("engine/iterationnode");return this._parent.Type()==j.Iteration&&x(this._parent,a)[s]()?this._parent.New():o.baseclass.New.call(this)},IsHiddenNew:function(){var a=m("engine/iterationnode");return this._parent.Type()==j.Iteration&&x(this._parent,a)[s]()?this._parent.IsHiddenNew():o.baseclass.IsHiddenNew.call(this)},RequiredAsterisk:function(){return this._interview._engine.RequiredAsterisk()},RequiredIsEnforcable:function(){if(!this.Active())return!1;if(this._type==j.Iteration){var a=m("engine/iterationnode"),b=x(this,a);if(b.New()&&b.IterationNumber()>0)return!1}return this.AllNew()&&!q.RepeatIndices.IsFirst(this._indices)?!1:this.GetIsPartOfInterview()?!0:!1},GetIsPartOfInterview:function(){var a=!0;return this._parent.Type()!=j.Root&&(a=x(this._parent,o).GetIsPartOfInterview()),a&&(a=this._parent.Children().Contains(this)),a},Caption:function(){var a;return this.GetCaption(g.PlainText,i.DefaultProcessor,a)},GetOutlineCaption:function(a){return this.GetCaption(g.OutlineText,i.DefaultProcessor,a)},Title:function(a){return a===n?this._title:(a!=this._title&&this.SetUpdateFlags(l.Title|l.NodeTitle),this._title=a,void 0)},AutoHidden:function(a){return a===n?this._autoHidden:(this._autoHidden!=a&&(this._autoHidden=a,this.Active(!a)),void 0)},Active:function(a){if(a===n)return this._active;if(this._active!=a&&(this._active=a,this._parent.SetUpdateFlags(l.NodeChildCount|l.ChildCount),!this._active))for(child in this.Children)child.Active(!1)},IsOwnedBy:function(a){if(!this.AskedImplicitly())return!1;if(this._owner==a)return!0;if(this._owner.AskedImplicitly())return this._owner.IsOwnedBy(a);if(this._owner.IsDescendantOf(a))return!0;for(var b=x(this._owner.Parent,o);null!=b&&!b.AskedImplicitly();)b=x(b.Parent,o);return null!=b?b.IsOwnedBy(a):!1},FindNodesAskedImplicitly:function(a){for(var b,c=this;c._parent.Type()!=j.Root;)c=x(c._parent,o);for(b=x(c._parent,q.RootNode),a.endIndex=b.Children().IndexOf(c),a.startIndex=a.endIndex;a.startIndex>0&&b._children.get(a.startIndex-1).AskedImplicitly();)a.startIndex--;for(;a.startIndex<a.endIndex&&!b._children.get(a.startIndex).IsOwnedBy(this);)a.startIndex++;for(;a.endIndex>a.startIndex&&b._children.get(a.endIndex-1).AskedImplicitly()&&!b._children.get(a.endIndex-1).IsOwnedBy(this);)a.endIndex--},GetNodesAskedImplicitly:function(){var a,b={startIndex:0,endIndex:0},c=[];for(this.FindNodesAskedImplicitly(b),a=b.startIndex;a<b.endIndex;a++)c.push(this._interview.Root.Children().get(a));return c},GenerateDefaultTitle:function(){var a,b,c,d=this._dialog,e=null,f=null,g=!1,h=0;for(h=0;h<d.vList.Count();h++){if(e=d.vList.GetItem(h),e instanceof q.Variable){for(a=h+1;a<d.vList.Count();a++)if(d.vList.GetItem(a)instanceof q.Variable){g=!0;break}b=e,f=b.EvTitle(),v(f)&&(f=o.TrimForUseAsTitle(b.EvPrompt()),v(f)&&(f=b.name));break}if("TXL"==e.type){if(c=e,f=o.TrimForUseAsTitle(c.EvText()),!v(f))break}else if("HDL"==e.type&&(c=e,f=c.EvCapt().replace(/^\s+|\s+$/g,""),!v(f)))break}return v(f)?f=y.GetStr("ui_emptydlg"):"NONE"==f&&(f="",g=!1),g&&(f+=y.GetStr("ui_etc")),f},EvTitle:function(){var a=this._dialog.EvTitle();return v(a)&&this._interview.PreferenceCache().GenerateDialogTitles()&&(a=this.GenerateDefaultTitle()),a},EvaluateText:function(){this.Title(this.EvTitle()),this._updateFlags|=this._itemNodes.Update()},ShowInOutline:function(){return this.AutoHidden()?!1:this.Active()&&!this.IsHiddenNew()},AvailableForNavigation:function(){return this.ShowInOutline.call(this)},DoImplicitAnswerProcessing:function(){},ClearGroupedItems:function(a,b,c){if(this._type!=j.Dialog&&this._type!=j.Iteration)throw new f(y.GetStr("err_grptf"));if(""==this._dialog.gType&&!IsSpreadsheetRow)throw new f(y.GetStr("err_grptf_un"));this._interview.BeginBulkAnswerChange();var d,e,g,h=!1;for(d=a;b>=d;d++)e=this._itemNodes.get(d),e!=c&&(g=e.DialogItem(),("TF"==g.type||"DI"==g.type)&&(this._interview._engine.LoadAnswerValue("TF",g.name,!1,x(g,q.Variable).saveAns,this._indices),e.SetUpdateFlags(l.ScriptAnswer),h=!0));if(this._dialog.nota&&(h||a==b)){if(!this._itemNodes.get(b+1).NoneOfTheAbove())throw new f("Failed to find None of the Above item in the expected position.");this._itemNodes.get(b+1).SetUpdateFlags(l.ScriptAnswer)}this._interview.EndBulkAnswerChange(!1)},ClearAnswers:function(a){"boolean"!=typeof a&&(a=!0),this._interview.BeginBulkAnswerChange(),a&&this.DoAnswerSync();var b,c;for(b=0;b<this._itemNodes.Count();b++)c=this._itemNodes.get(b),c.ClearAnswer(!1);this.DoImplicitAnswerProcessing(),this._interview.EndBulkAnswerChange(!0)},VariableHasAnswer:function(a){if(null!=a){var b=this._interview._engine.GetAnswer(a.name);if(b!==n)return b.IsAns(this._indices)}return!1},VariableIsUserModifiable:function(a){var b,c=!1;return null!=a&&(c=!0,b=this._interview._engine.GetAnswer(a.name),null!=b&&(c=b.GetUserModifiable(this._indices),c&&this.Type()==j.Iteration&&this.New()&&!this.UserExtendible()&&(c=!1))),c},GetVariableAnswerDouble:function(a){var b,c=this._interview._engine.GetAnswer(a.name);return null!=c&&(b=c.GetValue(this._indices),null!=b)?b:null},GetVariableAnswerDate:function(a,b){var c,d=this._interview._engine.GetAnswer(a.name);return null!=d&&(c=d.GetValue(this._indices),null!=c)?(b.v=c,!0):!1},GetVariableAnswerList:function(a,b){var c,d=this._interview._engine.GetAnswer(a.name);return d===n&&a.dv&&(d=q.Answers.CreateAnswer("MC",a.name)),null!=d&&(c={v:d.GetValue(this._indices)},null==c.v&&a.dv&&(!this[s]()||0==this._indices[this._indices.length-1])&&(d.SetValue(a.dv,this._indices),c.v=d.GetValue(this._indices)),a.ReconcileOptions(c,this._interview.GetRuntimeOptionsForVariable(a)),null!=c.v)?(b.push.apply(b,c.v),!0):(b=null,!1)},GetVariableAnswerOther:function(a,b){if(a.othr&&!a.MultipleSelect()){var c,d,e=this._interview._engine.GetAnswer(a.name);if(null!=e&&(c=e.GetValue(this._indices),null!=c&&(d=this._interview.GetRuntimeOptionsForVariable(a),!d.Contains(c[0]))))return b=c[0],!0}return b=null,!1},SetVariableAnswerDouble:function(a,c,d){d.v="";var e,f=y.ParseNumber(c);switch(null!=f&&(e=Math.pow(10,a.decPl),f=Math.round(f*e)/e),a.CheckMinMax(f)){case b.Valid:return this._interview._engine.LoadAnswerValue("NU",a.name,f,a.saveAns,this._indices),!0;case b.ErrorNotANumber:d.v=y.GetStr("val_invnum");break;case b.ErrorOutOfRange:d.v=y.GetStr("val_numrng",y.FormatNumberDef(a.min,a.decPl),y.FormatNumberDef(a.max,a.decPl));break;case b.ErrorTooSmall:d.v=y.GetStr("val_numgt",y.FormatNumberDef(a.min,a.decPl));break;case b.ErrorTooBig:d.v=y.GetStr("val_numlt",y.FormatNumberDef(a.max,a.decPl))}return!1},SetVariableAnswerDate:function(a,b){var c=b?new Date(b):null;this._interview._engine.LoadAnswerValue("DA",a.name,c,a.saveAns,this._indices)},SetVariableAnswerList:function(a,b){"string"==typeof b&&(""==b&&(this[s]()||"CO"==a.style||"SL"==a.style)&&(b=null),null!=b&&(b=[b])),this._interview._engine.LoadAnswerValue("MC",a.name,b,a.saveAns,this._indices)},GetItemWidth:function(a){for(var b,c=0,d=1,e=a;e>0&&(1==this._dialog.plcmt[e]||3==this._dialog.plcmt[e]);)e--;for(this._dialog.plcmt[e]>=2&&c++,b=e+1;b<this._dialog.plcmt.length&&(1==this._dialog.plcmt[b]||3==this._dialog.plcmt[b]);)d++,this._dialog.plcmt[b]>=2&&c++,b++;switch(d){case 1:return 100;case 2:return this._dialog.plcmt[a]>=2?67:c>0?33:50;case 3:return 33;default:throw new f("Found more than 3 variables on a single line in the dialog")}},IsItemOnPrevLine:function(a){return 1==this._dialog.plcmt[a]||3==this._dialog.plcmt[a]},GetItemMapName:function(a){var b,c=this._dialog.Mappings[a];return c!==n&&null!=c?c.n:(b=x(this._itemNodes.get(a).DialogItem(),q.Variable),null!=b&&"DI"!=b.type?b.name:null)},GetItemMapType:function(a){var b,c=this._dialog.Mappings[a];return c!==n&&null!=c&&"UN"!=c.ExpectedType&&"OT"!=c.ExpectedType?c.t:(b=x(this._itemNodes.get(a).DialogItem(),q.Variable),null!=b&&"DI"!=b.type?b.valType:"UN")},IsItemInProtectedGroup:function(a){if(""==this._dialog.gType)return!1;var b,c,d,e,f=x(this._itemNodes.get(a).DialogItem(),q.Variable),g={},h={};if(null==f||"TF"!=f.type&&"DI"!=f.type)return!1;if(this._dialog.GetTrueFalseGroupBounds(a,g,h),g.v<0)return!1;for(b=g.v;b<=h.v;b++)if(c=this._dialog.vList.GetItem(b),d=this._interview._engine.GetAnswer(c.name),null!=d&&(e=d.GetValue(this.Indices()),null!=e&&e&&!d.GetUserModifiable(this.Indices())))return!0;return!1},IsAnyVariableProtected:function(){var a,b,c;for(a=0;a<this._dialog.vList.Count();a++)if(b=this._dialog.vList.GetItem(a),c=this._interview._engine.GetAnswer(b.name),null!=c&&!c.GetUserModifiable(this.Indices()))return!0;return!1},NavigateTo:function(a,b,c){this._interview.GotoDialog(this,b,a,null,c)},HasAnswerSource:function(){return!(this.Type()!=j.Dialog&&this.Type()!=j.Iteration||null==this._dialog.DataSource||"CAF"!=this._dialog.DataSource.t&&"AF"!=this._dialog.DataSource.t&&"C"!=this._dialog.DataSource.t)},AnswerSourceColumns:function(){var b=[];return a.each(this.AllAnswerSourceColumns(),function(a,c){c.ConcealedOnAnswerSource()||b.push(c)}),b},AllAnswerSourceColumns:function(){var b=[];return a.each(this._itemNodes._itemNodes,function(a,c){c.DialogItem()instanceof q.Variable&&"DI"!=c.DialogItem().type&&!c.OmittedFromAnswerSource()&&b.push(c)}),b},AnswerSourceTypeIsCompatible:function(a,b){return a==b?!0:"TX"==a&&"MC"==b||"MC"==a&&"TX"==b},GetDataSourcePropertyName:function(a){if(null==this._dialog.DataSource)throw new NullReferenceException("Cannot get a property name when there is no data source defined.");switch(this._dialog.DataSource.t){case"CAF":case"AF":case"C":return a.MapName();default:throw new e(w("The data source type '{0}' is not supported.",this._dialog.DataSource.t))}},LoadDataSourceRows:function(b){if(null==this._dialog.DataSource)throw new NullReferenceException("Cannot load data source rows when there is no data source defined.");var c,f,g,h,i,j,k,l,m,n=this._dialog.DataSource;switch(n.t){case"CAF":c=[],f=[],g=this,a.each(this.AllAnswerSourceColumns(),function(b,d){if(i=g._interview._engine.GetAnswer(d.MapName()),null!=i&&g.AnswerSourceTypeIsCompatible(i.VT(),d.MapType())){for(h=null==i?0:i.GetChildCount(),j=0;h>j;j++)j>=f.length&&f.push(new a.Dictionary),value=i.GetValue([j]),f[j].Add(d.MapName(),value);c.push(d)}}),b(new d(c,f,null));break;case"AF":k=q.DataSourceLoader.GetDataSourceCollection(n.id),null==k?(l="",p.call(this,l),q.DataSourceLoader.LoadAnswerFileDataSource(q.DataSourceAddressDict[n.n.toLowerCase()].Address,q.TemplateLocator,this._template.name,n.id,l,r(function(a){b(new d(this.AllAnswerSourceColumns(),a.Rows(),a.Error()))},this))):b(new d(this.AllAnswerSourceColumns(),k.Rows(),k.Error()));break;case"C":k=q.DataSourceLoader.GetDataSourceCollection(n.id),null==k?(l="",p.call(this,l),m=q.DataSourceAddressDict[n.n.toLowerCase()],q.DataSourceLoader.LoadCustomDataSource(m.Address,m.Name,n.id,l,r(function(a){b(new d(this.AllAnswerSourceColumns(),a.Rows(),a.Error()))},this))):b(new d(this.AllAnswerSourceColumns(),k.Rows(),k.Error()));break;default:throw new e(w("Data sources of type {0} are not supported.",this._dialog.DataSource.t))}},SetAnswersFromAnswerSourceRow:function(a,b){this._interview.BeginBulkAnswerChange();var c,d,e;for(c=0;c<a.length;c++)switch(d=a[c],e=b.TryGetValue(this.GetDataSourcePropertyName(d)),d.DialogItem().type){case"TX":null!=e?"string"==typeof e?d.StringAnswer(e):"array"==typeof e&&d.StringAnswer(e.toString()):d.StringAnswer(null);break;case"NU":null!=e?d.DoubleAnswer(e):d.DoubleAnswer(null);break;case"DA":null!=e?d.DateAnswer(e):d.DateAnswer(null);break;case"TF":null!=e?d.BoolAnswer(e):d.BoolAnswer(null);break;case"MC":null!=e?"object"==typeof e&&e.length?d.ListAnswer(e):"string"==typeof e&&d.StringAnswer(e):d.ListAnswer(null)}this._interview.EndBulkAnswerChange(!0)},GetFocusedItemNode:function(){var a,b,c=null;return this._type==j.Repeat&&x(this,q.RepeatNode).IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?c=x(this,q.RepeatNode).SpreadsheetItemNode()._parent.GetFocusedItemNode():this._focusedItem>=0&&(c=this._itemNodes.get(this._focusedItem),c.IsSpreadsheet()&&(a=c.SpreadsheetNode(),b=c.GetRowFocus(),b>=0&&b<a.Children().Count()&&(c=a.Children().get(b).GetFocusedItemNode()))),c},ClearFocusedItemNode:function(){var a=m("engine/iterationnode");this._type==j.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?this.SpreadsheetItemNode()._parent.ClearFocusedItemNode():this._focusedItem>=0&&this._itemNodes.get(this._focusedItem).ClearFocus(),this[s]()&&x(this,a).SpreadsheetItemNode().SetRowFocus(-1),this._focusedItem=-1},SetFocus:function(a){var b=m("engine/iterationnode");if(this._type==j.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode())return this.SpreadsheetItemNode()._parent.SetFocus(a),void 0;if(this._focusedItem=a,this[s]()){var c=x(this,b).SpreadsheetItemNode(),d=q.RepeatIndices.GetTopIndex(this._indices);d>=this._parent.Children().Count()&&(d=this._parent.Children().Count()-1),c.SetRowFocus(d)}},AdvanceFocus:function(a,b,c){function d(){this._focusedItem>=0&&this._focusedItem<this._itemNodes.Count()?this._itemNodes.get(this._focusedItem).AssertFocus(a?u.Advance:u.AdvanceIfNecessary,b,r(function(e){return e?(c(e),void 0):(this._focusedItem+=b==t.Forward?1:-1,a=!1,d.call(this),void 0)},this)):(this._focusedItem=-1,c(!1))}if(c===n&&(c=function(){}),this._type==j.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode())return this.SpreadsheetItemNode()._parent.AdvanceFocus(a,b,c),void 0;var e,f;return-1==this._focusedItem&&(this._focusedItem=b==t.Forward?0:this._itemNodes.Count()-1,a=!1),a&&!this[s]()&&(e=this.GetFocusedItemNode(),f=!1,null!=e&&(f=e.OnAnswerSync()),f)?(c(!1),void 0):(d.call(this),void 0)},ReassertFocus:function(a){return this._type==j.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?(this.SpreadsheetItemNode()._parent.ReassertFocus(a),void 0):(this._focusedItem>=0&&this._focusedItem<this._itemNodes.Count()&&this._itemNodes.get(this._focusedItem).AssertFocus(u.ReassertOnly,a),void 0)},GetNextFocusNode:function(a){if(!this._interview.IsSinglePage()||!this.OnSinglePage())return null;var b=this._parent.Children().IndexOf(this),c=null;return a==t.Reverse?b>0?c=this._parent.Children().get(b-1):this._parent.Type()!=j.Root&&(b=this._parent._parent.Children().IndexOf(x(this._parent,o)),b>0&&(c=this._parent._parent.Children().get(b-1))):b<this._parent.Children().Count()-1&&(this._parent.Type()!=j.Repeat||!this._parent.Children().get(b+1).IsHiddenNew())?c=this._parent.Children().get(b+1):this._parent.Type()!=j.Root&&(b=this._parent._parent.Children().IndexOf(x(this._parent,o)),b<this._parent._parent.Children().Count()-1&&(this._parent._parent.Type()!=j.Repeat||!this._parent._parent.Children().get(b+1).IsHiddenNew())&&(c=this._parent._parent.Children().get(b+1))),null!=c&&c.Type()==j.Repeat&&"S"!=c._dialog.rType&&(c=a==t.Forward?c.Children().get(0):c.Children().Count()>1&&c.Children().get(c.Children().Count()-1).IsHiddenNew()?c.Children().get(c.Children().Count()-2):c.Children().get(c.Children().Count()-1)),c},GenerateBookmark:function(){var a,b="";if(b+=this.Variable().name,this._type!=j.DefaultDialog)for(b+="|",b+=this._focusedItem>=0?this._type==j.Repeat?this.Children().get(0).ItemNodes.IndexOfName(this._itemNodes.get(this._focusedItem).DialogItem().name):this._focusedItem:"-1",a=0;a<this._indices.length;a++)b+="|",b+=this._indices[a];return b},SerializeAttributes:function(a){this._type!=j.DefaultDialog&&a.WriteAttributeString("Name",this.Variable().name),null!=this._indices&&this._indices.length>0&&a.WriteAttributeString("Indices",q.RepeatIndices.ToString(this._indices)),null!=this._owner&&a.WriteAttributeString("Owner",this._owner.Variable().name),this._active||a.WriteAttributeString("Active",this._active.toString()),this._autoHidden&&a.WriteAttributeString("AutoHidden",this._autoHidden.toString());var b=Caption;!v(b)&&b!=this.Variable().name&&a.WriteAttributeString("Caption",b),o.baseclass.SerializeAttributes(a)}},{HDEscQuots:function(a,b,c){return"boolean"!=typeof c&&(c=!0),"string"!=typeof a&&null!=typeof a.hdType&&"S"!=a.hdType?"":(b!==!1&&(b=!0),b?(a=a.replace(/&/g,"&amp;"),c&&(a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;")),a=a.replace(/\'/g,"&#39;"),a=a.replace(/\"/g,"&quot;")):(a=a.replace(/&#39;/g,"'"),a=a.replace(/&quot;/g,'"'),c&&(a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">")),a=a.replace(/&amp;/g,"&")),a)},FixAmpersands:function(a,b){"string"!=typeof a&&(a=""),"boolean"!=typeof b&&(b=!1);var c,d=b?"&amp;":"&";return a=a.replace(new RegExp("\\"+d+"\\"+d,"g"),"※⁂"),a=a.replace(new RegExp("\\"+d+"(\\s|<BR>)","g"),"※⁂$1"),c=a.indexOf(d),c>=0&&(a=a.substr(0,c)+"<u>"+a.substr(c+d.length,1)+"</u>"+a.substr(c+d.length+1)),a=a.replace(new RegExp("\\"+d,"g"),""),a=a.replace(new RegExp("※⁂","g"),d)},TrimForUseAsTitle:function(a){if(!a)return"";if(""==a)return a;a=a.replace(/<br>/gi,"\n");var b=a.search(/[^-:;,.?! \n\t]/);return b>0&&(a=a.slice(b)),b=a.search(/[\n\t]/),b>0&&(a=a.slice(0,b)),b=a.search(/[-:;.,?! ]+$/),b>0&&(a=a.slice(0,b)),a}}),q.InterviewNode=o,o}),define("dialog/answersourcewindow",["hdmain/system","system/jquery.hd.childwindow","hdmain/jq","dialog/answersourcevalueconverter","system/jq.datagrid/datagridtextcolumn","system/jq.datagrid/datagridcheckboxcolumn","system/jq.datagrid/datagrid","dialog/stringformatter","engine/stringparsersource","engine/interviewnode"],function(a,b,c,d,e,f,g,h,i,j){function k(){this.DialogResult(!0)}function l(){this.DialogResult(!1)}function m(a){try{this._dslr=a,null!=a.Error?o.ExceptionAlert("err_datarequest",a.Error):(0==a.Rows.length&&a.Rows.push(new o.jq.Dictionary),this[q][q]({ItemsSource:a.Rows,SelectedIndex:0}))}finally{}}function n(a){return a.preventDefault(),0==c(a.target).parents(".hd-grid-header").length&&this.DialogResult(!0),!1}var o=HOTDOC$,p=c.proxy,q="DataGrid",r=j.FixAmpersands;return c.widget("hd.AnswerSourceWindow",b,{_setOption:function(a){switch(b.prototype._setOption.apply(this,arguments),a){case"width":case"height":this.element.children().resize(),this[q]&&this[q].triggerHandler("LayoutUpdated")}},_create:function(){b.prototype._create.apply(this,arguments);var a=this.options.node;this[q]=c("<div/>").appendTo(this.element)[q]({CanUserSortColumns:!0,IsReadOnly:!0}),this._setOption("buttons",[{icons:{primary:"hd-img hd-selbtn"},click:p(k,this)},{text:r(o.Lc.GetStr("ui_cancel"),!1),icons:{primary:"hd-img hd-blank"},click:p(l,this)}]),this.element.siblings(".ui-dialog-buttonpane").find(".hd-selbtn").siblings().html(r(o.Lc.GetStr("ui_select"),!1)),this[q].on("mousedown",function(a){a.preventDefault()}).on("dblclick",p(n,this)),this._setOption("title",o.Lc.GetStr("ui_selectcaption")),this.DefineColumns(a.AnswerSourceColumns()),a.LoadDataSourceRows(p(m,this))},Show:function(){this.open();var a=this[q],b=a.width(),c=0,d=window.setInterval(function(){newGridWidth=a.width(),(c>5||newGridWidth==b&&0!=newGridWidth)&&window.clearInterval(d),newGridWidth!=b?(b=newGridWidth,c=0,a.triggerHandler("LayoutUpdated")):c++},50)},DefineColumns:function(b){var g,j,k=this[q],l=this.options.node;c.each(b,function(b,c){switch(g=null,c.DialogItem().type){case"TX":case"NU":case"DA":case"MC":g=new e;break;case"TF":g=new f;break;default:g=null}null!=g&&(a.String.IsNullOrEmpty(c.Prompt())?g.Header(r(c.DialogItem().name,!1)):(j=new a.Text.StringBuilder,o.Dialog.DialogControl.DotCodeParser().Parse(new i(c.Prompt()),new h(j,a.Windows.TextWrapping.NoWrap)),g.Header(r(j.ToString(),!1))),g.Binding({Path:l.GetDataSourcePropertyName(c),Mode:a.Windows.Data.BindingMode.OneTime,Converter:new d}),k[q]("option","Columns").Add(g))
})},SelectedRow:function(){return this[q][q]("option","SelectedItem")},MappedNodes:function(){return null!=this._dslr?this._dslr.Nodes:null}}),c.hd.AnswerSourceWindow}),define("system/textbox",["system/control","hdmain/jq"],function(a,b,c){return b.widget("hd.TextBox",a,{_create:function(){a.prototype._create.apply(this,arguments),this.option(this.options)},Text:function(a){return a===c?this.element.val():(this.element.val(a),void 0)},SelectionStart:function(a){return a===c?this.element.caret().start:(this.element.caret(a,a),void 0)}}),b.hd.TextBox}),define("dialog/answertextbox",["hdmain/jq","system/textbox"],function(a,b){var c=a.proxy;return a.widget("hd.AnswerTextBox",b,{options:{Style:"",IsReadOnly:!1,LineCount:1},_create:function(){b.prototype._create.apply(this,arguments),this.element.attr("tabIndex",1).on("keydown",c(this.OnKeyDown,this)).on("keyup",c(this._onKeyUp,this)),this.option(this.options)},_setOption:function(a,c){switch(a){case"Text":this.element.text(c);break;case"IsReadOnly":this.element.prop("disabled",c),c?this.element.removeAttr("autocapitalize"):this.element.attr("autocapitalize","off");break;case"BorderThickness":this.element.css("border-width",c);break;case"Background":this.element.css("background-color",c)}b.prototype._setOption.apply(this,arguments)},OnKeyDown:function(a){(33==a.which||34==a.which)&&this.element.trigger("NavigationKeyPress",a)},_onKeyUp:function(){var a=this.element.val();this.val!=a&&(this.val=a,this.element.trigger("TextChanged"))}}),a.hd.AnswerTextBox}),define("system/radiobutton",["hdmain/jq","system/jquery.hd.togglebutton"],function(a,b){return a.widget("hd.RadioButton",b,{}),a.hd.RadioButton}),define("dialog/childdialogcontrol",["hdmain/system","system/control","hdmain/jq","system/checkbox","system/radiobutton","engine/answeredstatus"],function(a,b,c,d,e,f,g){function h(a){return this.OnNavigate(a),!1}function i(a){1==a.which&&(this.NavigateButton.attr("disabled")||this.NavigateButton.click())}function j(a,b){this._setOption(y,!0),this.element.trigger("Checked",b)}function k(a,b){this._setOption(y,!1),this.element.trigger("Unchecked",b)}var l=HOTDOC$,m=c.proxy;this.DEBUG===g&&(this.DEBUG=l.DEBUG);var n=" hd-img",o="hd-dlg-a"+n,p=o+"-g",q="hd-dlg-p"+n,r=q+"-g",s="hd-dlg-u"+n,t=s+"-g",u="hd-child-btn",v="NavigateToChildCommand",w="IsButtonEnabled",x="AnsweredStatus",y="IsChecked",z="IsEnabled";return c.widget("hd.ChildDialogControl",b,{options:{IsEnabled:!0,GroupType:""},_create:function(){b.prototype._create.apply(this,arguments);var a=this.NavigateButton=c("<button/>").appendTo(this.element).addClass(u).click(m(h,this)),d=c("<div/>").appendTo(a).mouseup(m(i,this));this.AnswerStatusImage=c('<div class="hd-img"/>').appendTo(d),this.PromptText=c("<span/>").appendTo(d),this._setOption(x,f.Unanswered),this.option(this.options)},_setOption:function(d,e){switch(b.prototype._setOption.apply(this,arguments),d){case x:this.UpdateImage();break;case"GroupType":""==e?(this._toggleButton&&this._toggleButton.remove(),this._toggleButton=null):(this._toggleButton="S"==e?c('<input type="radio"/>').RadioButton({GroupName:a.Guid.NewGuid()}):c('<input type="checkbox"/>').CheckBox().on("Unchecked",m(k,this)),this._toggleButton.on("Checked",m(j,this)).prependTo(this.element));break;case y:null!=this._toggleButton&&this._toggleButton.prop("checked",e);break;case w:null!=this._toggleButton&&this._toggleButton.prop("disabled",!e);case z:this.NavigateButton.prop("disabled",!e),this.UpdateImage();break;case v:this.NavigateButton.on("click",e)}},IsChecked:function(a){return a===g?this.options[y]:(this._setOption(y,a),void 0)},IsButtonEnabled:function(a){return a===g?this.options[w]:(this._setOption(w,a),void 0)},NavigateToChildCommand:function(a){return a===g?this.options[v]:(this._setOption(v,a),void 0)},UpdateImage:function(){var a=this.options,b=this.AnswerStatusImage;a[x]==f.Answered?b.removeClass().addClass(a[z]?o:p):a[x]==f.PartiallyAnswered?b.removeClass().addClass(a[z]?q:r):b.removeClass().addClass(a[z]?s:t)},AnsweredStatus:function(a){return a===g?this.options[x]:(this._setOption(x,a),void 0)},OnNavigate:function(){this.element.trigger("NavigateToChild")},SetFocus:function(a){""!=this.options.GroupType&&null!=a&&a==l.GroupedChildOptionName?this._toggleButton.focus():this.NavigateButton.focus()}}),c.hd.ChildDialogControl}),define("dialog/command",[],{EraseAnswers:0,AddIteration:1,EditIteration:2,InsertIteration:3,DeleteIteration:4,MoveIterationUp:5,MoveIterationDown:6}),define("dialog/commandhandler",["./command"],function(a){return{IsRepeatCommandEnabled:function(b,c,d){var e=!1;switch(b){case a.AddIteration:e=c.AddingIterationsIsEnabled();break;case a.EditIteration:e=!0;break;case a.InsertIteration:e=c.AddingIterationsIsEnabled();break;case a.DeleteIteration:e=c.Children().get(d).DeleteIsEnabled();break;case a.MoveIterationUp:e=d>0&&c.UserExtendible();break;case a.MoveIterationDown:e=d<c.AnsweredIterationCount-1&&c.UserExtendible()}return e},GetRepeatCommandImage:function(b,c){var d="hd-";switch(b){case a.AddIteration:d+="adit";break;case a.EditIteration:c=!0,d+="sser";break;case a.InsertIteration:d+="ssir";break;case a.DeleteIteration:d+="ssdr";break;case a.MoveIterationUp:d+="mov-u";break;case a.MoveIterationDown:d+="mov-d"}return d+=" hd-img",c||(d+="-g"),d},ExecuteRepeatCommand:function(b,c,d){var e=HOTDOC$.Alert;switch(b){case a.AddIteration:c.AddIteration()||e(c.GetResourceString("err_cantadd"));break;case a.EditIteration:var f={s:null};c.EditIteration(d,f,function(a){a||e(f)});break;case a.InsertIteration:c.InsertIteration(d);break;case a.DeleteIteration:c.DeleteIteration(d);break;case a.MoveIterationUp:c.MoveIteration(d,d-1);break;case a.MoveIterationDown:c.MoveIteration(d,d+1)}}}}),define("system/jq.menu/basemenucontrol",["hdmain/jq"],function(a){var b="hd-menu";return a.widget("hd.BaseMenuControl",{_create:function(){this.element.addClass(b+"-base").css("width","200px"),a("<div/>").addClass(b+"-iconbkgrd").appendTo(this.element),this.item=a("<div/>").addClass(b+"-item").css("width","98%").appendTo(this.element),this.icon=a("<div/>").addClass(b+"-icon").appendTo(this.item),this.caption=a("<div/>").addClass(b+"-caption").appendTo(this.item)}}),a.hd.BaseMenuControl}),define("system/jq.menu/menudivider",["hdmain/jq","system/jq.menu/basemenucontrol"],function(a,b){return a.widget("hd.MenuDivider",b,{_create:function(){b.prototype._create.apply(this,arguments),a("<hr/>").addClass("hd-menu-divider").appendTo(this.caption),this.icon.height(10),this.element.height(10)}}),a.hd.MenuDivider}),define("system/jq.menu/menuitem",["hdmain/jq","system/jq.menu/basemenucontrol"],function(a,b){var c="hd-menu";return a.widget("hd.MenuItem",{_create:function(){b.prototype._create.apply(this,arguments),this.element.css("cursor","default"),this.option(this.options)},_setOption:function(b,d){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"Label":this.caption.html(d.replace(/ +/g,"&nbsp;"));break;case"IconImageSource":this.icon.addClass(d);break;case"Tag":this.element.attr("tag",d);break;case"IsEnabled":d?this.element.on("click",a.proxy(function(){this.element.parent().trigger("ItemSelected",parseInt(this.element.attr("tag")))},this)).hover(a.proxy(function(){this.item.toggleClass(c+"-hilite")},this)):this.caption.addClass(c+"-disabled")}}}),a.hd.MenuItem}),define("system/jquery.hd.popup",["hdmain/jq"],function(a){return a.widget("hd.Popup",{_create:function(){this._isOpen=!1,this.element.addClass("hd-popup-elem").hide().appendTo("#hdMainDiv")},open:function(){var a,b,c=this.options,d=c.anchor;this._isOpen=!0,this.element.show(),"function"==typeof c.open&&c.open(this),d&&(a="t"==c.anchorPos?d.offset().top-this.element.height():d.offset().top+d.height(),b=d.offset().left-this.element.width()+d.outerWidth(),this.element.css({top:a,left:b}))},close:function(){this._isOpen=!1,this.element.hide(),"function"==typeof this.options.close&&this.options.close(this)},toggle:function(){this._isOpen?this.close():this.open()},IsOpen:function(){return this._isOpen},Empty:function(){}}),a.hd.Popup}),define("system/jq.menu/menu",["hdmain/jq","system/jquery.hd.popup"],function(a){var b="hd-menu";return a.widget("hd.Menu",{_create:function(){this.element.addClass(b).on("mouseleave",function(){a("."+b).parent().Popup("close")})}}),a.hd.Menu}),define("dialog/contextmenucontrol",["dialog/commandhandler","hdmain/jq","./command","system/jq.menu/menudivider","system/jq.menu/menuitem","system/jq.menu/menu","system/jquery.hd.popup","engine/interviewnodetype"],function(a,b,c,d,e,f,g,h){var i=HOTDOC$,j=b.proxy,k="ContextMenuControl";return b.widget("hd."+k,{options:{node:null,ersAll:!1},_create:function(){this.InitializeComponent(),i.HDEngine.Host.on("resize",this.Content_Resized)},InitializeComponent:function(){this.Image=this.element,this.element.addClass("hd-img hd-dlg-btn hd-dlg-title-btn"),this.element.on("mousedown",j(this.Image_MouseLeftButtonDown,this))},Image_MouseLeftButtonDown:function(a){if(1==a.which){a.stopPropagation(),a.preventDefault();var d=this.options.node;if(b(".hd-menu").parent().Popup("close"),null!=d&&(this.options.ersAll||d.Type()==h.Iteration)){if(null==this._popup){var e=b("<div/>").Menu();if(e.on("ItemSelected",j(this.menu_ItemSelected,this)).on("SizeChanged",j(this.menu_SizeChanged,this)),this.options.ersAll&&b("<div/>").appendTo(e).MenuItem({Label:d.GetResourceString("hdmnuEraseAllAns"),Tag:c.EraseAnswers,IsEnabled:!0,IconImageSource:"hd-img hd-dlg-clr"}),d.Type()==h.Iteration){e.children().length>0&&b("<div/>").appendTo(e).MenuDivider();var f=d._parent,g=d.IterationNumber();this.CreateRepeatCommandMenuItem("hdmnuNewRep",c.AddIteration,f,g).appendTo(e),this.CreateRepeatCommandMenuItem("hdmnuInsRep",c.InsertIteration,f,g).appendTo(e),this.CreateRepeatCommandMenuItem("hdmnuDelRep",c.DeleteIteration,f,g).appendTo(e),b("<div/>").appendTo(e).MenuDivider(),this.CreateRepeatCommandMenuItem("hdmnuMoveUp",c.MoveIterationUp,f,g).appendTo(e),this.CreateRepeatCommandMenuItem("hdmnuMoveDn",c.MoveIterationDown,f,g).appendTo(e)}this._popup=b("<div/>").Popup({open:j(this.popup_Opened,this)}),this._popup.Popup("Empty"),e.appendTo(this._popup)}this._popup.Popup("open")}}},CreateRepeatCommandMenuItem:function(c,d,e,f){var g=a.IsRepeatCommandEnabled(d,e,f);return b("<div/>").MenuItem({Label:this.options.node.GetResourceString(c),Tag:d,IsEnabled:g,IconImageSource:a.GetRepeatCommandImage(d,g)})},UpdateContextMenuLayout:function(){if(null!=this._popup){var a=this.element.offset();this._popup.css({left:Math.max(0,a.left-this._popup.width()+this.Image.width()),top:a.top+this.Image.height()})}},menu_SizeChanged:function(){this.UpdateContextMenuLayout()},Content_Resized:function(){null!=this._popup&&this._popup.Popup("IsOpen")&&this.UpdateContextMenuLayout()},popup_Opened:function(){var a=this.options.node;null!=a&&a.Type()==h.Iteration,this.UpdateContextMenuLayout()},menu_ItemSelected:function(b,d){if(this._popup.Popup("close"),null!=this.options.node)switch(d){case c.EraseAnswers:this.options.node.ClearAnswers();break;case c.AddIteration:case c.InsertIteration:case c.DeleteIteration:case c.MoveIterationUp:case c.MoveIterationDown:a.ExecuteRepeatCommand(d,this.options.node._parent,this.options.node.IterationNumber())}},canvas_MouseLeftButtonDown:function(){this._popup.Popup("close")}}),b.hd[k]}),define("system/jquery.hd.button",["hdmain/system","hdmain/jq"],function(a,b,c){var d=a.Windows.Visibility;return b.widget("hd.Button",{options:{type:0,icon:"hd-blank",Visibility:d.Visible},_create:function(){this.label=b("<span/>").addClass("hd-btn-text").html("&nbsp;").appendTo(this.element),this.icon=b("<div/>").appendTo(this.element),this.option(this.options)},_setOption:function(a,c){switch(b.Widget.prototype._setOption.apply(this,arguments),a){case"type":switch(c){case 0:this.icon.width(0);break;case 1:this.label.width(0);break;case 3:this.icon.css("float","right")}break;case"icon":this.icon.removeClass().addClass("hd-img "+c);break;case"label":1!=this.options.type&&this.label.html(c.replace("&","&amp;"));break;case"click":c&&this.element.on("click",c);break;case"image":c&&this.options.type>0&&(this.icon.addClass("hd-blank").css("width","auto"),b('<img src="'+this.options.image+'"/>').appendTo(this.icon));break;case"Visibility":this.element[c==d.Visible?"show":"hide"]()}},IsEnabled:function(a){return a===c?!this.element.prop("disabled"):(a?(this.element.prop("disabled",!1),this.icon.removeClass("hd-img-g").addClass("hd-img")):(this.element.prop("disabled",!0),this.icon.removeClass("hd-img").addClass("hd-img-g")),void 0)}}),b.hd.Button}),define("engine/pairedcode",[],{b:0,i:1,st:2,un:3,sc:4,fs:5,ac:6,lc:7,h:8,p:9,wl:10}),define("engine/htmlformatter",["hdmain/system","engine/pairedcode"],function(a,b){function c(a){this._text=a}function d(a){var b=a.substr(11);return b.indexOf("+")>=0&&(b=/%\d{2}?/.test(b)?/\x20|%20/.test(b)?b.replace("+","%2B"):b.replace(/\+/g,"%20"):b.replace(/\+/g,"%2B")),b=b.replace(/\x27/g,"%27").replace(/\x22/g,"%22"),b=b.replace(/\&#39;/g,"%27").replace(/\&quot;/g,"%22"),"javascript:"+b}function e(a,b){var d=c.MakeAbsoluteUrl(a,!0);return 0==d.indexOf("javascript:")?"HDAPI._DoWebLinkAction('"+d+"')":(a=d.replace(/\x27/g,"\\'"),"window.open('"+a+"', '_blank'"+(f(b)?"":", '"+b+"'")+")")}var f=a.String.IsNullOrEmpty;return a.ExtendClass(c,null,{PreParse:function(){},PostParse:function(){},WriteText:function(a,c){var d,e="";a.IsCodeEnabled(b.b)&&(e+="font-weight:bold; "),a.IsCodeEnabled(b.i)&&(e+="font-style:italic; "),a.IsCodeEnabled(b.st)&&(e+="text-decoration:line-through; "),a.IsCodeEnabled(b.un)&&(e+="text-decoration:underline; "),a.IsCodeEnabled(b.sc)&&(e+="font-variant:small-caps; "),a.IsCodeEnabled(b.fs)&&(d=a.ChangeFontSize(100),e+="font-size:"+d.toString()+"%; "),e.length>0&&(this._text.Append('<span style="'),this._text.Append(e),this._text.Append('">'));for(var f=0;f<c.length&&" "==c[f];f++)c=c.substr(0,f)+"&#160;"+c.substr(f+1),f+=5;c=c.replace("	","&#160;&#160;&#160;&#160;"),this._text.Append(c),e.length>0&&this._text.Append("</span>")},WriteLineBreak:function(){this._text.Append("<br/>")},WriteWebLink:function(a,b,c){this._text.Append('<a href="#" class="dot-w" '),this._text.Append('onclick="javascript:'),this._text.Append(e(b,null)),this._text.Append('">'),this.WriteText(a,c),this._text.Append("</a>")}},{MakeAbsoluteUrl:function(a,b){0==a.toLowerCase().indexOf("javascript:")&&(a=d(a));var c,e,g=a;return/^\w+:/.test(g)?g:(e=b&&"string"==typeof HDBaseURLForLinks?HDBaseURLForLinks:null,c=f(e)?"":e,c+g)}}),c}),define("dialog/customnavigationbarbutton",["hdmain/system","system/jquery.hd.button","hdmain/jq","system/exception/argumentnullexception","engine/htmlformatter"],function(a,b,c,d,e){function f(){this.CheckActive()}function g(){this.CheckActive()}function h(){this.CheckActive()}function i(){var a=this.options;return a.clickEnabledDel()&&a.clickedDel(a.id),!1}var j,k=HOTDOC$,l=c.proxy,m=a.String.IsNullOrEmpty,n="CustomNavigationbarButton";return k.Dialog.HDNavSepPos={None:0,Left:1,Right:2,Both:3},k.Dialog.HDNavBtnType=j={TextOnly:0,ImageOnly:1,ImageLeft:2,ImageRight:3},k.Dialog.HDNavBarCell={Left:0,Middle:1,Right:2},c.widget("hd."+n,b,{options:{image:null,_showText:!0,_isTextOnly:!1,_origText:""},_create:function(){b.prototype._create.apply(this,arguments);var a=null,c=null;if("function"!=typeof this.options.clickEnabledDel)throw new d("clickEnabledDel");if("function"!=typeof this.options.clickedDel)throw new d("clickedDel");this.Name=this.options.id,this.options.type!=j.TextOnly&&!m(this.options.icon)&&(this._normalBitmapImage=this.GetCustomButtonImageSource(this.options.icon)),this._textblock=null,this.options.type!=j.TextOnly&&null!=this._normalBitmapImage,this.options.type!=j.ImageOnly&&!m(this.options.label)&&(c=this.element.children(".hd-btn-text")),null!=a&&null!=c?this._textblock=c:null==a&&null!=c&&(this._textblock=c,this.options._isTextOnly=!0,this.options._origText=c.text()),this.element.on("mouseenter",l(f,this)).on("mouseleave",l(g,this)).on("click",l(h,this)),this._setOption("click",l(i,this)),this.CheckActive()},_setOption:function(c,d){switch(b.prototype._setOption.apply(this,arguments),c){case"tip":m(d)||a.Windows.Controls.ToolTipService.SetToolTip(this.element,d)}},GetCustomButtonImageSource:function(a){return e.MakeAbsoluteUrl(a,!1)},CheckActive:function(){var a=this.options,b=c.Deferred();return null==a.activeDel?(this.element.prop("disabled",!1),b.resolve()):a.activeDel(a.id,l(function(a){this.element.prop("disabled",!a).children(".hd-blank").toggleClass("hd-img",a).toggleClass("hd-img-g",!a),b.resolve()},this)),b},IsToggleButton:function(){return null!=this.options.activeDel},Separator:function(){return this.options.sep},ShowText:function(a){var b=this.options;return"undefined"==typeof a?b._showText:(b._showText!=a&&(null!=this._textblock&&(b._isTextOnly?this._textblock.text(a?b._origText:b._origText.substr(0,1)):this._textblock[a?"show":"hide"]()),this._setOption("_showText",a)),void 0)}}),c.hd[n]}),define("dialog/textmetrics",["hdmain/system","hdmain/jq"],function(a){function b(){}return a.ExtendClass(b,null,{GetTextWidth:function(a){return this._textBlock.text(a),this._textBlock.width()}}),b}),define("dialog/controlmetrics",["hdmain/system","hdmain/jq","dialog/textmetrics"],function(a,b,c){function d(a){this._textBlock=b('<span class="hd-input">5</span>').hide().appendTo("#hdMainDiv").css({"font-family":a.css("font-family"),"font-size":a.css("font-size"),"font-style":a.css("font-style"),"font-weight":a.css("font-weight")}),this.QuixelFactor=this._textBlock.width(),this.LineHeight=this._textBlock.height()}return a.ExtendClass(d,c),d}),define("dialog/dateinputcontrol",["hdmain/jq","hdmain/system","dialog/controlmetrics"],function(a,b,c,d){var e=HOTDOC$;this.DEBUG===d&&(this.DEBUG=e.DEBUG);var f,g,h,i="InputControl",j="Date"+i,k="AnswerDatePicker",l="<div/>",m="<input/>",n=a.proxy,o="hd-input-date",p=o+"-readonly";e.Class[j]={B:i,SC:function(){g=new c(a(m).addClass(o)),h=new c(a(m).addClass(p)),f=a.hd[i].prototype},W:{_create:function(){f._create.apply(this,arguments);var b=this._dialogItemNode;this.element.attr("widget",j),this.s_calculatedWidth=0,b.ReadOnly()?(this._dateControl=a(l).AnswerTextBox({Style:p}),this._textMetrics=h):(this._dateControl=a(l)[k]({Style:o}),this._textMetrics=g,b.ChangeErrorState.push(n(this._dialogItemNode_ChangeErrorState,this)),b.AnswerReformatted.push(n(this._dialogItemNode_AnswerReformatted,this))),this._dateControl.appendTo(this.ControlCell)},_setOption:function(b,c){switch(b){case"IsEnabled":this._dateControl[k]({IsEnabled:c});break;case"IsReadOnly":if(c!=this._isReadOnly){if(c){var d=a(l).appendTo(this.ControlCell).AnswerTextBox({Text:this._dateControl.data("hd-"+k)?this._dateControl[k]("RawText"):this._dateControl.text(),Style:p});this._dateControl.remove(),d.appendTo(this.ControlCell),this._dateControl=d}this._isReadOnly=c}break;case"IsSetByDialogScript":if(c!=this._isSetByDialogScript){var d,g,h=this._dateControl.data("hd-"+k)?this._dateControl[k]("DisplayDate"):new Date(this._dateControl.text());this._dateControl.remove(),c?(d=a(l).appendTo(this.ControlCell).AnswerTextBox({Text:""==h?h:e.Lc.FormatDate(h.getDate(),h.getMonth()+1,h.getFullYear()),IsReadOnly:!0,BorderThickness:0}),this._dateControl=d):(g=a(l).appendTo(this.ControlCell)[k]({SelectedDate:isNaN(h)?null:h,Style:o}),this._dateControl=g),this._isSetByDialogScript=c}}f._setOption.apply(this,arguments)},Dispose:function(b){"boolean"!=typeof b&&(b=!0),a.hd[i].prototype.Dispose.call(this,b),b&&!this._dialogItemNode.ReadOnly()&&(this._dialogItemNode.ChangeErrorState.pop(),this._dialogItemNode.AnswerReformatted.pop())},PromptVerticalAlignment:function(){return"C"},QuixelFactor:function(){return this._textMetrics.QuixelFactor},CalculatedWidth:function(){if(0==this.s_calculatedWidth){var a,b=0;for(a=0;12>a;a++)b=Math.max(b,this._textMetrics.GetTextWidth(new Date(2008,a,25).toLocaleDateString()));this._dateControl.data("hd-"+k)&&(b+=29),this.s_calculatedWidth=b}return this.s_calculatedWidth},SetControlAnswer:function(){var a=this._dateControl;null!=a?(a[k]({SelectedDate:this._dialogItemNode.DateAnswer()}),null==this._dialogItemNode.DateAnswer()&&a[k]("RawText","")):this._dateControl.text(this._dialogItemNode.DateAnswer().HasValue?this._dialogItemNode.DateAnswer.Value.ToShortDateString():"")},SetFocus:function(){var a=b.Cast(this._dateControl,k);null!=a&&a.SetFocus()},SaveControlAnswer:function(){var a,b=this._dateControl;null!=b&&(a={s:null},this._dialogItemNode.SetAnswerString(b[k]("RawText"),a)!=e.Engine.SetAnswerResult.AnswerWasSet)},_dialogItemNode_ChangeErrorState:function(a,b){this.ValidationError.ValidationErrorControl({Text:b.ErrorMessage,Visibility:b.IsError})},_dialogItemNode_AnswerReformatted:function(){var a=this._dateControl;null!=a&&a[k]({SelectedDate:this._dialogItemNode.DateAnswer()})}}}}),define("engine/dialognode",["hdmain/system","system/exception/invalidoperationexception","system/exception/notimplementedexception","system/exception/argumentnullexception","engine/answeredstatustabulator","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode"],function(a,b,c,d,e,f,g,h,i){function j(a,b,c){c===i?(j.baseConstructor.call(this,a,f.Iteration,b,b._dialog,a.GetCurrentIndices()),this.SharedInit()):(j.baseConstructor.call(this,a,f.Dialog,b,c,b.Type()==f.Root?[]:a.GetCurrentIndices()),this.SharedInit(),this.InitializeId())}var k=HOTDOC$,l=a.Cast,m=a.String.IsNullOrEmpty;return this.DEBUG===i&&(this.DEBUG=k.DEBUG),a.ExtendClass(j,h,{SharedInit:function(){var a,b,c,d=this._dialog.vList.Count(),e=this._dialog.nota?this._dialog.TrueFalseGroupCount():0,f=e>0||"S"==this._dialog.gType&&this._dialog.TrueFalseGroupCount()>0,g=-1,h={v:-1},i={v:-1};for(this._itemNodes=new k.DialogItemNodeList(d+e),c=0;d>c;c++)f&&(c<=i.v?!1:i.v>=0?(this._dialog.nota&&(a=this._interview.GetNOTAProxyForDialog(this._dialog,g),this._itemNodes.Add(a.name,this,k.NoneOfTheAboveIndex)),h.v=i.v=-1):(this._dialog.GetTrueFalseGroupBounds(c,h,i),h.v>=0&&g++)),b=this._dialog.vList.GetItem(c),this._itemNodes.Add(b.name,this,c);i.v>=0&&this._dialog.nota&&(a=this._interview.GetNOTAProxyForDialog(this._dialog,g),this._itemNodes.Add(a.name,this,k.NoneOfTheAboveIndex)),this._interview.RegisterNode(this)},AutoHidden:function(a){if(a===i)return j.baseclass.AutoHidden.call(this);if(this._autoHidden!=a){j.baseclass.AutoHidden.call(this,a);var b=l(this._parent,h);null!=b&&b.Type()!=f.Repeat&&b._itemNodes.get(this.Variable().name).SetUpdateFlags(g.Hidden)}},DoAnsweredStatusTabulation:function(){var a,b,c,d,g,h,i;for(this._answeredStatus.Reset(),i=0;i<this._itemNodes.Count();i++)if(a=this._itemNodes.get(i),!(a.NoneOfTheAbove()||(b=a.DialogItem(),b instanceof k.DlgEl)))if("DI"==b.type)a.NeedsProcessing()&&(h=this._children.get(b.name),null!=h&&e.Aggregate(this._answeredStatus,h.AnsStatus()));else{if(a.Gray()||a.Hidden()||a.SetByDialogScript())continue;if(c=l(b,k.Variable),d=!1,"TF"==c.type&&(""!=this._dialog.gType||this._type==f.Iteration&&l(this,k.IterationNode).IsSpreadsheetRowInSpreadsheet())){if(g={v:null},a.GetAnswerBool(g)){this._answeredStatus.IncAnswered(c.warnUna,a.Required(),!g.v);continue}d=!0}if(!d&&a.IsAnswered()){this._answeredStatus.IncAnswered(c.warnUna,a.Required(),!1);continue}this._answeredStatus.IncUnanswered(c.warnUna,a.Required())}this._answeredStatus.IsThisUnansweredRequired()&&!this._answeredStatus.IsAnswered()&&(this.RequiredIsEnforcable()||this._answeredStatus.ClearRequired()),m(this.ErrorText)?this._answeredStatus.ClearError():this._answeredStatus.SetError(),this._answeredStatus.IsThisHasErrorText()&&!this._answeredStatus.IsAnswered()&&(this.RequiredIsEnforcable()||this._answeredStatus.ClearError())},GetRequiredVarName:function(){throw new c},DoImplicitAnswerProcessing:function(){var a,c,d,e;for(this._interview.BeginBulkAnswerChange(),a=0;a<this._dialog.vList.Count();a++)c=this._dialog.vList.GetItem(a),"MC"==c.type&&(d=l(c,k.McVar),e=this._interview._engine.GetAnswer(d.name),null!=e&&(value={v:e.GetValue(this._indices)},d.ReconcileOptions(value,this._interview.GetRuntimeOptionsForVariable(d))&&this._interview._engine.LoadAnswerValue("MC",d.name,value.v,d.saveAns,this._indices)));if(this._interview.EndBulkAnswerChange(!1),""!=this._dialog.gType||this.IsSpreadsheetRowInSpreadsheet()){if(this._type!=f.Dialog&&this._type!=f.Iteration)throw new b(k.Lc.GetStr("err_grptf"));for(this._interview.BeginBulkAnswerChange(),a=0;a<this._dialog.vList.Count();a++)c=this._dialog.vList.GetItem(a),"TF"==c.type||"DI"==c.type&&""!=this._dialog.gType&&this._itemNodes.get(c.name).IsChildDialogButton()?this.VariableHasAnswer(l(c,k.Variable))||this._interview._engine.LoadAnswerValue("TF",c.name,!1,l(c,k.Variable).saveAns,this._indices):"DI"==c.type&&this._itemNodes.get(c.name).IsDialogOnParent()&&this.Children().get(c.name).DoImplicitAnswerProcessing();this._interview.EndBulkAnswerChange(!1)}},SerializeElements:function(a){a.WriteStartElement("DialogItems");for(var b=0;b<this._itemNodes.Count();b++)this._itemNodes.get(b).Serialize(a);a.WriteEndElement(),j.baseclass.SerializeElements(a)}},{CreateOrLocate:function(a,b,c,e){var g,i;if(null==a)throw new d("interview");if(null==b)throw new d("parent");if(null==c)throw new d("dialog");return g=a.CurrentBuildNode()!=b?l(a.CurrentBuildNode(),h):null,i=l(b.Children().FindExisting(c.name,f.Dialog,g,a.CurrentTemplate()),j),null==i?(i=new j(a,b,c),e.v=!0):e.v=!1,i.InitUpdate(),i}}),j}),define("engine/iterationnode",["hdmain/system","system/exception/argumentnullexception","./interviewnodeoutlinefontflags","engine/dialogupdateflags","engine/interviewnode","engine/dialognode"],function(a,b,c,d,e,f,g){function h(a,b,c){h.baseConstructor.call(this,a,b),this._iterationId=b.NextIterationId(),this_flags=m.None,this.SetFlag(m.NewIteration,c),this.InitializeId()}var i=HOTDOC$,j=a.Cast,k=a.String.IsNullOrEmpty,l=a.Windows.Visibility;this.DEBUG===g&&(this.DEBUG=i.DEBUG);var m={None:0,NewIteration:1,Hidden:2};return a.ExtendClass(h,f,{OutlineParent:function(){return j(this._parent,i.RepeatNode).IsSpreadsheetRow()?j(this._parent._parent,e):h.baseclass.OutlineParent.call(this)},IterationId:function(){return this._iterationId},GetFlag:function(a){return 0!=(this._flags&a)},SetFlag:function(a,b){b?this._flags|=a:this._flags&=~a},New:function(){return this.GetFlag(m.NewIteration)},IsHiddenNew:function(){if(this.New()&&this.IterationNumber()>0){var a=this._interview.CurrentOutlineNode();if(a!=this&&!this.ContainsDescendant(a))return!0}return!1},UserExtendible:function(){return this._parent.UserExtendible()},AddButtonText:function(){return k(this._addButtonCaption)?i.Lc.GetStr("ui_addbtn"):this._addButtonCaption},DisplayAddButton:function(){return!this.IsSpreadsheetRowInSpreadsheet()},AddButtonVisibility:function(){if(!this._interview.IsSinglePage())return l.Visible;var a=this._parent.Children().Count(),b=this._parent.Children().get(a-1);return this==b||a>1&&b instanceof h&&j(b,h).IsHiddenNew()&&this==this._parent.Children().get(a-2)?l.Visible:l.Collapsed},AddButtonIsEnabled:function(){return this._parent.Children().get(this._parent.Children().Count()-1).New()?this._parent.Limit>0&&this.IterationNumber()==this._parent.Limit-1?!1:this.UserExtendible()?!0:!1:!1},DeleteIsEnabled:function(){return this.UserExtendible()?this.IsAnyVariableProtected()?!1:!0:!1},IterationNumber:function(){return i.RepeatIndices.GetTopIndex(this._indices)},IterationHidden:function(a){return a===g?this.GetFlag(m.Hidden):(this.IterationHidden()!=a&&(this.SetFlag(m.Hidden,a),this._parent.SetUpdateFlags(d.NodeChildCount)),void 0)},ShowInOutline:function(){return this.IsSpreadsheetRow()?!1:this.IsHiddenNew()?!1:h.baseclass.ShowInOutline.call(this)&&!this.IterationHidden()},AvailableForNavigation:function(){var a=j(this._parent,i.RepeatNode);return a.IsSpreadsheet()&&null!=a.EditingRow()&&!this.New()?!0:h.baseclass.AvailableForNavigation.call(this)},SpreadsheetItemNode:function(){if(this.IsSpreadsheetRowInSpreadsheet()){var a=j(this._parent,i.RepeatNode);return a.IsOnParent()?j(a._parent,e)._itemNodes.get(this._dialog.name):a._itemNodes.get(this._dialog.name)}return null},EndRowEdit:function(){j(this._parent,i.RepeatNode).SetEditRow(-1)},EvTitle:function(){return this._addButtonCaption=this._dialog.EvAddBC(),h.baseclass.EvTitle.call(this)},GetCaption:function(a,b,d){return d=c.None,this.New()?i.Lc.GetStr("ui_new")+": "+(""==this._title?this._dialog.name:b(e.FixAmpersands(this._title,!1),a,d)):i.RepeatIndices.ToPrefixString(this._indices)+(""==this._title?this._dialog.name:b(e.FixAmpersands(this._title,!1),a,d))},OnSinglePage:function(){return this.IsSpreadsheetRowInEditMode()?!1:this._parent.OnSinglePage()},SerializeAttributes:function(a){h.baseclass.SerializeAttributes(a),this.New()&&a.WriteAttributeString("New","true")}},{CreateOrLocate:function(a,c,e,f){if(null==a)throw new b("interview");if(null==c)throw new b("parent");var g,i,k=null;if(c.Children().Count()>c.Children().UpdatedCount()){if(k=j(c.Children().get(c.Children().UpdatedCount()),h),k.SetIndex(a.GetCurrentIndices()),k.New()!=e){if(k.SetUpdateFlags(d.Title|d.NodeTitle|d.NodeAnsStatus),k.IsSpreadsheetRowInSpreadsheet()&&k._children.Count()>0)for(i=0;i<k._children.Count();i++)g=k._children.get(i),g.SetUpdateFlags(d.Title|d.NodeTitle);k.SetFlag(m.NewIteration,e)}f.v=!1}else k=new h(a,c,e),f.v=!0;return k.InitUpdate(),k}}),h}),define("engine/titleparsersource",["hdmain/system","engine/interviewnodetype","engine/iterationnode"],function(a,b,c){function d(a){this._interviewNode=a}var e=HOTDOC$,f=a.Cast,g=a.String.Format,h=a.String.IsNullOrEmpty;return a.ExtendClass(d,null,{SourceString:function(){var a,d,i,j=null;return this._interviewNode._parent.Type()==b.Iteration&&f(this._interviewNode._parent,c).IsSpreadsheetRowInSpreadsheet()?j=f(this._interviewNode._parent,c):this._interviewNode.Type()==b.Iteration&&(j=f(this._interviewNode,c)),a=this._interviewNode.Title(),null!=j?(d=this._interviewNode._dialog.name,i=j.New()?g("{0}: {1}",this._interviewNode.GetResourceString("ui_new"),h(a)?d:a):g("{0}{1}",e.RepeatIndices.ToPrefixString(this._interviewNode.Indices()),h(a)?d:a)):i=h(a)?this._interviewNode.Variable().name:a,i}}),d}),define("dialog/dialogcaptioncontrol",["hdmain/system","hdmain/jq","dialog/stringformatter","engine/titleparsersource","engine/dialogupdateflags"],function(a,b,c,d,e){var f=HOTDOC$;return b.widget("hd.DialogCaptionControl",{_create:function(){this._interviewNode=this.options.node;var a=b('<td colspan="6" class="hd-dlg-title"/>').appendTo(this.element);this.ContextMenu=b("<div/>").appendTo(a).attr("title",this._interviewNode.GetResourceString("ui_mnutt")).ContextMenuControl({node:this._interviewNode,ersAll:!0}),this.ResourceImage=b("<div class='hd-img hd-rsrc hd-dlg-title-btn' />").appendTo(a).hide().attr("title",this._interviewNode.GetResourceButtonCaption()),this.LayoutRoot=b('<div id="hdDlgTitle"/>').appendTo(a),this.CaptionDiv=b("<div class='DlgTitle'/>").appendTo(this.LayoutRoot),this.CaptionText=b("<div style='width:0px'/>").appendTo(this.CaptionDiv),null!=this._interviewNode._dialog.rsrc&&(this.ResourceImage.show().css("visibility","visible").mouseup(this,this.ResourceImage_MouseLeftButtonUp),this.LayoutRoot.css("margin-right","45px"))},Update:function(b){if(b||(this._interviewNode.UpdateFlags()&e.Title)==e.Title){var g=new a.Text.StringBuilder;f.Dialog.DialogControl.DotCodeParser().Parse(new d(this._interviewNode),new c(g,a.Windows.TextWrapping.NoWrap)),this.CaptionText.html(g.ToString()+"&nbsp;")}},ResourceImage_MouseLeftButtonUp:function(b){if(1==b.which){var c,d=b.data;null!=d._interviewNode._dialog.rsrc&&(c=new a.Text.StringBuilder,DialogControl=f.Dialog.DialogControl,DialogControl.AppendResource(c,d._interviewNode._dialog.rsrc,d._interviewNode,d._interviewNode._dialog,null),DialogControl.DisplayResourceWindow(c.ToString(),d._interviewNode.GetResourceButtonCaption()))}}}),b.hd.DialogCaptionControl}),define("engine/fontsizechange",[],function(){function a(a,b){this.Direction=a,this.Amount=b
}return a}),define("engine/listpunctuation",["hdmain/system"],function(a,b){function c(b,c){var g,i;for(this._codeIndex=0,this._part=new a.Text.StringBuilder,g=0;h>g;g++)this._part[g]=new a.Text.StringBuilder;if(this._codeCount=c,!d(b))for(i=0,g=0;g<b.length;g++)i<f.length&&b[g].toUpperCase()==f[i]?i++:this._part[i].Append(b[g]);this._mid1Len=this._part[e.MidPart1].Length,this._mid2Len=this._part[e.MidPart2].Length,this._mid1Char=this._mid1Len>0?this._part[e.MidPart1].s[0]:"x",this._mid2Char=this._mid2Len>0?this._part[e.MidPart2].s[0]:"x"}this.DEBUG===b&&(this.DEBUG=HOTDOC$.DEBUG);var d=a.String.IsNullOrEmpty,e={PrePart:0,MidPart1:1,MidPart2:2,PostPart:3},f="ABC",g=",;:/.-",h=e.PostPart+1;return a.ExtendClass(c,null,{IncrementCodeIndex:function(){this._codeIndex<this._codeCount&&this._codeIndex++},CodeCount:function(a){return a===b?this._codeCount:(this._codeCount=a,void 0)},GetPrePart:function(){return this._part[e.PrePart].ToString()},GetPunctuation:function(){if(this._codeCount<=0||this._codeIndex>=this._codeCount)return"";var a;return this._codeIndex==this._codeCount-1?a=this._part[e.PostPart].ToString():this._codeIndex==this._codeCount-2?(a=this._part[this._mid2Len>0?e.MidPart2:e.MidPart1].ToString(),2==this._codeCount&&this._mid2Len>0&&a.length>=3&&g.indexOf(a[0])>=0&&this._mid1Len<3&&(a=a.substr(1,a.length-1))):a=this._mid1Len<3||g.indexOf(this._mid1Char)<0||this._mid2Len>0?this._part[e.MidPart1].ToString():this._part[e.MidPart1].ToString().substring(0,2),a}}),c}),define("engine/changedirection",[],{Increase:0,Decrease:1}),define("engine/dotcodeparser",["hdmain/jq","hdmain/system","hdmain/stack","engine/pairedcode","./fontsizechange","./listpunctuation","./changedirection"],function(a,b,c,d,e,f,g,h){function i(a){return a.replace(/^\s+/,"")}function j(b,c){if(b=a.trim(b),c!==h){for(;a.inArray(b[0],c)>=0;)b=b.substr(1);for(;a.inArray(b[b.length-1],c)>=0;)b=b.substr(0,b.length-1)}return b}function k(a){return/\s/.test(a)}function l(a){return/^[a-zA-Z]+$/.test(a)}function m(){}function n(a,b){p.call(this,a),r(b)}function o(a,b){p.call(this,a),s(b)}function p(a){A.Length>0&&(a.WriteText(this,A.ToString()),A.Clear())}function q(a,b,c,e){if(c-b>0){if(!this.IsCodeEnabled(d.h))if(this.IsCodeEnabled(d.ac)||this.IsCodeEnabled(d.sc))A.Append(a.substr(b,c-b).toUpperCase());else if(this.IsCodeEnabled(d.lc))for(var f=b;c>f;f++)k(a[f])?(e.v=!0,A.Append(a[f])):e.v?(A.Append(a[f].toUpperCase()),e.v=!1):A.Append(a[f]);else A.Append(a.substr(b,c-b));A.Length>0&&(e.v=k(A.s[A.Length-1]))}}function r(a){B[a]=B[a]+1}function s(a){B[a]>0&&(B[a]=B[a]-1)}function t(a,b){A.Append(a),b.v=k(a)}function u(b,c){for(var d,e,f,g,h,j=0,l=1,m=!1,n=b.indexOf(y,c);!m&&n>=0;){if(n<b.length-1&&b[n+1]==y)c=n+2;else if(d=b.indexOf(z,++n),0>d)c=n;else{for(e=a.trim(b.substr(n,d-n)),f=0;f<e.length&&!k(e[f]);f++);switch(g=e.substr(0,f),c=d+1,g){case".p":h=f<e.length?i(e.substr(f,e.length-f)):null,w(h)?1==l&&++j:++l;break;case".pe":l>1?--l:m=!0}}n=b.indexOf(y,c)}return j}var v=HOTDOC$,w=b.String.IsNullOrEmpty;this.DEBUG===h&&(this.DEBUG=v.DEBUG);var x=d.wl+1,y="«",z="»",A=new b.Text.StringBuilder,B=[],C=new c,D=new c,E="";return b.ExtendClass(m,null,{IsCodeEnabled:function(a){return B[a]>0},ChangeFontSize:function(a){return C.Peek().Direction==g.Increase?a*=1+C.Peek().Amount/100:a-=a*C.Peek().Amount/100,a},FontSizeChange:function(){return C.Peek()},Parse:function(b,c,h){var m,F,G,H,I,J,K,L,M,N,O,P,Q;for(A.Clear(),m=0;x>m;m++)B[m]=0;for(C.Clear(),D.Clear(),F=b.SourceString(),h&&(F=F.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")),F.indexOf("\\t")>=0&&(F=F.replace(/\\t/g,"«.tc»")),F.indexOf("\\r")>=0&&(F=F.replace(/\\r/g,"«.lb»")),c.PreParse(this),G=[y,"\r"],A.Clear(),H={v:!0},I=0,J=v.IndexOfAny(F,G,I);J>=0;){if(q.call(this,F,I,J,H),"\r"==F[J])this.IsCodeEnabled(d.wl)?A.Append(" "):(p.call(this,c),c.WriteLineBreak()),I=J<F.length-1&&"\n"==F[J+1]?J+2:J+1,H=!0;else if(J<F.length-1&&F[J+1]==y)t(y,H),I=J+2;else if(K=F.indexOf(z,++J),0>K)I=J;else{for(L=j(F.substr(J,K-J)),m=0;m<L.length&&!k(L[m]);m++);if(M=L.substr(0,m),N=m<L.length?i(L.substr(m,L.length-m)):null,I=K+1,!this.IsCodeEnabled(d.wl)||".we"==M)switch(M){case".b":n.call(this,c,d.b);break;case".i":n.call(this,c,d.i);break;case".x":n.call(this,c,d.st);break;case".u":n.call(this,c,d.un);break;case".s":n.call(this,c,d.sc);break;case".z":n.call(this,c,d.fs),!w(N)&&N.length>=2&&("+"==N[0]||"-"==N[0])&&(O=parseInt(N.substr(1,N.length-1)),isNaN(O)||C.Push(new e("+"==N[0]?g.Increase:g.Decrease,O)));break;case".be":o.call(this,c,d.b);break;case".ie":o.call(this,c,d.i);break;case".xe":o.call(this,c,d.st);break;case".ue":o.call(this,c,d.un);break;case".se":o.call(this,c,d.sc);break;case".ze":o.call(this,c,d.fs),C.Count()>0&&C.Pop();break;case".h":r(d.h);break;case".a":r(d.ac);break;case".l":r(d.lc);break;case".he":s(d.h);break;case".ae":s(d.ac);break;case".le":s(d.lc);break;case".an":for(m=I;m<F.length&&k(F[m]);m++);m<F.length&&A.Append("aeiou".indexOf(F[m].toLowerCase())>=0?"an":"a"),A.Append(F.substr(I,m-I)),A.Length>0&&(H=k(A.s[A.Length-1])),I=m;break;case".c":I<F.length&&l(F[I])&&t(F[I++].toUpperCase(),H);break;case".la":t("‘",H);break;case".ra":t("’",H);break;case".lq":t("“",H);break;case".rq":t("”",H);break;case".ps":t("¶",H);break;case".ss":t("§",H);break;case".tc":t("&#160;&#160;&#160;&#160;&#160;",H);break;case".ns":t(" ",H);break;case".nh":t("‑",H);break;case".oh":t("­",H);break;case".":case",":case";":case":":case"!":case"?":for(m=Math.min(I,F.length-1);m>=0&&F[m]!=y;m--);m>0&&(P=A.ToString(),".,:;?!".indexOf(P[P.length-1])<0&&(A.Append(M),H=!1));break;case".lb":case".pm":case".pb":p.call(this,c),c.WriteLineBreak(),H=!0;break;case".w":w(N)||(E=j(N,['"']),w(E)||n.call(this,c,d.wl));break;case".we":this.IsCodeEnabled(d.wl)&&(A.Length>0&&(c.WriteWebLink(this,E,A.ToString()),A.Clear()),s(d.wl));break;case".p":w(N)?D.Count()>0&&(Q=D.Peek().GetPunctuation(),w(Q)||(A.Append(Q),H=k(A.s[A.Length-1])),D.Peek().IncrementCodeIndex()):D.Push(new f(N.replace(/^["]/,"").replace(/["]$/,""),u(F,I)));break;case".pe":D.Count()>0&&D.Pop()}}for(J=-1,m=I;m<F.length;m++)if(a.inArray(F[m],G)>=0){J=m;break}}q.call(this,F,I,F.length,H),p.call(this,c),c.PostParse(this)}}),m}),define("dialog/dialogerrorcontrol",["hdmain/system","hdmain/jq","engine/stringparsersource","engine/dotcodeparser","engine/htmlformatter","engine/dialogupdateflags"],function(a,b,c,d,e,f){return b.widget("hd.DialogErrorControl",{_create:function(){var a=b('<td colspan="6"/>').appendTo(this.element);this.LayoutRoot=b('<div class="hd-dialog-error"><div class="hd-img hd-error-32"/></div>').appendTo(a).hide(),this.ErrorDiv=b('<div class="hd-dialog-error-text"/>').appendTo(this.LayoutRoot),this.option(this.options)},Update:function(b){if(b||(this.options.node.UpdateFlags()&f.HasError)==f.HasError)if(a.String.IsNullOrEmpty(this.options.node.ErrorText))this.ErrorDiv.empty(),this.LayoutRoot.hide();else{var g=new a.Text.StringBuilder,h=new d;h.Parse(new c(this.options.node.ErrorText),new e(g)),this.ErrorDiv.html(g.ToString()),this.LayoutRoot.show()}}}),b.hd.DialogErrorControl}),define("dialog/textblockformatter",["hdmain/system","hdmain/jq","engine/pairedcode"],function(a,b,c){function d(a,b,c){this._textBlock=a,this._fontSize=b,this._required=c}return a.ExtendClass(d,null,{PreParse:function(a){this._textBlock.text(""),this._required&&this.WriteText(a,"*")},PostParse:function(){},WriteText:function(a,d){var e=b("<span/>"),f=parseFloat(this._fontSize);a.IsCodeEnabled(c.b)&&e.css("font-weight","bold"),a.IsCodeEnabled(c.i)&&e.css("font-style","italic"),a.IsCodeEnabled(c.un)&&e.css("text-decoration","underline"),a.IsCodeEnabled(c.sc)&&(f*=.75),a.IsCodeEnabled(c.fs)&&(f=a.ChangeFontSize(f)),e.css("font-size",f),e.text(d),this._textBlock.append(e)},WriteLineBreak:function(){this._textBlock.append("<br/>")},WriteWebLink:function(a,b,c){this._textBlock.append(c)}}),d}),define("dialog/dialogcontentcontrol",["hdmain/system","hdmain/jq","engine/stringparsersource","dialog/textblockformatter","engine/htmlformatter","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode"],function(a,b,c,d,e,f,g,h,i){function j(a,b){this.FireNavigationKeyPress(b)}function k(a,b){this.FireResourceUpdate(b)}function l(){var a,b=this.options;return a=u(b.InterviewNode,i),a._parent.AddIteration()||p.Alert(b.InterviewNode.GetResourceString("err_cantadd")),!1}function m(){var a,c,d=this.options;return a=this.options.InterviewNode._dialog.DataSource,c=null!=a&&("CAF"==a.t||!p.TestInBrowser&&("AF"==a.t||"C"==a.t)),c?null==d._answerSourceWindow&&(d._answerSourceWindow=b("<div/>").appendTo("#hdMainDiv")[x]({node:d.InterviewNode}),this.ResizeAnswerSourceWindow(),p.HDEngine.Host.App({ContentResized:q(this.Content_Resized,this)}),d._answerSourceWindow.on("Closed",q(n,this))[x]("Show")):p.Alert(p.Locale.GetStr("err_noastest")),!1}function n(){var a=this.options;p.HDEngine.Host.App({ContentResized:null}),a._answerSourceWindow.off("Closed",n),a._answerSourceWindow[x]("DialogResult")&&null!=a._answerSourceWindow[x]("SelectedRow")&&a.InterviewNode.SetAnswersFromAnswerSourceRow(a._answerSourceWindow[x]("MappedNodes"),a._answerSourceWindow[x]("SelectedRow")),a._answerSourceWindow.remove(),a._answerSourceWindow=null}var o,p=HOTDOC$,q=b.proxy,r="NavigationKeyPress",s="ResourceUpdate",t=a.Windows.Visibility,u=a.Cast,v="TrueFalseInputControl",w="MultipleChoiceInputControl",x="AnswerSourceWindow",y=0;p.Class.DialogContentControl={B:"IInterviewNodeControl",SC:function(){o=p.Dialog},W:{options:{_itemRowCount:0,_answerSourceWindow:null,sff:!1,sffEnabled:!1},_create:function(){this._updateWhenDialogContentLoaded=!1,this.LayoutRoot=this.element,this.element.on("keydown",q(this.OnKeyDown,this)),this.element.on("Loaded",q(this.DialogContentControl_Loaded,this)).on("Unloaded",q(this.DialogContentControl_Unloaded,this)),this.LayoutRoot.mousedown(this.LayoutRoot_MouseLeftButtonDown);var a,c,d,e,g,n,o,t,x,z,A,B,C,D,E=this.options,F=null,G=0,H=0,I=E.InterviewNode._itemNodes,J=I.Count();for(E.caption&&(a=b("<tr/>").DialogCaptionControl({node:E.InterviewNode}).appendTo(this.LayoutRoot),H++),b("<tr/>").DialogErrorControl({node:E.InterviewNode}).appendTo(this.LayoutRoot),H++,this.FirstItemNodeRow=H,e=0;J>e;e++){switch(d=I.get(e),0!=e&&d.IsOnPrevLine()||(F=b("<tr/>").appendTo(this.LayoutRoot),++E._itemRowCount,G=0),c=b('<td class="hd-cell-input"/>'),d.DialogItem().type){case"TX":c.TextInputControl({node:d});break;case"NU":c.NumberInputControl({node:d});break;case"DA":c.DateInputControl({node:d});break;case"TF":c[v]({node:d});break;case"MC":c[w]({node:d});break;case"DI":d.IsSpreadsheet()?c.SpreadsheetControl({node:d}):d._parent._dialog.hideCB?c.hide():c.DialogInputControl({node:d});break;case"TXL":switch(g=u(d.DialogItem(),p.TxDlgEl),n=!1,g.dspIn){case"":n=!0;break;case"S":o=u(d._parent,p.RepeatNode),n=null!=o&&o.IsSpreadsheet();break;case"E":n=d._parent instanceof i}b("<div/>").appendTo(c),n||c.hide();break;case"HDL":b("<table><tr/></table>").appendTo(c);break;case"VSL":g=u(d.DialogItem(),p.VsDlgEl),0==y&&(t=b("<div>W</div>").hide().appendTo("#hdBodyDiv"),y=t.height(),t.remove()),b("<div/>").appendTo(c),c.height(y*(g.spacing/100));break;case"SLL":case"WLL":u(d.DialogItem(),p.LDlgEl).env>1?c.LinkControl({node:d}):b("<div/>").appendTo(c).hide();break;case"IML":switch(g=u(d.DialogItem(),p.ImDlgEl),g.just){case"L":D="left";break;case"C":D="center";break;case"R":D="right"}b("<img/>").appendTo(c).attr("src",E.InterviewNode.InterviewImageUrl()+g.img).error(this.image_ImageFailed).css("text-align",D)}x=Math.round(6*(d.GetWidth()/100)),c.attr("colspan",x),z=u(c,"IDialogItemNodeControl"),null!=z&&z.element.on(r,q(j,this)).on(s,q(k,this)),c.appendTo(F).trigger("Loaded"),6==c.prev().attr("colspan")&&c.prev().attr("colspan",4==x?2:x)}A=b("<tr/>"),B=b('<td class="hd-cell-input hd-btn-grid" colspan="6"/>').appendTo(A),C=0,p.Dialog.DialogControl.DisplayAnswerSourceButton(E.InterviewNode)&&(C++,b('<button tabIndex="1"/>').Button({type:p.Dialog.HDNavBtnType.ImageLeft,icon:"hd-selbtn",label:h.FixAmpersands(p.Lc.GetStr("ui_select")),Tag:E.InterviewNode}).on("click",q(m,this)).appendTo(B)),E.InterviewNode.Type()==f.Iteration&&u(E.InterviewNode,i).DisplayAddButton()&&(C++,this.AddIterationButton=b('<button tabIndex="1"/>').Button({type:p.Dialog.HDNavBtnType.ImageLeft,icon:"hd-adit",label:h.FixAmpersands(p.Lc.GetStr("ui_select")),Tag:E.InterviewNode}).on("click",q(l,this)).appendTo(B)),C>0&&A.appendTo(this.LayoutRoot)},DialogContentControl_Loaded:function(){this._dialogContentLoaded=!0,this._updateWhenDialogContentLoaded&&(this.Update(!0),this.options.InterviewNode.ReassertFocus(p.FocusDirection.Forward),this._updateWhenDialogContentLoaded=!1)},DialogContentControl_Unloaded:function(){this._dialogContentLoaded=!1},SetContentRowMargins:function(){},image_ImageFailed:function(a){var c=b(a.srcElement);b('<div class="hd-img hd-img-missing"/>').insertBefore(c),c.remove()},LayoutRoot_MouseLeftButtonDown:function(){},LastItemNodeRow:function(){return this.FirstItemNodeRow+this.options._itemRowCount},Update:function(c){var f,h,i,l,m,n,t,v,x,y,z,A,B,C,D,E,F,G,H,I=this.options;if(!this._dialogContentLoaded)return this._updateWhenDialogContentLoaded=!0,void 0;if(I.caption&&this.LayoutRoot.children(":first").DialogCaptionControl("Update",c),u(this.LayoutRoot.children().eq(this.FirstItemNodeRow-1),"DialogErrorControl").Update(c),c||0!=(I.InterviewNode.UpdateFlags()&g.DialogContentRelated)||0!=(I.InterviewNode.DescendantUpdateflags()&g.DialogContentRelated)){for(!I.sff&&I.sffEnabled&&(I.sffEnabled=!1,this.LayoutRoot.children(".hd-sff-row").each(function(){var a=b(this);a.children("td").appendTo(a.prev("tr")),I._itemRowCount--,a.remove()}),this.LayoutRoot.children(".hd-lff-row").children("td").each(function(){var a=b(this);a.attr("colspan",a.attr("lff-colspan")),a.children("table").width(a.attr("lff-table-width"))})),f=0,h=this.FirstItemNodeRow;h<this.LastItemNodeRow();h++)for(i=this.LayoutRoot.children(":eq("+h+")"),l=0;l<i.children().length;l++){if(m=I.InterviewNode._itemNodes.get(f),n=m.UpdateFlags(),m.IsSpreadsheet()&&(n|=m.SpreadsheetNode().DescendantUpdateflags()),c||0!=(n&g.DialogContentRelated))switch(m.DialogItem().type){case"TX":case"NU":case"DA":case"TF":t=i.children().eq(l),t=t.data("hd-"+t.attr("widget")),t.Update(c);break;case"MC":v=i.children().eq(l),(n&g.AddClear)==g.AddClear&&(x=b('<td class="hd-cell-input"/>')[w]({node:m}),x.on(r,q(j,this)).on(s,q(k,this)).attr("colspan",v.attr("colspan")),v.off(r,j).off(s,k)[w]("Dispose"),i.children().eq(l).replaceWith(x),v=x,v.trigger("Loaded"),c=!0),v[w]("Update",c);break;case"DI":m.IsSpreadsheet()?(y=u(i.children().eq(l),"SpreadsheetControl"),y.Update(c)):m._parent._dialog.hideCB||(t=i.children().eq(l),t.DialogInputControl("Update",c));break;case"TXL":z=i.children().eq(l),null!=z&&((c||(n&g.Hidden)==g.Hidden)&&(m.Hidden()?z.hide():z.show()),(c||0!=(n&(g.Prompt|g.Gray)))&&(A=new o.PromptParserSource(m),B=new a.Text.StringBuilder,o.DialogControl.DotCodeParser().Parse(A,new e(B)),z.html(B.ToString()),z.removeClass().addClass("hd-cell-input "+A.TextColor())));break;case"HDL":C=i.children().eq(l).children(":first-child"),(c||(n&g.Hidden)==g.Hidden)&&(m.Hidden()?C.hide():C.show()),(c||(n&g.Prompt)==g.Prompt)&&(D=u(m.DialogItem(),p.HdDlgEl),E=a.String.IsNullOrEmpty(m.Prompt()),(0==C.find("td").length||1==C.find("td").length&&!E||C.find("td").length>1&&E)&&this.UpdateHorizontalDivider(D,E,C),E||(F="L"==D.just?0:"C"==D.just?1:1,G=C.find("td:eq("+F+")"),o.DialogControl.DotCodeParser().Parse(new o.PromptParserSource(m),new d(G,parseInt(G.css("font-size"))*(D.fSize/100),!1)))),(c||(n&g.Gray)==g.Gray)&&C.toggleClass("GrayText",m.Gray());break;case"VSL":(c||(n&g.Hidden)==g.Hidden)&&(H=i.children().eq(l),m.Hidden()?H.hide():H.show());break;case"SLL":case"WLL":u(m.DialogItem(),p.LDlgEl).env>1?i.children().eq(l).LinkControl("Update",c):!1;break;case"IML":(c||(n&g.Hidden)==g.Hidden)&&i.children().eq(l).css("visibility",m.Hidden()?"hidden":"visible"),(c||(n&g.Gray)==g.Gray)&&i.children().eq(l).children().fadeTo(0,m.Gray()?.3:1)}f++}I.sff&&!I.sffEnabled&&(I.sffEnabled=!0,this.LayoutRoot.children("tr:gt("+(this.FirstItemNodeRow-1)+"):lt("+(this.LastItemNodeRow()-2)+")").each(function(){for(var a,c=b(this).children("td"),d=c.length,e=d-1;e>=0;e--){0==e?a=b(this).addClass("hd-lff-row"):(a=b("<tr/>").addClass("hd-sff-row").insertAfter(b(this)),I._itemRowCount++);var f=c.eq(e),g=f.attr("colspan"),h=f.children("table");f.appendTo(a).attr({"lff-colspan":g,colspan:6,"lff-table-width":h.length>0?h[0].style.width:0}),f.children("table").width("100%").find(".hd-width-calc, .hd-width-exact").width("100%")}}))}},FireNavigationKeyPress:function(a){this.element.trigger(r,a)},FireResourceUpdate:function(a){this.element.trigger(s,a)},Dispose:function(a){if("boolean"!=typeof a&&(a=!0),a){this._setOption("IsEnabled",!1);var b,c,d,e,f,g,h=0;for(c=this.FirstItemNodeRow;c<this.LastItemNodeRow();c++)for(d=this.LayoutRoot.children().eq(c),e=0;e<d.children().length;e++){switch(b=null,f=this.options.InterviewNode._itemNodes.get(h),f.DialogItem().type){case"TX":case"NU":case"DA":case"TF":case"MC":b=d.children().eq(e);break;case"DI":f.IsSpreadsheet()?b=d.children().eq(e):f._parent._dialog.hideCB||(b=d.children().eq(e));break;case"SLL":case"WLL":u(f.DialogItem(),p.LDlgEl).env>1&&(b=d.children().eq(e))}null!=b&&(g=u(b,"IDialogItemNodeControl"),null!=g&&(g.element.off(r,j).off(s,k),g.Dispose())),h++}}},OnKeyDown:function(a){if(9==a.which||33==a.which||34==a.which||36==a.which||35==a.which)this.FireNavigationKeyPress(a);else if(38==a.which||37==a.which||40==a.which||39==a.which)this.OnDialogGroupingKey(a);else if(8==a.which&&"text"!=a.target.type&&"TEXTAREA"!=a.target.tagName)return!1},OnDialogGroupingKey:function(c){var d,e,f=this.options;if("S"==f.InterviewNode._dialog.gType&&"TF"==f.InterviewNode.GetFocusedItemNode().DialogItem().type&&(e=this.LayoutRoot.children().find("[widget="+v+"]"),trueFalseInputControl=a.List.FirstOrDefault(e,function(a){return b(a)[v]("option","node")==f.InterviewNode.GetFocusedItemNode()}),null!=trueFalseInputControl&&(d=e.index(trueFalseInputControl),d>=0)))switch(c.which){case 38:case 37:d>0&&(e.eq(d-1)[v]("SetAnswerAndFocus"),c.Handled=!0);break;case 40:case 39:d<e.length-1&&(e.eq(d+1)[v]("SetAnswerAndFocus"),c.Handled=!0)}},ResizeAnswerSourceWindow:function(){this.options._answerSourceWindow[x]({height:.8*b("#hdWrapper").height(),width:.8*b("#hdWrapper").width()})},Content_Resized:function(){this.ResizeAnswerSourceWindow()},UpdateAddButton:function(a){var b,e,f,h,j=this.options;(a||(j.InterviewNode.UpdateFlags()&g.AddButtonRefresh)==g.AddButtonRefresh)&&(b=u(j.InterviewNode,i),e=this.AddIterationButton,h=o.DialogControl,e[b.AddButtonVisibility()==t.Visible?"show":"hide"](),b.AddButtonIsEnabled()?e.prop("disabled",!1).children(".hd-img-g").removeClass("hd-img-g").addClass("hd-img"):e.prop("disabled",!0).children(".hd-img").removeClass("hd-img").addClass("hd-img-g"),f=e.children("span"),h.DotCodeParser().Parse(new c(b.AddButtonText()),new d(f,f.css("font-size"),!1)),f.text(h.StripAmpersand(f.text())))},UpdateHorizontalDivider:function(a,c,d){if(c)b('<td style="width:100%"><hr/></td>').appendTo(d.find("tr"));else{var e=b("<td nowrap='nowrap'/>").appendTo(d.find("tr"));switch(a.just){case"L":b('<td style="width:100%"><hr/></td>').insertAfter(e);break;case"C":b('<td style="width:50%"><hr/></td>').insertBefore(e),b('<td style="width:50%"><hr/></td>').insertAfter(e);break;default:b('<td style="width:100%"><hr/></td>').insertBefore(e)}}}}}}),define("dialog/tracehelper",["hdmain/system"],function(a,b){a.String.Format;return this.DEBUG===b&&(this.DEBUG=HOTDOC$.DEBUG),{WriteLine:function(){},Focus:function(){}}}),define("dialog/builtinnavigationbarbuttonstate",["hdmain/system"],function(a,b){function c(a){this.ImageName(a),this.IsImageDefault=!0,this.Visible=!0}return a.ExtendClass(c,null,{ImageName:function(a){return a===b?this._imageName:(a!=this._imageName&&(this._imageName=a,this.IsImageDefault=!1),void 0)}}),c}),define("dialog/navigationuistate",["dialog/builtinnavigationbarbuttonstate","engine/htmlformatter"],function(a,b,c){var d=HOTDOC$;this.DEBUG===c&&(this.DEBUG=d.DEBUG);var e,f={FirstButtonName:"First",PreviousUnansweredButtonName:"PreviousUnanswered",PreviousButtonName:"Previous",NextButtonName:"Next",NextUnansweredButtonName:"NextUnanswered",LastButtonName:"Last",FinishButtonName:"Finish",FinishPopupButtonName:"FinishPopup",SetDefaultButton:function(b,c){e[b]=new a(c)},IsValidBuiltInButtonInternalName:function(a){switch(a){case this.FirstButtonName:case this.PreviousUnansweredButtonName:case this.PreviousButtonName:case this.NextButtonName:case this.NextUnansweredButtonName:case this.LastButtonName:case this.FinishButtonName:case this.FinishPopupButtonName:return!0}return!1},GetBuiltInButtonInternalName:function(a){switch(a){case"HDFirstPage":return this.FirstButtonName;case"HDPrevUnans":return this.PreviousUnansweredButtonName;case"HDPrevPage":return this.PreviousButtonName;case"HDNextPage":return this.NextButtonName;case"HDNextUnans":return this.NextUnansweredButtonName;case"HDLastPage":return this.LastButtonName;case"HDFinish":return this.FinishButtonName;case"HDFinishPopup":return this.FinishPopupButtonName;default:return""}},SetBuiltInButtonVisible:function(a,b){e[a].Visible=b},GetBuiltInButtonVisible:function(a){var b=e[a];return b!==c?b.Visible:!1},IsBuiltInButtonUsingDefaultImage:function(a){var b=e[a];return b!==c?b.IsImageDefault:!1},SetBuiltInButtonImage:function(a,b){e[a].ImageName(b)},GetBuiltInButtonImage:function(a){var b=e[a];return b!==c?b.ImageName():""},MakeBuiltInButtonImageUri:function(a){var d=e[a];return d!==c?d.IsImageDefault?d.ImageName():b.MakeAbsoluteUrl(d.ImageName(),!1):null}};return f.NavigationbarVisible=!0,e={},f.SetDefaultButton(f.FirstButtonName,"hd-nav-First"),f.SetDefaultButton(f.PreviousUnansweredButtonName,"hd-nav-PrevU"),f.SetDefaultButton(f.PreviousButtonName,"hd-nav-Prev"),f.SetDefaultButton(f.NextButtonName,"hd-nav-Next"),f.SetDefaultButton(f.NextUnansweredButtonName,"hd-nav-NextU"),f.SetDefaultButton(f.LastButtonName,"hd-nav-Last"),f.SetDefaultButton(f.FinishButtonName,"hd-nav-Finish"),f.SetDefaultButton(f.FinishPopupButtonName,"hd-nav-FinishEM"),f}),define("dialog/dialogcontrol",["hdmain/system","hdmain/jq","hdmain/stack","system/jq.menu/menuitem","system/jq.menu/menu","system/jquery.hd.popup","system/exception/argumentnullexception","dialog/tracehelper","dialog/navigationuistate","engine/stringparsersource","engine/dotcodeparser","engine/htmlformatter","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a){if(0!=a.length){if(a.is("button")){var c=a.children(".hd-btn-text"),d=a.children("div");c.height()>d.height()?d.children("img").length>0?d.css("background-image","none"):d.css("margin-top",Math.round((c.height()-d.height())/2)+"px"):c.css("line-height",d.height()+"px")}a.children().each(function(){r(b(this))})}}function s(a,b,c,d,e){var f=a.substr(0,4).toUpperCase(),g='<a href="'+a+'"'+("HTTP"!=f&&"NTTP"!=f||b?">":' target="_blank">');return E(e,g+'<div class="hd-img hd-rsrc" border=0 style="visibility:visible"></div></a>&nbsp;'+g,d,"</a>",c)}function t(a){if(a===q)t.call(this,this.GetNavigationGroupPanel(y[A].HDNavBarCell.Left)),t.call(this,this.GetNavigationGroupPanel(y[A].HDNavBarCell.Middle)),t.call(this,this.GetNavigationGroupPanel(y[A].HDNavBarCell.Right));else{var b,c,d,e,f,g,h=[];for(b=0;b<a.children().length;b++)e=C(a.children().eq(b),"Button"),null!=e&&e.options.Visibility==B.Visible&&h.push(b);for(d=h.length,b=d>0?h[0]:a.children().length,c=0;b>c;c++)f=a.children().eq(c),f.hasClass("hd-img")&&f.hide();if(0==d)return;for(b=1;d>b;b++)for(g=!0,c=h[b-1]+1;c<h[b];c++)f=a.children().eq(c),f.hasClass("hd-img")&&(f.css("display",g?null:"none"),g=!1);for(c=h[d-1]+1;c<a.children().length;c++)f=a.children().eq(c),f.hasClass("hd-img")&&f.hide()}}function u(){1==arguments.length?(this.InterviewNode=arguments[0],this.Type=P.DialogResource):(this.DialogItemNode=arguments[0],this.OptionName=arguments[1],this.Type=P.DialogItemResource),this.Equals=function(a){return null==a?!1:a.Type==this.Type?a.Type==P.DialogResource?a.InterviewNode==this.InterviewNode:a.DialogItemNode==this.DialogItemNode&&a.OptionName==this.OptionName:!1}}var v,w,x,y=HOTDOC$,z=b.proxy,A="Dialog",B=a.Windows.Visibility,C=a.Cast,D=a.String.IsNullOrEmpty,E=a.String.Format,F=a.Windows.Controls.ToolTipService.SetToolTip,G="CurrentOutlineNode",H="IInterviewNodeControl",I="NavigationBarTextVisibility",J="CustomNavigationbarButton",K="DialogControl",L="FocusLeavingEventArgs",M="NavigationKeyPress",N="ResourceUpdate",O="keydown",P=(y.Engine,{DialogResource:0,DialogItemResource:1}),Q=y[A].NavigateOperation={First:0,PreviousUnanswered:1,Previous:2,Next:3,NextUnanswered:4,Last:5,Finish:6};y.ButtonGlyphWidth=18,y.Class.IDialogItemNodeControl={W:y[A].IDialogItemNodeControl={DialogItemNode:function(){}}},y.Class[H]={W:y[A][H]={}},y.Class.HDHyperlinkButton={N:A,C:function(){},P:{OnClick:function(){try{0==this.NavigateUri.indexOf("javascript:")?w._DoWebLinkAction(this.NavigateUri.AbsolutePath):window.open(this.NavigateUri,TargetName)}catch(a){}}}},y.Class[K]={SC:function(){v=y.FocusDirection,w=window.HDAPI,x=new k},W:y[A][K]={_create:function(){var a,c,d=this.options;if(this.InitializeComponent(),null==d.interview)throw new g("interview");this.element.on("LayoutUpdated",z(this.DialogControl_LayoutUpdated,this)),d[I]=B.Visible,a=d.interview,b(a).on("PageModeChanging",z(this._interview_PageModeChanging,this)).on("RefreshDialogContent",z(this._interview_RefreshDialogContent,this)).on("RefreshInterviewProgress",z(this._interview_RefreshInterviewProgress,this)).on("Navigated",z(this._interview_Navigated,this)).on("MoveFocus",z(this._interview_MoveFocus,this)).on("Closing",z(this.OnClosed,this)),d.PageMode=a.IsSinglePage()?y.PageMode.SinglePage:y.PageMode.NormalPaged,a.wantsprog=!0,c=a.GetResourceString,this.First.Button({label:c("navb_First")}),this.Previous.Button({label:c("navb_Prev")}),this.Next.Button({label:c("navb_Next")}),this.Last.Button({label:c("navb_Last")}),this.Finish.Button({label:c("navb_Finish")}),this.More.Button({label:c("navb_More")}),this.CreateKeyboardAccelerators(),F(this.First,c("uitt_First")),F(this.PreviousUnanswered,c("uitt_PrevU")),F(this.Previous,c("uitt_Prev")),F(this.Next,c("uitt_Next")),F(this.NextUnanswered,c("uitt_NextU")),F(this.Last,c("uitt_Last")),F(this.Finish,c(a.IsPopup()?"nav_FinPopup":"nav_Finish")),F(this.More,c("nav_More")),this.Finish.on(O,z(this.Finish_KeyDown,this)),this._setOption("ProgressBarEnabled",a.ProgressBarEnabled()),this.UpdateProgressBar(a.HasRequiredUnansweredQuestions(),a.HasErrorText(),a.AnsweredCount(),a.TotalCount()),this.option(d)},_setOption:function(a,c){var d,e,f=this.options,g=f[a],h=f.interview;switch(a){case"ProgressBarEnabled":this.ProgressBar[c?"show":"hide"]();break;case"ResourcePaneVisibility":g===q&&(g="none"==this.ResourcePane.css("display")?B.Collapsed:B.Visible),g!=c&&(d=this.LayoutRoot.children().last(),c==B.Visible?(d.height(Math.max(Math.min(this._resourcePaneHeight>0?this._resourcePaneHeight:f.interview.ResourcePaneInitialHeight(),this.DialogGrid.height()/2),30)).css("min-height",30),this.DialogResourceSplitter.show(),this.ResourcePane.show(),this.UpdateResourcePane(),this.DialogGrid.height(this.DialogGrid.height()-d.outerHeight()-this.DialogResourceSplitter.outerHeight()-this.TitleGrid.outerHeight())):(this.DialogGrid.height(this.DialogGrid.height()+d.outerHeight()+this.DialogResourceSplitter.outerHeight()+this.TitleGrid.outerHeight()),this._resourcePaneHeight=d.height(),d.css("min-height",0).height(0),this.DialogResourceSplitter.hide(),this.ResourcePane.hide()));break;case I:c!=g&&this.SetTextBlockVisibility(this.Navigationbar(),c);break;case"PageMode":c!=g&&(h.DoAnswerSync(),e={s:null},h.SetPageMode(c,e,!0)?h.Update():y.Alert(e),this._reassertFocus=!0)}b.Widget.prototype._setOption.apply(this,arguments)},InitializeComponent:function(){this._resourcePaneHeight=0,this._navigationButtonMinHeight=0,this.LayoutRoot=this.element.addClass("hd-dialog-control").on(O,z(this.OnKeyDown,this)),this.TitleGrid=b("<div id='hdDlgTitle'/>").appendTo(this.LayoutRoot),this.DialogGrid=b("<div class='hd-dlg-content'/>").appendTo(this.LayoutRoot),this.ContentGrid=b('<table id="HDContentGrid" class="hd-content-grid"/>').appendTo(this.DialogGrid),b('<colgroup width="16%" span="6" style="width:16%"/>').appendTo(this.ContentGrid),this.NavigationGrid=b("<div/>").attr("id","hdNavBar").addClass("HD3DObject").appendTo(this.LayoutRoot);var a=b('<div class="hd-nav-table"/>').appendTo(this.NavigationGrid),c="hdResourcePane";this.NavGroupLeft=b('<div class="hd-nav-left"/>').appendTo(a),this.First=b('<button Name="First" tabindex="1"/>').appendTo(this.NavGroupLeft).Button({click:z(this.First_Click,this),type:2,icon:"hd-nav-First"}),this.NavGroupMiddle=b('<div class="hd-nav-middle"/>').appendTo(a),this.PreviousUnanswered=b('<button Name="PreviousUnanswered" tabindex="2"/>').appendTo(this.NavGroupMiddle).Button({click:z(this.PreviousUnanswered_Click,this),type:1,icon:"hd-nav-PrevU"}),this.Previous=b('<button Name="Previous" tabindex="2"/>').appendTo(this.NavGroupMiddle).Button({click:z(this.Previous_Click,this),type:2,icon:"hd-nav-Prev"}),this.Next=b('<button Name="Next" tabindex="2"/>').appendTo(this.NavGroupMiddle).Button({click:z(this.Next_Click,this),type:3,icon:"hd-nav-Next"}),this.NextUnanswered=b('<button Name="NextUnanswered" tabindex="2"/>').appendTo(this.NavGroupMiddle).Button({click:z(this.NextUnanswered_Click,this),type:1,icon:"hd-nav-NextU"}),this.NavGroupRight=b('<div class="hd-nav-right"/>').insertBefore(this.NavGroupMiddle),this.Last=b('<button Name="Last" tabindex="3"/>').appendTo(this.NavGroupRight).Button({click:z(this.Last_Click,this),type:3,icon:"hd-nav-Last"}),this.NavSep=b("<div class='hd-img hd-nav-Sep' style='margin:0'/>").appendTo(this.NavGroupRight),this.Finish=b('<button Name="Finish" tabindex="3"/>').appendTo(this.NavGroupRight).Button({click:z(this.Finish_Click,this),type:3,icon:"hd-nav-Finish"}),this.NavGroupSff=b('<div class="hd-nav-sff"/>').css({display:"table",width:"100%","table-layout":"fixed"}).insertAfter(this.NavGroupMiddle).hide();var d=(b('<span style="display: table-cell; text-align:left;"/>').appendTo(this.NavGroupSff),b('<span style="display: table-cell; text-align:center;"/>').appendTo(this.NavGroupSff),b('<span style="display: table-cell; text-align:center;"/>').appendTo(this.NavGroupSff),b('<span style="display: table-cell; text-align:right;"/>').appendTo(this.NavGroupSff));b('<span class="hd-nav-sff-1 hd-nav-sff-placeholder"/>').insertBefore(this.Previous),this.Previous.addClass("hd-nav-lff-1"),b('<span class="hd-nav-sff-2 hd-nav-sff-placeholder"/>').insertBefore(this.Next),this.Next.addClass("hd-nav-lff-2"),b('<span class="hd-nav-sff-3 hd-nav-sff-placeholder"/>').insertBefore(this.Finish),this.Finish.addClass("hd-nav-lff-3"),this.More=b('<button Name="More" tabindex="3"/>').appendTo(d).Button({click:z(this.More_Click,this),type:3,icon:"hd-nav-More"}),this.MorePopup=null,this.ProgressBar=b("<div/>").appendTo(this.LayoutRoot).progressbar(),this.DialogResourceSplitter=b("<div/>").appendTo(this.LayoutRoot).hide().GridSplitter({type:"h",elems:[".hd-dlg-content","#"+c],minWidth:[40,30]}),this.ResourcePane=b("<div/>").attr("id",c).HtmlHostControl().appendTo(this.LayoutRoot)},DotCodeParser:function(){return x},ScrollIntoView:function(){},DisplayResourceWindow:function(a,b){w._OpenResourceWindow(a,b)},StripAmpersand:function(a){return a.replace(/&/,"")},DisplayAnswerSourceButton:function(a){if(a.HasAnswerSource()){var b=a._dialog.DataSource;switch(b.t){case"CAF":return!0;case"AF":case"C":return null!=y.DataSourceAddressDict&&y.DataSourceAddressDict[b.n.toLowerCase()]!=q}}return!1},CreateKeyboardAccelerators:function(){var a,b,c,d,e,f,g=[this.First,this.Previous,this.Next,this.Last,this.Finish];
for(this.options.AccessKeys={},a=0;a<g.length;a++)b=g[a],c=b.children("span"),null!=c&&(d=c.text(),e=d.indexOf("&"),e>=0&&(f=d.substr(e+1,1),D(f)||(c.html(d.substr(0,e)+"<u>"+f+"</u>"+d.substr(e+2)),this.options.AccessKeys[f.toUpperCase().charCodeAt(0)]=b)))},MayInvokeButton:function(){return w._assertSvrRspHidden()},CustomNavigationbarClicked:function(a){w._clickCustNBBtn(a)},CustomNavigationbarEnabled:function(a,b){w._custNBBtnIsEnabled(a,b)},ApplyCustomNavigationbarButtonDefinitions:function(a){var c,d,e,f,g,h,i,j;for(c=0;c<a.length;c++){for(e=a[c],f=b("<button/>")[J]({id:e.ID,clickEnabledDel:y[A][K].MayInvokeButton,clickedDel:this.CustomNavigationbarClicked,activeDel:e.HasEnabledState?this.CustomNavigationbarEnabled:null,type:e.ButtonType,sep:e.SeparatorPos,label:e.ButtonText,tip:e.Tooltip,image:e.ImageName}).attr({tabIndex:e.Cell+1,Name:e.Name}),null!=this._hiddenNavigationbarButtons&&this._hiddenNavigationbarButtons.Contains(f[J]("option","id"))&&(f.hide(),this._hiddenNavigationbarButtons.Remove(f[J]("option","id"))),g=[],h=this.GetNavigationGroupPanel(e.Cell),d=0;d<h.children().length;d++)h.children().eq(d).is("button")&&g.push(d);i=e.ButtonIndex,i>=g.length&&(i=-1),i>=0&&(i=g[i],this.HasLeftSeparator(h.children()[i])&&i--),(e.SeparatorPos==y[A].HDNavSepPos.Left||e.SeparatorPos==y[A].HDNavSepPos.Both)&&(j=this.CreateSeparatorImage(),0>i?j.appendTo(h):h.children().eq(i++).before(j)),0>i?f.appendTo(h):h.children().eq(i++).before(f),(e.SeparatorPos==y[A].HDNavSepPos.Right||e.SeparatorPos==y[A].HDNavSepPos.Both)&&(j=this.CreateSeparatorImage(),0>i?j.appendTo(h):h.children().eq(i++).before(j)),t.call(this,h),e.HasEnabledState&&(this._customESBtns===q&&(this._customESBtns=[]),this._customESBtns.push(f)),this.FirstCustomNavButton===q&&(this.FirstCustomNavButton=f),r(f)}},GetNavigationbarButtonInternalName:function(a){var b=i.GetBuiltInButtonInternalName(a);return D(b)?a:b},ClickTheButton:function(a){a.click()},CreateSeparatorImage:function(){return b("<div class='hd-img hd-nav-Sep'/>")},GetSeparator:function(a){var b=a;return null!=b?b.Separator:a.Name==i.FinishButtonName?y[A].HDNavSepPos.Left:y[A].HDNavSepPos.None},HasLeftSeparator:function(a){var b=this.GetSeparator(a);return b==y[A].HDNavSepPos.Left||b==y[A].HDNavSepPos.Both},GetNavigationGroupPanel:function(a){return a==y[A].HDNavBarCell.Left?this.Navigationbar().find(".hd-nav-left"):a==y[A].HDNavBarCell.Middle?this.Navigationbar().find(".hd-nav-middle"):this.Navigationbar().find(".hd-nav-right")},SetNavButtonMinHeight:function(a){r(a)},SetTextBlockVisibility:function(a,c){if(null!=a){if(null!=C(a,J))return a[J]("ShowText",c==B.Visible),void 0;if(a.data("hd-Button"))return a.children("span").css({width:c==B.Visible?"auto":"1px",visibility:c==B.Visible?"visible":"hidden"}),void 0;var d=this;b.each(a.find("button"),function(){d.SetTextBlockVisibility(b(this),c)})}},DialogControl_LayoutUpdated:function(){var c,d,e,f,g,h,j,k=this.options;if(this._reassertFocus&&(this._reassertFocus=!1,k.interview[G]().ReassertFocus(v.Forward)),this._navigationButtonMinHeight<=0&&(c=this.element.find("button[name="+i.FirstButtonName+"]"),c.length>0))return this._navigationButtonMinHeight=c.outerHeight(),a.CallAsync(z(function(){r(this.Navigationbar())},this)),void 0;d=this.element.width(),k[I]==B.Visible?(f=b("#hdNavBar").clone().hide().appendTo("#hdMainDiv").attr("id","hdNavBarClone").css("position","absolute"),f.find(".hd-nav-table").children().css("float","left"),e=f.outerWidth(!0)+50,e>d?(this._navigationBarMinWidth=e,a.CallAsync(z(function(){this._setOption(I,B.Collapsed),f.remove()},this))):f.remove()):d>this._navigationBarMinWidth&&a.CallAsync(z(function(){this._setOption(I,B.Visible)},this));var l=C(this.ContentGrid.children("tbody"),"IInterviewNodeControl"),m=400;if(null!=l){!l.options.sff&&m>=d&&(l.options.sff=!0,l.Update(!0),this.NavGroupSff.show().siblings().hide(),this.Previous.appendTo(this.NavGroupSff.children().eq(0)),this.Next.appendTo(this.NavGroupSff.children().eq(1)),this.Finish.appendTo(this.NavGroupSff.children().eq(2))),d>m&&l.options.sff&&(l.options.sff=!1,l.Update(!0),this.NavGroupSff.hide().siblings().show(),this.Previous.insertAfter(".hd-nav-sff-1"),this.Next.insertAfter(".hd-nav-sff-2"),this.Finish.insertAfter(".hd-nav-sff-3"));var g=b("#hdInterviewDiv"),h=g.children(".hd-dlg-content");if(!l.options.sff){var j=Math.max(10,g.width()/6-50);h.find(".hd-width-calc, .hd-width-exact").each(function(){var a=b(this),c=a.closest(".hd-cell-input"),d=c.attr("colspan")*j,e=a.width(),f=parseInt(a.attr("hdwidth"));(e>=f||d>f)&&a.width(f),(f>d&&d>e||e>d)&&a.width(d)})}h.find(".hd-grid").triggerHandler("LayoutUpdated")}},UpdateProgressBar:function(a,b,c,d){this.ProgressBar.progressbar({Maximum:d,Value:c});var e,f=null;f=a||b?"hd-progress-required":c>=d?"hd-progress-complete":"hd-progress-normal",null!=f&&this.ProgressBar.progressbar({Foreground:f}),e=a?b?4:2:b?3:c>=d?0:1,w._invokeHandler("OnHDProgress",!1,!1,"Answered",c,"Total",d,"State",e)},_interview_RefreshInterviewProgress:function(a,b){this.UpdateProgressBar(b.ru,b.et,b.aq,b.tq)},_interview_PageModeChanging:function(){this.ClearContentGrid()},UpdateBuiltInNavigationbarButtons:function(){var a=this.options.interview;this.First.Button("IsEnabled",a.IsFirstEnabled()),this.PreviousUnanswered.Button("IsEnabled",a.IsPreviousUnansEnabled()),this.Previous.Button("IsEnabled",a.IsPreviousEnabled()),this.Next.Button("IsEnabled",a.IsNextEnabled()),this.NextUnanswered.Button("IsEnabled",a.IsNextUnansEnabled()),this.Last.Button("IsEnabled",a.IsLastEnabled())},SetNavigationbarButtonVisible:function(a,b){var c,d=this.GetNavigationbarButtonInternalName(a);return D(d)?!1:(c=C(this.Navigationbar().find("[Name='"+(d==i.FinishPopupButtonName?i.FinishButtonName:d)+"']"),"Button"),null!=c&&(c._setOption("Visibility",b?B.Visible:B.Collapsed),t.call(this)),D(i.GetBuiltInButtonInternalName(a))&&(b?null!=this._hiddenNavigationbarButtons&&this._hiddenNavigationbarButtons[d]!==q&&this._hiddenNavigationbarButtons.splice(this._hiddenNavigationbarButtons.indexOf(d),1):(this._hiddenNavigationbarButtons===q&&(this._hiddenNavigationbarButtons=[]),this._hiddenNavigationbarButtons.push(d))),null!=c)},SetNavButtonImage:function(a,c){if(0!=a.length&&0!=a.width()){var d,e="hd-img",f=e+"-g",g=a.hasClass(f);return a.hasClass(e)||g?(a.removeClass().addClass("hd-blank "+(g?f:e)).css({width:"auto"}),d=a.children("img"),0==d.length&&(d=b("<img>").appendTo(a)),d.attr("src",c),void 0):(this.SetNavButtonImage(a.find("."+e+", ."+f),c),void 0)}},SetNavigationbarButtonImage:function(a,b){var c,d,e,f=this.GetNavigationbarButtonInternalName(a);D(f)||(c=this.Navigationbar().find("[Name="+(f==i.FinishPopupButtonName?i.FinishButtonName:f)+"]"),c.length>0&&(d=C(c,J),e=null!=d?d.GetCustomButtonImageSource(b):i.MakeBuiltInButtonImageUri(f),this.SetNavButtonImage(c,e)))},IsNavigationbarButtonEnabled:function(a){if(y[A][K].MayInvokeButton()){var b,c,d=this.GetNavigationbarButtonInternalName(a);if(!D(d)&&(b=this.Navigationbar().FindName(d==i.FinishPopupButtonName?i.FinishButtonName:d),null!=b&&(c=b,null!=c?c.CheckActive():UpdateBuiltInNavigationbarButtons(),b.IsEnabled)))return!0}return!1},InvokeNavigationbarButton:function(a){if(y[A][K].MayInvokeButton()){var b,c,d=this.GetNavigationbarButtonInternalName(a);if(!D(d)&&(b=C(this.Navigationbar().find("[Name="+(d==i.FinishPopupButtonName?i.FinishButtonName:d)+"]"),"Button"),null!=b))return c=C(b.element,J),null!=c?c.CheckActive():this.UpdateBuiltInNavigationbarButtons(),b.IsEnabled()&&this.ClickTheButton(b.element),!0}return!1},UpdateCustomNavigationbarButtons:function(){if(null!=this._customESBtns){var a,b;for(a=0;a<this._customESBtns.length;a++)b=this._customESBtns[a],b[J]("CheckActive")}},_interview_RefreshDialogContent:function(a,b){var c,d,e,f=this.options.interview;f.IsSinglePage()?this.SinglePageUpdate():this.MultiPageUpdate(b.CurrentNodeChanged),this._currentResource=null,this.UpdateBuiltInNavigationbarButtons(),this.UpdateCustomNavigationbarButtons(),f.InEditSpreadsheetRow()?(c="hd-nav-FinishEM",d="nav_FinEM"):f.IsPopup()?(c=i.MakeBuiltInButtonImageUri(i.FinishPopupButtonName),d="nav_FinPopup"):(c=i.MakeBuiltInButtonImageUri(i.FinishButtonName),d="nav_Finish"),(D(this._finishButtonToolTipKey)||this._finishButtonToolTipKey!=d)&&(e=this.Finish.children(".hd-img"),e.removeClass().addClass("hd-img "+c),F(this.Finish,f.GetResourceString(d)),this._finishButtonToolTipKey=d)},_interview_Navigated:function(b,c){var d,e,f,g,h=this.options;if(c.s&&h.interview.IsSinglePage()&&this.ContentGrid.height()>0){if(d=h.interview[G](),null!=d){for(e=null,f=0;f<this.ContentGrid.children("tbody").length&&(e=C(this.ContentGrid.children("tbody").eq(f),"IInterviewNodeControl"),null==e||e.options.InterviewNode._id!=d._id);f++);d=e}null!=d&&d.element.scrollintoview()}null!=h.interview.CurrentNode()&&null!=h.interview.CurrentNode()._dialog&&null!=h.interview.CurrentNode()._dialog.rsrc?(g=new u(h.interview.CurrentNode()),null!=this._currentResource&&this._currentResource.Equals(g)||(this._currentResource=g)):this._currentResource=null,this.UpdateResourcePane(),c.f&&a.CallAsync(z(function(){null!=y[G]()&&y[G]().AdvanceFocus(!1,v.Forward)},this))},ScrollFocusIntoView:function(){},_interview_MoveFocus:function(){this.ScrollFocusIntoView()},SinglePageUpdate:function(){this.TitleGrid.hide();var a,c,d,e,f,g,h,i=this.options;if(0!=(i.interview.Root().DescendantUpdateflags()&n.SinglePageRelated)){for(d=0;d<i.interview.Root().Children().Count();d++){if(a=i.interview.Root().Children().get(d),c=null,(a.UpdateFlags()&n.NewlyAdded)!=n.NewlyAdded){for(e=d;e<this.ContentGrid.children("tbody").length&&C(this.ContentGrid.children("tbody").eq(e),H).options.InterviewNode._id!=a._id;e++);if(e<this.ContentGrid.children("tbody").length){for(f=d;e>f;f++)this.RemoveInterviewNodeControl(d);g=C(this.ContentGrid.children("tbody").eq(d),H),g.Update(!1),c=g}}null==c&&(h=C(a,y.RepeatNode),g=null==h||h.IsSpreadsheet()?b("<tbody/>").DialogContentControl({InterviewNode:a,caption:a.Type()!=m.DefaultDialog}):b("<tbody/>").RepeatControl({InterviewNode:h}),g.on(M,z(this.interviewNodeControl_NavigationKeyPress,this)).on(N,z(this.interviewNodeControl_ResourceUpdate,this)),C(g,H).Update(!0),c=g,c.appendTo(this.ContentGrid),window.setTimeout(function(){c.trigger("Loaded")},1)),0==d}for(;d<this.ContentGrid.children("tbody").length;)this.RemoveInterviewNodeControl(d)}},MultiPageUpdate:function(a){this.TitleGrid.show();var d,e,f,g,h,i,j,k,l,q=!1;if(a){for(this.ClearContentGrid(),d=new c,e=null!=y[G]()?C(y[G]()._parent,o):null;null!=e;)!e.IsOnParent()&&(e.Type()==m.Dialog||e.Type()==m.Iteration&&!C(e,p).IsSpreadsheetRow()||e.Type()==m.Repeat&&C(e,y.RepeatNode).IsSpreadsheet())&&d.Push(C(e,o)),e=C(e._parent,o);for(f=0;d.Count()>0;)g=b("<div/>").ParentTitleControl({node:d.Pop()}),g.appendTo(this.TitleGrid);null!=y[G]()&&(h=b("<tbody/>").appendTo(this.ContentGrid),window.setTimeout(function(){h.trigger("Loaded")},1),h.DialogContentControl({InterviewNode:y[G](),caption:!0}).on(M,z(this.interviewNodeControl_NavigationKeyPress,this)).on(N,z(this.interviewNodeControl_ResourceUpdate,this))),q=!0}if(q||0!=(this.options.interview.Root().DescendantUpdateflags()&n.DialogRelated)){for(i=0;i<this.TitleGrid.children().length;i++)g=this.TitleGrid.children(i),g.ParentTitleControl("Update",q);this.ContentGrid.children("tbody").length>0&&(h=this.ContentGrid.children("tbody"),h.appendTo(this.ContentGrid.LayoutRoot),this.ContentGrid.children("tbody").length>1&&this.ContentGrid.children("tbody:first").remove(),0==h.children(".hd-hidden-sizer").length&&b('<tr class="hd-hidden-sizer" style="visibility:hidden"><td/><td/><td/><td/><td/><td/></tr>').appendTo(h),h.find("*").load(),h.DialogContentControl("Update",q),h.DialogContentControl("option","InterviewNode").Type()==m.Iteration&&(j=C(h.DialogContentControl("option","InterviewNode"),p),j.DisplayAddButton()&&!j.IsHiddenNew()&&h.DialogContentControl("UpdateAddButton",q)))}k=b("#InterviewEngine").children().children(),l=k.InterviewControl("option","height"),k.InterviewControl({height:l}),!1},RemoveInterviewNodeControl:function(a){var b=this.ContentGrid.children("tbody").eq(a);b.off(M,this.interviewNodeControl_NavigationKeyPress).off(N,this.interviewNodeControl_ResourceUpdate),C(b,H).Dispose(),b.remove()},ClearContentGrid:function(){for(this.TitleGrid.empty();this.ContentGrid.children("tbody").length>0;)this.RemoveInterviewNodeControl(0)},Navigationbar:function(){return this.NavigationGrid},FindDialogContentControl:function(a,b){var c,d=null;for(c=0;null==d&&c<a.length;c++)d=C(a.eq(c),"DialogContentControl"),null!=d?d.options.InterviewNode._id!=b&&(d=null):d=this.FindDialogContentControl(C(a.eq(c),"RepeatControl").LayoutRoot.children(),b);return d},AdvanceFocus:function(a,c){function d(j){if(null!=j)i.interview.GotoDialog(j,h,!1,!1,function(i){return i||y.Alert(h.s),a==v.Reverse&&j.Type()==m.Iteration&&(e=j,e.DisplayAddButton&&e.AddButtonVisibility()==B.Visible&&e.AddButtonIsEnabled())?(f=this.FindDialogContentControl(ContentGrid.Children,e.ID),g=f.LayoutRoot.Children[f.LayoutRoot.Children.Count-1],g.Focus(),c(!0),void 0):(j.AdvanceFocus(!1,a,b.proxy(function(b){b?c(!0):d.call(this,j.GetNextFocusNode(a))},this)),void 0)});else{if(a==v.Forward){if("none"==this.Navigationbar().css("display"))return c(!1),void 0;if("none"!=this.Next.css("display"))this.Next.focus();else{if(null==this.FirstCustomNavButton||"none"==this.FirstCustomNavButton.css("display")||!this.FirstCustomNavButton.data("hd-"+J).IsEnabled)return c(!1),void 0;this.FirstCustomNavButton.focus()}return c(!0),void 0}if(this.focuslv)return this.element.trigger("FocusLeaving",new y[A][L](v.Reverse)),c(!0),void 0;c(!1)}}c===q&&(c=function(){});var e,f,g,h={},i=this.options;return null==i.interview[G]()?(c(!1),void 0):(d.call(this,i.interview[G]().GetNextFocusNode(a)),void 0)},OnNavigationKeyPress:function(b){if(b.Handled)return!1;var c,d,e,f,g,h,i,j,k=this.options.interview;switch(b.which){case 9:if(c=b.shiftKey?v.Reverse:v.Forward,d=null,e=a.Windows.Input.FocusManager.GetFocusedElement(),null!=e&&(d=C(e,"Button")),null!=d&&null!=d.options.Tag&&d.options.Tag instanceof o)return f=d.element.parent(),g=d.element.index(),c==v.Forward?g<f.children().length-1?(f.children().eq(g+1).focus(),b.Handled=!0):this.AdvanceFocus(c,function(a){b.Handled=a}):g>0?(f.children().eq(g-1).focus(),b.Handled=!0):null!=k[G]()?k[G]().AdvanceFocus(!1,c,z(function(a){a?b.Handled=!0:this.AdvanceFocus(c,function(a){b.Handled=a})},this)):this.AdvanceFocus(c,function(a){b.Handled=a}),b.Handled&&b.preventDefault(),void 0;null!=k[G]()&&k[G]().AdvanceFocus(!0,c,z(function(a){if(a)b.Handled=!0;else if(null!=k[G]()){if(c==v.Forward&&(h=!1,y[A][K].DisplayAnswerSourceButton(k[G]())?h=!0:k[G]().Type()==m.Iteration&&(i=k[G](),i.DisplayAddButton()&&i.AddButtonVisibility()==B.Visible&&i.AddButtonIsEnabled()&&(h=!0)),h))return j=this.FindDialogContentControl(this.ContentGrid.children("tbody"),k[G]()._id),null!=j&&(f=j.LayoutRoot.children(":last-child"),f.hasClass("hd-hidden-sizer")&&(f=f.prev()),f=f.children("td"),f.children(":first-child").focus()),b.Handled=!0,b.preventDefault(),void 0;this.AdvanceFocus(c,function(a){b.Handled=a})}},this));break;case 33:b.altKey||b.ctrlKey?b.ctrlKey&&(b.Handled=this.DoNavigation(Q.PreviousUnanswered)):b.Handled=this.DoNavigation(Q.Previous);break;case 34:b.altKey||b.ctrlKey?b.ctrlKey&&(b.Handled=this.DoNavigation(Q.NextUnanswered)):b.Handled=this.DoNavigation(Q.Next);break;case 36:b.ctrlKey&&(b.Handled=this.DoNavigation(Q.First));break;case 35:b.ctrlKey&&(b.Handled=this.DoNavigation(Q.Last))}return b.Handled?(b.stopImmediatePropagation(),b.preventDefault(),!1):void 0},OnKeyDown:function(a){if(33==a.which||34==a.which||36==a.which||35==a.which)this.OnNavigationKeyPress(a);else if(8==a.which&&"text"!=a.target.type&&"TEXTAREA"!=a.target.tagName)return!1},interviewNodeControl_NavigationKeyPress:function(a,b){this.OnNavigationKeyPress(b)},OnClosed:function(){this.element.trigger("Closed",{})},Close:function(){this.options.interview.Close()},DoNavigation:function(b){var c,d,e,f=w.ServerResponseVisible(),g=this.options.interview;if("function"!=typeof b){if(!f){switch(d=b,e=!1,d){case Q.First:g.IsFirstEnabled&&(a.CallAsync(z(function(){this.DoNavigation(g.GotoFirst)},this)),e=!0);break;case Q.PreviousUnanswered:g.IsPreviousUnansEnabled&&(a.CallAsync(z(function(){this.DoNavigation(g.GotoPrevUnans)},this)),e=!0);break;case Q.Previous:g.IsPreviousEnabled&&(a.CallAsync(z(function(){this.DoNavigation(g.GotoPrev)},this)),e=!0);break;case Q.Next:g.IsNextEnabled()&&(a.CallAsync(z(function(){this.DoNavigation(g.GotoNext)},this)),e=!0);break;case Q.NextUnanswered:g.IsNextUnansEnabled()&&(a.CallAsync(z(function(){this.DoNavigation(g.GotoNextUnans)},this)),e=!0);break;case Q.Last:g.IsLastEnabled()&&(a.CallAsync(z(function(){this.DoNavigation(g.GotoLast)},this)),e=!0);break;case Q.Finish:a.CallAsync(z(function(){this.DoNavigation(g.Finish)},this)),e=!0}e&&g.DoAnswerSync()}return e}if(!f){c=b;var h={s:""};c.call(g,h,function(a,b){!a&&!D(b)&&y.Alert(b)})}},First_Click:function(){return this.DoNavigation(y[A].NavigateOperation.First),!1},PreviousUnanswered_Click:function(){return this.DoNavigation(y[A].NavigateOperation.PreviousUnanswered),!1},Previous_Click:function(){return this.DoNavigation(y[A].NavigateOperation.Previous),!1},Next_Click:function(){return this.DoNavigation(y[A].NavigateOperation.Next),!1},NextUnanswered_Click:function(){return this.DoNavigation(y[A].NavigateOperation.NextUnanswered),!1},Last_Click:function(){return this.DoNavigation(y[A].NavigateOperation.Last),!1},Finish_Click:function(){return this.DoNavigation(y[A].NavigateOperation.Finish),!1},More_Click:function(){function a(a,d){this.Navigationbar().find(a).children("button").each(function(){var a=C(b(this),"Button"),e=!a.element.attr("disabled"),f=a.options.tip;D(f)&&(f=a.element.attr("title"));var g=o.FixAmpersands(a.options.label,!1);D(g)&&(g=f);var h=b("<div/>").attr("title",f).appendTo(d).MenuItem({Label:g,Tag:c.length,IsEnabled:e});h.find(".hd-menu-icon").replaceWith(a.icon.clone().addClass("hd-menu-icon").css("float","left")),c.push(a.element)})}var c=[];return null==this.MorePopup&&(this.MorePopup=b("<div/>").Popup({anchor:this.More,anchorPos:"t",open:function(a){var c=0;a.element.find(".hd-menu-item").css("width","auto").each(function(){c=Math.max(c,b(this).outerWidth())}),a.element.find(".hd-menu-item").css("width",.98*c),a.element.find(".hd-menu-base").width(c)}}).css("width","auto"),this.MoreMenu=b("<div/>").appendTo(this.MorePopup).Menu().on("ItemSelected",z(function(a,b){this.MorePopup.Popup("close"),c[b].click()},this))),this.MoreMenu.empty(),a.call(this,".hd-nav-left",this.MoreMenu),a.call(this,".hd-nav-middle",this.MoreMenu),a.call(this,".hd-nav-right",this.MoreMenu),this.MorePopup.Popup("open"),!1},Finish_KeyDown:function(a){9==a.which&&!a.shiftKey&&this.element.trigger("FocusLeaving",new y[A][L](v.Forward))},UpdateResourcePane:function(){var c="",d=b(".sliding-resource-pane");if(null!=this._currentResource)if(this._currentResource.Type==P.DialogResource){var e=new a.Text.StringBuilder;y[A][K].AppendResource(e,this._currentResource.InterviewNode._dialog.rsrc,this._currentResource.InterviewNode,this._currentResource.InterviewNode._dialog,null),c=e.ToString()}else c=this.GetResourceText(this._currentResource.DialogItemNode,this._currentResource.OptionName,!0);d.html(c),b(".hd-collapse-bar:last").children(".hdtb-btnrs").removeClass("hd-img hd-img-g").addClass(D(c)?"hd-img-g":"hd-img"),this.ResourcePane.HtmlHostControl("SetText",c)},GetResourceText:function(b,c,d){for(var e,f,g,h,i=new a.Text.StringBuilder,j=b.DialogItem(),k=b._parent;null!=j&&(d||"DI"!=j.type||j.onPar)&&(e=C(j,y.Variable),null!=e&&("MC"==e.type&&!D(c)&&(f=C(e,y.McVar).opts.GetItem(c),null!=f&&y[A][K].AppendResource(i,f.rsrc,b._parent,j,c)),y[A][K].AppendResource(i,e.rsrc,b._parent,j,null)),"DI"!=j.type||null==k||k.Type()!=m.Iteration||!k.IsSpreadsheetRowInEditMode()||!j.onPar)&&(g="DI"==j.type,h=g&&C(j,y.Dlg).onPar,j=null!=j.parent||null==k||k._dialog.lnkVars?j.parent:k._dialog,null!=j&&(k=k.OutlineParent(),null!=k&&k.Type()==m.Repeat&&(k=k.OutlineParent())),!g||h||null==j||"DI"!=j.type););return i.ToString()},AppendResource:function(b,c,d,e,f){if(null!=c){var g,h,i,k,m="";"T"==c.type?m=c.EvText():"U"==c.type&&(m=c.EvText()),D(m)||(b.Length>0&&b.Append("<hr/>"),"U"==c.type?(g="",g="MC"!=e.type||D(f)?"DI"==e.type?d.GetResourceString("rs_dlg"):d.GetResourceString("rs_fld"):d.GetResourceString("rs_opt"),h=d.GetResourceButtonCaption(),i=d.GetResourceString("rs_ind"),b.Append(s(c.EvText(),!1,g,h,i))):(k=new a.Text.StringBuilder,y[A][K].DotCodeParser().Parse(new j(c.EvText()),new l(k)),b.Append(k.ToString())))}},interviewNodeControl_ResourceUpdate:function(a,b){var c=new u(b.DialogItemNode,b.OptionName);null!=this._currentResource&&this._currentResource.Equals(c)||(h.Focus(b.DialogItemNode,E("ResourceUpdate({0})",D(b.OptionName)?"null":b.OptionName)),this._currentResource=c,this.UpdateResourcePane())}}},y.Class[L]={N:A,C:function(a){this.FocusDirection=a}},y.Class.ResourceUpdateEventArgs={N:A,C:function(a,b){this.DialogItemNode=a,this.OptionName=b},P:{Equals:function(a){var b=C(a,y[A].ResourceUpdateEventArgs);return null!=b?b.DialogItemNode==this.DialogItemNode&&b.OptionName==this.OptionName:!1}}}}),define("dialog/dialoginputcontrol",["hdmain/jq","dialog/textblockformatter","engine/dialogupdateflags"],function(a,b,c,d){var e=HOTDOC$;this.DEBUG===d&&(this.DEBUG=e.DEBUG);var f,g=a.proxy,h="ChildDialogControl";e.Class.DialogInputControl={B:"InputControl",SC:function(){f=a.hd.InputControl.prototype},W:{_create:function(){f._create.apply(this,arguments),this.element.attr("widget","DialogInputControl"),this._childDialogControl=a("<div/>")[h]().appendTo(this.ControlCell).on("NavigateToChild",g(this._childDialogControl_NavigateToChild,this)),""!=this.Dialog().gType&&this._childDialogControl[h]({GroupType:this.Dialog().gType}).on("Checked",g(this._childDialogControl_Checked,this)).on("Unchecked",g(this._childDialogControl_Unchecked,this)),this.options.IsEnabledChanged=g(this.DialogInputControl_IsEnabledChanged,this)},_setOption:function(a,b){switch(a){case"IsEnabled":this.element.find("input,button").prop("disabled",!b);break;case"IsReadOnly":b!=this._isReadOnly&&(this.UpdateState(b),this._isReadOnly=b);break;case"IsSetByDialogScript":b!=this._isSetByDialogScript&&(this.UpdateState(b),this._isSetByDialogScript=b)}f._setOption.apply(this,arguments)},Update:function(a){if(f.Update.call(this,a),(a||(this._dialogItemNode.UpdateFlags()&c.AnsweredStatus)==c.AnsweredStatus)&&this._childDialogControl[h]({AnsweredStatus:this._dialogItemNode.AnsweredStatus()}),a||(this._dialogItemNode.UpdateFlags()&c.Prompt)==c.Prompt){var d=new e.Dialog.PromptParserSource(this._dialogItemNode);e.Dialog.DialogControl.DotCodeParser().Parse(d,new b(this._childDialogControl.data("hd-ChildDialogControl").PromptText,this._childDialogControl.data("hd-ChildDialogControl").PromptText.css("font-size"),d.Required()))}},DisplayPrompt:function(){return!1},FieldWidth:function(){return"F"},QuixelFactor:function(){return 0},CalculatedWidth:function(){return 0},DisplayClearAnswer:function(){return f.DisplayClearAnswer.apply(this)&&""!=this._childDialogControl[h]("option","GroupType")},DisplayResource:function(){return!1},_childDialogControl_NavigateToChild:function(){""!=this.Dialog().gType&&(this._dialogItemNode.BoolAnswer(!0),this.SetControlAnswer());var a,b=this._dialogItemNode._parent.Children().get(this._dialogItemNode.DialogItem().name);null!=b&&(a={s:null},b.NavigateTo(!0,a,function(b){b||e.Alert(a)}))},_childDialogControl_Checked:function(){this._inUpdateControlAnswer||this._dialogItemNode.BoolAnswer(this._childDialogControl[h]("option","IsChecked"))},_childDialogControl_Unchecked:function(){this._inUpdateControlAnswer||this._dialogItemNode.BoolAnswer(this._childDialogControl[h]("option","IsChecked"))},SetControlAnswer:function(){""!=this.Dialog().gType&&(this._inUpdateControlAnswer=!0,this._childDialogControl[h]({IsChecked:this._dialogItemNode.BoolAnswer()}),this._inUpdateControlAnswer=!1)},SetFocus:function(a){this._childDialogControl[h]("SetFocus",a)},SaveControlAnswer:function(){},UpdateState:function(a){""!=this.Dialog().gType&&(a?(this._setOption("IsEnabled",this._childDialogControl[h]("option","IsChecked")),this._childDialogControl[h]({IsButtonEnabled:!1})):(this._setOption("IsEnabled",!0),this._childDialogControl[h]({IsButtonEnabled:!0})))},DialogInputControl_IsEnabledChanged:function(){this._childDialogControl[h]({IsEnabled:this.options.IsEnabled})}}}}),define("dialog/htmlhostcontrol",["hdmain/system"],function(a){var b=HOTDOC$,c=a.String.Format;b.Class.HtmlHostControl={W:{_create:function(){this.element.hide(),this._id=c("HtmlHost{0}",a.Guid.NewGuid()),this._innerDiv=b.jq("<div/>").appendTo(this.element).attr("id","inner_"+this._id)},SetText:function(a){a=a.replace(/\<\u0020|\u0020\>/gi,function(a){return"< "==a?"&lt; ":" &gt;"}),a=a.replace(/\<\w*\>|\<\/\w*\>/gi,function(a,b,d){var e,f;switch("/"==a.substr(1,1)?(f=a.substr(2,a.length-3).toUpperCase(),e=!1):(f=a.substr(1,a.length-2).toUpperCase(),e=!0),f){case"":return"/"==a.substr[1]?"":"&lt;&gt;";case"BR":case"HR":if(e){var g=d.substr(b+a.length).match(/\<\w*\>|\<\/\w*\>/i);if(null==g||g[0].toUpperCase()!=c("</{0}>",f))return c("<{0}/>",f)}return a;case"H1":case"H2":case"H3":case"IMG":case"P":case"DIV":case"SPAN":case"A":case"B":case"STRONG":case"I":case"ITALIC":case"U":case"UNDERLINE":return a;default:return""}});try{var d=b.jq.parseXML("<div>"+a+"</div>");b.jq(d).find("*").each(function(){for(var a=0;a<this.attributes.length;a++)"on"==this.attributes[a].name.toLowerCase().substr(0,2)&&this.removeAttribute(this.attributes[a].name)}),"undefined"!=typeof XMLSerializer?this._innerDiv.html((new XMLSerializer).serializeToString(d)):"undefined"!=typeof d.xml&&this._innerDiv.html(d.xml)}catch(e){this._innerDiv.html(e.message.replace(/</gi,"&lt;").replace(/>/gi,"&gt;"))}}}}}),define("dialog/inputcontrol",["hdmain/jq","hdmain/system","system/jquery.hd.popup","dialog/tracehelper","engine/htmlformatter","engine/dialogupdateflags"],function(a,b,c,d,e,f){function g(a){this.ClearAnswer(),a.preventDefault()}function h(){var a=k.Dialog.DialogControl.GetResourceText(this._dialogItemNode,this.ResourceOptionName(),!1);k.Dialog.DialogControl.DisplayResourceWindow(a,this._dialogItemNode._parent.GetResourceButtonCaption())}var i,j,k=HOTDOC$,l=a.proxy,m=b.String.Format,n=b.Windows.Controls.ToolTipService.SetToolTip,o=b.Windows.Visibility,p="InputControl",q="UpdateResourceAndClearAnswerButtons",r="IsSetByDialogScript",s="IsReadOnly",t="IsGray";k.Class[p]={B:"IDialogItemNodeControl",SC:function(){var b=a("<span>5</span>").hide().appendTo("body");i=b.width(),b.remove()},W:{_create:function(){"undefined"==typeof j&&(j=new b.Text.StringBuilder),this.LayoutRoot=this.element,this.ControlGrid=a("<table/>").appendTo(this.LayoutRoot),this.ControlRow=a("<tr/>").appendTo(this.ControlGrid),this.ControlCell=a("<td/>").appendTo(this.ControlRow),this._calculatedWidth=0,this.InputControlButtons=[a('<td class="hd-cell-button"/>').appendTo(this.ControlRow),a('<td class="hd-cell-button"/>').appendTo(this.ControlRow)],this.ResourceImage=a('<div class="hd-rsrc" name="HDRsrcBtn"/>').appendTo(this.InputControlButtons[0]),this.ClearAnswerImage=a('<div class="hd-img hd-clr-ans"/>').css("visibility","hidden").appendTo(this.InputControlButtons[1]),this.ValidationError=a("<div/>").ValidationErrorControl().appendTo(this.LayoutRoot),this._dialogItemNode=this.options.node,this._prompt=a("<div/>"),this.PositionPrompt("T"==this.PromptPosition()?"T":"L"),this.element.on("GotFocus."+p,l(this.InputControl_GotFocus,this)).on("blur."+p,"input, textarea",l(this.InputControl_LostFocus,this)).on("mouseenter."+p,l(this.InputControl_MouseEnter,this)).on("mouseleave."+p,l(this.InputControl_MouseLeave,this)).on("Loaded."+p,l(this.InputControl_Loaded,this)).on("keydown."+p,l(this.OnKeyDown,this)),this._dialogItemNode.FocusEntering.unshift(l(this._dialogItemNode_FocusEntering,this)),this._dialogItemNode.FocusLeaving.unshift(l(this._dialogItemNode_FocusLeaving,this)),this._dialogItemNode.AnswerSync.unshift(l(this._dialogItemNode_AnswerSync,this))},_setOption:function(b,c){var d=this.options;switch(b){case"IsEnabled":d[b]=c,d.IsEnabledChanged&&d.IsEnabledChanged();break;case"Visibility":this.element[c==o.Collapsed?"hide":"show"]();break;case"ResourceVisibility":c==o.Collapsed&&this.InputControlButtons[0].insertAfter(this.InputControlButtons[1]);break;case t:c!=d._isGray&&(this._setOption("IsEnabled",!c),this.IsResourceEnabled(!c),d._isGray=c);break;case s:c!=this._isReadOnly&&(this._isReadOnly=c);break;case r:c!=this._isSetByDialogScript&&(this._setOption("IsEnabled",!c),this._isSetByDialogScript=c);break;case"ClearAnswerVisibility":d.ClearAnswerVisibility!=c&&(c==o.Visible?this.ClearAnswerImage.css("visibility","visible").on("click",l(g,this)):this.ClearAnswerImage.css("visibility","hidden").off("click",g))}a.hd.IDialogItemNodeControl.prototype._setOption.apply(this,arguments)},OnKeyDown:function(a){13==a.which&&this.element.find("input").length>0&&a.preventDefault()},UpdateResourceButton:function(){this.DisplayResource()&&this.HasResource()?(this.option({ResourceVisibility:o.Visible}),this._dialogItemNode.ShowAllResourceButtons()?this.ResourceImage.css("visibility","visible"):this.ResourceImage.css("visibility",this.options._isMouseOver||this.options._hasFocus?"visible":"hidden")):this.option({ResourceVisibility:o.Collapsed})},UpdateClearAnswerButton:function(){this.DisplayClearAnswer()?(this._setOption("ClearAnswerVisibility",o.Visible),this.ClearAnswerImage.css("visibility",this.options._isMouseOver||this.options._hasFocus?"visible":"hidden")):this._setOption("ClearAnswerVisibility",o.Collapsed)},UpdateResourceAndClearAnswerButtons:function(){this.UpdateResourceButton(),this.UpdateClearAnswerButton()},InputControl_MouseEnter:function(){this.options._isMouseOver=!0,this[q]()},InputControl_MouseLeave:function(){this.options._isMouseOver=!1,this[q]()},InputControl_Loaded:function(){this.element.on("focus","input, textarea",l(function(){this.element.closest(".hd-cell-input").trigger("GotFocus")},this)),this.UpdateControlWidth(),this[q](),this.IsResourceEnabled(this.DisplayResource()&&this.HasResource()&&!this._dialogItemNode.Gray()),n(this.ClearAnswerImage,this.GetResourceString("hdmnuClearAns")),n(this.ResourceImage,this._dialogItemNode._parent.GetResourceButtonCaption()),n(this.ValidationError.children("div"),this.GetResourceString("ui_err"))},PositionPrompt:function(b){"T"==b?(this._prompt.css({position:"inherit",width:"auto","text-align":"left"}).prependTo(this.LayoutRoot),this._promptCell&&this._promptCell.remove()):(this._prompt.width(this.PromptMaxWidth()),this._promptCell=a("<td/>").prependTo(this.ControlCell.parent()),this._prompt.appendTo(this._promptCell).css("text-align",this.Dialog().prmtAlgn?"left":"right")),this.options._resolvedPromptPosition=b},_prompt_LayoutUpdated:function(){var a=this.PromptPosition();"A"==a&&(a=this._prompt.height()>16?"T":"L"),a!=this.options._resolvedPromptPosition&&this.PositionPrompt(a)},Dispose:function(){},Update:function(a){var b,c=this._dialogItemNode.UpdateFlags(),d=l(this._setOption,this);(a||(c&f.Hidden)==f.Hidden)&&d("Visibility",this._dialogItemNode.Hidden()?o.Collapsed:o.Visible),(a||(this._dialogItemNode.UpdateFlags()&f.ScriptAnswer)==f.ScriptAnswer)&&this.SetControlAnswer(),(a||0!=(c&(f.Gray|f.set)))&&(this._dialogItemNode.Gray()?(d(r,!1),d(s,!1),d(t,!0)):this._dialogItemNode.SetByDialogScript()?(d(t,!1),d(s,!1),d(r,!0)):this._dialogItemNode.ReadOnly()?(d(t,!1),d(r,!1),d(s,!0)):(d(t,!1),d(r,!1),d(s,!1)),(a||(c&f.Gray)==f.Gray)&&(c|=f.Prompt)),(a||0!=(c&(f.Required|f.RequiredAnswer)))&&(c|=f.Prompt),this.DisplayPrompt()?(this._prompt.show(),(a||(c&f.Prompt)==f.Prompt)&&(b=new k.Dialog.PromptParserSource(this._dialogItemNode),j.Clear(),b.Required()&&j.Append("*"),k.Dialog.DialogControl.DotCodeParser().Parse(b,new e(j),!0),this._prompt.html(j.ToString()).removeClass().addClass("hd-input-prompt "+b.TextColor()),"A"==this.PromptPosition()&&"L"!=this.options._resolvedPromptPosition&&this.PositionPrompt("L"),this._prompt_LayoutUpdated())):this._prompt.hide()
},FireNavigationKeyPress:function(a){this.element.trigger("NavigationKeyPress",a)},FireResourceUpdate:function(){this.DisplayResource()&&this.element.trigger("ResourceUpdate",new k.Dialog.ResourceUpdateEventArgs(this._dialogItemNode,this.ResourceOptionName()))},DialogItemNode:function(){return this._dialogItemNode},Dialog:function(){return this._dialogItemNode._parent._dialog},Variable:function(){return this._dialogItemNode.DialogItem()},GetResourceString:function(a){return this._dialogItemNode._parent.GetResourceString(a)},DisplayPrompt:function(){return"NONE"!=this._dialogItemNode.Prompt()},PromptPosition:function(){return 100!=this._dialogItemNode.GetWidth()?"T":this.Dialog().prmtPos},PromptMaxWidth:function(){return this.Dialog().maxPWid*i},PromptVerticalAlignment:function(){return k.VerticalAlignment.Top},DisplayClearAnswer:function(){return!this._dialogItemNode.ReadOnly()&&!this._dialogItemNode.Gray()&&!this._dialogItemNode.SetByDialogScript()},DisplayResource:function(){return!0},HasResource:function(){return null!=this._dialogItemNode.Resource()},ResourceOptionName:function(){return null},FieldWidth:function(){return this.Variable().fldWT},FieldWidthValue:function(){return this.Variable().fldWid},ExactWidth:function(){return this.FieldWidthValue()*this.QuixelFactor()+.75*this.QuixelFactor()},UpdateControlWidth:function(){var a,b;"F"!=this.FieldWidth()?(a="E"==this.FieldWidth(),b=a?this.ExactWidth():this.CalculatedWidth(),this.ControlCell.width(b).addClass("hd-width-"+(a?"exact":"calc")).attr("hdwidth",b).closest("table").css("width","auto")):(this.ControlGrid.css("width","100%"),this.ControlCell.css("width","100%"))},ControlWidth:function(a){return a.outerWidth()-a.width()},ShowBorderEnabled:function(a,b){a.toggleClass("hd-input-box-disabled",!b)},IsResourceEnabled:function(a){var b=this.ResourceImage;return"boolean"!=typeof a?b.hasClass("hd-img"):((a&&!b.hasClass("hd-img")||!a&&!b.hasClass("hd-img-g"))&&(a?b.addClass("hd-img").removeClass("hd-img-g").on("click."+p,l(h,this)):b.addClass("hd-img-g").removeClass("hd-img").off("click",h)),void 0)},ClearAnswer:function(){this._dialogItemNode.ClearAnswer()},Dispose:function(a){"boolean"!=typeof a&&(a=!0),a&&(this.element.off("GotFocus."+p,this.InputControl_GotFocus).off("LostFocus."+p,this.InputControl_LostFocus),this._dialogItemNode.FocusEntering.pop(),this._dialogItemNode.FocusLeaving.pop(),this._dialogItemNode.AnswerSync.pop())},_dialogItemNode_FocusEntering:function(a,b){d.Focus(this._dialogItemNode,m("FocusEntering({0})",b.OptionName)),this.SetFocus(b.OptionName),this.options._hasFocus=!0,this[q](),this.FireResourceUpdate()},_dialogItemNode_FocusLeaving:function(){d.Focus(this._dialogItemNode,"FocusLeaving"),this.options._hasFocus=!1,this[q]()},_dialogItemNode_AnswerSync:function(){d.Focus(this._dialogItemNode,"AnswerSync"),this._dialogItemNode.ReadOnly()||this.SaveControlAnswer()},FocusOptionName:function(){return""},InputControl_GotFocus:function(){a(".hd-menu").parent().Popup("close");var c,e,f=this.FocusOptionName();for(d.Focus(this._dialogItemNode,m("GotFocus({0})",f)),this._dialogItemNode.SetFocus(f),c=this.element;null!=c&&c.length>0&&null==b.Cast(c,"DialogControl");)c=c.parent();null!=c&&c.length>0&&(e=b.Cast(c,"DialogControl"),e.ScrollFocusIntoView()),this.options._hasFocus=!0,this[q](),this.FireResourceUpdate()},InputControl_LostFocus:function(){this.options._hasFocus=!1,this[q]()}}}}),define("dialog/interviewstack",["hdmain/stack","hdmain/jq"],function(a,b,c){function d(a,b,c){this.Source=a,this.Interview=b,this.ParentInterview=c}function e(a,b){this.Interview=a,this.ClosedInterview=b}var f=HOTDOC$;this.DEBUG===c&&(this.DEBUG=f.DEBUG);var g={s_interviewStack:new a,PushInterview:function(a){var c=this.Depth()>1?this.CurrentInterview().ComputationVariableName():null;this.s_interviewStack.Push(a),this.InPopupInterview()&&b(this).trigger("PopupInterviewOpened",a,new d(a.ScriptLinkDialogElementName(),a.ComputationVariableName(),c))},PopInterview:function(){var a,c=this.InPopupInterview(),d=this.s_interviewStack.Pop();return c&&(a=this.Depth()>1?this.CurrentInterview().ComputationVariableName():null,b(this).trigger("PopupInterviewClosed",this.CurrentInterview(),new e(a,d.ComputationVariableName()))),d},Depth:function(){return this.s_interviewStack.Count()},CurrentInterview:function(){return this.s_interviewStack.Peek()},InPopupInterview:function(){return this.Depth()>1}},h="Dialog";return f[h].InterviewStack=g,f[h].InterviewOpenedEventArgs=d,f[h].InterviewClosedEventArgs=e,g}),define("dialog/iterationrow",["hdmain/jq","hdmain/system","system/exception","dialog/tracehelper","engine/dialogupdateflags"],function(a,b,c,d,e,f){function g(a,c){var e=a;d.Focus(e,q),b.Windows.Input.FocusManager.GetFocusedElement()!=this._spreadsheet&&this._spreadsheet.focus(),this.SetCurrentCell(this.DialogItemNodeToColumnNumber(e),!1,c.OptionName)}function h(a){d.Focus(a,r),this.EndCellEdit()}function i(){if(this.EditColumnNumber>=0){var a=this.Cells[this.EditColumnNumber];d.Focus(a.DialogItemNode(),p),a.SaveAnswer()}}function j(a,b){for(var c=0;c<this.ErrorStateChanged.length;c++)this.ErrorStateChanged[c](this,new m.Dialog.ErrorStateChangeEventArgs(this.DialogItemNodeToColumnNumber(a),this._iterationNode.IterationId(),b.IsError,b.ErrorMessage))}function k(){if(this.EditColumnNumber>=0){var a=this.Cells[this.EditColumnNumber];d.Focus(a.DialogItemNode(),t),a.Update(!0)}}function l(a){this.ChildDialogCell=a}var m=HOTDOC$;this.DEBUG===f&&(this.DEBUG=m.DEBUG);var n=a.proxy,o=b.Cast,p="AnswerSync",q="FocusEntering",r="FocusLeaving",s="ChangeErrorState",t="AnswerReformatted";m.Class.IterationRow={C:function(b,d){var e,f,l,o,p,q,r=a.hd.SpreadsheetControl.prototype,u=[];for(this.ErrorStateChanged=[],this.OptionSelected=[],this.NavigateToChild=[],this.CellEditStarted=[],this.CellEditEnded=[],this.PropertyChanged=[],this._inSettingCell=!1,this._spreadsheet=b,this._iterationNode=d,f=r.GetColumnItemNodes(this._iterationNode),l=0;l<f.length;l++){switch(o=f[l],o.FocusEntering.push(n(g,this)),o.FocusLeaving.push(n(h,this)),o.AnswerSync.push(n(i,this)),o[s].push(n(j,this)),o[t].push(n(k,this)),o.DialogItem().type){case"TX":e=new m.TextVariableCell(o);break;case"NU":e=new m.NumberVariableCell(o);break;case"DA":e=new m.DateVariableCell(o);break;case"TF":e=new m.TrueFalseVariableCell(o);break;case"MC":p=new m.MultipleChoiceVariableCell(o),p.OptionSelected.push(n(this.mcVarCell_OptionSelected,this)),e=p;break;case"DI":q=new m.ChildDialogCell(o),q.NavigateToChild.push(n(this.childDialogCell_NavigateToChild,this)),e=q;break;default:throw new c("Invalid spreadsheet column type.")}u.push(e)}this.Cells=u,this.EditColumnNumber=-1},P:{Dispose:function(a){if("boolean"!=typeof a&&(a=!0),a){this.EndCellEdit();var b,c,d;for(b in this.Cells)isNaN(parseInt(b))||(c=o(this.Cells[b],m.VariableCell),d=c._dialogItemNode,d.FocusEntering.pop(),d.FocusLeaving.pop(),d.AnswerSync.pop(),d[s].pop(),d[t].pop(),"MultipleChoiceVariableCell"==c.widgetName?c.OptionSelected.pop():"ChildDialogCell"==c.widgetName&&c.NavigateToChild.pop())}},IterationNode:function(){return this._iterationNode},RowNumber:function(a){return a===f?this._rowNumber:(a!=this._rowNumber&&(this._rowNumber=a,this.OnPropertyChanged("RowNumber")),void 0)},EditControl:function(){return this.EditColumnNumber>=0?this.Cells[this.EditColumnNumber].EditControl():null},OnPropertyChanged:function(a){b.CallAsync(n(function(){for(var b=0;b<this.PropertyChanged.length;b++)this.PropertyChanged[b]({PropertyName:a})},this))},Update:function(a){var b;if(a||0!=(this._iterationNode.UpdateFlags()&(e.Gray|e.set|e.AnsweredStatus|e.ScriptAnswer)))for(b in this.Cells)isNaN(parseInt(b))||o(this.Cells[b],m.VariableCell).Update(a)},DialogItemNodeToColumnNumber:function(a){for(var b=0;this.Cells[b].DialogItemNode()!=a;)++b;return b},SetCurrentDialogItem:function(a){if(!this._inSettingCell){var b=o(this.Cells[a],m.VariableCell)._dialogItemNode;d.Focus(b,"SetCurrentDialogItem"),this._editOptionName="DI"==b.DialogItem().type?m.GroupedChildOptionName:null,b.SetFocus(this._editOptionName),b.AssertFocus(m.FocusOperation.ReassertOnly,m.FocusDirection.Forward,n(function(){this._spreadsheet.Spreadsheet("option","Columns").get(a)instanceof m.TrueFalseVariableColumn||this._spreadsheet.Spreadsheet("option","Columns").get(a)instanceof m.ChildDialogColumn?this.BeginCellEdit(a,this._spreadsheet.Spreadsheet("option","Columns").get(a).GetCellContent(this)):this._spreadsheet.Spreadsheet("BeginEdit")},this))}},SetCurrentCell:function(a,b,c){if(!this._inSettingCell){this._inSettingCell=!0;var e,f,g;this.EditColumnNumber>=0&&a==this.EditColumnNumber?(e=o(this.Cells[this.EditColumnNumber],m.VariableCell).EditControl(),f=o(e,"ChildDialogControl"),null!=f&&f.SetFocus(c)):(g=o(this.Cells[a],m.VariableCell)._dialogItemNode,d.Focus(g,"SetCurrentCell"),this._spreadsheet.Spreadsheet({SelectedItem:this}),this._spreadsheet.Spreadsheet("CurrentColumn",this._spreadsheet.Spreadsheet("option","Columns").get(a)),this._spreadsheet.Spreadsheet("ScrollIntoView",this,this._spreadsheet.Spreadsheet("option","Columns").get(a)),b&&g.SetFocus(c),this._editOptionName=c,this._spreadsheet.Spreadsheet("option","Columns").get(a)instanceof m.TrueFalseVariableColumn||this._spreadsheet.Spreadsheet("option","Columns").get(a)instanceof m.ChildDialogColumn?this.BeginCellEdit(a,this._spreadsheet.Spreadsheet("option","Columns").get(a).GetCellContent(this)):this._spreadsheet.Spreadsheet("BeginEdit")),this._inSettingCell=!1}},BeginCellEdit:function(a,b){var c,e,f;for(this.EditColumnNumber=a,c=b,e=o(this.Cells[a],m.VariableCell),d.Focus(e.DialogItemNode(),"BeginCellEdit"),e.DialogItemNode().SetFocus(this._editOptionName),e.BeginEdit(c,this._editOptionName),this._editOptionName=null,f=0;f<this.CellEditStarted.length;f++)this.CellEditStarted[f](this,{})},EndCellEdit:function(){var a,c;for(this.EditColumnNumber>=0&&(a=this.Cells[this.EditColumnNumber],d.Focus(a.DialogItemNode(),"EndCellEdit"),a.EndEdit(),this._spreadsheet.Spreadsheet("CommitEdit",b.Windows.Controls.DataGridEditingUnit.Cell,!0),this.EditColumnNumber=-1),c=0;c<this.CellEditEnded.length;c++)this.CellEditEnded[c](this,{})},mcVarCell_OptionSelected:function(){for(var a=0;a<this.OptionSelected.length;a++)this.OptionSelected[a](this,{})},childDialogCell_NavigateToChild:function(a){for(var b=0;b<this.NavigateToChild.length;b++)this.NavigateToChild[b](this,new l(a))}}},m.Class.ErrorStateChangeEventArgs={N:"Dialog",C:function(a,b,c,d){this.Column=a,this.IterationId=b,this.IsError=c,this.Message=d},P:{Equals:function(a){var b;return null!=b?a.IterationId==this._iterationId&&a.Column==this._column:!1}}},m.Dialog.OptionSelectedEventArgs=function(a){this.OptionName=a}}),define("dialog/linkcontrol",["hdmain/jq","hdmain/system","dialog/tracehelper","dialog/textblockformatter","engine/htmlformatter","engine/dialogupdateflags"],function(a,b,c,d,e,f,g){function h(){b.CallAsync(n(function(){this.ResizePopupInterviewWindow()},this))}function i(){l.HDEngine.Host.off("Resized."+p,h),this._popupInterviewWindow=null}function j(a,b){c.Focus(this._dialogItemNode,o("FocusEntering({0})",b.OptionName)),this.button.focus()}function k(){c.Focus(this._dialogItemNode,o("GotFocus({0})","")),this._dialogItemNode.SetFocus("")}var l=HOTDOC$;this.DEBUG===g&&(this.DEBUG=l.DEBUG);var m,n=a.proxy,o=b.String.Format,p="LinkControl",q=5;l.Class[p]={B:"IDialogItemNodeControl",SC:function(){var b=a("<span>5</span>").hide().appendTo("body");m=b.width(),b.remove()},W:{_create:function(){this._dialogItemNode=this.options.node,this._dialogItemNode.FocusEntering.push(n(j,this));var c,d=b.Cast(this._dialogItemNode.DialogItem(),l.LDlgEl);this.button=a("<button/>").appendTo(this.element).on("focus."+p,n(k,this)).css("padding",q).on("click",n(this.hyperlink_Click,this)),"B"==d.dTyp?(d.bWid>0&&this.button.width(d.bWid*m),d.bHgt>0&&this.button.height(d.bHgt*m),2==d.style?(c=a("<img/>").attr("src",this._dialogItemNode._parent.InterviewImageUrl()+d.img),c.appendTo(this.button)):(this._linkTextBlock=a("<span/>"),this._linkTextBlock.appendTo(this.button))):(d.style>1&&(c=a('<img style="margin-right:5px"/>').attr("src",this._dialogItemNode._parent.InterviewImageUrl()+d.img),c.appendTo(this.button)),(1==d.style||3==d.style)&&(this._linkTextBlock=a("<span/>"),this._linkTextBlock.appendTo(this.button),this._linkTextBlock.addClass("DlgElemLnkText")),this.button.addClass("DlgElemLnk"))},Update:function(a){var c,e,g=b.Cast(this._dialogItemNode.DialogItem(),l.LDlgEl),h=this._dialogItemNode.UpdateFlags();(a||(h&f.Hidden)==f.Hidden)&&(this._dialogItemNode.Hidden()?this.button.hide():this.button.show()),(a||(h&f.Gray)==f.Gray)&&(e=this._dialogItemNode.Gray(),"H"==g.dTyp&&null!=this._linkTextBlock&&this._linkTextBlock.toggleClass("GrayText",e),this.button.prop("disabled",e).children("img").fadeTo(0,e?.3:1)),null!=this._linkTextBlock&&(a||(h&f.Prompt)==f.Prompt)&&(c=new l.Dialog.PromptParserSource(this._dialogItemNode),l.Dialog.DialogControl.DotCodeParser().Parse(c,new d(this._linkTextBlock,parseInt(this._linkTextBlock.css("font-size")),!1)))},FireNavigationKeyPress:function(a){this.element.trigger("NavigationKeyPress",a)},FireResourceUpdate:function(a){this.element.trigger("ResourceUpdate",a)},DialogItemNode:function(){return this._dialogItemNode},Dispose:function(a){"boolean"!=typeof a&&(a=!0),a&&(this.button.off("focus."+p),this._dialogItemNode.FocusEntering.pop())},hyperlink_Click:function(){this.button.focus();var b,c,d,f,g=this._dialogItemNode.DialogItem();if(g instanceof l.SlDlgEl)b=this._dialogItemNode.EvaluateComputedVariable(),null!=b&&(c=g,this._popupInterviewWindow=a("<div/>").PopupInterviewWindow({close:n(i,this),interview:b,dlgEl:c.name,compVar:c.varName}),this.ResizePopupInterviewWindow(),l.HDEngine.Host.on("Resized."+p,n(h,this)),this._popupInterviewWindow.PopupInterviewWindow("open"));else{d=g,f=e.MakeAbsoluteUrl(d.url,!0);try{0==f.indexOf("javascript:")?HDAPI._DoWebLinkAction(f):window.open(f,"_blank",d.openF)}catch(j){}}return!1},ResizePopupInterviewWindow:function(){this._popupInterviewWindow.PopupInterviewWindow({height:Math.round(.8*a("#hdWrapper").height()),width:Math.round(.8*a("#hdWrapper").width())});var b=this._popupInterviewWindow.find(".hd-dlg-content"),c=a("#hdNavBar"),d=this._popupInterviewWindow.find(".hd-progress");b.height(this._popupInterviewWindow.outerHeight()-c.outerHeight(!0)-d.outerHeight(!0))}}}}),define("dialog/multchoicecombobox",["hdmain/jq","hdmain/system"],function(a,b,c){var d=HOTDOC$;d.Class.MultChoiceComboBox={W:{_create:function(){this.element.on("keydown",a.proxy(this.OnKeyDown,this)).addClass("hd-input-mc").css({margin:"0px",width:"100%"}),this.option(this.options)},_setOption:function(b,c){switch(b){case"ItemsSource":this.element.empty(),a("<option/>").appendTo(this.element);for(var d=0;d<c.length;d++)a('<option value="'+c[d].Name()+'">'+c[d].Prompt()+"</option>").appendTo(this.element);this.Items=c}a.Widget.prototype._setOption.apply(this,arguments)},OnKeyDown:function(a){if(this.Items&&this.Items.length>0){var c=null;if(a.which>=65&&a.which<=90?c=String.fromCharCode(a.which):a.which>=48&&a.which<=57?c=String.fromCharCode(a.which):a.which>=96&&a.which<=105&&(c=String.fromCharCode(a.which-48)),null!=c)for(var d=this.element.prop("selectedIndex")-1,e=0>d;;){if(++d,d==this.Items.length){if(e)break;d=0,e=!0}if(d==this.element.prop("selectedIndex"))break;var f=this.Items[d].Prompt();if(!b.String.IsNullOrEmpty(f)&&f[0].toUpperCase()==c[0]){this.element.prop("selectedIndex",d+1),a.Handled=!0;break}}else 13==a.which&&a.stopPropagation()}},SelectedItem:function(a){if(a===c){var b=this.element.prop("selectedIndex");return b>0?this.Items[b-1]:null}this.element.val(null==a?"":a.Name())}}}}),define("dialog/multchoiceeditablecomboboxcontrol",["hdmain/jq","hdmain/system"],function(a,b,c){function d(){var a=this.Text(),c=b.List.FirstOrDefault(this[o][o]("option",p),function(b){return b.Prompt()==a});this[o][o]({SelectedItem:c})}function e(){null!=this._dropDownSelection&&(null==this._selectedOption||this._selectedOption!=this._dropDownSelection)&&(this._selectedOption=this._dropDownSelection,this.OnSelectionChanged())}function f(a,b){b.A.length>0&&(this._dropDownSelection=b.A[0])}function g(b){var c=a(b.target);c[0]!=this.element[0]&&c.closest("select")[0]!=this.opts[0]&&this._togglelist(!1)}var h=HOTDOC$,i=a.proxy,j=b.String.IsNullOrEmpty,k="mousedown mousewheel",l="SelectionChanged",m="DropDownOpened",n="DropDownClosed",o="EditableComboBox",p="ItemsSource",q="MultChoice"+o+"Control";h.Class[q]={W:{_create:function(){this.element.css("position","relative"),this[o]=a('<input type="text"/>').appendTo(this.element)[o]({ValueMemberPath:"Prompt"}).on(l,i(f,this)).on(m,i(d,this)).on(n,i(e,this)),this.option(this.options)},ItemsSource:function(a){return a===c?this[o][o]("option",p):(this[o][o]({ItemsSource:a}),void 0)},OnSelectionChanged:function(){this.element.trigger(l,{})},SelectedOption:function(a){return a===c?this._selectedOption:(this._selectedOption=a,this[o][o]({Text:null!=this._selectedOption?this._selectedOption.Prompt():""}),void 0)},Text:function(a){return a===c?this[o][o]("option","Text"):(j(a)?(this[o][o]({Text:""}),this._selectedOption=null):(this._selectedOption=b.List.FirstOrDefault(this[o][o]("option",p),function(b){return b.Name()==a}),this[o][o]({Text:null!=this._selectedOption?this._selectedOption.Prompt():a})),void 0)}}},h.Class[o]={W:{_create:function(){a.Widget.prototype._create.apply(this,arguments),this.ddVisible=!1,this.element.addClass("hd-input hd-input-mc").css({width:"100%","padding-right":"20px"}).on("blur",i(function(){var a,c,d;a=this.element.val(),c=b.List.FirstOrDefault(this.options[p],function(b){return b.Name()==a}),d=null!=c?c.Prompt():a,this.options.Text!=d&&(this._setOption("Text",d),this._togglelist(!1),this.element.trigger(l,{R:null,A:[d]}))},this)).on("keydown",i(function(a){var c,d,e,f;switch(a.which){case 38:case 40:return this.ddVisible?(c=this.opts.prop("selectedIndex"),this.opts.val(this.opts.children().eq(c+(38==a.which?-1:1)).prop("value")),d=this.opts.val(),e=b.List.FirstOrDefault(this.options[p],function(a){return a.Name()==d}),null!=e&&this._setOption("Text",e.Prompt()),this.element.trigger(l,{R:null,A:[e]})):this._togglelist(!0),!1;case 9:d=this.element.val(),e=b.List.FirstOrDefault(this.options[p],function(a){return a.Name()==d}),f=null!=e?e.Prompt():d,this._setOption("Text",f),this._togglelist(!1),this.element.trigger(l,{R:null,A:[f]});break;default:this._togglelist(!0)}},this)),this.btn=a('<div class="hd-img hd-cmbo-arrow"/>').css({position:"absolute",top:"0px",right:"0px",height:"100%"}).on("click",i(function(){this.btn.hasClass("hd-img")&&this._togglelist()},this)).insertAfter(this.element),this.opts=a("<select/>").hide().addClass("hd-input").insertAfter(this.element).css({position:"absolute",left:0,"z-index":505}).on("click",i(function(){this._setOption("Text",this.opts.children('[value="'+this.opts.val()+'"]').text()),this._togglelist(!1),this.element.focus()},this)).on("change",i(function(){var a=this.opts.val(),c=b.List.FirstOrDefault(this.options[p],function(b){return b.Name()==a});this._setOption("Text",a),this.element.trigger(l,{R:null,A:[c]})},this)),this.option(this.options)},_setOption:function(b,c){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case p:this.opts.empty().attr("size",Math.min(c.length+1,15));for(var d=0;d<c.length;d++)a('<option value="'+c[d].Name()+'">'+c[d].Prompt()+"</option>").appendTo(this.opts);break;case"Text":j(c)?(this.element.val(""),this.opts.val("").prop("selectedindex",-1)):this.element.val(c)}},_togglelist:function(b){if(b==c&&(b=!this.ddVisible),this.element.toggleClass("active",b),this.ddVisible!=b)if(this.ddVisible=b,b){this.opts.css({height:"auto",width:this.element.outerWidth()});var d,e,f=this.opts.height(),h=this.element.offset(),j=this.element.closest("#hdInterviewDiv"),l=j.height(),o=this.element.outerHeight(),p=f;h.top+this.element.outerHeight()+f>l&&(h.top-f>j.offset().top?o=-f:(d=h.top-j.offset().top,e=j.offset().top+l-h.top-this.element.outerHeight(),d>e?(o=-d,p=d):p=e)),this.element.parents(".hd-grid-cell").length>0?this.opts.css({position:"fixed","background-color":"white",left:h.left,top:o+h.top,height:p}).appendTo(document.body):this.opts.css({top:o,height:p}),this.opts.show(),this.element.trigger(m),a(document.body).on(k,i(g,this))}else this.opts.hide().insertAfter(this.element),this.element.trigger(n),a(document.body).off(k,g)}}}}),define("dialog/multchoicelistbox",["hdmain/jq","hdmain/system"],function(a,b,c){return a.widget("hd.MultChoiceListBox",{options:{DisplayMemberPath:"Prompt",Style:"",ItemContainerStyle:""},_create:function(){this.option(this.options)},_setOption:function(c,d){switch(c){case"ItemsSource":this.options.Items=d;for(var e=0;e<d.length;e++)a('<option value="'+d[e].Name()+'">'+d[e][this.options.DisplayMemberPath]()+"</option>").appendTo(this.element).addClass(this.options.ItemContainerStyle);this.element.attr("size",d.length>4?4:d.length);break;case"ItemContainerStyle":this.element.children().removeClass().addClass(d);break;case"SelectionMode":d==b.Windows.Controls.SelectionMode.Single?this.element.removeAttr("multiple"):this.element.attr("multiple","multiple");break;case"Style":this.element.removeClass().addClass("hd-input hd-input-mc "+d)}},SelectedItems:function(){var a,b=this.element.val(),c=[];if(this.element.attr("multiple")||(b=[b]),null!=b)for(a=0;a<b.length;a++)c.push(new HOTDOC$.Dialog.OptionPrompt(b[a],this.element.children("[value='"+b[a]+"']").text()));return c},SelectedItem:function(a){if(a===c){var b=this.SelectedItems();return b.length>0?b[0]:null}this.element.val(a.Name())}}),a.hd.MultChoiceListBox}),define("dialog/textblockmetrics",["hdmain/system","hdmain/jq","dialog/textmetrics"],function(a,b,c){function d(a){this._textBlock=b("<span>5</span>").hide().appendTo("#hdMainDiv").css("width","auto").addClass(a),this.QuixelFactor=this._textBlock.width(),this.LineHeight=this._textBlock.height()}return a.ExtendClass(d,c),d}),define("dialog/multiplechoiceinputcontrol",["hdmain/jq","hdmain/system","system/checkbox","system/radiobutton","dialog/controlmetrics","dialog/textblockmetrics","engine/stringparsersource","dialog/textblockformatter"],function(a,b,c,d,e,f,g,h,i){function j(a){var b=a.name;return b===i&&(b=a.DialogItem().name),b=b.replace(/\s/gi,"%20"),k.g_spOn&&"VA"!=a.type&&(b+="]["+a.parInt.GUID),"DE"==a.type&&(b+="]["+a.ID),b}var k=HOTDOC$,l=b.Windows.Visibility,m=b.String.IsNullOrEmpty,n=b.Windows.Controls.SelectionMode;this.DEBUG===i&&(this.DEBUG=k.DEBUG);var o,p,q,r,s,t=a.proxy,u=b.Windows.Input.FocusManager.GetFocusedElement,v="InputControl",w="MultipleChoice"+v,x="MultChoiceEditableComboBoxControl",y="NoneOfTheAboveOptionName",z=5,A="-readonly",B="hd-input-mc-btn",C=B+A,D="hd-input-mc-lb-item",E=D+A,F="hd-input hd-input-mc-tb",G=F+A;k.Class[w]={B:v,SC:function(){o=a.hd[v].prototype,p=new f("DialogTextStyle"),q=new e(a("<input/>").addClass(G)),r=new e(a("<option/>").addClass(D)),s=new e(a("<option/>").addClass(E))},W:{_create:function(){o._create.apply(this,arguments),this.element.attr("widget",w);var c,d,e,f,g,h,i,j,l,m,p,q,u,v,z,A,B=this.Variable();switch(this._listItemMetrics=this._dialogItemNode.ReadOnly()?s:r,B.style){case"RB":case"RG":case"CB":case"CG":if(this._buttons=new b.Collections.Generic.List,this._border=a('<div class="GrpBoxBox"/>'),this.options.IsEnabledChanged=t(this.MultipleChoiceInputControl_IsEnabledChanged,this),c=a("<div/>"),d=a('<table width="100%"/>'),e=a("<thead/>").appendTo(d),g=[],"RG"==B.style||"CG"==B.style){for(i=this._dialogItemNode.GetOptions().Count(),B.othr&&"CG"==B.style&&++i,this._numColumns=i>=9?3:2,j=Math.floor(i/this._numColumns)+(i%this._numColumns>0?1:0),l=0;l<this._numColumns;l++)a('<th style="width:'+100/this._numColumns+'%" />').appendTo(e);for(m=0,u=0;m<this._dialogItemNode.GetOptions().Count()&&u<this._numColumns;u++)for(h=0;m<this._dialogItemNode.GetOptions().Count()&&j>h;h++)g.length<=h&&g.push(a("<tr/>").appendTo(d)),p=this.CreateButton(B.style,this._dialogItemNode.GetOptions().GetItem(m).name,this._dialogItemNode.GetOptions().GetItem(m).Prompt(),t(this.button_Checked,this),t(this.button_Unchecked,this)),this._buttons.push(p),q=a("<td/>").appendTo(g[h]),p.appendTo(q),++m;B.othr&&"CG"==B.style&&(u=this._numColumns-1,this._noneOfTheAboveButton=this.CreateButton("CB",k[y],this.GetResourceString("ui_nota"),t(this._noneOfTheAboveButton_Checked,this),t(this._noneOfTheAboveButton_Unchecked,this)),this._buttons.push(this._noneOfTheAboveButton),g.push(a("<tr/>").appendTo(d)),q=a("<td/>").appendTo(g[h]),this._noneOfTheAboveButton.appendTo(q)),d.appendTo(c),B.othr&&"RG"==B.style&&(d=this.CreateOtherGrid(),d.appendTo(c))}else{for(this._numColumns=1,this.ControlCell.css("width","100%"),v=0;v<this._dialogItemNode.GetOptions().Count();v++)p=this.CreateButton(B.style,this._dialogItemNode.GetOptions().GetItem(v).name,this._dialogItemNode.GetOptions().GetItem(v).Prompt(),t(this.button_Checked,this),t(this.button_Unchecked,this)),this._buttons.push(p),g.push(a("<tr/>").appendTo(d)),q=a("<td/>").appendTo(g[g.length-1]),p.appendTo(q);d.appendTo(c),B.othr&&("RB"==B.style?this.CreateOtherGrid().appendTo(c):(g.push(a("<tr/>").appendTo(d)),q=a("<td/>").appendTo(g[g.length-1]),this._noneOfTheAboveButton=this.CreateButton("CB",k[y],this.GetResourceString("ui_nota"),t(this._noneOfTheAboveButton_Checked,this),t(this._noneOfTheAboveButton_Unchecked,this)),this._buttons.push(this._noneOfTheAboveButton),this._noneOfTheAboveButton.appendTo(q)))}c.appendTo(this._border),this._border.appendTo(this.ControlCell);break;case"SL":case"ML":this.ControlGrid.css("width","auto"),d=a("<table/>"),z=0,"SL"==B.style&&B.othr&&(f=a("<tr/>").appendTo(d),q=a("<td/>").appendTo(f),this._otherTextBox=a('<input type="text" style="width:100%"/>').addClass(this._dialogItemNode.ReadOnly()?G:F),this._otherTextBox.on("keyup",t(this._otherTextBox_TextChanged,this)),this._otherTextBox.appendTo(q)),f=a("<tr/>").appendTo(d),q=a("<td/>").appendTo(f),A="SL"==B.style?n.Single:n.Extended,this._optionPromptList=this._dialogItemNode.GetOptions().Select(function(a){return k.Dialog.OptionPrompt.ToOptionPrompt(a)}),A!=n.Single&&B.othr&&this._optionPromptList.push(new k.Dialog.OptionPrompt(k[y],this.GetResourceString("ui_nota"))),this._listBox=a("<select/>").MultChoiceListBox({Style:this._dialogItemNode.ReadOnly()?"hd-input-mc-lb-readonly":"hd-input-mc-lb",ItemContainerStyle:this._dialogItemNode.ReadOnly()?"hd-input-mc-lb-item-readonly":"hd-input-mc-lb-item",SelectionMode:A,DisplayMemberPath:"Prompt",ItemsSource:this._optionPromptList}),this._listBox.on("change",t(this._listBox_SelectionChanged,this)).on("LayoutUpdated",t(this._listBox_LayoutUpdated,this)),this._listBox.appendTo(q),d.appendTo(this.ControlCell);break;case"CO":this._optionPromptList=this._dialogItemNode.GetOptions().Select(function(a){return k.Dialog.OptionPrompt.ToOptionPrompt(a)}),this._dialogItemNode.ReadOnly()?(this._readOnlyComboTextBox=a("<div/>").addClass(G),this._readOnlyComboTextBox.appendTo(this.ControlCell)):B.othr?(this._editableComboBox=a("<div/>")[x](),this._editableComboBox[x]("ItemsSource",this._optionPromptList),this._editableComboBox.on("SelectionChanged",t(this._editableComboBox_SelectionChanged,this)).appendTo(this.ControlCell).trigger("Loaded")):(this._comboBox=a("<select/>").MultChoiceComboBox({Style:"hd-input-mc-cb",ItemContainerStyle:"hd-input-mc-cb-item",DisplayMemberPath:"Prompt",ItemsSource:this._optionPromptList}),this._comboBox.on("change",t(this._comboBox_SelectionChanged,this)),this._comboBox.appendTo(this.ControlCell))}this._hasOptionResource=null!=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return null!=a.rsrc})},_setOption:function(a,b){switch(a){case"IsEnabled":this.element.toggleClass("GrayText",!b).find("input,select,textarea,button").prop("disabled",!b),b?this.element.find(".hd-img-g").removeClass("hd-img-g").addClass("hd-img"):this.element.find(".hd-img").removeClass("hd-img").addClass("hd-img-g");break;case"IsReadOnly":if(b!=this._isReadOnly){if(b){if(null!=this._buttons)for(var c=0;c<this._buttons.length;c++)this._buttons[c].find("input").prop("disabled",b);null!=this._listBox&&this._listBox.prop("disabled",b),null!=this._otherTextBox&&this._otherTextBox.prop("disabled",b)}this._isReadOnly=b}}o._setOption.apply(this,arguments)},_listBox_LayoutUpdated:function(){if(this._listBox.Items.Count>0){var a,b=_listBox.ItemContainerGenerator.ContainerFromIndex(0);null!=b&&(a=this._listBox.Margin.Top+this._listBox.BorderThickness.Top+this._listBox.Padding.Top+b.ActualHeight*Math.min(this._optionPromptList.length,4)+this._listBox.Padding.Bottom+this._listBox.BorderThickness.Bottom+_listBox.Margin.Bottom,this._listBox.ScrollViewer.ComputedHorizontalScrollBarVisibility==l.Visible&&(a+=18),this._listBox.Height=a)}},PromptPosition:function(){switch(this.Variable().style){case"RB":case"RG":case"CB":case"CG":return"T";default:return o.PromptPosition.call(this)}},PromptVerticalAlignment:function(){return"CB"==this.Variable().style?"C":"T"},HasResource:function(){return o.HasResource.call(this)||this._hasOptionResource},ResourceOptionName:function(){return this._resourceOptionName},SetResourceOptionName:function(a){if(this.HasResource()){var b,c=m(a)?null:this._dialogItemNode.GetOptions().FirstOrDefault(function(b){return b.name==a&&null!=b.rsrc});null!=c?(this._resourceOptionName=c.name,b=!0):(this._resourceOptionName=null,b=o.HasResource.call(this)),this.IsResourceEnabled(b)}},FieldWidth:function(){var a=o.FieldWidth.call(this);if("D"==a)switch(this.Variable().style){case"RB":case"RG":case"CB":case"CG":a="F";break;default:a="C"}else"C"==a&&null!=this._otherTextBox&&(a="F");return a},ExactWidth:function(){switch(this.Variable().style){case"RB":case"CB":case"RG":case"CG":return this.FieldWidthValue()*this.QuixelFactor();default:return o.ExactWidth.call(this)}},MaxOptionPromptWidth:function(){var a,b,c=this.Variable(),d=0;for(a=0;a<this._optionPromptList.length;a++)b=this._optionPromptList[a],d=Math.max(d,this._dialogItemNode.ReadOnly()&&"CO"==c.style?q.GetTextWidth(b.Prompt()):this._listItemMetrics.GetTextWidth(b.Prompt()));return d},QuixelFactor:function(){return p.QuixelFactor},CalculatedWidth:function(){if(0==this._calculatedWidth){var a,b,c,d=this.Variable();switch(d.style){case"RB":case"CB":case"RG":case"CG":if(this._calculatedWidth=this._border.outerWidth()-this._border.width(),this._buttons.length>0){for(this._calculatedWidth+=this.ControlWidth(this._buttons[0]),a=0,b=0;b<this._buttons.length;b++)c=this._buttons[b],a=Math.max(a,c.outerWidth());this._calculatedWidth+=this._numColumns*(a+this.QuixelFactor()/2),this._calculatedWidth+=(this._numColumns-1)*z,this._calculatedWidth+=this._numColumns*k.ButtonGlyphWidth}break;case"SL":case"ML":case"CO":"CO"==d.style?this._dialogItemNode.ReadOnly()?this._calculatedWidth+=this.ControlWidth(this._readOnlyComboTextBox)+this.MaxOptionPromptWidth()+q.QuixelFactor/2:d.othr?(this._editableComboBox.children("select").css("width","auto"),this._calculatedWidth=Math.max(this.ControlWidth(this._editableComboBox.children("select"))+this.MaxOptionPromptWidth()+28,45)):this._calculatedWidth=this.ControlWidth(this._comboBox)+this.MaxOptionPromptWidth()+28:this._calculatedWidth=this.ControlWidth(this._listBox)+this.MaxOptionPromptWidth()+28}}return this._calculatedWidth},CreateButton:function(c,d,e,f,i){var l,n,o,p=a('<label style="float:left; text-indent: -25px; margin-left: 25px;"/>');return"RB"==c||"RG"==c?(n=j(this.Variable()),l=a('<input type="radio"/>').RadioButton().attr({name:n,id:"MCOpt|"+d+"|"+n,value:d}),m(this._groupName)&&(this._groupName=b.Guid.NewGuid()),l.GroupName=this._groupName):l=a('<input type="checkbox"/>').CheckBox(),l.appendTo(p).on("focus",t(this.button_GotFocus,this)),p.addClass(this._dialogItemNode.ReadOnly()?C:B).attr("Tag",d).on("Checked",f).on("Unchecked",i),o=a("<span/>"),k.Dialog.DialogControl.DotCodeParser().Parse(new g(e),new h(o,o.FontSize,!1)),o.appendTo(p),p},CreateOtherGrid:function(){var b,c=a('<table width="100%"/>'),d=a("<tr/>").appendTo(c);
return this._otherButton=this.CreateButton("RB",k.OtherOptionName,this.GetResourceString("ui_other"),t(this._otherButton_Checked,this),t(this._otherButton_Unchecked,this)),b=a("<td/>").appendTo(d),this._otherButton.appendTo(b),this._otherButton.children("div").width("auto"),this._otherButton.css({display:"block"}),this._otherTextBox=a('<input type="text" style="width:100%"/>').addClass(this._dialogItemNode.ReadOnly()?G:F).attr("Tag",k.OtherInputName),b=a('<td style="width:100%"/>').appendTo(d),this._otherTextBox.appendTo(b),c},button_Checked:function(b){if(!this._inUpdateControlAnswer){var c,d,e=this.Variable();switch(a(b.target).parent().focus(),e.style){case"RB":case"RG":this._dialogItemNode.ListAnswer([b.target.value]);break;case"CB":case"CG":for(e.othr&&(this._inCheckedButton=!0,this._noneOfTheAboveButton.children("input").prop("checked",!1),this._inCheckedButton=!1),c=[],d=0;d<this._buttons.length;d++)this._buttons[d].children("input").prop("checked")&&c.push(this._buttons[d].attr("tag"));this._dialogItemNode.ListAnswer(c)}}},button_Unchecked:function(){if(!this._inUpdateControlAnswer){var a,b,c=this.Variable();switch(c.style){case"RB":case"RG":break;case"CB":case"CG":if(!this._inCheckedNoneOfTheAbove){for(a=[],b=0;b<this._buttons.length;b++)this._buttons[b].children("input").prop("checked")&&a.push(this._buttons[b].attr("Tag"));this._dialogItemNode.ListAnswer(a)}}}},_otherButton_Checked:function(){if(!this._inUpdateControlAnswer){var a=m(this._otherTextBox.val())?"":this._otherTextBox.val();this._dialogItemNode.ListAnswer([a])}},_otherButton_Unchecked:function(){this._inUpdateControlAnswer||this._otherTextBox.val("")},_noneOfTheAboveButton_Checked:function(){if(!this._inUpdateControlAnswer){this._inCheckedNoneOfTheAbove=!0;var a,b;for(a=0;a<this._buttons.length;a++)b=this._buttons[a],b.attr("Tag")!=k[y]&&b.children("input").prop("checked",!1);this._inCheckedNoneOfTheAbove=!1,this._dialogItemNode.ListAnswer([k.MC.nota])}},_noneOfTheAboveButton_Unchecked:function(){this._inUpdateControlAnswer||this._inCheckedButton||this._dialogItemNode.ListAnswer(null)},button_GotFocus:function(a){this.SetResourceOptionName(a.target.parentNode.getAttribute("tag")),this.element.trigger("GotFocus")},GetMatchingListBoxIndex:function(){var a,b,c=0,d=this._otherTextBox.val().toUpperCase();if(!m(d))for(a=0;a<this._optionPromptList.length;a++)if(b=this._optionPromptList[a].Prompt().toUpperCase(),0==b.indexOf(d)){c=a+1;break}return c},SetOtherTextBoxInternal:function(a,b){this._otherTextBox.val()!=a&&(this._ignoreNextTextChange=!0,this._ignoreNextTextChangeAndNeedFocus=b,this._otherTextBox.val(a))},_otherTextBox_TextChanged:function(){if(this._ignoreNextTextChange)return this._ignoreNextTextChange=!1,this._otherTextBox.select(),this._ignoreNextTextChangeAndNeedFocus&&(this._ignoreNextTextChangeAndNeedFocus=!1,this._otherTextBox.focus(),k.Dialog.DialogControl.ScrollIntoView(this._otherTextBox)),void 0;if(!this._inUpdateControlAnswer){var a=this.GetMatchingListBoxIndex();this._listBox.MultChoiceListBox("SelectedItem",null),a>0&&this._listBox.children().length>0?b.CallAsync(t(function(){var b=this._listBox.height()/this._listBox.attr("size");this._listBox.scrollTop(b*a)},this)):b.CallAsync(t(function(){this._listBox.scrollTop(0)},this))}},_listBox_SelectionChanged:function(){if(!this._inUpdateControlAnswer){var a,b,c,d,e,f=this._listBox.MultChoiceListBox("SelectedItems");if(null!=f&&f.length>0)if(a=this.Variable(),"SL"==a.style)a.othr&&this.SetOtherTextBoxInternal(f[0].Prompt(),!0),this._dialogItemNode.ListAnswer([f[0].Name()]);else if(a.othr&&1==f.length&&f[0].Name()==k[y])this._dialogItemNode.ListAnswer([k.MC.nota]);else{for(b=f.length,b>1&&f[b-1].Name()==k[y]&&(this._listBox.MultChoiceListBox("SelectedItems").splice(b-1,1),b--),c=[],d=0;b>d;d++)c[d]=f[d].Name();this._dialogItemNode.ListAnswer(c)}else this._dialogItemNode.ListAnswer(null);e=this._listBox.MultChoiceListBox("SelectedItem"),null!=e&&this.SetResourceOptionName(e.Name())}},_editableComboBox_SelectionChanged:function(){if(!this._inUpdateControlAnswer){var a=this._editableComboBox[x]("SelectedOption");null!=a?("function"!=typeof a.Name&&(a=new k.Dialog.OptionPrompt(a,a)),this._dialogItemNode.ListAnswer([a.Name()]),this.SetResourceOptionName(a.Name())):(this._dialogItemNode.ListAnswer(null),this.SetResourceOptionName(null))}},_comboBox_SelectionChanged:function(){if(!this._inUpdateControlAnswer){var a=this._comboBox.MultChoiceComboBox("SelectedItem");null!=a?(this._dialogItemNode.SetAnswerList([a.Name()]),this.SetResourceOptionName(a.Name())):(this._dialogItemNode.SetAnswerList(null),this.SetResourceOptionName(null))}},SetControlAnswer:function(){this._inUpdateControlAnswer=!0;var b,c,d,e=null,f=this._dialogItemNode.ListAnswer(),g=this.Variable();switch(null!=f&&f.length>0&&(e=f.slice(0)),g.style){case"RB":case"RG":if(null!=e)if(null!=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return e.indexOf(a.name)>=0})){for(b=0;b<this._buttons.length;b++)if(this._buttons[b].attr("Tag")==e[0]){this._buttons[b].children("input").prop("checked",!0);break}g.othr&&this._otherTextBox.val("")}else g.othr?(this._otherButton.children("input").prop("checked",!0),this._otherTextBox.val(e[0])):e=null;null==e&&(a.each(this._buttons,function(){a(this).find("input").prop("checked",!1)}),g.othr&&(this._otherButton.prop("checked",!1),this._otherTextBox.val("")));break;case"CB":case"CG":if(null!=e)if(this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return e.indexOf(a.name)>=0})){if(a.each(this._buttons,function(){this.children("input").prop("checked",e.indexOf(this.attr("Tag"))>=0)}),g.othr)for(b=0;b<this._buttons.length;b++)if(this._buttons[b].attr("Tag")==k[y]){this._buttons[b].children("input").prop("checked",!1);break}}else g.othr?e[0]==k.MC.nota?a.each(this._buttons,function(){this.children("input").prop("checked",this.attr("Tag")==k[y])}):e=null:e=null;null==e&&a.each(this._buttons,function(){this.children("input").prop("checked",!1)});break;case"SL":null!=e?(c=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return e.indexOf(a.name)>=0}),this._listBox.MultChoiceListBox("SelectedItem",null!=c?k.Dialog.OptionPrompt.ToOptionPrompt(c):null),g.othr&&this.SetOtherTextBoxInternal(null==c?e[0]:k.Dialog.OptionPrompt.ToOptionPrompt(c).Prompt(),!1)):(this._listBox.prop("selectedIndex",-1),g.othr&&this.SetOtherTextBoxInternal("",!1));break;case"ML":null!=e?(d=this._dialogItemNode.GetOptions().Where(function(a){return e.indexOf(a.name)>-1}),g.othr&&e.indexOf(k.MC.nota)>-1&&d.push(k[y]),this._listBox.val(null),this._listBox.val(d)):this._listBox.val(null);break;case"CO":this._dialogItemNode.ReadOnly()?this._readOnlyComboTextBox.text(null!=e&&e.length>0?e[0]:""):g.othr?null!=e?(c=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return e.indexOf(a.name)>=0}),null!=c?this._editableComboBox[x]("SelectedOption",k.Dialog.OptionPrompt.ToOptionPrompt(c)):this._editableComboBox[x]("Text",e[0])):this._editableComboBox[x]("Text",null):null!=e?(c=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return e.indexOf(a.name)>=0}),null!=c?this._comboBox.val(c.name):this._comboBox.val(null)):this._comboBox.val(null)}this._inUpdateControlAnswer=!1},MultipleChoiceInputControl_IsEnabledChanged:function(){this.ShowBorderEnabled(this._border,this.options.IsEnabled)},SetFocus:function(a){var c,d=this.Variable(),e=k.Dialog.DialogControl.ScrollIntoView;switch(d.style){case"RB":case"RG":if(c=b.List.FirstOrDefault(this._buttons,function(b){return b.attr("Tag")==a}),null!=c)c.children("input").focus(),e(c);else if(d.othr){if(a==k.OtherOptionName)return this._otherButton.focus(),e(this._otherButton),void 0;if(a==k.OtherInputName)return this._otherTextBox.focus(),e(this._otherTextBox),void 0}break;case"CB":case"CG":c=b.List.FirstOrDefault(this._buttons,function(b){return b.attr("Tag")==a}),null!=c&&(c.find("input").focus(),e(c));break;case"SL":d.othr?(this._otherTextBox.focus(),e(this._otherTextBox)):this._listBox.focus(),e(this._listBox);break;case"ML":this._listBox.focus(),e(this._listBox);break;case"CO":this._dialogItemNode.ReadOnly()?(this._readOnlyComboTextBox.focus(),e(_readOnlyComboTextBox)):d.othr?(this._editableComboBox.children("input").focus(),e(this._editableComboBox)):(this._comboBox.focus(),e(this._comboBox))}},SaveControlAnswer:function(){var a,b,c,d=this.Variable();switch(d.style){case"RB":case"RG":d.othr&&(m(this._otherTextBox.val())||(this._otherButton.children("input").prop("checked",!0),this._dialogItemNode.ListAnswer([this._otherTextBox.val()])));break;case"CB":case"CG":break;case"SL":d.othr&&(a=this._otherTextBox.val(),b=this._dialogItemNode.GetOptions().FirstOrDefault(function(b){k.Dialog.OptionPrompt.ToOptionPrompt(b).Prompt==a}),null==b&&(this._dialogItemNode.ListAnswer(m(this._otherTextBox.val())?null:[this._otherTextBox.val()]),this._listBox.SelectedItem=null));break;case"CO":d.othr&&(c=this._editableComboBox[x]("Text"),b=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return a.Prompt()==c}),null==b&&this._dialogItemNode.ListAnswer(m(c)?null:[c]))}},FocusOptionName:function(){var a,c,d=this.Variable();switch(d.style){case"RB":case"RG":if(a=u(),null!=a&&null!=a.parent().attr("tag")){if(d.othr){if(a.data("hd-RadioButton")&&a.parent().attr("Tag")==this._otherButton.attr("Tag"))return k.OtherOptionName;if(a.data("hd-TextBox")&&a.parent().attr("Tag")==this._otherTextBox.attr("Tag"))return k.OtherInputName}if(a.data("hd-RadioButton")&&(c=b.List.FirstOrDefault(this._buttons,function(b){return a.parent().attr("Tag")==b.attr("Tag")}),null!=c))return c.attr("Tag")}return"";case"CB":case"CG":return a=u(),null!=a&&null!=a.parent().attr("tag")&&a.data("hd-CheckBox")&&(c=b.List.FirstOrDefault(this._buttons,function(b){return a.parent().attr("Tag")==b.attr("Tag")}),null!=c)?c.attr("Tag"):"";default:return""}},ClearAnswer:function(){o.ClearAnswer.call(this),null!=this._otherTextBox&&this._otherTextBox.val(""),null!=this._editableComboBox&&this._editableComboBox.val("")},OnKeyDown:function(c){if(38==c.which||37==c.which||40==c.which||39==c.which){var d,e,f,g,h,i=this.Variable();if("RB"==i.style||"RG"==i.style){if(d=[],a.each(this._dialogItemNode.GetOptions().list,function(){d.push(this.name)}),e=d.slice(0),i.othr&&(d.push(k.OtherOptionName),e.push(this._otherTextBox.val())),f=-1,g=b.List.FirstOrDefault(this._buttons,function(a){return a.children("input")[0]==u()[0]}),null!=g?f=d.indexOf(g.attr("Tag")):i.othr&&this._otherButton.children("input")[0]==u()[0]&&(f=d.length-1),f>=0){switch(c.which){case 38:case 37:0==f?f=d.length-1:--f;break;case 40:case 39:f<d.length-1?++f:f=0}this._dialogItemNode.ListAnswer(e[f]),this.SetControlAnswer(),this.SetFocus(d[f]),c.preventDefault()}}else("SL"==i.style||"ML"==i.style)&&(40==c.which?(h=this._listBox.prop("selectedIndex"),0>h?this._listBox.prop("selectedIndex",this.GetMatchingListBoxIndex()-1).trigger("change"):h<this._listBox.children().length-1&&this._listBox.prop("selectedIndex",h+1).trigger("change"),c.preventDefault()):38==c.which&&(h=this._listBox.prop("selectedIndex"),0>h?this._listBox.prop("selectedIndex",this.GetMatchingListBoxIndex()-1).trigger("change"):h>0&&this._listBox.prop("selectedIndex",h-1).trigger("change"),c.preventDefault()))}o.OnKeyDown.call(this,c)},Update:function(a){o.Update.call(this,a),this._comboBox!==i&&this._comboBox.on("change",t(this._comboBox_SelectionChanged,this)),this._listBox!==i&&this._otherTextBox!==i&&this._otherTextBox.width(this._listBox.width())}}}}),define("dialog/numberinputcontrol",["hdmain/jq","hdmain/system","dialog/controlmetrics"],function(a,b,c){var d,e,f,g=HOTDOC$,h=b.String.IsNullOrEmpty,i=a.proxy,j="hd-input hd-input-num",k=j+"-readonly",l="NumberInputControl";g.Class[l]={B:"InputControl",SC:function(){d=a.hd.InputControl.prototype,e=new c(a("<input/>").addClass(j)),f=new c(a("<input/>").addClass(k))},W:{_create:function(){d._create.apply(this,arguments),this.element.attr("widget",l),this._textBox=a('<input type="text"/>').on("NavigationKeyPress."+l,i(this._textBox_NavigationKeyPress,this)).AnswerTextBox({Style:this._dialogItemNode.ReadOnly()?k:j}),g.iOS&&this._textBox.attr("pattern","[0-9]*"),this._textMetrics=this._dialogItemNode.ReadOnly()?f:e,h(this.Variable().currS)||a("<td/>").addClass("hd-input-currency").text(this.Variable().currS).insertBefore(this.ControlCell),this._dialogItemNode.ReadOnly()||(this._dialogItemNode.ChangeErrorState.push(i(this._dialogItemNode_ChangeErrorState,this)),this._dialogItemNode.AnswerReformatted.push(i(this._dialogItemNode_AnswerReformatted,this))),this._textBox.appendTo(this.ControlCell)},_setOption:function(a,b){switch(a){case"IsEnabled":this._textBox.AnswerTextBox({IsReadOnly:!b});break;case"IsReadOnly":b!=this._isReadOnly&&(b&&this._textBox.AnswerTextBox({IsReadOnly:b}),this._isReadOnly=b);break;case"IsSetByDialogScript":b!=this._isSetByDialogScript&&(b?this._textBox.AnswerTextBox({IsReadOnly:!0,BorderThickness:0,Background:"transparent"}):this._textBox.AnswerTextBox({IsReadOnly:!1,BorderThickness:"",Background:""}),this._isSetByDialogScript=b)}d._setOption.apply(this,arguments)},Dispose:function(a){"boolean"!=typeof a&&(a=!0),d.Dispose.call(this,a),a&&!this._dialogItemNode.ReadOnly()&&(this._dialogItemNode.ChangeErrorState.pop(),this._dialogItemNode.AnswerReformatted.pop())},ControlColumn:function(){return h(this.Variable().currS)?0:1},PromptVerticalAlignment:function(){return VerticalAlignment.Center},MeasureNumber:function(a,b){return a=a>0?Math.max(99,a):Math.min(-99,a),this._textMetrics.GetTextWidth(a.toString()+(b>0?"."+Array(b+1).join("0"):""))},QuixelFactor:function(){return this._textMetrics.QuixelFactor},CalculatedWidth:function(){if(0==this._calculatedWidth){var a=this.Variable();a.max>0&&(this._calculatedWidth=this.MeasureNumber(a.min>0?a.max:-a.max,a.decPl)),a.min<0&&(this._calculatedWidth=Math.max(this._calculatedWidth,this.MeasureNumber(a.min,a.decPl))),0==this._calculatedWidth&&(this._calculatedWidth=this.MeasureNumber(1e9,a.decPl)),this._calculatedWidth+=this.QuixelFactor()/2}return this._calculatedWidth},SetControlAnswer:function(){this._textBox.val(this._dialogItemNode.StringAnswer())},SetFocus:function(){this._textBox.focus()},SaveControlAnswer:function(){this._dialogItemNode.StringAnswer(this._textBox.val())},_textBox_NavigationKeyPress:function(a,b){this.FireNavigationKeyPress(b)},_dialogItemNode_ChangeErrorState:function(a,b){this.ValidationError.ValidationErrorControl({Text:b.ErrorMessage,Visibility:b.IsError})},_dialogItemNode_AnswerReformatted:function(a,b){this._textBox.val(b.FormattedAnswer)}}}}),define("dialog/optionprompt",["hdmain/system","dialog/stringformatter","engine/stringparsersource"],function(a,b,c,d){var e=HOTDOC$;e.Class.OptionPrompt={N:"Dialog",C:function(a,b){this._name=a,this._prompt=b},S:{ToOptionPrompt:function(d){var f=new a.Text.StringBuilder;return e.Dialog.DialogControl.DotCodeParser().Parse(new c(d.Prompt()),new b(f,a.Windows.TextWrapping.NoWrap)),new e.Dialog.OptionPrompt(d.name,f.ToString())}},P:{Name:function(a){return a===d?this._name:(this._name=a,void 0)},Prompt:function(a){return a===d?this._prompt:(this._prompt=a,void 0)}}}}),define("dialog/parenttitlecontrol",["hdmain/system","hdmain/jq","dialog/stringformatter","engine/titleparsersource","engine/interviewnodetype","engine/dialogupdateflags"],function(a,b,c,d,e,f){var g=HOTDOC$;return b.widget("hd.ParentTitleControl",{_create:function(){this.InitializeComponent(),this.ContextMenu.ContextMenuControl({node:this.options.node}),(null==this.options.node||this.options.node.Type()!=e.Iteration)&&this.ContextMenu.hide()},InitializeComponent:function(){this.Button=b("<button style='width:100%; padding:5px;'/>").appendTo(this.element).on("click",b.proxy(this.Button_Click,this)),this.ContextMenu=b("<div/>").css({"float":"none",position:"absolute",right:"5px"}).appendTo(this.element).ContextMenuControl(),this.Title=b("<div>&nbsp;</div>").appendTo(this.Button),this.option(this.options)},Update:function(b){var e,h=this.ContextMenu.ContextMenuControl("option","node");(b||(h.UpdateFlags()&f.Title)==f.Title)&&(e=new a.Text.StringBuilder,g.Dialog.DialogControl.DotCodeParser().Parse(new d(h),new c(e,a.Windows.TextWrapping.NoWrap)),this.Title.text(e.ToString())),this.ContextMenu.css("top",this.element.position().top+5)},Button_Click:function(){var a={s:null};return this.ContextMenu.ContextMenuControl("option","node").NavigateTo(!0,a,function(b){b||g.Alert(a)}),!1}}),b.hd.ParentTitleControl}),define("dialog/customnavigationbar",[],{s_customNavigationbarButtonDefs:[],AddButtonDefinition:function(a){this.s_customNavigationbarButtonDefs.push(a)},ButtonDefinitions:function(){return this.s_customNavigationbarButtonDefs}}),define("dialog/popupinterviewwindow",["hdmain/jq","dialog/customnavigationbar"],function(a,b){var c=HOTDOC$,d=a.proxy;c.Class.PopupInterviewWindow={B:"ChildWindow",W:{options:{focus:function(){a(this).find("#hdPopupInterviewDiv").DialogControl("SetNavButtonMinHeight",a(this).find("#hdNavBar"))}},_create:function(){a.hd.ChildWindow.prototype._create.apply(this,arguments),this.element.addClass("PopupInterviewDiv"),this.options.hdClose.push(d(this.PopupInterviewWindow_Closing,this)),this._interview=this.options.interview,this._scriptLinkDialogElementName=this.options.dlgEl,this._computationVariableName=this.options.compVar,this._dialogControl=a('<div id="hdPopupInterviewDiv"/>').DialogControl({interview:this._interview}),this._dialogControl.on("blur",d(this._dialogControl_FocusLeaving,this)).on("Closed",d(this._dialogControl_Closed,this)),c.Dialog.InterviewStack.PushInterview(this),this._dialogControl.DialogControl("ApplyCustomNavigationbarButtonDefinitions",b.ButtonDefinitions()),this._dialogControl.appendTo(this.element)},_dialogControl_FocusLeaving:function(a,b){b.FocusDirection==FocusDirection.Forward?this._dialogControl.SetFocusToFirstControl():this._dialogControl.SetFocusToLastControl()},PopupInterviewWindow_Closing:function(){null==this.DialogResult()&&this.CloseInterview()},_dialogControl_Closed:function(){c.Dialog.InterviewStack.PopInterview(),this._closing=!0,this.DialogResult(!0),this._closing=!1},ScriptLinkDialogElementName:function(){return this._scriptLinkDialogElementName},ComputationVariableName:function(){return this._computationVariableName},DialogControl:function(){return this._dialogControl},CloseInterview:function(){this._dialogControl.DialogControl("Close")}}}}),define("dialog/promptparsersource",["hdmain/system","engine/interviewnode"],function(a,b){var c=HOTDOC$,d="HDRequired",e="HDMarked",f="GrayText";c.Class.PromptParserSource={N:"Dialog",C:function(a){this._dialogItemNode=a},P:{SourceString:function(){return a.String.IsNullOrEmpty(this._dialogItemNode.Prompt())?this._dialogItemNode.DialogItem()instanceof c.Variable?b.FixAmpersands(this._dialogItemNode.DialogItem().name,!1):"":b.FixAmpersands(this._dialogItemNode.Prompt(),!1)},TextColor:function(){return this._dialogItemNode.Gray()?f:this._dialogItemNode.Required()&&!this._dialogItemNode.IsAnswered()?d:this._dialogItemNode.Marked()?e:""},Required:function(){return this._dialogItemNode.Required()&&c.RequiredAsterisk}}}}),define("dialog/repeatcontrol",["hdmain/jq","hdmain/system","engine/dialogupdateflags"],function(a,b,c,d){var e=HOTDOC$;this.DEBUG===d&&(this.DEBUG=e.DEBUG);var f=a.proxy,g="ResourceUpdate",h="NavigationKeyPress";e.Class.RepeatControl={B:"IInterviewNodeControl",W:{_create:function(){a('<tr><td style="padding:0px;"><table class="hd-content-grid"/></td></tr>').appendTo(this.element),this.LayoutRoot=this.element.find("table")},Dispose:function(a){if(a===d||a)for(this.disable();this.LayoutRoot.children().length>0;)this.RemoveIteration(0)},Update:function(d){var e,i,j,k,l,m=this.options.InterviewNode;if(d||(m.UpdateFlags()&c.RepeatAnswer)==c.RepeatAnswer||0!=(m.DescendantUpdateflags()&c.DialogRelated)){for(j=0;j<m.Children().Count();j++){if(e=m.Children().get(j),i=null,(e.UpdateFlags()&c.NewlyAdded)!=c.NewlyAdded){for(k=j;k<this.LayoutRoot.children().length&&b.Cast(this.LayoutRoot.children().eq(k),"IInterviewNodeControl").options.InterviewNode._id!=e._id;k++);if(k<this.LayoutRoot.children().length){for(l=j;k>l;l++)this.RemoveIteration(j);e.IsHiddenNew()?this.RemoveIteration(j):(i=this.LayoutRoot.children().eq(j),i.DialogContentControl("Update",!1))}}e.IsHiddenNew()||(null==i&&(i=a("<tbody/>").DialogContentControl({InterviewNode:e,caption:!0}),0>=j?i.prependTo(this.LayoutRoot):j>=this.LayoutRoot.children().length?i.appendTo(this.LayoutRoot):i.insertBefore(this.LayoutRoot.children().eq(j)),i.on(h,f(this.dialogContentControl_NavigationKeyPress,this)).on(g,f(this.dialogContentControl_ResourceUpdate,this)).DialogContentControl("Update",!0)),0==j)}for(;j<this.LayoutRoot.children().length;)this.RemoveIteration(j);for(j=m.Children().Count()-1;j>=0;j--)e=m.Children().get(j),e.DisplayAddButton()&&!e.IsHiddenNew()&&(i=this.LayoutRoot.children().eq(j),i.DialogContentControl("UpdateAddButton",d||(e.UpdateFlags()&c.NewlyAdded)==c.NewlyAdded))}},FireNavigationKeyPress:function(a){this.element.trigger(h,a)},FireResourceUpdate:function(a){this.element.trigger(g,a)},dialogContentControl_NavigationKeyPress:function(a,b){this.FireNavigationKeyPress(b)},dialogContentControl_ResourceUpdate:function(a,b){this.FireResourceUpdate(b)},RemoveIteration:function(a){var b=this.LayoutRoot.children().eq(a);b.off(h,this.dialogContentControl_NavigationKeyPress).off(g,this.dialogContentControl_ResourceUpdate).DialogContentControl("Dispose").remove()}}}}),define("dialog/spreadsheet",["system/jq.datagrid/datagrid","hdmain/jq"],function(a,b){return b.widget("hd.Spreadsheet",a,{OnApplyTemplate:function(){a.prototype.OnApplyTemplate.apply(this,arguments)},HorizontalScrollBar:function(){return this._hScrollBar}}),b.hd.Spreadsheet}),define("dialog/variablecolumn",["hdmain/system","system/textblock","hdmain/jq","system/jq.datagrid/datagridtemplatecolumn","system/radiobutton"],function(a,b,c,d,e,f){function g(){g.baseConstructor.apply(this,arguments)}function h(a){h.baseConstructor.apply(this,arguments);var b=[{Property:p,Path:n(s,a),Mode:o.TwoWay}];this.CellTemplate=g.CreateTextBlockCellTemplate(a),this.CellEditingTemplate=g.CreateCellTemplate(null,y,b,{Style:K})}function i(a){i.baseConstructor.apply(this,arguments);var b=[{Property:q,Path:n(s,a),Mode:o.TwoWay}];this.CellTemplate=g.CreateTextBlockCellTemplate(a),this.CellEditingTemplate=g.CreateCellTemplate(null,"AnswerDatePicker",b,{Style:I})}function j(a,b){j.baseConstructor.apply(this,arguments);var c="S"==b?"RadioButton":A,d=[{Property:u,Path:n(u,a),Mode:o.OneWay},{Property:v,Path:n(s,a),Mode:o.TwoWay}];this.CellTemplate=g.CreateCellTemplate(null,c,d,{HorizontalAlignment:z,VerticalAlignment:z,Style:H}),this.IsReadOnly(!0)}function k(a,b){k.baseConstructor.apply(this,arguments),this.CellTemplate=g.CreateTextBlockCellTemplate(a),this.CellEditingTemplate="CB"!=b.style&&"CG"!=b.style&&"ML"!=b.style&&b.othr?g.CreateCellTemplate(C,E,null,null):g.CreateCellTemplate(C,D,null,{DisplayMemberPath:"Prompt",Style:J,ItemContainerStyle:"{StaticResource SpreadsheetMultipleChoiceComboBoxItemStyle}"})}function l(a,b){l.baseConstructor.apply(this,arguments);var c=[{Property:u,Path:u,Mode:o.OneWay},{Property:t,Path:t,Mode:o.OneWay},{Property:v,Path:s,Mode:o.TwoWay},{Property:w,Path:w,Mode:o.OneWay},{Property:x,Path:x,Mode:o.OneWay}];this.CellTemplate=g.CreateCellTemplate(C,B,c,{HorizontalAlignment:z,VerticalAlignment:z,GroupType:b}),this.IsReadOnly(!0)}{var m=HOTDOC$,n=a.String.Format;a.String.IsNullOrEmpty}this.DEBUG===f&&(this.DEBUG=m.DEBUG);var o=a.Windows.Data.BindingMode,p="Text",q="Raw"+p,r="Foreground",s="Answer",t=s+"edStatus",u="IsEnabled",v="IsChecked",w="IsButtonEnabled",x="NavigateToChildCommand",y=p+"Box",z="Center",A="CheckBox",B="ChildDialogControl",C="local",D="MultChoiceComboBox",E="MultChoiceEditableComboBoxControl",F="hd-input-",G="hd-ss-text",H=F+"tf-ss",I=F+"date-ss",J=F+"mc-cb-ss",K=F+"num-ss";return a.ExtendClass(g,d,null,{CreateTextBlockCellTemplate:function(a){var b=[{Property:p,Path:n("DisplayAnswer",a),Mode:o.OneWay},{Property:r,Path:n(r,a),Mode:o.OneWay}];return this.CreateCellTemplate(null,"TextBlock",b,{HorizontalAlignment:"Left",VerticalAlignment:z,Margin:"5,5,5,5",Style:G})},CreateCellTemplate:function(a,d,e,f){var g={Type:d,Control:{Bindings:e},LoadContent:function(){var a,d=this.Type;switch(d){case b:a=c('<input type="text"/>')[d]();break;case"AnswerDatePicker":a=c("<label/>")[d]();break;case E:a=c("<div/>")[d]();break;case D:a=c("<select/>")[d]();break;case B:a=c('<div style="text-align:center"/>')[d]();break;case"RadioButton":a=c('<input type="radio"/>')[d]();break;case A:a=c('<input type="checkbox"/>')[d]();break;default:a=c('<input type="text"/>')[d]().attr("autocapitalize","off"),this.Control.Class==K&&m.iOS&&a.attr("pattern","[0-9]*")}a.on("keyup",function(a){c(a.target).trigger("TextChanged")});for(var e in f)switch(e){case"Style":a.addClass(f[e])}return a}};return g}}),a.ExtendClass(h,g),m.NumberVariableColumn=h,a.ExtendClass(i,g),m.DateVariableColumn=i,a.ExtendClass(j,g),m.TrueFalseVariableColumn=j,a.ExtendClass(k,g),m.MultipleChoiceVariableColumn=k,a.ExtendClass(l,g),m.ChildDialogColumn=l,g}),define("dialog/textvariablecolumn",["hdmain/system","dialog/variablecolumn"],function(a,b){function c(d){c.baseConstructor.apply(this,arguments);var e=[{Property:"Text",Path:a.String.Format("Answer",d),Mode:a.Windows.Data.BindingMode.TwoWay}];this.CellTemplate=b.CreateTextBlockCellTemplate(d),this.CellEditingTemplate=b.CreateCellTemplate(null,"TextBox",e,{Style:"hd-input-text-ss"})}return a.ExtendClass(c,b),c}),define("dialog/spreadsheetcontrol",["hdmain/system","dialog/commandhandler","hdmain/jq","./command","system/exception","dialog/textvariablecolumn","system/jq.datagrid/datagridlength","dialog/textblockmetrics","dialog/textblockformatter","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){switch(a.DialogItem().type){case"TX":case"NU":case"DA":case"TF":case"MC":case"DI":return!0}return!1}function o(a){1==a.which&&(a.Handled=!0)}function p(){this._repeatNode._dialog.hideSB||this.ToolbarGrid.css("visibility","visible"),this._hasFocus=!0,this[S]()}function q(){this.ToolbarGrid.css("visibility","hidden"),this._hasFocus=!1,this[S]()}function r(a,b){var c=b.Row.DataGridRow("option","DataContext");c.Cells[b.Column.DisplayIndex()].IsEnabled()||(b.Cancel=!0)}function s(a,b){b.Row.DataGridRow("option","DataContext").BeginCellEdit(b.Column.DisplayIndex(),b.EditingElement)}function t(a,b){var c=b.Row.DataGridRow("option","DataContext");b.Row.DataGridRow("option","Header",c),b.Row.on(Z,R(J,this))}function u(a,b){b.Row.off(Z,J)}function v(){if(!this._inUpdate){var a=this[W][W]("option","SelectedItem");null!=a&&a.SetCurrentDialogItem(this[W][W]("CurrentColumn").DisplayIndex())}}function w(b){if(this._ignoreNextKeyDown)return this._ignoreNextKeyDown=!1,void 0;if(33==b.which||34==b.which||36==b.which||35==b.which)this.FireNavigationKeyPress(b);else if(13==b.which||45==b.which||46==b.which)this.OnSpreadsheetKeyPress(b);else if(40==b.which){var c,d,e,f=this[W][W]("option","ItemsSource"),g=this[W].data("hd-Spreadsheet").SelectedItem;null!=g&&g==f.Last()&&g.EditColumnNumber>=0&&(c=g.EditColumnNumber,d=g.RowNumber(),e=g.Cells[c],(e.data("hd-TextVariableCell")||e.data("hd-NumberVariableCell")||e.data("hd-DateVariableCell"))&&(e.SaveAnswer(),e.DialogItemNode.IsAnswered&&(g.EndCellEdit(),a.CallAsync(R(function(){f.Count()==d+1&&(g=f.Last(),g.SetCurrentCell(c,!0,null))},this)))))}}function x(){this._isMouseOver=!0,this[S]()}function y(){this._isMouseOver=!1,this[S]()}function z(a){var b=c(a.target),e=d[b.attr("tag")];this.IsCommandEnabled(e)&&b.addClass("hd-grid-button-hover")}function A(a){var b=c(a.target);b.removeClass("hd-grid-button-hover")}function B(a){if(1==a.which){var b=d[c(a.target).attr("tag")];this.ExecuteCommand(b),a.preventDefault()}}function C(a){var b,c=a;null!=c.attr("Tag")&&("undefined"==typeof this._columnHeaders&&(this._columnHeaders=[]),b=parseInt(c.attr("Tag")),b>this._columnHeaders.length?this._columnHeaders.push(c):this._columnHeaders.splice(b,0,c),this._columnHeaders.length==this[W][W]("option","Columns").Count()&&this.Update(!0))}function D(a,b){null==this._spreadsheetErrors&&(this._spreadsheetErrors=[]);var c=this._spreadsheetErrors[b.Column],d=null;null==c&&(c=[],this._spreadsheetErrors[b.Column]=c),b.IsError?(c.push(b),1==c.length&&this.InsertError(b)):(c.pop(),this.ValidationErrorGrid.children().length&&(d=this.ValidationErrorGrid.children().eq(0)),null!=d&&this.RemoveError(d))}function E(a){var c,e,f,g,h,i,j,k=b.GetRepeatCommandImage;c=k(d.EditIteration,this.IsCommandEnabled(d.EditIteration)),this.EditRowCmd.removeClass().addClass(c),c=k(d.InsertIteration,this.IsCommandEnabled(d.InsertIteration)),this.InsertRowCmd.removeClass().addClass(c),c=k(d.DeleteIteration,this.IsCommandEnabled(d.DeleteIteration)),this.DeleteRowCmd.removeClass().addClass(c),c=k(d.MoveIterationUp,this.IsCommandEnabled(d.MoveIterationUp)),this.MoveRowUpCmd.removeClass().addClass(c),c=k(d.MoveIterationDown,this.IsCommandEnabled(d.MoveIterationDown)),this.MoveRowDownCmd.removeClass().addClass(c),e=a,f=N(e.Cells[e.EditColumnNumber],L.VariableCell),g=f.DialogItemNode(),this._hasResource&&("MC"==g.DialogItem().type?(h=e.EditControl(),N(h,V)?(i=N(h,V),this.SetResourceOptionName(e,null!=i.options.SelectedOption?i.options.SelectedOption.Name():null)):(j=N(h,U),this.SetResourceOptionName(e,null!=j.SelectedItem()?j.SelectedItem().Name():null))):(this.IsResourceEnabled(null!=g.Resource()),this._resourceOptionName=null,this.FireResourceUpdate(g,null)))}function F(a,b){this.SetResourceOptionName(a,b.OptionName)}function G(a,b){var c,d,e;c=b.ChildDialogCell.DialogItemNode(),""!=c._parent._dialog.gType&&b.ChildDialogCell.ChildDialogCell("Answer",!0),d=c._parent.Children().get(c.DialogItem().name),null!=d&&(e={s:null},d.NavigateTo(!0,e,function(a){a||L.Alert(e)}))}function H(){this.IsResourceEnabled(!1)}function I(a){var b,c,d,e,f=N(this[W][W]("option","SelectedItem"),L.IterationRow);null==f||f.EditColumnNumber<0||(b=N(f.Cells[f.EditColumnNumber],L.VariableCell).DialogItemNode(),b.ClearAnswer(),"MC"==b.DialogItem().type&&(c=N(b.DialogItem(),L.McVar),!c.MultipleSelect()&&c.othr?(d=N(f.EditControl(),V),d.Text(null)):(e=N(f.EditControl(),U),e.SelectedItem(null))),a.preventDefault())}function J(a){9==a.which||33==a.which||34==a.which||36==a.which||35==a.which?(this.FireNavigationKeyPress(a),this._ignoreNextKeyDown=!0):(13==a.which||45==a.which||46==a.which)&&(this.OnSpreadsheetKeyPress(a),this._ignoreNextKeyDown=!0)}function K(){var a,b=null,c="",d=this[W][W]("option","SelectedItem");null!=d&&d.EditColumnNumber>=0&&(a=d.Cells[d.EditColumnNumber].DialogItemNode(),null!=a.Resource()&&(b=P.GetResourceText(a,this._resourceOptionName,!1),c=a._parent.GetResourceButtonCaption())),M(b)&&null!=this._dialogItemNode.Resource()&&(b=P.GetResourceText(this._dialogItemNode,null,!1),c=this._dialogItemNode._parent.GetResourceButtonCaption()),M(b)||P.DisplayResourceWindow(b,c)}var L=HOTDOC$,M=a.String.IsNullOrEmpty,N=a.Cast,O=a.Windows.Controls.ToolTipService.SetToolTip;this.DEBUG===m&&(this.DEBUG=L.DEBUG);var P,Q,R=c.proxy,S="UpdateResourceAndClearAnswerButtons",T="GetResourceString",U="MultChoiceComboBox",V="MultChoiceEditableComboBoxControl",W="Spreadsheet",X=L.Dialog,Y=a.Windows.Visibility,Z="keydown",$="mouse",_=$+"enter",ab=$+"leave",bb=$+"down",cb=$+"up.SpreadsheetControl",db="CellEditStarted",eb="CellEditEnded",fb="ErrorStateChanged",gb="OptionSelected",hb="NavigateToChild",ib="FocusEntering",jb="FocusLeaving",kb="hd-img",lb="hd-img-g";L.Class.SpreadsheetControl={B:"IDialogItemNodeControl",SC:function(){Q=new h("hd-ss-text"),P=X.DialogControl},W:{GetColumnItemNodes:function(a){var b,c,d=[],e=a._itemNodes;for(b=0;b<e.Count();b++)c=e.get(b),n(c)&&d.push(c);return d},_create:function(){this.InitializeComponent(),this.element.on(bb,R(o,this)),this._dialogItemNode=this.options.node,this._dialogItemNode[ib].push(R(p,this)),this._dialogItemNode[jb].push(R(q,this)),this._dialogItemNode.IsDialogOnParent()&&null!=this._dialogItemNode.Resource()&&(this._hasResource=!0),this._repeatNode=this._dialogItemNode.SpreadsheetNode(),!1;
var a,b,d,g,h,i,j=c("<div class='hd-grid-rh'/>").hide().appendTo("#hdBodyDiv"),k=Math.max(28,j.height());for(j.remove(),this[W][W]({RowHeight:k}),this[W].on("BeginningEdit",R(r,this)).on("PreparingCellForEdit",R(s,this)).on("LoadingRow",R(t,this)).on("UnloadingRow",R(u,this)).on("CurrentCellChanged",R(v,this)).on(Z,R(w,this)),this.element.on(_,R(x,this)).on(ab,R(y,this)),d=this.GetColumnItemNodes(N(this._repeatNode.Children().get(0),l)),g=0;g<d.length;g++){switch(h=d[g],b=this[W][W]("option","Columns").Count(),h.DialogItem().type){case"TX":a=new f(b);break;case"NU":a=new L.NumberVariableColumn(b);break;case"DA":a=new L.DateVariableColumn(b);break;case"TF":a=new L.TrueFalseVariableColumn(b,this._dialogItemNode._parent._dialog.gType);break;case"MC":a=new L.MultipleChoiceVariableColumn(b,N(h.DialogItem(),L.McVar));break;case"DI":a=new L.ChildDialogColumn(b,this._dialogItemNode._parent._dialog.gType);break;default:throw new e("Invalid spreadsheet column type.")}a.Header("&nbsp;"),this[W][W]("option","Columns").Add(a),null!=h.Resource()?this._hasResource=!0:"MC"==h.DialogItem().type&&(i=this,c.each(h.GetOptions().list,function(a,b){null!=b.rsrc&&(i._hasResource=!0)}))}this[W][W]({ItemsSource:c.ObservableCollection()}),this[S](),this.IsResourceEnabled(!1),this._repeatNode._dialog.hideSB&&this.ToolbarGrid.hide(),O(this.ClearAnswerImage,this._repeatNode[T]("hdmnuClearAns")),O(this.ResourceImage,this._repeatNode.GetResourceButtonCaption()),O(this.EditRowCmd,this._repeatNode[T]("uitt_ssbedit")),O(this.InsertRowCmd,this._repeatNode[T]("uitt_ssbins")),O(this.DeleteRowCmd,this._repeatNode[T]("uitt_ssbdel")),O(this.MoveRowUpCmd,this._repeatNode[T]("hdmnuMoveRowUp")),O(this.MoveRowDownCmd,this._repeatNode[T]("hdmnuMoveRowDn"))},_setOption:function(a,b){switch(a){case"ClearAnswerVisibility":this.options.ClearAnswerVisibility!=b&&(b==Y.Visible?this.ClearAnswerImage.css("visibility","visible").on("click",R(I,this)):this.ClearAnswerImage.css("visibility","hidden").off("click",I));break;case"ResourceVisibility":this.ResourceImage.css("visibility",b==Y.Visible?"visible":"hidden");break;case"Visibility":this.element[b==Y.Visible?"show":"hide"](),b==Y.Visible&&this[W].triggerHandler("LayoutUpdated")}c.hd.IDialogItemNodeControl.prototype._setOption.apply(this,arguments)},InitializeComponent:function(){this.ControlGrid=c("<table/>").appendTo(this.element),this.ControlRow=c("<tr/>").appendTo(this.ControlGrid),this.InputCell=c('<td style="width:100%"/>').appendTo(this.ControlRow),this[W]=c("<div/>").appendTo(this.InputCell)[W]({ColumnHeaderLoaded:R(C,this),CanUserSortColumns:!1}),this.InputControlButtons=[],this.InputControlButtons.push(c('<td class="hd-cell-button"/>').appendTo(this.ControlRow)),this.InputControlButtons.push(c('<td class="hd-cell-button"/>').appendTo(this.ControlRow)),this.ResourceImage=c('<div class="hd-rsrc" name="HDRsrcBtn"/>').appendTo(this.InputControlButtons[0]),this.ClearAnswerImage=c('<div class="hd-img hd-clr-ans"/>').css("visibility","hidden").appendTo(this.InputControlButtons[1]),this.ValidationErrorGrid=c('<div style="float:left; margin-top:5px;"/>').appendTo(this.InputCell),this.ToolbarGrid=c("<div/>").css("visibility","hidden").appendTo(this.InputCell),this.ImageGrid=c('<div class="hd-grid-buttongrid"/>').appendTo(this.ToolbarGrid),this.EditRowCmd=c('<div tag="EditIteration"/>').appendTo(this.ImageGrid),this.InsertRowCmd=c('<div tag="InsertIteration"/>').appendTo(this.ImageGrid),this.DeleteRowCmd=c('<div tag="DeleteIteration"/>').appendTo(this.ImageGrid),c('<div class="hd-img hd-nav-Sep" style="float:left"/>').appendTo(this.ImageGrid),this.MoveRowUpCmd=c('<div tag="MoveIterationUp"/>').appendTo(this.ImageGrid),this.MoveRowDownCmd=c('<div tag="MoveIterationDown"/>').appendTo(this.ImageGrid),this.ImageGrid.children().filter(":not(.hd-nav-Sep)").on(_,R(z,this)).on(ab,R(A,this)).on(cb,R(B,this))},UpdateResourceButton:function(){var a=this.ResourceImage;this._hasResource?(this._setOption("ResourceVisibility",Y.Visible),this._dialogItemNode.ShowAllResourceButtons()||a.css("visibility",this._isMouseOver||this._hasFocus?"visible":"hidden")):(this._setOption("ResourceVisibility",Y.Collapsed),this.InputControlButtons[0].insertAfter(this.InputControlButtons[1]))},UpdateClearAnswerButton:function(){var a,b,c,d=this[W][W]("option","SelectedItem");null!=d&&(c=N(d,L.IterationRow),a=N(c.Cells[this[W][W]("CurrentColumn").DisplayIndex()],L.VariableCell),b=N(a,L.ChildDialogCell),(null!=b?b.IsButtonEnabled():a.IsEnabled())?(this._setOption("ClearAnswerVisibility",Y.Visible),this.ClearAnswerImage.css("visibility",this._isMouseOver||this._hasFocus?"visible":"hidden")):this._setOption("ClearAnswerVisibility",Y.Collapsed))},UpdateResourceAndClearAnswerButtons:function(){this.UpdateResourceButton(),this.UpdateClearAnswerButton()},Update:function(a){var b,c,d,e,f,h,m,n,o,p,q,r,s,t,u;if(this._inUpdate=!0,(a||(this._dialogItemNode.UpdateFlags()&j.Hidden)==j.Hidden)&&this._setOption("Visibility",this._dialogItemNode.Hidden()?Y.Collapsed:Y.Visible),(a||(this._dialogItemNode.UpdateFlags()&j.Gray)==j.Gray)&&this._setOption("IsEnabled",!this._dialogItemNode.Gray()),null!=this._columnHeaders&&(a||0!=(this._repeatNode.DescendantUpdateflags()&(j.Hidden|j.Prompt|j.Required))))for(b=this.GetColumnItemNodes(N(this._repeatNode.Children().get(0),l)),u=this[W][W]("option","Columns"),!1,columnNumber=0;columnNumber<u.Count();columnNumber++)if(c=b[columnNumber],(a||(c.UpdateFlags()&j.Hidden)==j.Hidden)&&u.get(columnNumber).Visibility(c.Hidden()?Y.Collapsed:Y.Visible),(a||0!=(c.UpdateFlags()&(j.Prompt|j.Required)))&&(d=this._columnHeaders[columnNumber].children("span"),"NONE"!=c.Prompt()&&(promptSource=new X.PromptParserSource(c),P.DotCodeParser().Parse(promptSource,new i(d,d.FontSize,promptSource.Required())),d.text(k.TrimForUseAsTitle(d.text()))),a&&!u.get(columnNumber).Width().IsAbsolute())){if(e=0,f=c.DialogItem(),null!=f)if("E"==f.colWT)e=f.colWid;else switch(c.DialogItem().type){case"TX":e=24;break;case"NU":e=12;break;case"DA":e=10;break;case"MC":e=16}u.get(columnNumber).Width(new g(Math.max(d.outerWidth()+22,e*Q.QuixelFactor+12)))}if(a||0!=(this._repeatNode.DescendantUpdateflags()&(j.ScriptAnswer|j.Gray|j.set|j.RepeatAnswer))){for(h=this[W][W]("option","ItemsSource"),m=h.Count(),p=0;p<this._repeatNode.Children().Count();p++){if(n=N(this._repeatNode.Children().get(p),l),o=null,(n.UpdateFlags()&j.NewlyAdded)!=j.NewlyAdded){for(q=p;q<h.Count()&&h.get(q).IterationNode()._id!=n._id;q++);if(q<h.Count()){for(r=p;q>r;r++)this.RemoveIteration(p);o=h.get(p),o.RowNumber(p+1),o.Update(!1)}}null==o&&(o=new L.IterationRow(this[W],n),o.RowNumber(p+1),o[fb].push(R(D,this)),o[db].push(R(E,this)),o[eb].push(R(H,this)),o[gb].push(R(F,this)),o[hb].push(R(G,this)),h.Insert(p,o))}for(;p<h.Count();)this.RemoveIteration(p);if(this.Spreadsheet.Spreadsheet({EditingColumnIndex:-1}),null!=this._columnHeaders&&(a||h.Count()!=m)){for(b=this.GetColumnItemNodes(this._repeatNode.Children().get(0)),s=0,columnNumber=0;columnNumber<this[W][W]("option","Columns").Count();columnNumber++)b[columnNumber].Hidden()||(s=Math.max(this._columnHeaders[columnNumber].height(),s));t=Math.min(h.Count(),this._dialogItemNode.DialogItem().maxRows),this[W][W]({Height:Math.ceil(this[W][W]("option","RowHeight"))*t})}}this._inUpdate=!1},FireNavigationKeyPress:function(a){this.element.trigger("NavigationKeyPress",a)},FireResourceUpdate:function(a,b){this.element.trigger("ResourceUpdate",new X.ResourceUpdateEventArgs(a,b))},DialogItemNode:function(){return this._dialogItemNode},Dispose:function(a){if(a===m||a){this._dialogItemNode[ib].pop(),this._dialogItemNode[jb].pop(),this._inUpdate=!0;for(var b=this[W][W]("option","ItemsSource");b.Count()>0;)this.RemoveIteration(0);this._inUpdate=!1}},RemoveIteration:function(a){var b=this[W][W]("option","ItemsSource"),c=b.get(a);c[fb].pop(),c[db].pop(),c[eb].pop(),c[gb].pop(),c[hb].pop(),this.DiscardRowErrors(c),c.Dispose(),b.RemoveAt(a)},InsertError:function(a){var b=c("<div/>").ValidationErrorControl({Tag:a,Text:a.Message});O(b.children(".hd-img"),this._repeatNode[T]("ui_err")),b.attr("row",this.ValidationErrorGrid.children().length),b.appendTo(this.ValidationErrorGrid).show()},RemoveError:function(a){a.nextAll().each(function(a,b){var d=c(b),e=d.attr("row");d.attr("row",e-1)}),columnNumber=a.ValidationErrorControl("option","Tag").Column,columnErrors=this._spreadsheetErrors[columnNumber],columnErrors.length>0&&this.InsertError(columnErrors[0]),a.remove()},DiscardRowErrors:function(a){if(null!=this._spreadsheetErrors){var b,c,d,e,f=a.IterationNode().IterationId();for(b=0;b<this._spreadsheetErrors.length;b++)if(null!=this._spreadsheetErrors[b])for(c=this._spreadsheetErrors[b],d=0;d<c.length;)c[d].IterationId==f?c.splice(d,1):d++;for(d=0;d<this.ValidationErrorGrid.children().length;d++)e=N(this.ValidationErrorGrid.children().eq(d),"ValidationErrorControl"),e.options.Tag.IterationId==f&&this.RemoveError(e.element)}},OnSpreadsheetKeyPress:function(a){switch(a.which){case 13:a.ctrlKey?(this.ExecuteCommand(d.EditIteration),a.preventDefault()):!a.shiftKey&&!a.altKey&&a.preventDefault();break;case 45:a.ctrlKey&&(this.ExecuteCommand(d.InsertIteration),a.preventDefault());break;case 46:a.ctrlKey&&(this.ExecuteCommand(d.DeleteIteration),a.preventDefault())}},IsCommandEnabled:function(a){var c=this[W][W]("option","SelectedItem");return null==c?!1:b.IsRepeatCommandEnabled(a,this._repeatNode,c.IterationNode().IterationNumber())},ExecuteCommand:function(a){this.IsCommandEnabled(a)&&(b.ExecuteRepeatCommand(a,this._repeatNode,this[W][W]("option","SelectedItem").IterationNode().IterationNumber()),a!=d.EditIteration&&this._repeatNode.AdvanceFocus(!1,L.FocusDirection.Forward))},SetResourceOptionName:function(a,b){if(this._hasResource){var c,d=a.Cells[a.EditColumnNumber].DialogItemNode(),e=M(b)?null:null;null!=e?(this._resourceOptionName=b,c=!0):(this._resourceOptionName=null,c=!1),!c&&null!=d.Resource&&(c=!0),this.IsResourceEnabled(c),this.FireResourceUpdate(d,this._resourceOptionName)}},IsResourceEnabled:function(a){if("boolean"!=typeof a)return this.ResourceImage.hasClass(kb);var b=this._dialogItemNode.IsDialogOnParent()&&null!=this._dialogItemNode.Resource()?!0:a;b&&!this.ResourceImage.hasClass(kb)?this.ResourceImage.addClass(kb).removeClass(lb).on("click",R(K,this)):!b&&!this.ResourceImage.hasClass(lb)&&this.ResourceImage.addClass(lb).removeClass(kb).off("click",K)}}}}),define("dialog/textinputcontrol",["hdmain/jq","hdmain/system","dialog/controlmetrics"],function(a,b,c){var d,e,f,g=HOTDOC$,h=b.String.IsNullOrEmpty,i=a.proxy,j="InputControl",k="Text"+j,l="TextInputStyle",m="TextReadOnlyStyle",n="AnswerTextBox",o="¶";g.Class[k]={B:j,SC:function(){d=a.hd[j].prototype,e=new c(a("<input/>").TextBox({Style:g.GetStyle(l)})),f=new c(a("<input/>").TextBox({Style:g.GetStyle(m)}))},W:{_create:function(){d._create.apply(this,arguments),this.element.attr("widget",k);var b=this.Variable();this._wrap=a('<div class="hd-input-wrapper"/>').appendTo(this.ControlCell),this._textBox=a(b.fldHgt>1?"<textarea/>":'<input type="text"/>')[n]({Style:g.GetStyle(this._dialogItemNode.ReadOnly()?m:l)}),this._textBox.on("NavigationKeyPress."+k,i(this._textBox_NavigationKeyPress,this)).appendTo(this._wrap),this._textMetrics=this._dialogItemNode.ReadOnly()?f:e,b.fldHgt>1?(this._textBox.attr({rows:b.fldHgt,wrap:"hard"}),b.maxLen>0&&this._textBox.attr("maxlength",b.maxLen)):h(b.patrn)?b.maxLen>0&&this._textBox.attr("maxlength",b.maxLen):this._dialogItemNode.ReadOnly()||(this._textBox.on("TextChanged",i(this._textBox_TextChanged,this)).attr("placeholder",b.patrn),g.iOS&&b.patrn.length>0&&/[0-9\(\)]/.test(b.patrn.substr(0,1))&&this._textBox.attr("pattern","[0-9]*"),this._dialogItemNode.AnswerReformatted.push(i(this._dialogItemNode_AnswerReformatted,this))),"absolute"==this._prompt.css("position")&&this._wrap.css("padding-left",this._prompt.width())},_setOption:function(a,b){switch(a){case"IsEnabled":this._textBox.prop("disabled",!b);break;case"IsReadOnly":b!=this._isReadOnly&&(b&&this._textBox[n]({IsReadOnly:b}),this._isReadOnly=b);break;case"IsSetByDialogScript":b!=this._isSetByDialogScript&&(b?this._textBox[n]({IsReadOnly:!0,BorderThickness:0,Background:"transparent"}):this._textBox[n]({IsReadOnly:!1,BorderThickness:"",Background:""}),this._isSetByDialogScript=b)}d._setOption.apply(this,arguments)},_textBox_NavigationKeyPress:function(a,b){this.FireNavigationKeyPress(b)},_textBox_TextChanged:function(){if(this._skipTextChange)this._skipTextChange=!1;else{var a=b.Cast(this._textBox,n),c={v:a.SelectionStart()},d=g.TxVar.FitTextToPattern(a.Text(),this.Variable().patrn,c);d!=a.Text()&&(a.Text(d),a.SelectionStart(c.v),this._skipTextChange=!0)}},_dialogItemNode_AnswerReformatted:function(a,b){this._skipTextChange=!0,this._textBox[n]("Text",b.FormattedAnswer)},Dispose:function(a){"boolean"!=typeof a&&(a=!0),d.Dispose.call(this,a),a&&!h(this.Variable().patrn)&&!this._dialogItemNode.ReadOnly()&&this._dialogItemNode.AnswerReformatted.pop()},OnKeyDown:function(a){var c,e,f,g,h=this.Variable();13==a.which&&h.fldHgt>1&&(a.ctrlKey||h.entPar&&!a.shiftKey)&&(c=b.Cast(this._textBox,n),e=c.Text(),f=c.SelectionStart(),g=1,e=e.slice(0,f)+o+e.slice(f),a.ctrlKey&&(e=e.slice(0,f+1)+"\r\n"+e.slice(f+1),g++),c.Text(e),c.SelectionStart(f+g)),d.OnKeyDown.call(this,a)},PromptVerticalAlignment:function(){return this.Variable().fldHgt>1?"T":"C"},FieldWidth:function(){return this.Variable().fldHgt>1?"F":d.FieldWidth.call(this)},QuixelFactor:function(){return this._textMetrics.QuixelFactor},CalculatedWidth:function(){if(0==this._calculatedWidth){var a=this.Variable();this._calculatedWidth=h(a.patrn)?a.maxLen>0?a.maxLen*this.QuixelFactor():30*this.QuixelFactor():this._textMetrics.GetTextWidth(a.patrn),this._calculatedWidth+=this._textBox.width()+this.QuixelFactor()/2}return this._calculatedWidth},SetControlAnswer:function(){this._skipTextChange=!0,this._textBox.val(this._dialogItemNode.StringAnswer())},SetFocus:function(){this._textBox.focus()},SaveControlAnswer:function(){this._dialogItemNode.StringAnswer(this._textBox.val())}}}}),define("dialog/truefalseinputcontrol",["hdmain/jq","hdmain/system","system/checkbox","system/radiobutton","dialog/textblockmetrics","dialog/textblockformatter","engine/dialogupdateflags"],function(a,b,c,d,e,f,g,h){var i=HOTDOC$;this.DEBUG===h&&(this.DEBUG=i.DEBUG);var j,k,l=a.proxy,m=b.Windows.Input.FocusManager.GetFocusedElement;i.Class.TrueFalseInputControl={B:"InputControl",SC:function(){j=a.hd.InputControl.prototype,k=new e("DialogTextStyle")},W:{_create:function(){j._create.apply(this,arguments),this.element.attr("widget","TrueFalseInputControl"),this._inUpdateControlAnswer=!1,this._buttons=[];var c,d,e,f;switch(c=this._dialogItemNode.ReadOnly()?"hd-input-tf-readonly":"hd-input-tf",this.Dialog().gType){case"":f=this._dialogItemNode.DialogItem().name,this.stackPanel=a('<div style="float:left; white-space:nowrap;"/>').appendTo(this.ControlCell),this.Variable().sameLine||(this._border=this.stackPanel,this.options.IsEnabledChanged=l(this.TrueFalseInputControl_IsEnabledChanged,this),this.stackPanel.addClass("hd-input-tf hd-input-tf-gb")),d=a("<label/>").text(this.GetResourceString("ui_yes")),this.Variable().sameLine&&d.css("margin-right","15px"),e=a('<input type="radio"/>').attr("name",f).appendTo(this.stackPanel).RadioButton({Style:c,Content:d}),e.on("Checked",l(this.button1_Checked,this)),this._buttons.push(e),this.Variable().sameLine||a("<br/>").appendTo(this.stackPanel),d=a("<label/>").text(this.GetResourceString("ui_no")),e=a('<input type="radio"/>').attr("name",f).appendTo(this.stackPanel).RadioButton({Style:c,Content:d}).on("Checked",l(this.button2_Checked,this)),this._buttons.push(e);break;case"S":d=a("<label/>").addClass("hd-input-prompt"),e=a('<input type="radio"/>').appendTo(this.ControlCell).RadioButton({Style:c,GroupName:b.Guid.NewGuid(),Content:d}).on("Checked",l(this.button1_Checked,this)),this._buttons.push(e);break;case"M":d=a("<label/>").addClass("hd-input-prompt"),e=a('<input type="checkbox"/>').appendTo(this.ControlCell).CheckBox({Style:c,Content:d}).on("Checked",l(this.button1_Checked,this)).on("Unchecked",l(this.button1_Unchecked,this)),this._buttons.push(e)}},_setOption:function(a,b){switch(a){case"IsEnabled":this.element.find("input,select,textarea,button").prop("disabled",!b),this.element.find(".hd-input-tf, label").toggleClass("GrayText",!b);break;case"IsReadOnly":if(b!=this._isReadOnly){if(b)for(var c=0;c<this._buttons.length;c++)this._buttons[c].prop("disabled",b);this._isReadOnly=b}}j._setOption.apply(this,arguments)},Update:function(a){if(j.Update.call(this,a),""!=this.Dialog().gType&&j.DisplayPrompt.call(this)&&(a||(this._dialogItemNode.UpdateFlags()&g.Prompt)==g.Prompt)){var c=b.Cast(this._buttons[0],"ToggleButton").options.Content;i.Dialog.DialogControl.DotCodeParser().Parse(new i.Dialog.PromptParserSource(this._dialogItemNode),new f(c,c.FontSize,!1)),this._calculatedWidth=0,this.UpdateControlWidth()}},DisplayPrompt:function(){return""==this.Dialog().gType?j.DisplayPrompt.call(this):!1},PromptPosition:function(){return this.Variable().sameLine?j.PromptPosition.call(this):"T"},ExactWidth:function(){return""==this.Dialog().gType?this.Variable().sameLine?this.CalculatedWidth():this.FieldWidthValue()*this.QuixelFactor():this.CalculatedWidth()},QuixelFactor:function(){return k.QuixelFactor},CalculatedWidth:function(){if(0==this._calculatedWidth)switch(this.Dialog().gType){case"":this.Variable().sameLine?(this._calculatedWidth=this._buttons[0].width(),this._calculatedWidth+=i.ButtonGlyphWidth,this._calculatedWidth+=this._buttons[0].RadioButton("option","Content").width(),this._calculatedWidth+=this._buttons[1].width(),this._calculatedWidth+=i.ButtonGlyphWidth,this._calculatedWidth+=this._buttons[1].RadioButton("option","Content").width()):(this._calculatedWidth=parseInt(this.stackPanel.css("margin-left"))+parseInt(this.stackPanel.css("padding-left"))+parseInt(this.stackPanel.css("padding-right"))+parseInt(this.stackPanel.css("margin-right")),this._calculatedWidth+=this._buttons[0].width(),this._calculatedWidth+=Math.max(this._buttons[0].RadioButton("option","Content").width(),this._buttons[1].RadioButton("option","Content").width()));break;case"S":case"M":this._calculatedWidth=this._buttons[0].width(),this._calculatedWidth+=i.ButtonGlyphWidth,this._calculatedWidth+=b.Cast(this._buttons[0],"ToggleButton").options.Content.width()+this.QuixelFactor()/2}return this._calculatedWidth},button1_Checked:function(){this._inUpdateControlAnswer||this._dialogItemNode.SetAnswerBool(!0)},button1_Unchecked:function(){this._inUpdateControlAnswer||this._dialogItemNode.SetAnswerBool(!1)},button2_Checked:function(){this._inUpdateControlAnswer||this._dialogItemNode.SetAnswerBool(!1)},SetControlAnswer:function(){this._inUpdateControlAnswer=!0;var a=this._dialogItemNode.BoolAnswer();switch(this.Dialog().gType){case"":null!=a?(this._buttons[0].prop("checked",a),this._buttons[1].prop("checked",!a)):(this._buttons[0].prop("checked",!1),this._buttons[1].prop("checked",!1));break;case"S":case"M":null!=a?this._buttons[0].prop("checked",a):this._buttons[0].prop("checked",!1)}this._inUpdateControlAnswer=!1},TrueFalseInputControl_IsEnabledChanged:function(){this.ShowBorderEnabled(this._border,this.options.IsEnabled)},SetFocus:function(a){switch(this.Dialog().gType){case"":this._buttons[a==i.TrueOptionName?0:1].focus();break;case"S":case"M":this._buttons[0].focus()}},SaveControlAnswer:function(){},FocusOptionName:function(){switch(this.Dialog().gType){case"":return this._buttons[0]==m()[0]?i.TrueOptionName:i.FalseOptionName;default:return""}},OnKeyDown:function(a){if(""==this.Dialog().gType)switch(a.which){case 38:case 37:case 40:case 39:this._buttons[0][0]==m()[0]?(this._dialogItemNode.BoolAnswer(!1),this.SetFocus(i.FalseOptionName)):this._buttons[1][0]==m()[0]&&(this._dialogItemNode.BoolAnswer(!0),this.SetFocus(i.TrueOptionName)),this.SetControlAnswer(),a.preventDefault()}j.OnKeyDown.call(this,a)},SetAnswerAndFocus:function(){this._dialogItemNode.SetAnswerBool(!0),this.SetControlAnswer(),this.SetFocus(null)}}}}),define("dialog/validationerrorcontrol",["hdmain/jq"],function(a){var b="ValidationErrorControl";return a.widget("hd."+b,{_create:function(){a.Widget.prototype._create.apply(this,arguments),this.element.addClass("hd-validation"),this.Img=a('<div class="hd-img hd-error-16"/>').appendTo(this.element),this.Msg=a("<span/>").appendTo(this.element),this.option(this.options)},_setOption:function(b,c){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"Text":null!=c&&this.Msg.text(c);break;case"Visibility":this.element[c?"show":"hide"](),c&&this.Img.css("margin-top",Math.max(0,(this.element.outerHeight()-this.Img.height())/2)+"px")}}}),a.hd[b]}),define("dialog/variablecell",["hdmain/jq","hdmain/system","engine/dialogupdateflags"],function(a,b,c,d){function e(b){if(this._skipTextChange)this._skipTextChange=!1;else{var c=i(a(b.target),"TextBox"),d={v:c.SelectionStart()},e=h.TxVar.FitTextToPattern(c.Text(),this._dialogItemNode.DialogItem().patrn,d);e!=c.Text()&&(c.Text(e),c.SelectionStart(d.v),this._skipTextChange=!0)}}function f(b){var c=i(a(b.target),n);null!=c.SelectedItem()?(this.Answer([c.SelectedItem().Name()]),this.OnOptionSelected(c.SelectedItem().Name())):(this.Answer(null),this.OnOptionSelected(null))}function g(b){var c=i(a(b.delegateTarget),m),d=c.SelectedOption();null!=d?(this.Answer([d.Name()]),this.OnOptionSelected(d.Name())):(this.Answer(null),this.OnOptionSelected(null))}var h=HOTDOC$,i=b.Cast,j=b.String.IsNullOrEmpty;this.DEBUG===d&&(this.DEBUG=h.DEBUG);var k,l=a.proxy,m="MultChoiceEditableComboBoxControl",n="MultChoiceComboBox",o="SelectionChanged",p="VariableCell",q="Text"+p,r="Number"+p,s="Date"+p,t="TrueFalse"+p,u="MultipleChoice"+p,v="ChildDialogCell";h.Class[p]={SC:function(){k="hd-ss-text"},C:function(a){this._dialogItemNode=a,this.PropertyChanged=[]},P:{DisplayAnswer:function(){return this.Answer().toString()},Foreground:function(){return this._dialogItemNode.Gray()?"hd-ss-text-gray":this._dialogItemNode.SetByDialogScript()?"hd-ss-text-set":this._dialogItemNode.ReadOnly()?"hd-ss-text-readonly":k},IsEnabled:function(){return!this._dialogItemNode.Gray()&&!this._dialogItemNode.SetByDialogScript()&&!this._dialogItemNode.ReadOnly()},AnsweredStatus:function(){return this._dialogItemNode.AnsweredStatus()},DialogItemNode:function(){return this._dialogItemNode},Update:function(a){(a||(this._dialogItemNode.UpdateFlags()&c.ScriptAnswer)==c.ScriptAnswer)&&(this.OnScriptAnswerChange(),this.NotifyPropertyChanged(this.AnswerPropertyName())),(a||0!=(this._dialogItemNode.UpdateFlags()&(c.Gray|c.set)))&&(this.NotifyPropertyChanged("Foreground"),this.NotifyPropertyChanged("Background"),this.NotifyPropertyChanged("IsEnabled"))},BeginEdit:function(a){a.is("label")||a.is("div")?a.find("input").focus():a.focus(),h.Dialog.DialogControl.ScrollIntoView(a),this._editControl=a,this.NotifyPropertyChanged(this.AnswerPropertyName())},EndEdit:function(){this._editControl=null},EditControl:function(){return this._editControl},NotifyPropertyChanged:function(a){for(var b=0;b<this.PropertyChanged.length;b++)this.PropertyChanged[b]({PropertyName:a})},OnScriptAnswerChange:function(){},AnswerPropertyName:function(){return null!=this._editControl?"Answer":"DisplayAnswer"}}},h.Class[q]={B:p,C:function(){h[q].baseConstructor.apply(this,arguments)},P:{Answer:function(a){return a===d?this._dialogItemNode.StringAnswer():(this._dialogItemNode.StringAnswer(a),void 0)},SaveAnswer:function(){null!=this._editControl&&this.Answer(this._editControl.val())},BeginEdit:function(){h[q].baseclass.BeginEdit.apply(this,arguments);var a=this._dialogItemNode.DialogItem();j(a.patrn)?a.maxLen>0&&this._editControl.attr("maxlength",a.maxLen):(this._skipTextChange=!1,this._editControl.on("TextChanged",l(e,this)))},EndEdit:function(){var a=this._dialogItemNode.DialogItem();j(a.patrn)?a.maxLen>0&&this._editControl.removeAttr("maxlength"):this._editControl.off("TextChanged",e),h[q].baseclass.EndEdit.apply(this,arguments)}}},h.Class[r]={B:p,C:function(){h[r].baseConstructor.apply(this,arguments)},P:{Answer:function(a){if(a===d)return j(this._cachedAnswer)?this._dialogItemNode.StringAnswer():this._cachedAnswer;var b={s:null},c=a;this._cachedAnswer=this._dialogItemNode.SetAnswerString(c,b)==h.Engine.SetAnswerResult.AnswerWasSet?null:c},SaveAnswer:function(){this.Answer(this._editControl.val())},OnScriptAnswerChange:function(){this._cachedAnswer=null}}},h.Class[s]={B:p,C:function(){h[s].baseConstructor.apply(this,arguments)},P:{Answer:function(a){if(a===d)return j(this._cachedAnswer)?this._dialogItemNode.StringAnswer():this._cachedAnswer;var b={s:null},c=a;this._cachedAnswer=this._dialogItemNode.SetAnswerString(c,b)==h.Engine.SetAnswerResult.AnswerWasSet?null:c},SaveAnswer:function(){this._editControl.parents().length>0&&this.Answer(this._editControl.AnswerDatePicker("RawText"))},OnScriptAnswerChange:function(){this._cachedAnswer=null}}},h.Class[t]={B:p,C:function(){h[t].baseConstructor.apply(this,arguments)},P:{Answer:function(a){return a===d?this._dialogItemNode.BoolAnswer():(this._dialogItemNode.BoolAnswer(a),void 0)},SaveAnswer:function(){},AnswerPropertyName:function(){return"Answer"}}},h.Class[u]={B:p,C:function(){h[u].baseConstructor.apply(this,arguments),this.OptionSelected=[]},P:{Answer:function(a){return a===d?this._dialogItemNode.ListAnswer():(this._dialogItemNode.ListAnswer(null!=a?a:null),void 0)},DisplayAnswer:function(){var a,b,c=null,d=this._dialogItemNode.ListAnswer();return null!=d&&d.length>0&&(c=d.slice(0)),null==c?"":(a=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return c.indexOf(a.name)>-1}),b=this._dialogItemNode.DialogItem(),!b.MultipleSelect()&&b.othr?null!=a?a.Prompt():c[0]:null!=a?a.Prompt():"")},SaveAnswer:function(){var a,b,c=this._dialogItemNode.DialogItem();!c.MultipleSelect()&&c.othr&&(a=i(this._editControl,m),b=this._dialogItemNode.GetOptions().FirstOrDefault(function(b){return b.Prompt()==a.Text()}),null==b?this.Answer(j(a.Text())?null:[a.Text()]):null==a.SelectedOption()&&this.Answer([b.name]))},BeginEdit:function(a){h[u].baseclass.BeginEdit.apply(this,arguments);var c,d,e,j,k,p=null,q=this.Answer();null!=q&&q.length>0&&(p=q.slice(0)),c=this._dialogItemNode.GetOptions().Select(function(a){return h.Dialog.OptionPrompt.ToOptionPrompt(a)}),d=this._dialogItemNode.DialogItem(),!d.MultipleSelect()&&d.othr?(e=a,e[m]("ItemsSource",c),null==p?e[m]({Text:null}):(j=b.List.FirstOrDefault(c,function(a){return p.indexOf(a.Name())>-1}),null!=j?e[m]("SelectedOption",j):e[m]({Text:p[0]})),e.on(o,l(g,this))):(k=i(this._editControl,n),k._setOption("ItemsSource",c),null==p?k.SelectedItem(null):(j=b.List.FirstOrDefault(c,function(a){return p.indexOf(a.Name())>-1}),k.SelectedItem(j)),k.element.on("change."+o,l(f,this)))},EndEdit:function(){var a=this._dialogItemNode.DialogItem();!a.MultipleSelect()&&a.othr?this._editControl.off(o,g):this._editControl.off("change."+o,f),h[u].baseclass.EndEdit.apply(this,arguments)},OnOptionSelected:function(a){for(var b=0;b<this.OptionSelected.length;b++)this.OptionSelected[b](this,new h.Dialog.OptionSelectedEventArgs(a))}}},h.Class[v]={B:p,C:function(){h[v].baseConstructor.apply(this,arguments),this.NavigateToChildCommand(l(function(){this.CanNavigateToChild.apply(this,arguments)&&this.OnNavigateToChild.apply(this,arguments)},this)),this.NavigateToChild=[]},P:{NavigateToChildCommand:function(a){return a===d?this.ntcc:(this.ntcc=a,void 0)},Answer:function(a){return a===d?null!=this._dialogItemNode.BoolAnswer()?this._dialogItemNode.BoolAnswer():!1:(this._dialogItemNode.BoolAnswer(a),void 0)},SaveAnswer:function(){},Update:function(a){h[v].baseclass.Update.apply(this,arguments),(a||(this._dialogItemNode.UpdateFlags()&c.AnsweredStatus)==c.AnsweredStatus)&&this.NotifyPropertyChanged("AnsweredStatus")},IsEnabled:function(){var a=!0,b=!0;return this._dialogItemNode.Gray()?(b=!1,a=!1):(this._dialogItemNode.SetByDialogScript()||this._dialogItemNode.ReadOnly())&&(b=!1,a=""!=this._dialogItemNode._parent._dialog.gType?this._dialogItemNode.BoolAnswer().GetValueOrDefault():!1),this.IsButtonEnabled(b),a},IsButtonEnabled:function(a){return"boolean"!=typeof a?this._isButtonEnabled:(a!=this._isButtonEnabled&&(this._isButtonEnabled=a,this.NotifyPropertyChanged("IsButtonEnabled")),void 0)},OnNavigateToChild:function(){for(var a=0;a<this.NavigateToChild.length;a++)this.NavigateToChild[a](this,{})},CanNavigateToChild:function(){return!0},BeginEdit:function(a,b){h[v].baseclass.BeginEdit.apply(this,arguments),i(a,"ChildDialogControl").SetFocus(b)},AnswerPropertyName:function(){return"Answer"}}}}),define("dialog",["dialog/answerdatepicker","dialog/answersourcewindow","dialog/answertextbox","dialog/childdialogcontrol","dialog/commandhandler","dialog/contextmenucontrol","dialog/customnavigationbarbutton","dialog/dateinputcontrol","dialog/dialogcaptioncontrol","dialog/dialogerrorcontrol","dialog/dialogcontentcontrol","dialog/dialogcontrol","dialog/dialoginputcontrol","dialog/htmlhostcontrol","dialog/inputcontrol","dialog/interviewstack","dialog/iterationrow","dialog/linkcontrol","dialog/multchoicecombobox","dialog/multchoiceeditablecomboboxcontrol","dialog/multchoicelistbox","dialog/multiplechoiceinputcontrol","dialog/numberinputcontrol","dialog/optionprompt","dialog/parenttitlecontrol","dialog/popupinterviewwindow","dialog/promptparsersource","dialog/repeatcontrol","dialog/spreadsheet","dialog/spreadsheetcontrol","dialog/stringformatter","dialog/textinputcontrol","dialog/truefalseinputcontrol","dialog/validationerrorcontrol","dialog/variablecell","dialog/variablecolumn"],function(){});