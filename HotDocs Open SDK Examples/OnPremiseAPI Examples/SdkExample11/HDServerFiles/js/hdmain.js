/*
 * HotDocs Browser Interview Script - hdmain.js
 * Version: 11.1.141205.0541
 * Copyright Â© HotDocs Limited 1992 - 2014. All rights reserved.
 */
/*!
* XMLWriter - XML generator for Javascript, based on .NET's XMLTextWriter.
* Copyright (c) 2008 Ariel Flesler - aflesler(at)gmail(dot)com | http://flesler.blogspot.com
* Licensed under BSD (http://www.opensource.org/licenses/bsd-license.php)
*/
/*!
* This is a HotDocs adaptation of Microsoft's System.Windows.Controls.DataGrid.
* The .NET DataGrid is licensed under the Microsoft Public License:
*
* (c) Copyright Microsoft Corporation.
* This source is subject to the Microsoft Public License (Ms-PL).
* Please see http://go.microsoft.com/fwlink/?LinkID=131993 for details.
* All other rights reserved.
*
*/
/*!
 * Copyright (c) 2010 C. F., Wong (<a href="http://cloudgen.w0ng.hk">Cloudgen Examplet Store</a>)
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 */
/*!
* jQuery scrollintoview() plugin and :scrollable selector filter
*
* Version 1.8 (14 Jul 2011)
* Requires jQuery 1.4 or newer
*
* Copyright (c) 2011 Robert Koritnik
* Licensed under the terms of the MIT license
* http://www.opensource.org/licenses/mit-license.php
*/
define("hd",[],function(){var a=window.HOTDOC$="undefined"==typeof window.HOTDOC$?{}:window.HOTDOC$;return a}),define("language/hdlang_en",["hd"],function(a){var b=a.Locales="undefined"==typeof a.Locales?{}:a.Locales;b["en-US"]={name:"English (United States)",dateOrder:"MDY",shortDateFormat:"M/d/yyyy",_SpellDollars:function(b){var c=Math.floor(b),d="";return d=a.Lc.SpellNum(c,"No",!1)+" Dollar",1!==c&&(d+="s"),c=b-c,c=Math.round(100*c),d+=" and "+a.Lc.SpellNum(c,"No",!1)+" Cent",1!==c&&(d+="s"),d}},b.en={name:"English",zeroFormats:["No","None","Zero"],_stringBeginsWith:function(a,b){return a.substr(0,b.length).toUpperCase()===b.toUpperCase()},IsOrdinalSuffix:function(a,b){if(b.length<2)return 0;var c=this.GetOrdinalSuffix(a);return this._stringBeginsWith(b,c)?c.length:0},GetOrdinalSuffix:function(a){switch(a%10){case 1:if(a%100!==11)return"st";break;case 2:if(a%100!==12)return"nd";break;case 3:if(a%100!==13)return"rd"}return"th"},_place:["-","Thousand","Million","Billion","Trillion","Quadrillion","Quintillion","Sextillion"],_digit:["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],_teens:["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],_tens:["-","Ten","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],_ord:["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],SpellNum:function(a,b,c){if(a=parseInt(a),isNaN(a))return"";if(c&&a>=0&&19>=a)return this._ord[a];if(0===a&&"string"==typeof b&&""!==b)return b;if(Math.abs(a)<10)return this._digit[Math.abs(a)];var d,e,f,g,h,i,j=[],k=""+a,l=[],m=[],n=!1;for(d=0;d<k.length;d++)e=k.charAt(d),l[d]=e,m[d]="-"===e?0:parseInt(e);for(d=0;d<l.length;d++)f=l.length-d-1,"-"!==l[d]&&m[d]>0&&(f>2?(g=f-f%3,i=k.substring(d,l.length-g),d=l.length-g-1,h=parseInt(f/3),j.push(this.SpellNum(i,b,!1)),j.push(" "),j.push(this._place[h]),j.push(" ")):2===f?(j.push(this._digit[m[d]]),j.push(" "),j.push("Hundred"),j.push(" ")):1===f?(n=!0,1===m[d]?(c?j.push(this._ord[m[d+1]+10]):j.push(this._teens[m[d+1]]),j.push(" "),d++):(i=this._tens[m[d]],c&&0===m[d+1]&&(i=i.slice(0,i.length-1)+"ieth"),j.push(i),j.push(0!==m[d+1]?"-":" "))):0===f&&(n=!0,j.push(c?this._ord[m[d]]:this._digit[m[d]]),j.push(" ")));return" "===j[j.length-1]&&j.pop(),c&&!n&&j.push("th"),j.join("")},InterpretSpelledNum:function(){}},b[""]={name:"Default",dateOrder:"DMY",shortDateFormat:"dd/MM/yyyy",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],calWeekBegin:0,calWeekend:[0,6],numSeps:[".",","],strings:{ui_hd:"HotDocs",ui_hdvers:"HotDocs Browser Interview Runtime version",ui_logo:"Powered by HotDocs",ui_load:"Loading HotDocs interview...",ui_addl:"Additional components are downloading...",ui_wait:"Please Wait",ui_wait_cmp:"Please wait while additional components are downloaded...",ui_help:"HotDocs Interview Help",ui_helpcaption:"Help",ui_io:"Interview Outline",ui_yes:"Yes",ui_no:"No",ui_unans:"*** Unanswered ***",ui_other:"Other",ui_nota:"None of the Above",ui_cal:"Calendar",ui_ssbedit:"Edit Ro&w",ui_ssbins:"&Insert Row",ui_ssbdel:"&Delete Row",ui_rownum:" [Row {0}]",ui_rownew:" [New Row]",ui_new:"New",ui_rtntiv:"Back to Interview",ui_sresult:"Server Results",ui_select:"Sele&ct",ui_selectcaption:"Select from Answer Source",ui_cancel:"Cancel",ui_addbtn:"&Add Another",ui_mnutt:"Dialog Menu",ui_err:"Error",ui_close:"Close",ui_emptydlg:"Empty Dialog",ui_etc:", etc.",ui_dataload:"Loading data...",ui_and:"and",ui_or:"or",ui_minus:"minus",ui_percent:"percent",ui_true:"true",ui_false:"false",ui_as:"HotDocs Answer Summary",ui_astitle:"Template: ",ui_print:"Print",tb_as:"Answer Summary",tb_ast:"Display a summary of all answers entered in this interview.",tb_sv:"Save Answers",tb_svt:"Save the current answers.",tb_dp:"Document Preview",tb_dpt:"Display an approximate preview of the finished document.",tb_ol0:"Hide Interview Outline",tb_ol1:"Show Interview Outline",tb_ol2:"Show/Hide Interview Outline",tb_ol3:"Show Drop-down Interview Outline",tb_ol4:"Dock Interview Outline to the left side of the interview",tb_od:"Show Interview Outline",tb_pg0:"Multi-page Interview",tb_pg1:"Single-page Interview",tb_pgt:"Toggle between Multi-page and Single-page interview.",tb_rs0:"Hide Resource Pane",tb_rs1:"Show Resource Pane",tb_rst:"Toggle between showing resources in Pop-up windows or the Resource Pane.",tb_hlp:"Display the HotDocs Server help page.",tb_mnu:"Menu",tb_mnu_tip:"Show Toolbar Menu",navb_First:"Fi&rst",navb_Prev:"&Previous",navb_Next:"&Next",navb_Last:"&Last",navb_Finish:"Fini&sh",navb_More:"More",nav_First:"First Dialog",nav_PrevU:"Previous Unanswered Dialog",nav_Prev:"Previous Dialog",nav_Next:"Next Dialog",nav_NextU:"Next Unanswered Dialog",nav_Last:"Last Dialog",nav_Finish:"Finish Interview",nav_FinEM:"Finish Editing Rows / Return to List",nav_FinPopup:"Return to parent interview",nav_More:"More Navigation Buttons",nav_leave:"This will terminate the interview, and any unsaved answers you have entered will be lost. Click the Next or Previous buttons at the bottom of the page to move through the interview. If you are finished answering questions, click Finish to complete the interview and submit your answers.",nav_warnfin:"This is the last dialog in the interview.",nav_warnfin_unans:"You still have {0} unanswered question(s).",nav_warnfin_ok:"Click OK if you are finished with the interview and want to submit your answers. Click Cancel to return to the interview.",uitt_First:"First Dialog (Ctrl+Home)",uitt_PrevU:"Previous Unanswered Dialog",uitt_Prev:"Previous Dialog (Page Up)",uitt_Next:"Next Dialog (Page Down)",uitt_NextU:"Next Unanswered Dialog",uitt_Last:"Last Dialog (Ctrl+End)",uitt_ssbedit:"Edit Row (Ctrl+Enter)",uitt_ssbins:"Insert Row (Ctrl+Insert)",uitt_ssbdel:"Delete Row (Ctrl+Delete)",rs_bcap:"View Resource",rs_title:"Resource",rs_ind:"{0}{1}{2} for {3}",rs_opt:"option",rs_fld:"answer field",rs_dlg:"dialog",rs_dis:"See individual {0} for available resources",rs_cols:"columns",rs_opts:"options",rs_dock:"Dock resource pane to bottom of interview",val_invdate:"Please enter a valid date.",val_invnum:"Please enter a number.",val_numrng:"Please enter a number between {0} and {1}.",val_numlt:"Please enter a number that is less than or equal to {0}.",val_numgt:"Please enter a number that is greater than or equal to {0}.",val_reqg:"One or more questions are required and must be answered before you can complete the interview.",val_reqp:"One or more questions are required and must be answered before you can proceed.",val_reqd:"One or more questions in the {0} dialog are required and must be answered before you can proceed.",val_dlg_errg:"You must resolve the outstanding dialog errors before you can complete the interview.",val_dlg_errp:"This dialog contains the following error, which must be resolved before you can proceed:\r\n\r\n{1}",val_dlg_errd:"The {0} dialog contains the following error, which must be resolved before you can proceed:\r\n\r\n{1}",val_rptlim:"You can enter only {0} sets of answers for this dialog.",val_repdel:"Are you sure you want to delete this repetition?",val_err:"You must resolve one or more input errors before you can proceed.",val_wait:"Please wait while your answers are being processed.",hdmnuClearAns:"Erase Answer",hdmnuCut:"Cut",hdmnuCopy:"Copy",hdmnuPaste:"Paste",hdmnuDel:"Delete",hdmnuSelAll:"Select All",hdmnuEditRow:"Edit Row",hdmnuInsRow:"Insert Row",hdmnuDelRow:"Delete Row",hdmnuMoveRowUp:"Move Row Up",hdmnuMoveRowDn:"Move Row Down",hdmnuClearDlg:"Erase Answers",hdmnuInsRep:"Insert Repetition",hdmnuDelRep:"Delete Repetition",hdmnuMoveUp:"Move Repetition Up",hdmnuMoveDn:"Move Repetition Down",hdmnuNewRep:"New Repetition",hdmnuEraseAllAns:"Erase All Answers",dateparse_today:"(t|today)",dateparse_days:"(d|day|days)",dateparse_months:"(m|month|months)",dateparse_years:"(y|year|years)",hde_assembling:"Assembling...",hde_complete:"Assembly Session Complete",hde_download:"You may download your {0} using the following {1}:",hde_warn:"Please download all of the documents you need before leaving.",hde_expired:"The download links have expired.",hde_error:"Error in contacting the server. {0}: {1}",hde_expire:"Links will expire in about {0}, or when you leave this page. Please download all of the documents you need before leaving.",hde_dl_doc:"document|documents",hde_dl_lnk:"link|links",hde_no_docs:"This interview produced no documents.",hd_time_day:"day|days",hd_time_hour:"hour|hours",hd_time_minute:"minute|minutes",hlp_to:"To",hlp_do:"Do This",hlp_intro:"These instructions describe how to complete a browser-based HotDocs Server or HotDocs Cloud Services interview. HotDocs Server is the version of HotDocs that uses a standard Web browser to display HotDocs interviews, or answer-gathering sessions. These answers are then used to assemble documents on a Web server. HotDocs Cloud Services provides the same service in the cloud. (For more information about HotDocs Server or Cloud Services, please visit <a href='http://www.hotdocs.com' target='_blank'>hotdocs.com</a>.)",hlp_intro2:"When a template is selected for assembly, HotDocs presents an interview in the Web browser to gather answers required by the template. To help you answer the questions, the interview window is divided into three panes: the interview outline, the dialog pane, and the resource pane. The interview outline provides an overview of the questions you must answer, while the dialog pane displays the specific questions. The resource pane can provide helpful information to assist you in answering specific questions or dialogs.",hlp_io_ovw:"The interview outline lists all the dialogs (or groupings of questions) in the interview and allows you to quickly move to any dialog in the interview you need. When you click the name of a dialog in the outline, the dialog appears in the dialog pane so you can answer questions in it.",hlp_io_tbl:"HotDocs uses the following icons in the interview outline to show the answered status of questions in each dialog, which can help you determine which dialogs contain questions you still need to answer:",hlp_io_du:"None of the questions in the dialog are answered.",hlp_io_dn:"A new repetition of a repeated dialog in which none of the questions are answered.",hlp_io_dp:"At least one of the questions in the dialog is answered.",hlp_io_da:"All required questions in the dialog are answered.",hlp_io_dr:"The dialog contains at least one unanswered required question.",hlp_io_dug:"The dialog cannot be answered until required questions in previous dialogs are answered.",hlp_io_loc:"By default, the interview outline appears to the left of the dialog pane, but you can change its width or position as needed. For example, if you need more space for answering questions in the dialog pane, you can shrink or hide the interview outline. The following table shows how to change the width and position of the interview outline:",hlp_io_widT:"Change the width of the interview outline",hlp_io_widD:"Drag the border separating the interview outline and dialog pane.",hlp_io_clsT:"Close the interview outline",hlp_io_clsD:"Click the <b>{0}Close</b> button in the upper right corner of the interview outline. To temporarily show it again, click the <b>{2}Interview Outline</b> bar on the left. To keep it open, click the <b>{1}Pin</b> button in the upper right-hand corner.",hlp_dp:"Dialog Pane",hlp_dp_ovw:"Questions you must answer are presented in dialogs. Some questions appear repeatedlyâeither as a series of dialogs or as a spreadsheet. This allows you to enter multiple answers for a single question, thereby creating a list of answers. Finally, some questions appear in a nested dialog. Nested dialogs usually represent questions that are either dependent on or related to questions in the main dialog. They usually appear as an icon directly on the main dialog, but they can also appear as a spreadsheet on the main dialog.",hlp_dp_tbl:"The following table shows how to navigate through dialogs and answer various types of questions:",hlp_dp_txtT:"Answer text fields",hlp_dp_txtD:"Enter your answer in the text field.",hlp_dp_chkT:"Answer check boxes or option buttons",hlp_dp_chkD:"Either select the check box using the mouse, or press the space bar.",hlp_dp_calT:"Answer dates",hlp_dp_calD:"Click the <b>{0}Calendar</b> button and choose a date from a calendar. You can also enter the letter <b>T</b> for today's date or enter a date in one of the following formats: <i>6/3/90</i>, <i>06/03/1990</i>, <i>June 3, 1990</i>, <i>3 June 1990</i>, and so forth.",hlp_dp_rptT:"Answer questions when the dialog is asked repeatedly",hlp_dp_rptD:"Answer all the questions in a dialog, and then click the <b>{0}Add Another</b> button to add another repetition of the dialog to the series. The repetition number next to the dialog icon increases each time you enter a new set of answers. To move to the next dialog after entering all the answers in the list, click <b>Next</b> in the navigation bar.",hlp_dp_sprT:"Answer questions in a repeated spreadsheet",hlp_dp_sprD:"Enter each set of answers on a its own row in the spreadsheet. To edit a row of answers, click <b>{0}</b>. To insert a new row between existing sets of answers, click <b>{1}</b>. To remove a set of answers, click <b>{2}</b>.",hlp_dp_nstT:"Answer questions in a nested dialog",hlp_dp_nstD:"Click the dialog icon. When you finish answering its questions, you can either click the <b>{0}Next</b> button in the navigation bar or click the main dialog in the interview outline.",hlp_dp_nxdT:"Go to the next or previous dialog",hlp_dp_nxdD:"Click either the <b>{0}Next</b> button or the <b>{1}Previous</b> button. (You can also press <b>Page Down/Page Up</b> or <b>Alt+N/Alt+P</b>.)",hlp_dp_nxuT:"Go to the next dialog or the previous dialog that contains an unanswered question",hlp_dp_nxuD:"Click either the <b>{0}Next Unanswered Dialog</b> button or the <b>{1}Previous Unanswered Dialog</b> button. (You can also press <b>Ctrl+Page Down/Ctrl+Page Up</b>.)",hlp_dp_frsT:"Go to the first or the last dialog in the interview",hlp_dp_frsD:"Click either the <b>{0}First</b> button or the <b>{1}Last</b> button. (You can also press <b>Alt+R/Alt+L</b>.)",hlp_dp_finT:"Finish the interview",hlp_dp_finD:"Click the <b>{0}Finish</b> button",hlp_rp:"Resource Pane",hlp_rp_intro:"Sometimes, the template provider includes resource text (or information) that can help you answer questions in a dialog. For example, reading a relevant statute may help you know how to answer a particular question. When resource text is available, it appears in the resource pane, which you can find to the right of the dialog pane.",hlp_rp_how:"To show or hide the resource pane, click the <b>{1}Resource</b> bar. When the resource pane is shown, you can see resource text for the current question in the dialog. (If a question does not have resource text available, the resource pane is empty.) To keep the resource pane open while you answer questions in the dialog pane, click on the <b>{0}Pin</b> button to keep the resource pane open below the dialog pane. You can hide it again by clicking on the <b>{2}Close</b> button. In addition, you can click the <b>{1}View Resource</b> button next to any question with resource text to view its resource text in a separate window.",hlp_rp_note:"Note: The resource pane may not be available in all situations. For example, template providers may choose to permanently hide the resource pane for a template.",err_invint:"Invalid Interview: The current dialog cannot be displayed!<br>&nbsp;<br>You may still click the Finish button below if you want to<br>submit the results of this interview.",err_vers:"This HotDocs interview (HDVers={0}) is incompatible with the current HotDocs Server interview runtime ({1}).",err_slv:"This HotDocs Server interview requires Microsoft Silverlight version 5.0 or later.",err_type:"Invalid Interview Type: {0}",err_load:"Error: {0} failed to load properly.",err_noint:"Invalid Interview: There is nothing to display!",err_print:"Printing failed due to your browser's security restrictions.",err_mustret:"You must return to the interview before performing this action.",err_rowclck:"Please click in a table cell to choose a current row.",err_nest:"Invalid Interview: REPEAT instructions are nested more than 4 levels deep.",err_cantadd:"You must answer at least one question in this dialog before you can add another dialog.",err_brows:"Browser Error",err_browsm:"You are attempting to use a HotDocs Server interview on an unsupported browser or platform; the interview may not appear correctly. Continue anyway?",err_browssl:"HotDocs Server Silverlight interviews are only supported in Internet Explorer (Windows), Chrome (Windows), Firefox (Windows or Mac), and Safari (Mac only).",err_browsjs:"HotDocs JavaScript interviews require Microsoft Internet Explorer 6.0 or later, and the page must use a Quirks mode document type.",err_dtype:"Please ensure that the page hosting this interview uses a strict DOCTYPE, such as &lt;!DOCTYPE html&gt;.",err_compat:"Your browser appears to be running in IE Compatibility View. Please turn off Compatibility View for this site and try again.",err_handler:"An error occured during the registered handler for the '{0}' event.",err_baseclass:"An error occurred while extending base classes.",err_siteadm:"Please notify your site administrator.",err_invprm:"Invalid Parameters",err_invprm_tb:"Failed to add custom toolbar button: invalid parameters to AddCustomToolbarButton.",err_invprm_nb:"Failed to add custom navigation bar button: invalid parameters to AddCustomNavButton.",err_invprm_img:"Failed to set toolbar button image: invalid parameters to SetToolbarButtonImage.",err_unk:"Unknown Error",err_noastest:"Answer sources based on answer files are not available during test in browser.",err_mixedtypes:"Attempted to read Multiple Choice options for the variable named '{0}', but its type was '{1}' instead of 'MC'. Verify that this variable's type is the same in all related templates.",errnoact:"Interview could not be initialized: FormAction not specified.",errpath:"Interview could not be initialized: no {0} path was specified.",errdiv:"Error: Unable to render HotDocs interview because the interview container (hdMainDiv) does not exist on this page. Please contact your network administrator.",errinit:"Error: Interview attempted to start before initialization was complete. Please report situation to HotDocs development.",errslimg:"Silverlight supports only PNG and JPG images.  Has an invalid or missing image file been used?",errpoprslt:"Error: Attempted to pop an empty result stack.",errsetrslt:"Error: Attempt to set the top of an empty result stack.",errgetrslt:"Error: Attempt to get the top of an empty result stack.",errpopuans:"Error: Attempted to pop an empty unanswered stack.",errsetuans:"Error: Attempt to set the top of an empty unanswered stack.",errgetuans:"Error: Attempt to get the top of an empty unanswered stack.",errpop:"{0}: Pop of empty stack!",errget:"{0}: Get on empty stack!",badmojo:"Bad Mojo {0}: {1}!",errpoprpt:"Error: Unable to pop an empty repeat stack.",erraccrpt:"Error: Unable to access the top of an empty repeat stack.",errinfunc:"Error in {0}: {1}",err_proc:"Failed to process the {0}() for the template '{1}'.",err_nocmp:"The component '{0}' does not exist.",err_idxgt0:"Index must be greater than or equal to 0.",err_emptyrptstk:"Cannot modify empty repeat stack",err_decidx:"Error: Unable to decrement a repeat index that is already at its lowest.",err_badrptstk:"Bad repeat stack: correct iteration of repeated dialog '{0}' not found.",err_badscrstk:"Bad script stack: dialog '{0}' not found.",err_limit:"Unable to set LIMIT; no dialog '{0}' found.",err_clear:"Unable to CLEAR options; multiple choice variable '{0}' not found.",err_grptf:"Cannot perform grouped true false operations on this type of node",err_grptf_un:"Cannot perform grouped true false operations on a dialog with ungrouped true false variables",err_invldloc:"Attempt to retrieve the Dialog Name from an invalid Interview Location object.",err_insrtlev:"There are too many INSERT levels in the template.",err_retrvbn:"Current Build Node cannot be retrieved unless an interview rebuild is in progress.",err_dateof:"Using the DATE OF function will create an invalid date. The first parameter must be in the range 1-31, the second 1-12, the third 1-9999, and the resulting date must be an actual calendar day.",err_setvar:"Tried to set an answer for something that was not a variable!",err_setdat:"Tried to set a date answer for something that was not a date variable!",err_settf:"Tried to set a true false answer for something that was not a true false variable or a dialog!",err_setmc:"Tried to set a multiple choice answer for something that was not a multiple choice variable!",err_retrvopt:"You can only retrieve options from multiple choice variables.",err_navstate:"Cannot update navigation state without a current dialog.",err_zeroiter:"Encountered a repeat node with zero iterations.",err_idxexceeds:"Index exceeds answered count.",err_nopath:"A navigation bar custom button image name must include a path.",err_serviceop:"Failed to define a data source for the following reason: ",err_datarequest:"Failed to download the data for a data source for the following reason: ",vnf:"Var not found!",badcomp:"Inappropriate comparison.",txtcomp:"Inappropriate text comparison.",datecomp:"Inappropriate date comparison.",tmccomp:"Error: Invalid text-to-MC comparison.",mccomp:"Invalid MC to MC comparison.",dateop:"Error: Inappropriate operation on a date variable.",badtest:"Error: Testing an invalid variable or one that does not exist.",badcount:"Error: Invalid item passed to HDCount.",baddateof:'Error: Invalid date used in "DATE OF" calculation.'},FormatNumLoc:function(b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p=a.Lc;if(j=p._localeHelper?p._localeHelper.FormatNum(b,c,d):b.toLocaleString(),c>0&&!e&&(j=a.HDZStrip(j,!0)),f&&(g=p.NativeDigits()),g&&10===g.length){for(k="",m="0".charCodeAt(0),l=0;l<j.length;l++)o=j.charAt(l),n=o.charCodeAt(0)-m,k+=n>=0&&9>=n?g[n]:o;if(j=k,h=p.NumSeps(),i=p.NativeSeps(),h&&2===h.length&&i&&2===i.length&&(h[0]!==i[0]||h[1]!==i[1])){for(k="",l=0;l<j.length;l++)switch(o=j.charAt(l)){case h[0]:k+=i[0];break;case h[1]:k+=i[1];break;default:k+=o}j=k}}return j},FormatNumLocDef:function(b,c){return a.Lc.FormatNumber(b,c,!0,!0,!0,!1)},SpellNum:function(a,b){return 0===a?b:this.FormatNumLocDef(a,0)},ParseNumLoc:function(b){return a.Lc._localeHelper.InterpretNum(b)},FormatDateLoc:function(b,c,d,e){return a.Lc._localeHelper?a.Lc._localeHelper.FormatDate(b,c,d,e):new Date(d,c-1,b).toLocaleDateString()},ParseDateLoc:function(b){var c=a.Lc._localeHelper.InterpretDate(b);return("System.DateTime"==typeof c||"date"==typeof c)&&(c=new Date(c)),c},IsOrdinalSuffix:function(){return!1},GetOrdinalSuffix:function(){return""},_alphaChar:/[a-z]/i,_IsUC:function(a){return a===a.toUpperCase()},_CharToUC:function(a,b){var c=a.charAt(b);return this._IsUC(c)?a.toString():a.slice(0,b)+c.toUpperCase()+a.slice(b+1)},FormatTextVal:function(a,b){var c,d,e,f,g=this._GetFmtObj(b,"Text");switch(g.casing){case 0:f=a.toString();break;case 1:f=a.toUpperCase();break;case 2:f=a.toLowerCase();break;case 3:f=a.toLowerCase(),c=a.search(this._alphaChar),c>=0&&(f=this._CharToUC(a,c));break;case 4:for(f=a.toLowerCase(),e=!0,c=0;c<f.length;c++)d=f.charAt(c)," "!==d&&"\n"!==d?e&&this._alphaChar.test(d)&&(f=this._CharToUC(f,c),e=!1):e=!0;break;case 5:f=a.toString(),c=f.search(this._alphaChar),c>=0&&(f=this._CharToUC(f,c))}return b.length>0&&"*"==b[b.length-1]&&(f=f.replace(/ /g,"&nbsp;")),f},FormatNumVal:function(c,d,e){var f,g,h,i,j,k,l=a.Lc,m=String(c);if(d){switch(d.toUpperCase()){case"NINE":m=l.SpellNum(c,l.GetArrayMember("zeroFormats",0),!1);break;case"IX":m=l.RomanNum(c);break;case"NINTH":m=l.SpellNum(c,l.GetArrayMember("zeroFormats",0),!0);break;case"NINE DOLLARS AND TWELVE CENTS":m=b["en-US"]._SpellDollars(c);break;case"ABC":m=l.NumToAlpha(c);break;default:k=l.NumSeps(),f=new RegExp("^[0-9\\"+k[0]+"\\"+k[1]+"]*$"),f.test(d)&&(g=d.split(k[0]),h=g.length>1?g[1].length:0,i=h&&"0"===g[1][0],j=g[0].length<=3||g[0].indexOf(k[1])>=0,m=l.FormatNumber(c,h,j,i,!0,!1))}"NIN"===d.substr(0,3)||"ABC"===d?m=m.toUpperCase():("nin"===d.substr(0,3)||"ix"===d)&&(m=m.toLowerCase())}else m=l.FormatNumberDef(c,e);return m},FormatDateVal:function(b,c){var d,e,f,g=a.Lc,h=b.getMonth(),i=b.getDate(),j=b.getFullYear();switch(c){case"June 3, 1990":d=g.GetMonthName(h,!1)+" "+i+", "+j;break;case"3rd day of June, 1990":d=g.FormatNumber(i,0,!1,!1,!0,!0)+" day of "+g.GetMonthName(h,!1)+", "+g.FormatNumber(j,0,!1,!1,!0,!1);break;case"third day of June, 1990":d=g.SpellNum(i,"zero",!0).toLowerCase()+" day of "+g.GetMonthName(h,!1)+", "+g.FormatNumber(j,0,!1,!1,!0,!1);break;case"Third day of June, 1990":d=g.SpellNum(i,"zero",!0)+" day of "+g.GetMonthName(h,!1)+", "+g.FormatNumber(j,0,!1,!1,!0,!1);break;case"3 June 1990":case"d MMM yyyy":d=i+" "+g.GetMonthName(h,"d MMM yyyy"==c)+" "+j;break;case"03 JUN 90":case"03 JUN 1990":d=10>i?"0":"",d+=i+" "+g.GetMonthName(h,!0).toUpperCase()+" ","03 JUN 90"===c?(10>j%100&&(d+="0"),d+=j%100):d+=j;break;case"6/3/90":case"6/3/1990":case"06/03/90":case"06/03/1990":d="",e="0"===c.substr(0,1),f="1990"===c.substr(c.length-4,4),g.DayIsFirst()?(e&&10>i&&(d+="0"),d+=i+"/",e&&10>h+1&&(d+="0"),d+=h+1+"/"):(e&&10>h+1&&(d+="0"),d+=h+1+"/",e&&10>i&&(d+="0"),d+=i+"/"),f?d+=j:(10>j%100&&(d+="0"),d+=j%100);break;case"1990":d=j.toString();break;default:d=g.FormatDate(i,h+1,j,0)}return d},FormatTFVal:function(b,c){var d=c.split("/");return d&&2===d.length?b?d[0]:d[1]:b?a.Lc.GetStr("ui_true"):a.Lc.GetStr("ui_false")},FormatList:function(a,b){var c,d=this._GetFmtObj(b,"List"),e=[];for(e.push(d.prefix),c=0;c<a.length;c++){switch(d.casing){case 0:e.push(a[c]);break;case 1:e.push(a[c].toUpperCase());break;case 2:0===c?e.push(a[c].charAt(0).toUpperCase()+a[c].substr(1)):e.push(a[c]);break;case 3:e.push(a[c].charAt(0).toUpperCase()+a[c].substr(1))}c<a.length-2?e.push(d.conj):c===a.length-2&&e.push(d.conjLast)}return e.push(d.suffix),e.join("")},_GetFmtObj:function(a,b){var c,d=this._GetFmtObj["_cache"+b];return d?c=d[a]:this._GetFmtObj["_cache"+b]=d={},c||(d[a]=c=this["_Parse"+b+"Format"].call(this,a)),c},_ParseTextFormat:function(a){if("string"!=typeof a||0===a.length||"T*"==a)return{casing:0};if(this._IsUC(a))return{casing:1};if(a===a.toLowerCase())return{casing:2};var b,c,d;if(b=a.search(this._alphaChar),-1===b||!this._IsUC(a.charAt(b)))return{casing:0};if(c=a.slice(b+1),c===c.toLowerCase())return{casing:3};for(d=a.split(/\s+/g),b=1;b<d.length;b++){if(!this._IsUC(d[b].charAt(0)))return{casing:5};if(c=d[b].slice(1),c!==c.toLowerCase())return{casing:5}}return{casing:4}},_ParseNumFormat:function(){},_ParseDateFormat:function(){},_ParseListFormat:function(a){if("string"!=typeof a||0===a.length)return{casing:0,prefix:"",suffix:"",conj:"\n",conjLast:"\n"};var b,c=a.toUpperCase(),d=c.indexOf("A"),e=d>=0?this._IsUC(a.charAt(d)):!1,f=c.indexOf("B",d),g=f>d?this._IsUC(a.charAt(f)):!1,h=c.indexOf("C",f),i=h>f?this._IsUC(a.charAt(h)):!1,j=h>0?h:f>0?f:d>=0?d:-1,k=d>0?a.substr(0,d):"",l=a.substr(j+1),m=f>d?a.substring(d+1,f):"",n=h>f?a.substring(f+1,h):m;return b=e?g?1:i?3:2:0,{casing:b,prefix:k,suffix:l,conj:m,conjLast:n}}}}),define("hdmain/jq",["hd"],function(a){return a.jq.uiBackCompat=!1,a.jq}),define("hdmain/blm_runtime",["hd","language/hdlang_en","hdmain/jq"],function(a,b,c){var d=void 0,e="string",f="number",g="boolean",h="object";a.Locale={_reqLocale:"",_localeHelper:null,_ilm:a.Locales[""],_clm:a.Locales[""],_daysInMonth:[31,0,31,30,31,30,31,31,30,31,30,31],Init:function(){var b,f,g,i,j=c("#hdMainDiv").HDInterview("option","type")==a.InterviewType.Silverlight;if(this._localeHelper=j?a.HDEngine.LocaleHelper:{GetLocale:function(){var a,b=this._currentLocale;return b||(b=navigator.language,b=b?b:navigator.userLanguage,b=b?b:"en-US",a=b.split("-"),a[0]=a[0].toLowerCase(),a.length>1&&(a[1]=a[1].toUpperCase()),b=a.join("-"),this._currentLocale=b),b},SetLocale:function(a){return this._currentLocale=a,!0},FormatNum:function(b,c,d){var e,f,g,h,i,j,k=Math.pow(10,-1===c?7:c),l=a.Lc.NumSeps();if(b=Math.round(b*k)/k,e=b.toString(),f="-"===e.substr(0,1),f&&(e=e.substr(1)),g=e.indexOf("."),h=g>0?e.substr(0,g):e,i=g>0?e.substr(g+1):"",d)for(j=h.length-3;j>0;)h=h.substr(0,j)+l[1]+h.substr(j),j-=3;return f&&(h="-"+h),e=h,0!==c&&((i.length>0||i.length<c)&&(e+=l[0]+i),i.length<c&&(e+=Array(c-i.length+1).join("0"))),e},InterpretNum:function(b){for(var c=a.Lc.NumSeps();b.indexOf(c[1])>-1;)b=b.replace(c[1],"");return b=b.replace(c[0],"."),/^[\d\.-]+$/.test(b)?parseFloat(b):0/0},InterpretDate:function(b){var c,d,f,g,h,i,j,k,l,m,n;if(/^\d+$/.test(b)&&(g=parseInt(b,10)),!isNaN(g)&&31>=g&&g>0)c=new Date,c.setDate(g);else{for(m=b.split(/[\s\-\\\/\.\,]+/),n=a.Lc.GetShortDateFormat().split(/\W+/),c=new Date,j=0;j<n.length;j++)switch(k=j<m.length?m[j]:"",l=parseInt(k,10),n[j].toUpperCase().substr(0,1)){case"Y":if(""===k)i=c.getFullYear();else if(k.length<=2)i=l,i>29&&(i-=100),i+=100*Math.round(c.getFullYear()/100);else{if(4!=k.length)return null;i=k}break;case"M":if(isNaN(l)&&typeof k===e)for(k=k.toLowerCase(),f=0;12>f;f++)if(a.Lc.GetArrayMember("months",f).toLowerCase()==k||a.Lc.GetArrayMember("monthsShort",f).toLowerCase()==k){l=f+1,k=l;break}if(1>l||l>12)return null;h=""===k?c.getMonth():k;break;case"D":g=""===k?c.getDate():k}c=new Date(i,h-1,g),isNaN(c)||(d=new Date(c),(d.getMonth()!=h-1||d.getDate()!=g||d.getFullYear()!=i)&&(c=void 0))}return isNaN(c)?null:new Date(c)},FormatDate:function(b,c,d,e){function f(a){return a.length>1?a:"0"+a}var g,h,i,j;return e?(b=new Date(d,c-1,b),b.toLocaleDateString()):(g=a.Lc.GetShortDateFormat(),h=c.toString(),i=b.toString(),j=d.toString(),g=g.replace("yyyy",j),g=g.replace("yy",j.substr(2)),g=g.replace("MM",f(h)),g=g.replace("M",h),g=g.replace("dd",f(i)),g=g.replace("d",i))},DayFirst:function(){},FirstDOW:function(){},DecimalSeparator:function(){},DigitSeparator:function(){}},""===this._reqLocale)this._reqLocale=this._localeHelper.GetLocale();else for(b=this._reqLocale;!this._localeHelper.SetLocale(b)&&b;)b=this._NameOfParent(b);this._clm=this._GetModule(this._reqLocale),(j||window.VBSetLocale!==d)&&(this._BuildLocAry("months"),this._BuildLocAry("monthsShort"),this._BuildLocAry("days"),this._BuildLocAry("daysShort"),i=this._GetProp("calWeekend",!0),typeof i!==h&&(f=this.FirstDayOfWeek(),f>1&&""!==this._clm.id&&(this._clm.calWeekend=[f-2,f-1])),g=this._GetProp("numSeps",!0),typeof g!==h&&""!==this._clm.id&&(this._clm.numSeps=[this._localeHelper.DecimalSeparator(),this._localeHelper.DigitSeparator()]))},_ParentOf:function(b){return typeof b.__parent===h?b.__parent:(b.__parent=a.Locales[this._NameOfParent(b.id)],b.__parent)},_NameOfParent:function(a){if(""!==a&&a!==d){var b=a.lastIndexOf("-");return b>0?a.substr(0,b):""}},_BuildLocAry:function(a){if(this._clm[a]===d){var b,c,e,f,g=a.length>6;for("months"===a.substr(0,6)?(f="GetMonthName",c=12):(f="GetWeekdayName",c=7),e=this._clm[a]=[],b=0;c>b;b++)e[b]=this._localeHelper[f](b,g)}},NativeDigits:function(){return this._GetProp("nativeDigits")},NumSeps:function(){return this._GetProp("numSeps")},NativeSeps:function(){return this._GetProp("nativeSeps")},_GetProp:function(a,b){if(!b||""!==this._reqLocale){for(var c=this._clm,e=c[a];c.id&&e===d;)c=this._ParentOf(c),(c.id||!b)&&(e=c[a]);return e}},_Invoke:function(a,b){for(var c=this._clm,e=c[a];c.id&&e===d;)c=this._ParentOf(c),e=c[a];return e?e.apply(c,b):void 0},SetLocale:function(a){if(this._reqLocale=a,this._localeHelper)for(;!this._localeHelper.SetLocale(a)&&a;)a=this._NameOfParent(a);
this._clm=this._GetModule(this._reqLocale)},_GetModule:function(b){var c=""===b?null:this._GetModule(this._NameOfParent(b)),d=a.Locales,e=d[b];return!e||e.strings&&e.strings.ui_logo&&e.strings.ui_logo.indexOf("HotDocs")<0?(e={id:b,name:b+" (Automatic)"},d[b]=e):(e.id=b,e.name||(e.name=b)),e.__parent=c,e},_re:[],GetStr:function(b){if(!arguments.length)return"";for(var c,f,g,h,i=this===window||this===d?a.Locale:this,j=i._clm;j&&(c=j.strings,c&&(f=c[b]),typeof f!==e);)j=i._ParentOf(j);if(typeof f!==e)return"";for(g=1;g<arguments.length;g++)g<=i._re.length?h=i._re[g-1]:(h=new RegExp("\\{"+(g-1)+"\\}"),i._re[g-1]=h),f=f.replace(h,arguments[g]);return f},GetArrayMember:function(a,b,c){var d=this._GetProp(a,c);return d?d[b]:void 0},GetShortDateFormat:function(){return this._GetProp("shortDateFormat")},GetMonthName:function(a,b){return this.GetArrayMember(b?"monthsShort":"months",a)},GetWeekdayName:function(a,b){return this.GetArrayMember(b?"daysShort":"days",a)},IsLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0},DaysInMonth:function(a,b){return 1!==a?this._daysInMonth[a]:this.IsLeapYear(b)?29:28},SpellNum:function(a,b,c){return this._Invoke("SpellNum",[a,b,c])},IsOrdinalSuffix:function(a,b){return this._Invoke("IsOrdinalSuffix",[a,b])},FormatNumber:function(a,b,c,d,e,f){var g=this._Invoke("FormatNumLoc",[a,b,c,d,e]);return 0===b&&f?g+this._Invoke("GetOrdinalSuffix",[parseInt(a,10)]):g},FormatNumberDef:function(a,b){return this._Invoke("FormatNumLocDef",[a,b])},RomanNum:function(a){function b(a,b){var c,d="";for(c=0;b>c;c++)d+=a;return d}var c,d="",e=Math.abs(a);return a>=1e3&&(c=Math.floor(a/1e3),d=b("M",c),e-=1e3*c),e>=100&&(c=Math.floor(e/100),c>0&&4>c&&(d+=b("C",c)),4==c&&(d+="CD"),9==c&&(d+="CM"),c>=5&&8>=c&&(d+="D"+b("C",c-5)),e-=100*c),e>=10&&(c=Math.floor(e/10),c>0&&4>c&&(d+=b("X",c)),4==c&&(d+="XL"),9==c&&(d+="XC"),c>=5&&8>=c&&(d+="L"+b("X",c-5)),e-=10*c),e>=1&&(c=Math.floor(e),c>0&&4>c&&(d+=b("I",c)),4==c&&(d+="IV"),9==c&&(d+="IX"),c>=5&&8>=c&&(d+="V"+b("I",c-5))),d},NumToAlpha:function(a){var b,c=Math.abs(a);return 0===c?"_":(b=c%26,0===b&&(b=26),b+=96,Array(Math.ceil(c/26)+1).join(String.fromCharCode(b)))},FormatDate:function(a,b,c,d){return this._Invoke("FormatDateLoc",[a,b,c,d])},DayIsFirst:function(){var a,b=this._GetProp("dateOrder",!0);return typeof b===e?"MDY"!==b:(a=this._localeHelper.DayFirst(),typeof a===g?a:"MDY"!==this._ilm.dateOrder)},FirstDayOfWeek:function(){var a=this._GetProp("calWeekBegin",!0);return typeof a!==f&&(a=this._localeHelper.FirstDOW(),typeof a!==f&&(a=this._ilm.calWeekBegin)),a},_TrimStr:function(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")},_IsDate:function(a){return typeof a===h&&null!==a&&a.getDate!==d},_IsTodayTkn:function(a){return this._IsTodayTkn._re||(this._IsTodayTkn._re=new RegExp("^"+this.GetStr("dateparse_today")+"$","i")),this._IsTodayTkn._re.test(a)},_ParseDateExpr:function(b){this._ParseDateExpr._re||(this._ParseDateExpr._re=new RegExp("^"+this.GetStr("dateparse_today")+"\\s*([+-])\\s*(\\d+)\\s*(?:"+this.GetStr("dateparse_days")+"|"+this.GetStr("dateparse_months")+"|"+this.GetStr("dateparse_years")+")$","i"));var c,d,e,f=this._ParseDateExpr._re.exec(b);return null===f?f:(c=f[2],d=parseInt(f[3],10),e=f[4]?"Days":f[5]?"Months":"Years",a.AddToDate(new Date,c,d,e))},ParseDate:function(a){if(this._IsDate(a))return a.constructor.prototype!==Date.prototype&&(a=new Date(a.valueOf())),a;if("date"==typeof a||"System.DateTime"==typeof a)return new Date(a);if(null===a)return null;if(typeof a!==e&&(a=a.toString()),""!==a&&(a=this._TrimStr(a)),""===a)return null;var b,c=a;if(this._IsTodayTkn(a))return new Date;if(a=this._Invoke("ParseDateLoc",[a]),this._IsDate(a))return a;if(null!==c.match(/^\d{1,4}$/)){if(b=parseInt(c,10),a=new Date,b>1e3&&9999>=b)return a.setFullYear(b),a;if(b>=1&&b<=this.DaysInMonth(a.getMonth(),a.getFullYear()))return a.setDate(b),a}return a=this._ParseDateExpr(c),null===a?"err":a},ParseNumber:function(a){return typeof a===f||null===a?a:(typeof a!==e&&(a=a.toString()),""!==a&&(a=this._TrimStr(a)),""===a?null:this._Invoke("ParseNumLoc",[a]))},_PrepFmt:function(a){return typeof a!==e&&(a=null===a?"":a.toString()),a},FormatTextVal:function(a,b){return this._Invoke("FormatTextVal",[a,this._PrepFmt(b)])},FormatNumVal:function(a,b,c){return this._Invoke("FormatNumVal",[a,this._PrepFmt(b),c])},FormatDateVal:function(a,b){return this._Invoke("FormatDateVal",[a,this._PrepFmt(b)])},FormatTFVal:function(a,b){return this._Invoke("FormatTFVal",[a,this._PrepFmt(b)])},FormatList:function(a,b){return this._Invoke("FormatList",[a,this._PrepFmt(b)])},IsListFormat:function(a){return typeof a!==e?!1:(a=a.toUpperCase(),a.indexOf("A")>=0&&-1===a.indexOf("LIKE"))}},a.Lc=a.Locale,a.AddToDate=function(a,b,c,d){var e,f=a.getMonth(),g=a.getFullYear();if("-"===b&&(c=-c),"Days"===d)return a.setTime(a.getTime()+864e5*c),a;if("Months"===d){for(f+=c;0>f;)f+=12;for(;f>12;)f-=12;a.setMonth(a.getMonth()+c)}else{if("Years"!==d)return null;g+=c,a.setFullYear(a.getFullYear()+c)}for(e=a.getTime();a.getMonth()>f;)e-=864e5,a.setTime(e);return a},a.HDZStrip=function(a,b){if(typeof a===e){for(var c=a.length-1;c>=0&&"0"===a.charAt(c);)c--;return b&&c>=0&&isNaN(parseInt(a.charAt(c),10))&&c--,a.substr(0,c+1)}}}),define("hdmain/icon_definitions",[],function(a){return[{c:"hd-blank",d:a,x:-220,y:0,w:0},{c:"hdtb-logo",d:a,x:0,y:0},{c:"hdtb-btnas",d:a,x:-20,y:0},{c:"hdtb-btnod",x:-80,d:a,y:0,w:11},{c:"hdtb-btnol",d:a,x:-100,y:0},{c:"hdtb-btnolc",d:a,x:-120,y:0},{c:"hdtb-btnpg",d:a,x:-140,y:0},{c:"hdtb-btnpgc",d:a,x:-160,y:0},{c:"hdtb-btnsv",d:a,x:-180,y:0},{c:"hdtb-btndp",d:a,x:-200,y:0},{c:"hdtb-btnrs",d:a,x:-200,y:-20},{c:"hd-nav-Prev",d:a,x:0,y:-20},{c:"hd-nav-Next",d:a,x:-20,y:-20},{c:"hd-nav-PrevU",d:a,x:-40,y:-20},{c:"hd-nav-NextU",d:a,x:-60,y:-20},{c:"hd-nav-First",d:a,x:-80,y:-20},{c:"hd-nav-Last",d:a,x:-100,y:-20},{c:"hd-nav-Finish",d:a,x:-120,y:-20},{c:"hd-nav-FinishEM",d:a,x:-140,y:-20},{c:"hd-nav-Sep",d:a,x:-160,y:-20,w:10},{c:"hd-nav-Print",d:a,x:-180,y:-20},{c:"hd-cal-pm",d:a,x:0,y:-40},{c:"hd-cal-nm",d:a,x:-20,y:-40},{c:"hd-cal-py",d:a,x:-40,y:-40},{c:"hd-cal-ny",d:a,x:-60,y:-40},{c:"hd-cal-calendar",d:a,x:-80,y:-40},{c:"hd-dlg-u",d:a,x:0,y:-60},{c:"hd-dlg-a",d:a,x:-20,y:-60},{c:"hd-dlg-p",d:a,x:-40,y:-60},{c:"hd-dlg-n",d:a,x:-60,y:-60},{c:"hd-dlg-r",d:a,x:-80,y:-60},{c:"hd-rpt-a",d:a,x:-100,y:-60},{c:"hd-rpt-p",d:a,x:-120,y:-60},{c:"hd-rpt-r",d:a,x:-140,y:-60},{c:"hd-rpt-u",d:a,x:-160,y:-60},{c:"hd-pls-t",d:a,x:0,y:-80},{c:"hd-pls-t:hover",d:a,x:0,y:-120},{c:"hd-pls-m",d:a,x:-20,y:-80},{c:"hd-pls-m:hover",d:a,x:-20,y:-120},{c:"hd-pls-b",d:a,x:-40,y:-80},{c:"hd-pls-b:hover",d:a,x:-40,y:-120},{c:"hd-mns-t",d:a,x:-60,y:-80},{c:"hd-mns-t:hover",d:a,x:-60,y:-120},{c:"hd-mns-m",d:a,x:-80,y:-80},{c:"hd-mns-m:hover",d:a,x:-80,y:-120},{c:"hd-mns-b",d:a,x:-100,y:-80},{c:"hd-mns-b:hover",d:a,x:-100,y:-120},{c:"hd-lin-t",d:a,x:-140,y:-80},{c:"hd-lin-m",d:a,x:-160,y:-80},{c:"hd-lin-b",d:a,x:-180,y:-80},{c:"hd-error-16",d:a,x:-180,y:-60,h:16,w:16},{c:"hd-error-32",d:a,x:-200,y:-60,h:32,w:32},{c:"hd-rsrc",d:a,x:-100,y:-40},{c:"hd-sser",d:a,x:-120,y:-40},{c:"hd-ssir",d:a,x:-140,y:-40},{c:"hd-ssdr",d:a,x:-160,y:-40},{c:"hd-mov-u",d:a,x:-120,y:-100},{c:"hd-mov-d",d:a,x:-140,y:-100},{c:"hd-closex",d:a,x:-180,y:-40},{c:"hd-adit",d:a,x:-200,y:-40},{c:"hd-selbtn",d:a,x:-220,y:-40},{c:"hd-pop-close",d:a,x:0,y:-100},{c:"hd-pop-stretch",d:a,x:-20,y:-100},{c:"hd-hgrip",d:a,x:-40,y:-100},{c:"hd-vgrip",d:a,x:-60,y:-100},{c:"hd-dlg-btn",d:a,x:-80,y:-100},{c:"hd-dlg-clr",d:a,x:-100,y:-100},{c:"hd-clr-ans",d:a,x:-160,y:-100},{c:"hd-img-missing",d:a,x:-180,y:-100},{c:"hd-grid-arrow",d:a,x:-200,y:-100},{c:"hd-cmbo-arrow",d:a,x:-220,y:-100},{c:"hd-dwnld-icon",d:a,x:-120,y:-120},{c:"hd-nav-More",d:a,x:0,y:-140},{c:"hd-alert",d:a,x:-20,y:-140},{c:"hd-dock",d:a,x:-40,y:-140}]}),define("system/jquery.hd.cast",["hdmain/jq"],function(a){function b(b,c){var d,e,f;if(b){if("function"==typeof c&&b instanceof c)return b;if("function"==typeof b.data&&(f="function"==typeof c?c.prototype.widgetName:c,"string"==typeof f))for(e in b.data())if(d=b.data(e),d instanceof a.hd[f])return d}return null}return b}),define("hdmain/system",["hdmain/jq","system/jquery.hd.cast"],function(a,b){var c=[],d={CallAsync:function(a){"function"==typeof a&&window.setTimeout(function(){a()},0)},Cast:b,Collections:{Generic:{List:function(){var a,b=Array.apply(b,arguments)||b,c=d.Collections.Generic.List;for(a in c.prototype)c.prototype.hasOwnProperty(a)&&(b[a]=c.prototype[a]);return b}}},Enum:{GetName:function(a,b){for(var c in a)if(a[c]==b)return c;return null}},ExtendClass:function(a,b,c,d){var e,f;if("function"==typeof b&&(e=function(){},e.prototype=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.baseConstructor=b,a.baseclass=b.prototype),null!==c&&"object"==typeof c){for(f in c)a.prototype[f]=c[f];c.hasOwnProperty("toString")&&(a.prototype.toString=c.toString)}if("object"==typeof d)for(f in d)a[f]=d[f]},Environment:{TickCount:function(){return(new Date).getTime()}},Guid:{NewGuid:function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}},List:{FirstOrDefault:function(){var a,b,c,d=null;if(1==arguments.length?(a=this,b=arguments[0]):2==arguments.length&&(a=arguments[0],b=arguments[1]),"function"==typeof b){for(c=0;c<a.length;c++)if(b(a[c])){d=a[c];break}return d}}},String:{Format:function(a){var b,d=a;if(d){for(b=1;b<arguments.length;b++)b>c.length&&(c[b-1]=new RegExp("\\{"+(b-1)+"\\}","g")),d=d.replace(c[b-1],"string"==typeof arguments[b]?arguments[b]:null!==arguments[b]?arguments[b].toString():"");return d}return null},IsNullOrEmpty:function(a){return!("string"==typeof a&&a.length>0)}},Text:{Encoding:{None:0,ISO88591:0,ISO8859:0,ANSI:0,UTF8:1,UTF16LE:2,UTF16BE:3},StringBuilder:function(){if(this.s=[],this.Length=2==arguments.length?arguments[1]:0,this.Append=function(a){var b=this.s;b[b.length]=a,this.Length=b.length},this.AppendLine=function(){this.Append("\r\n")},this.ToString=function(){return this.s.join("")},this.Clear=function(){this.s=[],this.Length=0},arguments.length>0&&"string"==typeof arguments[0])for(var a=0;a<arguments[0].length;a++)this.Append(arguments[0].charAt(a))}},Uri:{AbsolutePath:function(a){if(d.String.IsNullOrEmpty(a)||"http"===a.substr(0,4).toLowerCase()||"file:"===a.substr(0,5).toLowerCase()||"."===a.substr(0,1))return a;var b=document.location,c=b.href;return b.search&&(c=c.substr(0,c.indexOf(b.search))),c=0!==a.indexOf("/")?c.substr(0,c.lastIndexOf("/")+1):c.substr(0,c.search(/([^\/]|^)\/([^\/]|$)/)+1),c+a}},Windows:{Browser:{HttpUtility:{HtmlDecode:function(a){return a.replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}}},Controls:{SelectionMode:{Single:0,Multiple:1,Extended:2},DataGridEditingUnit:{Cell:0,Row:1},ToolTipService:{SetToolTip:function(a,b){a.attr("alt",b),a.attr("title",b)},GetToolTip:function(a){return a.attr("title")}}},Data:{BindingMode:{OneWay:1,OneTime:2,TwoWay:3}},Input:{FocusManager:{GetFocusedElement:function(){return a(document.activeElement)}}},TextWrapping:{NoWrap:1,Wrap:2},Visibility:{Collapsed:0,Visible:1}}};return d}),define("hdmain/hdloadererror",["hdmain/jq"],function(a){return a.widget("hd.HDLoaderError",{_create:function(){a("<div/>").appendTo(this.element).addClass("hd-img hd-error-32"),this.Msg=a("<div/>").appendTo(this.element).addClass("hd-error-msg"),this.option(this.options)},_setOption:function(b,c){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"message":this.Msg.html(c)}}}),a.hd.HDLoaderError}),define("hdmain/hdloaderprogressbar",["hdmain/jq"],function(a){return a.widget("hd.HDLoaderProgressBar",{options:{percent:0},_create:function(){var b="hd-loader-progbar";this.mtr=a("<div/>").addClass(b+"-mtr").appendTo(this.element),this.pct=a("<div/>").addClass(b+"-pct").appendTo(this.mtr),this.bar=a("<div>&nbsp;</div>").addClass(b+"-bar").appendTo(this.mtr),this.msg=a("<span/>").addClass(b+"-msg").appendTo(this.element),this.option(this.options)},_setOption:function(b,c){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"message":this.msg.html(c);break;case"percent":c="number"!=typeof c||0>c?0:c>100?100:Math.round(c),c+="%",this.pct.html(c),this.bar.css("width",c)}}}),a.hd.HDLoaderProgressBar}),define("hdmain/serverresponse",["hd","hdmain/jq"],function(a,b){var c=b.proxy,d="hdSvrRspFrm",e="hdModalResponse";return b.widget("hd.ServerResponse",{_create:function(){this.element.hide();var a,e,f="hd-response",g=this.hdr=b("<div/>").addClass("hd-dlg-title "+f+"-header").appendTo(this.element),h=b("<div/>").addClass(f+"-btns").appendTo(g);this.Title=b("<div/>").addClass(f+"-title").appendTo(g),this.Print=b("<button/>").addClass(f+"-print").appendTo(h).append('<div class="hd-img hd-nav-Print"></div><span class="hd-btn-text"/></button>').click(c(this.print,this)).attr({tabIndex:0}),e=b("<button/>").addClass(f+"-return").appendTo(h).append('<div class="hd-img hd-nav-Prev"></div><span class="hd-btn-text"/>').click(c(function(){return this._setOption("visible",!1),!1},this)).attr({tabIndex:0}),this.frame=b("<iframe/>").attr({id:d,name:d,frameborder:"0"}).appendTo(this.element),a=this.ftr=b("<div/>").addClass("HD3DObject "+f+"-footer").appendTo(this.element),e.clone(!0).appendTo(a),this.option(this.options)},_setOption:function(a,c){b.Widget.prototype._setOption.apply(this,arguments);var d,f,g,h="visibility",i="visible",j="hidden";switch(a){case"title":this.Title.html(c);break;case"visible":c?(d=this.frame,f=this.options.blankFrame,d.attr("src")!==f&&d.attr("src",f),d.show().css(h,i),this.element.show().css(h,i),this.Title.css("line-height",this.hdr.height()+"px"),this.sizeServerResponse(),g=this.element.find("#hdModalResponse"),0===g.length?d[0].contentWindow.focus():g.attr("tabIndex",0).focus()):(this.frame.hide().css(h,j).attr("src",this.options.blankFrame),this.element.hide().css(h,j),b("#"+e).remove());break;case"showPrint":this.Print.css(h,c?"inherit":j);break;case"PrintMsg":this.Print.attr("title",c).children("span").text(c);break;case"ReturnMsg":this.element.find("button.hd-response-return").attr("title",c).children("span").text(c);break;case"blankFrame":this.frame.attr("src",c)}},sizeServerResponse:function(){if(a.HDEngine){var c=this.element,d=b("#"+e),f=b("#hdWrapper"),g=Math.round(a.g_isSilverlight?a.HDEngine.ToolbarHeight:a.HDEngine.ToolbarHeight()),h=f.width(),i=f.height()-g-this.hdr.outerHeight(!0)-this.ftr.outerHeight(!0);c.width(h),d.outerWidth(h),this.frame.width(h),c.css("top",g),d.css("top",this.hdr.outerHeight(!0)),d.height(i-(d.outerHeight(!0)-d.height())),this.frame.height(i-(this.frame.outerHeight(!0)-this.frame.height()))}},print:function(){var d,f=this.options.css,g=window.open("about:blank","","width=600,height=500,directories=0,location=0,status=0,toolbar=0");return g?window.setTimeout(c(function(){g.document.title=this.Title.text(),document.createStyleSheet?g.document.createStyleSheet(f):(d=g.document.createElement("link"),d.rel="stylesheet",d.type="text/css",d.href=f,g.document.getElementsByTagName("head")[0].appendChild(d)),g.document.body.innerHTML='<div class="hd-interview-base">'+b("#"+e).html()+"</div>",g.print(),this._setOption("visible",!1)},this),200):alert(a.Lc.GetStr("err_print")),!1}}),b.hd.ServerResponse}),define("api/popupwindow",["hdmain/jq"],function(a){var b=a.ui.dialog;return a.widget("hd.PopupWindow",b,{options:{autoOpen:!1,resizable:!0,draggable:!0,dialogClass:"hd-interview-base hd-popup",icon:"hd-rsrc",width:400,autoResize:!0},_setOption:function(a,c){switch(b.prototype._setOption.apply(this,arguments),a){case"title":this.titleIcon.attr({alt:c,title:c});break;case"icon":this.titleIcon.removeClass().addClass("hd-img "+c)}},_create:function(){b.prototype._create.apply(this,arguments);var c=this.uiDialogTitlebar;this.titleIcon=a("<div/>").attr("name","HDRsrcBtn").css({position:"absolute",left:"5px",visibility:"visible",margin:"0px"}).prependTo(c),c.children(".ui-dialog-title").css({display:"block",overflow:"hidden"}).appendTo(c),this.option(this.options)}}),a.hd.PopupWindow}),define("dialog/hdnavbarcell",{Left:0,Middle:1,Right:2}),define("dialog/hdnavbtntype",{TextOnly:0,ImageOnly:1,ImageLeft:2,ImageRight:3}),define("dialog/hdnavseppos",{None:0,Left:1,Right:2,Both:3}),define("hdmain/stack",["hd","hdmain/system"],function(a,b,c){function d(){this.a=[]}return this.DEBUG===c&&(this.DEBUG=a.DEBUG),b.ExtendClass(d,null,{Push:function(a){this.a.push(a)},Pop:function(){return this.a.pop()},Peek:function(){return this.a[this.a.length-1]},Count:function(){return this.a.length},Clear:function(){this.a=[]},ElementAt:function(a){return this.a[a]}}),a.Stack=d,d}),define("dialog/interviewopenedeventargs",[],function(){function a(a,b,c){this.Source=a,this.Interview=b,this.ParentInterview=c}return a}),define("dialog/interviewclosedeventargs",[],function(){function a(a,b){this.Interview=a,this.ClosedInterview=b}return a}),define("dialog/interviewstack",["hd","hdmain/stack","hdmain/jq","dialog/interviewopenedeventargs","dialog/interviewclosedeventargs"],function(a,b,c,d,e,f){this.DEBUG===f&&(this.DEBUG=a.DEBUG);var g={s_interviewStack:new b,PushInterview:function(a){var b=this.Depth()>1?this.CurrentInterview().ComputationVariableName():null;this.s_interviewStack.Push(a),this.InPopupInterview()&&c(this).trigger("PopupInterviewOpened",a,new d(a.ScriptLinkDialogElementName(),a.ComputationVariableName(),b))},PopInterview:function(){var a,b=this.InPopupInterview(),d=this.s_interviewStack.Pop();return b&&(a=this.Depth()>1?this.CurrentInterview().ComputationVariableName():null,c(this).trigger("PopupInterviewClosed",this.CurrentInterview(),new e(a,d.ComputationVariableName()))),d},Depth:function(){return this.s_interviewStack.Count()},CurrentInterview:function(){return this.s_interviewStack.Peek()},InPopupInterview:function(){return this.Depth()>1}};return g}),define("api",["hd","hdmain/system","hdmain/jq","api/popupwindow","dialog/hdnavbarcell","dialog/hdnavbtntype","dialog/hdnavseppos","dialog/interviewstack"],function(a,b,c,d,e,f,g,h,i){function j(a){if(!a)return[];var b,c=a.split(":");for(b=0;b<c.length;b++)c[b]=parseInt(c[b],10);return c}function k(a){return typeof a!=m||2!=a.length?null:a.toUpperCase()}this.DEBUG===i&&(this.DEBUG=a.DEBUG);var l,m="string",n="number",o="boolean",p="object",q="function",r="",s=typeof RPC$===p,t="NOT_IMPLEMENTED",u={},v=[],w={},x=[],y={},z={};return z.Callbacks={OnHDFinish:function(){return typeof OnHDFinish==q?OnHDFinish.apply(arguments):t},OnHDStart:function(){typeof OnHDStart==q&&OnHDStart()},PreHDSubmit:function(){typeof PreHDSubmit==q&&PreHDSubmit.apply(arguments)}},z.PostAnswersToServer=function(b,c,d,e){if(typeof b==m&&b){typeof d==p&&d||(d={}),typeof e!=o&&(e=!0);var f;d.HDInfo=a.HDEngine.GetEncodedAnswers(),d.HDUtcOffset=(-(new Date).getTimezoneOffset()).toString(),f=z.PostAnswersToServer.caller==z._SaveAnswers?"SaveAnswers":z.PostAnswersToServer.caller==z.DocumentPreview?"DocumentPreview":"APICall",z._invokeHandler("PreHDSubmit",!0,!1,"FieldArray",d,"Context",f,"Callback",function(){z.PostToServer(b,d,e,c)})}},z.PostToServer=function(b,d,e,f){if(typeof b==m&&b&&typeof d==p&&d){typeof e!=o&&(e=!0);var g=c("#hdMainDiv");e&&(typeof f!=m&&(f=a.Lc.GetStr("ui_sresult")),g.HDInterview("ShowServerResponse",!0,!1,f)),g.HDInterview("Submit",b,d,"hdSvrRspFrm")}},z.AddCustomToolbarButton=function(b,d,e,f,g,h,j,k,l,o,p){var s,t=r;return typeof b==q?(typeof d!=m&&(d=null),typeof e!=m&&(e=r),typeof f!=m&&(f=r),typeof g!=m&&(g=r),typeof j!=m&&(j=r),typeof k!=m&&(k=r),typeof l!=m&&(l=r),typeof o!=n&&(o=0),t="hdtbbtn"+(v.length+1),s={ID:t,OnClick:b,IsActive:h,imgNorm:d?d:null,imgHot:e?e:null,imgAct:j?j:null,imgActHot:k?k:null,text:g,textAct:l,textStat:f,silverlightId:t,visible:!0,buttonIndex:o,textOnly:null===d||d===i||""===d,caption:typeof p==m?p:g},v.push(s),w[t]=s):c("#hdMainDiv").HDInterview("Error",this,a.Lc.GetStr("err_invprm_tb"),a.Lc.GetStr("err_invprm")),t},z.AddCustomNavButton=function(b,d,h,i,j,k,l,o,p){function s(a,b,c,d,e,f,g,h,i,j){this.id=null===a?"hdnbbtn"+(x.length+1):a,this.silverlightId=this.id,this.visible=!0,this.link=null===b?this.id:b,this.cell=e,this.separator=f,this.buttonType=d,this.customCaption=g,this.customImage=h,this.customTooltip=i,this.buttonIndex=j,x.push(this),y[this.id]=this}var t,u=r;return typeof b==q?(typeof h!=n&&(h=f.TextOnly),typeof k!=m&&(k=r),typeof i!=m&&(i=r),typeof j!=m&&(j=r),typeof l!=n&&(l=e.Right),typeof o!=n&&(o=-1),typeof p!=n&&(p=g.None),t=new s(null,null,0,h,l,p,i,k,j,o),t.OnClick=b,typeof d==q&&(t.IsEnabled=d),u=t.id):c("#hdMainDiv").HDInterview("Error",this,a.Lc.GetStr("err_invprm_nb"),a.Lc.GetStr("err_invprm")),u},z.InvokeButton=function(b){if(typeof b==m){var d,e=a.HDEngine;if("HDReturnToInterview"==b)c("#hdMainDiv").HDInterview("ShowServerResponse",!1);else{if("HDNavigationBar"==b||"HDToolBar"==b)return;if(d=y[b],d!=i)return e.InvokeButton(b),void 0;if(d=w[b],d!=i)return e.InvokeButton(d.silverlightId),void 0;e.InvokeButton(b)}}},z.SetButtonVisibility=function(b,c){if(typeof b==m){typeof c!=o&&(c=!0);var d,e=a.HDEngine;switch(b){case"HDNavigationBar":typeof e.NavigationBarVisible==o?e.NavigationBarVisible=c:e.NavigationBarVisible(c);break;case"HDToolBar":typeof e.ToolBarVisible==o?e.ToolBarVisible=c:e.ToolBarVisible(c);break;default:if(d=y[b],d!=i)return d.visible=c,e.SetButtonVisible(d.id,c),void 0;if(d=w[b],d!=i)return d.visible=c,e.SetButtonVisible(d.silverlightId,c),void 0;e.SetButtonVisible(b,c)}}},z.SetToolbarButtonImage=function(b,d,e,f,g){var h,j=a.HDEngine;if(typeof b==m&&typeof d==m&&d){if(typeof e!=m&&(e=r),typeof f!=m&&(f=r),typeof g!=m&&(g=r),"HDNavigationBar"==b||"HDToolBar"==b)return;if(h=w[b],h!=i)return h.imgNorm=d,h.imgHot=e?e:null,h.imgAct=f?f:null,h.imgActHot=g?g:null,j.SetToolbarButtonImage(h.silverlightId,h.imgNorm,h.imgHot,h.imgAct,h.imgActHot),void 0;j.SetToolbarButtonImage(b,d,e,f,g)}else c("#hdMainDiv").HDInterview("Error",this,a.Lc.GetStr("err_invprm_img"),a.Lc.GetStr("err_invprm"))},z.SetNavbarButtonImage=function(b,c){typeof b==m&&typeof c==m&&a.HDEngine.SetNavigationbarButtonImage(b,c)},z.ScreenRefresh=function(){var b=a.HDEngine;b.InBulkAnswerUpdate()&&b.EndBulkAnswerUpdate()},z.SetAnswer=function(b,c,d,e){var f=a.HDEngine;if(e=k(e?e:f.GetValType(b)),null!==e){if(f.InBulkAnswerUpdate()||f.BeginBulkAnswerUpdate(),null===c||typeof c==m&&c==r)c=null;else switch(e){case"TX":typeof c!=m&&(c=c.toString());break;case"DA":if(typeof c==m&&(c=a.Lc.ParseDate(c)),typeof c!=p||null===c||c.getDate===i)return;c=new Date(c.valueOf());break;case"TF":typeof c==m?c="TRUE"==c.toUpperCase():typeof c==n&&(c=0!==c);break;case"MC":c=typeof c==m?c.replace(/\|/g,""):c.toString();break;case"NU":typeof c!=n&&(c=parseFloat(c))}f.SetValue(e,b,j(d),c)}},z.GetAnswer=function(b,c,d){var e,f=a.HDEngine;return d=k(d?d:f.GetValType(b)),null!==d?("string"!=typeof c&&(c=null),e=f.GetValue(b,d,j(c)),e&&"MC"==d&&(e=typeof e===m?e.replace(/\2/g,"|"):e.join("|")),e):void 0},z.GetAnswerIterator=function(){var b;return b=a.HDEngine.GetCurrentRepeatIndex(),b===r?0:(b=b.split(":"),1+parseInt(b[b.length-1]))},z.GetAnswerRepeatIndex=function(){var b;for(b=a.HDEngine.GetCurrentRepeatIndex(),b===r&&(b="0"),b=b.split(":");b.length<4;)b.push("-1");return b.join(":")},z.GetXMLAnswers=function(){return a.HDEngine.GetXMLAnswers(!1)},z.GetInterviewBookmark=function(){return a.HDEngine.GetBookmark()},z.GetProgress=function(){return c.parseJSON(a.HDEngine.GetProgress())},z.GotoInterviewBookmark=function(b){return a.HDEngine.GotoBookmark(b)},z.RegisterHandler=function(a,b){var c=u[a];c||(c=[],u[a]=c),c.push(b)},z.UnregisterHandler=function(a,b){function c(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1}var d,e=u[a];e&&(d=c(e,b),d>=0&&e.splice(d,1))},z.GetAnswerSummary=function(){return a.HDEngine.GetAnswerSummary()},z.DocumentPreview=function(){var b={};"string"==typeof a.DPState?b.StateString=a.DPState:(b.TemplateState=HDTemplateState,b.TempInterviewUrl=c("#hdMainDiv").HDInterview("option","TplImgPath"),b.TempInterviewState=typeof HDTplImgState==m?HDTplImgState:r,b.InlineImages=a.g_allowDataURIs.toString()),z.PostAnswersToServer(HDDocPreviewUrl,a.Lc.GetStr("tb_dp"),b)},z.SetTemplateTitle=function(b){var c=a.HDEngine;typeof b==m&&(typeof c.TemplateTitle==q?c.TemplateTitle(b):c.TemplateTitle=b)},z.EncodeString=function(b,c,d){return a.HDEngine.EncodeString(b,c,typeof d==o?d:!1)},z.ServerResponseVisible=function(){var a=c("#hdServerResponse");return a.length>0&&"hidden"!=a.css("visibility")&&"none"!=a.css("display")},z.InPopupInterview=function(){return a.HDEngine.InPopupInterview()},z.ClosePopupInterview=function(){a.HDEngine.ClosePopupInterview()},z.ShowMessageBox=function(b,d,e){d===i&&(d=a.Lc.GetStr("ui_hd")),e===i&&(e="hd-alert");var f,g=!1;"number"==typeof document.documentMode&&(f=c("#hdSvrRspFrm"),g="visible"==f.css("visibility"),g&&f.css("visibility","hidden")),c("<div/>").html(b).PopupWindow({modal:!0,title:d,buttons:{OK:function(){c(this).PopupWindow("close").PopupWindow("destroy").remove(),g&&f.css("visibility","visible")}},icon:e,maxHeight:.8*c("#hdMainDiv").height()}).PopupWindow("open")},z._formatStr=function(){return b.String.Format.apply(this,arguments)},z._enumCustTBBtns=function(a){var b,c,d;for(b=0;b<v.length;b++)c=v[b],d=a.RegisterToolbarButton(c.imgNorm,c.imgHot,c.textStat,c.text,typeof c.IsActive==q,c.imgAct,c.imgActHot,c.textAct,c.buttonIndex,c.caption),c.silverlightId=d,w[d]=c,c.visible||z.SetButtonVisibility(c.ID,c.visible)},z._clickCustTBBtn=function(a){var b=w[a];b&&b.OnClick(b.ID)},z._custTBBtnIsActive=function(a,b){var c=w[a];c&&typeof c.IsActive==q?s?c.IsActive(c.ID,b):b(c.IsActive(c.ID)):b(!1)},z._enumCustNBBtns=function(a){var b,c,d;for(b=0;b<x.length;b++)c=x[b],d=a.RegisterNavigationbarButton(c.buttonType,typeof c.IsEnabled==q,c.customCaption,c.customTooltip,c.customImage,c.cell,c.buttonIndex,c.separator,c.id),c.silverlightId=d,y[d]=c,c.visible||z.SetButtonVisibility(c.id,c.visible)},z._clickCustNBBtn=function(a){var b=y[a];b&&b.OnClick(b.id)},z._custNBBtnIsEnabled=function(a,b){var c=y[a];c&&typeof c.IsEnabled==q?s?c.IsEnabled(c.id,b):b(c.IsEnabled(c.id)):b(!0)},z._invokeHandler=function(b,d,e){function f(a){if(null===a||typeof a!=p)return a;var b,c=new a.constructor;for(b in a)c[b]=a[b];return c}function g(a){if(null===a||typeof a!=p)return a;var b,c=new a.constructor;for(b in a)c[b]=g(a[b]);return c}var h,j,k,l,n,q,v,w={},x=!1,y=r,A=u[b];e&&(d=!0);try{for(d&&"OnHDStart"==b?z.Callbacks.OnHDStart():"OnHDNavigated"==b&&(a.g_navEventFired=!0),h=3;h<arguments.length-1;h+=2)if("Callback"==arguments[h]){q=arguments[h+1];break}if(q==i&&(q=function(){}),A&&A.length>0){for(e&&(w.Cancel=!1,w.CancelMessage=r),h=3;h<arguments.length-1;h+=2)"Callback"!=arguments[h]&&(w[arguments[h]]=arguments[h+1]);if(j=w,d){for(v=c.Deferred().progress(function(a){function b(){e&&w.Cancel&&(x=!0,w.CancelMessage&&(y=w.CancelMessage)),a==A.length-1&&v.resolveWith(this)}w=f(j),s?A[a](w,b):(A[a](w),b())}).done(function(){q(e?x:!1,y)}),h=0;h<A.length;h++)v.notifyWith(this,[h]);return}window.setTimeout(function(){for(h=0;h<A.length;h++)A[h](g(j))},0)}if(d&&"PreHDSubmit"==b)z.Callbacks.PreHDSubmit(arguments[4],arguments[6]);else if(d&&e&&"OnHDFinish"==b&&(k=z.Callbacks.OnHDFinish(),k!==t))return q(typeof k==o&&!k,y),void 0}catch(B){l=a.Lc.GetStr,n=l("err_handler",b),B&&(B.message?n+="  "+B.message:typeof B==m&&(n+="  "+B)),alert(n+"\n\n"+l("err_siteadm"))}q(x,y)},z._assertSvrRspHidden=function(){var b=z.ServerResponseVisible();return b&&HDAPI.ShowMessageBox(a.Lc.GetStr("err_mustret")),!b},z._SaveAnswers=function(){var b={};b.HDDlgAt=r,z.PostAnswersToServer(c("#hdMainDiv").HDInterview("option","saUrl"),a.Lc.GetStr("tb_sv"),b)},z._DoWebLinkAction=function(a){return typeof a==m?(a.indexOf("%")>=0&&(a=unescape(a)),window.eval(a)):void 0},z._OpenResourceWindow=function(a,d){typeof a!=m&&(a=r),typeof d!=m&&(d=r);var e=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i,f=e.test(navigator.userAgent)||e.test(navigator.platform);f&&h.CurrentInterview()._dialogControl.DialogControl("option","ResourcePaneVisibility")==b.Windows.Visibility.Visible?h.CurrentInterview()._dialogControl.data("hd-DialogControl").ResourcePane.HtmlHostControl("SetText",a).focus():(l===i&&(l=c("<div/>").appendTo("#hdMainDiv").PopupWindow(),l.parent().addClass("hd-popup-resource")),l.html(a).PopupWindow({title:d,modal:f,maxHeight:.8*c("#hdMainDiv").height()}).PopupWindow("open"))},z._showInterviewHelp=function(){function d(a){c("<h2/>").text(j.GetStr(a)).appendTo(i)}function e(a){return'<div class="hd-img '+a+'" style="top:4px; position:relative; float:none; display:inline-block; visibility:visible"/>'}function f(a){var b,d=j.GetStr(a);arguments.length>0&&(b=Array.prototype.slice.call(arguments),b[0]=d,d=k.apply(this,b)),c('<div class="hd-help"/>').html(d).appendTo(i)}function g(a){var b,d,e,f,g=c('<table class="hd-help-table"/>').appendTo(i),h=c("<thead/>").appendTo(g),l=c("<tr/>").appendTo(h);for(c('<th class="hd-help-col-one">'+j.GetStr("hlp_to")+"</th>").appendTo(l),c("<th>"+j.GetStr("hlp_do")+"</th>").appendTo(l),b=0;b<a.length;b++){d=c("<tr/>").appendTo(g);for(e in a[b])f=a[b][e]?a[b][e]:[],f.splice(0,0,j.GetStr("hlp_"+e)),c("<td/>").html(k.apply(this,f)).appendTo(d)}}function h(a){var b,d=c('<ul class="hd-help-ul"/>').appendTo(i);for(b=0;b<a.length;b++)c(a[b]).appendTo(d)}var i=c("<div/>"),j=a.Lc,k=b.String.Format,l='<li><div class="hd-dlg-{0} hd-img{1}"/>{2}</li>';f("hlp_intro"),f("hlp_intro2"),d("ui_io"),f("hlp_io_ovw"),f("hlp_io_tbl"),h([k(l,"u","",j.GetStr("hlp_io_du")),k(l,"n","",j.GetStr("hlp_io_dn")),k(l,"p","",j.GetStr("hlp_io_dp")),k(l,"a","",j.GetStr("hlp_io_da")),k(l,"r","",j.GetStr("hlp_io_dr")),k(l,"u","-g",j.GetStr("hlp_io_dug"))]),f("hlp_io_loc"),g([{io_widT:[],io_widD:[]},{io_clsT:[],io_clsD:[e("hd-closex"),e("hd-dock"),e("hdtb-btnol")]}]),d("hlp_dp"),f("hlp_dp_ovw"),f("hlp_dp_tbl"),g([{dp_txtT:null,dp_txtD:null},{dp_chkT:null,dp_chkD:null},{dp_calT:null,dp_calD:[e("hd-cal-calendar")]},{dp_rptT:null,dp_rptD:[e("hd-adit")]},{dp_sprT:null,dp_sprD:[j.GetStr("hdmnuEditRow"),j.GetStr("hdmnuInsRow"),j.GetStr("hdmnuDelRow")]},{dp_nstT:null,dp_nstD:[e("hd-nav-Next")]},{dp_nxdT:null,dp_nxdD:[e("hd-nav-Next"),e("hd-nav-Prev")]},{dp_nxuT:null,dp_nxuD:[e("hd-nav-NextU"),e("hd-nav-PrevU")]},{dp_frsT:null,dp_frsD:[e("hd-nav-First"),e("hd-nav-Last")]},{dp_finT:null,dp_finD:[e("hd-nav-Finish")]}]),d("hlp_rp"),f("hlp_rp_intro"),f("hlp_rp_how",e("hd-dock"),e("hd-rsrc"),e("hd-closex")),f("hlp_rp_note"),this._ShowModalResponse(i.html(),j.GetStr("ui_help"),!0)},z._ShowModalResponse=function(a,b,d){typeof a!=m&&(a=r),typeof b!=m&&(b=r),typeof d!=o&&(d=!1);var e="hdModalResponse",f=c("#"+e).remove(),g=c("#hdServerResponse"),h=c("#hdWrapper");f=c("<div/>").attr("id",e).css({position:"absolute",top:"0px",overflow:"auto"}).html(a).appendTo(g),c("#hdMainDiv").HDInterview("ShowServerResponse",!0,d,b),g.width(h.width()).height(h.height())},z._getAPIHelp=function(){function a(a,c,d){var f,g=b(a.toString()),h={},i=g.getElementsByTagName("param");for(f=0;f<i.length;f++)h[i[f].getAttribute("name")]=e(i[f]);return{Type:d,Title:c,Summary:e(g.getElementsByTagName("summary")),Remarks:e(g.getElementsByTagName("remarks")),Example:e(g.getElementsByTagName("example")),Return:e(g.getElementsByTagName("returns")),Parameters:h}}function b(a){var b,e=a.split("\r\n");for(b=0;b<e.length;b++)e[b]=d(e[b]),e[b]=0!==e[b].indexOf("///")||e[b].indexOf("JS_PUBLIC_API")>0?"":d(e[b].substr(3));return c("<doc>"+e.join(" ")+"</doc>").childNodes[0]}function c(a){return this.DOMParser?(parser=new DOMParser,xmlDoc=parser.parseFromString(a,"text/xml")):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async=!1,xmlDoc.loadXML(a)),xmlDoc}function d(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function e(a){var b,c,d="";if(0!==a.length)for(b=a.length?a[0].childNodes:a.childNodes,c=0;c<b.length;c++)"undefined"!=typeof XMLSerializer?d+=(new XMLSerializer).serializeToString(b[c]):"undefined"!=typeof b[c].xml&&(d+=b[c].xml);
return d}var f,g,h={};for(f in z)if(0!==f.indexOf("_"))switch(f){case"Callbacks":case"InterviewOptions":for(g in z[f])h[z[f][g]()]=a(z[f][g],g,"Callbacks"==f?1:2);break;default:h[f]=a(z[f],f,0)}return h},z._export=function(b){b.HDPostAnswersToServer=z.PostAnswersToServer,b.HDPostToServer=z.PostToServer,b.HDAddCustomToolbarButton=z.AddCustomToolbarButton,b.HDAddCustomNavButton=z.AddCustomNavButton,b.HDInvokeButton=z.InvokeButton,b.HDSetButtonVisibility=z.SetButtonVisibility,b.HDSetToolbarButtonImage=z.SetToolbarButtonImage,b.HDSetNavButtonImage=z.SetNavbarButtonImage,b.HDScreenRefresh=z.ScreenRefresh,b.HDAnsSetVal=z.SetAnswer,b.HDAnsGetVal=z.GetAnswer,b.HDAnsGetIter=z.GetAnswerIterator,b.HDAnsGetRptNdx=z.GetAnswerRepeatIndex,b.HDGetXMLAnswers=z.GetXMLAnswers,b.HDGetInterviewBookmark=z.GetInterviewBookmark,b.HDGotoInterviewBookmark=z.GotoInterviewBookmark,b.HDRegisterHandler=z.RegisterHandler,b.HDUnregisterHandler=z.UnregisterHandler,b.HDGetAnswerSummary=z.GetAnswerSummary,b.DoHDDocumentPreview=z.DocumentPreview,b.HDSetTemplateTitle=z.SetTemplateTitle,b.HDEncodeString=z.EncodeString,b.HDSubmitAns=function(){a.HDEngine.Finish()},b.HDServerResponseVisible=z.ServerResponseVisible},this.HDAPI=z,HDAPI}),define("hdmain/intstate",{Uninitialized:0,InitLoading:1,Initializing:2,Initialized:3,Loading:4,Active:5,Error:-1}),define("engine/uistate",{Uninitialized:0,Ready:1,Busy:2,Error:-1}),define("hdmain/hdinterview",["hd","hdmain/system","hdmain/hdloadererror","hdmain/hdloaderprogressbar","hdmain/serverresponse","api","hdmain/jq","hdmain/intstate","engine/uistate","require"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g.proxy,m=a.g_isSilverlight=!1,n="string",o="number",p="boolean",q="object",r="function",s=a.InterviewType,t=a.FileType={JavaScript:0,CSS:2,XAML:3},u={},v=0,w=0,x=0,y=!1,z=[],A="hd.",B="InterviewEngine",C="HDLoaderError",D="hd-interview-base",E="HDLoaderProgressBar";return a.g_navEventFired=!1,a.g_allowDataURIs=!1,a.iOS=navigator.userAgent.indexOf("iPad")>0,a.HDEngine=null,g.widget(A+"HDInterview",{options:{state:h.Uninitialized,LegacyAPI:!0,ProgressBar:!0},_create:function(){this.element.addClass(D),this.wrapper=g('<div id="hdWrapper" style="overflow:hidden;"/>').appendTo(this.element);var b=g('<div id="HDPreCSSProgress" style="font-family:sans-serif; padding:50px;"/>').appendTo(this.wrapper);this.host=g('<div id="hdHost"/>').appendTo(this.wrapper),this.svrResponse=g("<div id='hdServerResponse'/>").appendTo(this.wrapper).ServerResponse(),this.shader=g('<div id="hdShader"/>').appendTo(this.wrapper),this.progressBar=g('<div id="hdLoaderBar"/>')[E]().appendTo(this.wrapper).hide(),this.errorDiv=g('<div id="hdErrorDiv"/>')[C]().appendTo(this.wrapper),this.splash=g('<div id="hdSplash"/>').appendTo(this.wrapper),this.splashImg=g("<div><img/></div>").appendTo(this.splash),this.splashText=g("<div/>").appendTo(this.splash),g('<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="/>').on("error load",function(){var b=1==this.width&&1==this.height,c=document.documentMode;b&&(b=!(typeof c==o&&9>c)),a.g_allowDataURIs=b,g(this).remove()}).appendTo(this.wrapper),this.option(this.options),g(window).on("resize",l(this._resize,this)).resize();var c=a.Lc.GetStr("ui_wait"),d=0,e=setInterval(l(function(){d>0&&d%10===0&&(c+="."),b.text(c),d++,z.length<2&&100>d||(clearInterval(e),b.remove(),x+=2,x>1&&this._setOption("state",this.options.state),v+=2,this._loadCSS(),this._initEngine())},this),100)},_setOption:function(c,d){g.Widget.prototype._setOption.apply(this,arguments);var e=this.options,f=a.Lc;switch(c){case"type":d!==s.JavaScript&&d!==s.Silverlight?this.SetState(h.Error,b.String.Format(f.GetStr("err_type",d))):(m=a.g_isSilverlight=d===s.Silverlight,!m&&(typeof document.documentMode!=o||document.documentMode>8)&&this.host.css("visibility","hidden"));break;case"title":e[c]=unescape(d).replace(/\\\'/g,"'");break;case"Height":case"Width":typeof d===o&&(d+="px",e[c]=d),this.wrapper.css(c.toLowerCase(),d),this.host.resize();break;case"Locale":null!==d&&a.Lc.SetLocale(d),this.progressBar[E]({message:f.GetStr("ui_load")}),this.errorDiv[C]({message:f.GetStr("ui_err")}),this.svrResponse.ServerResponse({PrintMsg:f.GetStr("ui_print"),ReturnMsg:f.GetStr("ui_rtntiv")});break;case"Margin":0>d&&(d=parseInt(g(document.body).css("margin-bottom"),10),(isNaN(d)||d===k)&&(d=0),e[c]=d);break;case"formAction":d||this.Error(0,f.GetStr("errnoact"));break;case"ResourceHeight":0>=d&&(e[c]=100);break;case"SplashScreen":d&&(d.Image?this.splashImg.show().children("img").attr("src",d.Image):this.splashImg.hide(),d.Text&&this.splashText.text(d.Text),d.Duration="number"==typeof d.Duration?Math.min(d.Duration,10):3);break;case"state":if(d===h.Active)this.IsActive()||(this.host.css("visibility","visible"),this.progressBar.hide(),this.errorDiv.hide(),this.shader.fadeOut());else if(this.shader.show(),d===h.Error)this.progressBar.hide(),this.errorDiv.show();else if(x>1){if(this.errorDiv.hide(),this.options.SplashScreen&&(this.options.SplashScreen.Image||this.options.SplashScreen.Text)){var i=this.options.SplashScreen.Duration;i>0&&(this.splash.draggable({containment:"parent"}).css({visibility:"visible",position:"absolute"}).click(g.proxy(function(){this.hide()},this.splash)).delay(1e3*i).fadeOut("slow"),window.setTimeout(l(function(){this.splash.css({left:this.wrapper.width()/2-this.splash.width()/2+"px",top:this.wrapper.height()/2-this.splash.height()/2+"px"})},this),0))}this.progressBar.show()}break;case"hdvers":(null===d||"11"!==d.split(".")[0])&&this.SetState(h.Error,f.GetStr("err_vers",d,"11.x.x"));break;case"systemCSS":this.q(d,null,null,t.CSS);break;case"userCSS":g("style[id='hdsUserCSS']").remove(),this.q(d,null,null,t.CSS),this.svrResponse.ServerResponse({css:d});break;case"blankFrame":this.svrResponse.ServerResponse({blankFrame:d})}},_resize:function(b){if(b===k||b.target===window||b.target===window.document){var c,d=g(window),e=this.options,f=window.innerHeight?window.innerHeight:d.height(),i=f!==e.winHeight||e.state<h.Active,j=this.host.width()!==e.winWidth||e.state<h.Active;i&&(e.winHeight=f,c="auto"===e.Height?f-this.wrapper.position().top-e.FooterHeight:parseInt(e.Height),this.wrapper.height(c),this.host.height(c),m||a.HDEngine&&a.HDEngine.Host.App&&a.HDEngine.Host.App({height:c})),j&&(e.winWidth=this.host.width(),m||a.HDEngine&&a.HDEngine.Host.App&&a.HDEngine.Host.App({width:e.winWidth})),(i||j)&&this.svrResponse.ServerResponse("sizeServerResponse")}},_initEngine:function(){function b(){var a;for(a in u)u.hasOwnProperty(a)&&this._ajaxLoad(u[a])}{var c=this.options;a.jsPath}c.state!==h.Error&&(c.state=h.InitLoading,window.setTimeout(l(b,this),200))},_ajaxLoad:function(a){g.ajax({crossDomain:!0,dataType:"script",cache:!0,url:a.source,timeout:1e4,success:a.onload,error:a.onload})},_loadCSS:function(){function b(a,b){var c,d;if(o)m.insertRule(a+" { "+b+" }",p++);else if(a.indexOf(",")>0)for(c=a.split(","),d=0;d<c.length;d++)m.addRule(c[d],b);else m.addRule(a,b)}function c(a){function b(){var b=g("<img/>").hide().appendTo(document.body).attr("src",a.u),d=function(){a.h=b.height(),b.remove(),c.resolve()};b.height()>0?d():b.load(d)}var c=g.Deferred();return 0===a.u.indexOf("file:")?b():g.ajax({url:a.u,type:"HEAD",async:!0,error:function(){a.h=0,c.resolve()},success:b}),c}function d(a){function b(){f++,f==a.length&&e.resolve()}var d,e=g.Deferred(),f=0;for(d=0;d<a.length;d++)c(a[d]).then(b);return e}var e=this.options.userCSS,f=this.options.systemCSS,h=window.devicePixelRatio,i=[],j=[];h===k&&(h=1),h>1&&(i.push({u:e.replace(".css","-normal@"+h+".png"),r:h}),j.push({u:e.replace(".css","-disabled@"+h+".png"),r:h})),i.push({u:e.replace(".css","-normal.png"),r:1}),j.push({u:e.replace(".css","-disabled.png"),r:1}),h>1&&(i.push({u:f.replace(".css","-normal@"+h+".png"),r:h}),j.push({u:f.replace(".css","-disabled@"+h+".png"),r:h})),i.push({u:f.replace(".css","-normal.png"),r:1}),j.push({u:f.replace(".css","-disabled.png"),r:1});var m,n,o,p=0,q=0;n=window.setInterval(l(function(){if(q++<10){try{o=document.styleSheets[0].cssRules}catch(c){return}if(o)g("#hdsUserPvt").remove(),g('<style type="text/css" id="hdsUserPvt"/>').appendTo("head"),m=document.styleSheets[document.styleSheets.length-1];else{if("undefined"==typeof document.createStyleSheet)return;m=document.createStyleSheet()}}else this.Error(this,"The interview styles failed to load properly. If the problem persists, please contact technical support.");window.clearInterval(n),g.when(d(i),d(j)).then(function(){var c,d,e,f,h,l,m,n,o=a.ImageDefinitions;for(h=0;h<i.length&&!(i[h].h>0||h==i.length-1);h++);for(b(".hd-img, .hd-lin-s, .hd-popup .ui-dialog-titlebar-close .ui-icon","background-image: url('"+i[h].u+"');"),l=0;l<j.length&&!(j[l].h>0||l==j.length-1);l++);for(b(".hd-img-g","background-image: url('"+j[l].u+"');"),c=0;c<o.length;c++){d=o[c],e="."+d.c,d.w===k&&(d.w=20),d.h===k&&(d.h=20);var p=Math.abs(d.y);for(m=0;m<i.length-1&&!(i[m].h>p*i[m].r);m++);for(n=0;n<j.length-1&&!(j[n].h>p*j[n].r);n++);d.sn=m>h,d.sd=n>l,f="background-position:"+d.x+"px "+d.y+"px;",f+="width:"+d.w+"px;",f+="height:"+d.h+"px;",b(e,f),d.sn&&b(".hd-img."+d.c,"background-image: url('"+i[m].u+"');"),d.sd&&b(".hd-img-g."+d.c,"background-image: url('"+j[n].u+"');")}y=!0,g("#hdMainDiv").HDInterview("LoadSprite")})},this),200)},_setup:function(){var c=a.HDEngine,d=this.options;d.state=h.Initializing,c.SetAnswerSummaryPrefs(d.as_col,d.HDAS1IndentP,d.HDAS1BulletP,d.HDAS1IndentA,d.HDAS1BulletA,d.HDAS2Borders,d.HDAS2Perc),c.SetNextFollowsOutline(d.oio),c.SetDisableFinishWarning(!d.FinishWarning),c.SetTemplateImageUrl(d.test?d.TplImgPath:b.Uri.AbsolutePath(d.TplImgPath)),c.SetRequiredAsterisk(d.RequiredAsterisk),c.SetAnswerDTD(d.xmldtd),typeof PreHDRender2===r&&PreHDRender2(),m?(c.TemplateTitle=d.title,c.DocPreviewEnabled=d.dp,c.AnswerSummaryEnabled=d.as,c.SaveAnswersUrl=d.saUrl,c.ShowAllResourceButtons=d.sarb,c.ResourcePaneInitialHeight=d.ResourceHeight,c.InterviewOutlineInitialWidth=d.OutlineWidth,c.ProgressBarEnabled=d.ProgressBar):(c.TemplateTitle(d.title),c.DocPreviewEnabled(d.dp),c.AnswerSummaryEnabled(d.as),c.SaveAnswersUrl(d.saUrl),c.ShowAllResourceButtons(d.sarb),c.ResourcePaneInitialHeight(d.ResourceHeight),c.InterviewOutlineInitialWidth(d.OutlineWidth),c.ProgressBarEnabled(d.ProgressBar)),g(window).resize()},_start:function(){this.options.state!==h.Error&&(this.options.state<h.Initialized&&(this._setup(),this.options.state=h.Initialized),g(window).on("beforeunload.HDLoader",l(function(b){var c,d=b||window.event;if(this.options.LeaveWarning)return c=a.Lc.GetStr("nav_leave"),d&&(d.returnValue=c),c},this)),window.setTimeout(function(){f._invokeHandler("OnHDStart",!0,!1)},0))},_readyCheck:function(){if(this.options.state!==h.Error){var c,d=a.Lc,e="CSS1Compat"!==document.compatMode,g=document.documentMode&&document.documentMode<8;if(e||g)return this._engineError(l(this._readyCheck,this),{errorType:d.GetStr("err_brows"),errorMessage:d.GetStr(e?"err_dtype":"err_compat")}),this.options.state=h.Error,void 0;for(c in u)if(u.hasOwnProperty(c)&&!u[c].loaded)return;a.HDEngine&&(a.HDEngine.InterviewComplete=l(function(c,d){var e,g=this.options;f._invokeHandler("OnHDFinish",!0,!0,"Callback",l(function(c,i){return c?(b.String.IsNullOrEmpty(i)||a.Alert(i),d.Cancel=c,void 0):(e={HDInfo:a.HDEngine.GetEncodedAnswers(),HDDlgAt:"",HDUtcOffset:(-(new Date).getTimezoneOffset()).toString()},g.asmQ&&(e.HDAsmQ=g.asmQ),a.HDEngine&&a.HDEngine.ClearFocus(),g.DisableOnSubmit&&this.IsActive()&&this.SetState(h.Loading,a.Lc.GetStr("val_wait")),f._invokeHandler("PreHDSubmit",!0,!1,"FieldArray",e,"Context","InterviewComplete","Callback",l(function(){this.Submit(g.formAction,e,g.subFrame)},this)),void 0)},this))},this))}},_prereqsLoaded:function(){var c,d,e,f,i,k,p,q,r,s,t=this.options,u=this.host[0],v=t.enginePath,w=!0,x="5.0";t.state!==h.Error&&(f=l(this._engineError,this),i=l(this.hdEngineLoad,this),m?j(["silverlight"],l(function(){return s=a.Lc,p=document.documentMode,typeof p==o?(k=8>p,w=!1,p>10&&(x="5.1")):(q=navigator.userAgent,r=navigator.platform,k=!1,q.indexOf("Chrome")>=0?w=r.indexOf("Win")<0:q.indexOf("Firefox")>=0?w=r.indexOf("Win")<0&&r.indexOf("Mac")<0:q.indexOf("Safari")>=0?w=r.indexOf("Mac")<0:k=!0),t.BrowserWarning&&(k||w)&&!window.confirm(s.GetStr("err_browsm"))?(this._engineError(l(this._readyCheck,this),{errorType:s.GetStr("err_brows"),errorMessage:s.GetStr("err_browssl")}),t.state=h.Error,void 0):Silverlight.isInstalled(x)?(c=t.assemblyName,d="Template="+encodeURIComponent(t.templateID)+",TemplatePath="+encodeURIComponent(b.Uri.AbsolutePath(t.intvwDef)),c&&(typeof c.name===n&&""!==c.name&&(d+=",AssemblyName="+c.name),typeof c.version===n&&""!==c.version&&(d+=",Version="+c.version),typeof c.culture===n&&""!==c.culture&&(d+=",Culture="+c.culture),typeof c.publicKeyToken===n&&""!==c.publicKeyToken&&(d+=",PublicKeyToken="+c.publicKeyToken),typeof c.strongName===n&&""!==c.strongName&&(d+=",StrongName="+c.strongName)),Silverlight.createObject(v,u,B,{width:"100%",height:"100%",background:"white",isWindowless:"true",enableHtmlAccess:"true",version:"5.0"},{onError:f,onLoad:i},d,null),void 0):(e=a.Lc.GetStr("err_slv"),this.SetState(h.Error,'<span style="float:right">'+Silverlight.buildPromptHTML({version:x})+"</span><span>"+e+"</span>"),void 0)},this)):j(["interview","runtime","engine","system","dialog"],function(){g("<div/>").appendTo(u).attr("id",B).css({width:"100%",height:"100%"}).App({source:v,id:B,initParams:{Template:t.templateID,TemplatePath:b.Uri.AbsolutePath(t.intvwDef)},onError:f,onLoad:i})}))},_engineError:function(b,c){var d;typeof c.errorCode===o?(d="Silverlight "+c.errorType+" ["+c.errorCode+"]: "+c.errorMessage,4001===c.errorCode&&(d+="\r\n"+a.Lc.GetStr("errslimg"))):d=c.errorType+": "+c.errorMessage,"ParserError"===c.ErrorType?(""!==c.xamlFile&&(d+="<br>XamlFile: "+c.xamlFile),0!==c.lineNumber&&(d+="<br>Line: "+c.lineNumber+"<br>Position: "+c.charPosition),""!==c.xmlElement&&(d+="<br>XmlElement: "+c.xmlElement),""!==c.xmlAttribute&&(d+="<br>XmlAttribuate: "+c.xmlAttribute)):"RuntimeError"===c.ErrorType&&(""!==c.methodName&&(d+="<br>MethodName: "+c.methodName),0!==c.lineNumber&&(d+="<br>Line: "+c.lineNumber+"<br>Position: "+c.charPosition)),typeof c.errorCode===o&&4001===c.errorCode?alert(d):this.SetState(h.Error,d)},q:function(a,b,c,d){d===k&&(d=t.JavaScript);var e=d===t.CSS&&a.toLowerCase().indexOf("hdssystem.css")<0?"hdsUserCSS":"hdsSystemCSS",f=d!=t.JavaScript;this.LoadFile(d,e,a,b,f,c)},SetState:function(b,c){this._setOption("state",b),b!==h.Active&&(b===h.Error?(typeof c!==n&&(c=c?c.toString():a.Lc.GetStr("err_unk")),this.errorDiv[C]({message:c})):this.progressBar[E]({message:c}))},IsActive:function(){var a=this.shader[0],b="display",c="";return a&&(document.defaultView&&document.defaultView.getComputedStyle?c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b):a.currentStyle&&(b=b.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=a.currentStyle[b])),"none"===c},ShowServerResponse:function(a,b,c){this.svrResponse.ServerResponse({title:c,visible:a,showPrint:b})},hdEngineLoad:function(b){function c(){var b,c,f,g,h,i=a.HDEngine,l=a.InitAnswers;if(l!=k&&null!==l)for(h in l)if(l.hasOwnProperty(h)){if(c=l[h],b=c.n?c.n:h,b=b.replace(/&amp;/gi,"&"),typeof c.t!==n)continue;if(c.v===k){if(!(typeof c.mod==p&&!c.mod||typeof c.m==p&&c.m))continue;c.v=null}if(typeof c.i!==q&&(c.i=[]),c.m===k&&(c.m=!1),c.s===k&&(c.s=!1),f=typeof c.mod==p?c.mod:!0,g=typeof c.ext==p?c.ext:!0,null===c.v){i.AddValue(c.t,b,[],null,c.m,c.s,g,f);continue}switch(c.t){case"MC":typeof c.v===q&&c.v.length!==k&&(0===c.v.length?i.AddValue(c.t,b,[],null,c.m,c.s,g,f):typeof c.v[0]===n?i.AddValue(c.t,b,[],c.v.join("|"),c.m,c.s,g,f):d(b,c,c.v,g,typeof c.mod==q?c.mod:[],[]));break;default:typeof c.v===q&&c.v.length!==k?e(b,c,c.v,g,typeof c.mod==q?c.mod:[],[]):i.AddValue(c.t,b,[],j(c.v),c.m,c.s,g,f)}}i.ValuesAdded()}function d(b,c,e,f,g,h){var i,j,l=a.HDEngine;if(null===e)l.AddValue(c.t,b,h,e,c.m,c.s,f,typeof g==p?g:!0);else for(i=h.length,j=0;j<e.length;j++)h[i]=j,null!==e[j]&&typeof e[j]===q&&e[j].length!==k?0===e[j].length?l.AddValue(c.t,b,h,null,c.m,c.s,f,j<g.length?g[j]:!0):typeof e[j][0]===q?d(b,c,e[j],f,j<g.length?g[j]:[],h.slice(0)):l.AddValue(c.t,b,h,e[j].join("|"),c.m,c.s,f,j<g.length?g[j]:!0):l.AddValue(c.t,b,h,e[j],c.m,c.s,f,j<g.length?g[j]:!0)}function e(b,c,d,f,g,h){var i,l,m=a.HDEngine;if(null===d)m.AddValue(c.t,b,h,d,c.m,c.s,f,typeof g==p?g:!0);else for(i=h.length,l=0;l<d.length;l++)h[i]=l,null!==d[l]&&typeof d[l]===q&&d[l].length!==k?e(b,c,d[l],f,l<g.length?g[l]:[],h.slice(0)):m.AddValue(c.t,b,h,j(d[l]),c.m,c.s,f,l<g.length?g[l]:!0)}function j(a){return"string"==typeof a?a.replace(/\2/gi,"\\2"):a}if(b!==k){if(b.id!==B)return;m&&(a.HDEngine=b.Content.Engine),a.Lc.Init();var o=this.options,s=g.Deferred();null!==o.defunan&&a.HDEngine.SetUnansweredText(o.defunan),o.LegacyAPI&&f._export(window),typeof o.OnInit===r?typeof RPC$===q?o.OnInit(function(){s.resolve()}):(o.OnInit(),s.resolve()):s.resolve(),s.then(l(function(){a.HDEngine.PageStateUpdate=l(function(a,b){o.state!==i.Error&&(null===b||b.State===i.Ready?(o.state<h.Initialized&&this._start(),o.state!==h.Active&&this.SetState(h.Active)):b.State===i.Busy?(o.state===h.Active&&this.SetState(h.Loading,b.Message),o.state===h.Loading?this.progressBar[E]({percent:b.Progress}):this.progressBar[E]({percent:100*(v+b.Progress/100)/w})):b.State===i.Error&&this._engineError(a,{errorType:"InterviewEngineError",errorMessage:b.Message}))},this),b.focus(),m&&this._loaded(b.id),c()},this))}},_loaded:function(a){return a&&u[a]!==k&&(u[a].loaded=!0),this.options.state!==h.Error&&(a&&v++,this.progressBar[E]({percent:100*v/w}),v===w&&y&&(!a||"Tmpl_"!==a.substr(0,5))&&this._prereqsLoaded(),this._readyCheck()),!0},LoadSprite:function(){this._loaded()},LoadFile:function(b,c,d,e,f,i,j){if(w++,this.progressBar[E]({percent:100*v/w}),e&&e(j))return v++,i&&i(c,j),void 0;var m;switch(b){case t.JavaScript:m={source:d,onload:l(function(){e(j)?(m.pollTimer&&(window.clearInterval(m.pollTimer),m.pollTimer=0),m.onload=null,i&&i(c,j),this._loaded(c)):m.timeOut?(new Date).getTime()>m.timeOut&&(window.clearInterval(m.pollTimer),m.pollTimer=0,m.onload=null,this.SetState(h.Error,a.Lc.GetStr("err_load",d))):(m.timeOut=(new Date).getTime()+2e4,m.pollTimer=window.setInterval(m.onload,200))},this)},u[c]=m;break;case t.CSS:g("<style/>").attr({type:"text/css",id:c}).appendTo("head"),g.ajax({url:d,dataType:"text",success:function(a){var b=g("#"+c);b[0].styleSheet?b[0].styleSheet.cssText=a:b.html(a),z.push(c)},error:l(function(){g("#"+c).replaceWith(g("<link/>").attr({href:d,id:c,type:"text/css",rel:"stylesheet"})),z.push(c)},this)}),typeof i===r&&i()}f&&m!==k&&(u[c]=m,window.setTimeout(l(function(){this._ajaxLoad(m)},this),1))},Submit:function(a,b,c){"hdSvrRspFrm"!=c&&g(window).off("beforeunload.HDLoader");var d,e,f,h=102399,i=g("#HDS");i.length>0&&i.remove(),i=g("<FORM/>").appendTo(document.body).attr({id:"HDS",name:"HDS",method:"POST",action:a}),typeof c===n&&i.attr("target",c);for(f in b)if(b.hasOwnProperty(f)){if("indexOf"===f)continue;for(e=b[f],d=g("<INPUT type='hidden'/>").attr({id:f,name:f}).appendTo(i).val(e.substr(0,h)),e=e.substr(h);e.length>0;)d=g("<TEXTAREA/>").attr({id:f,name:f}).appendTo(i).val(e.substr(0,h)),e=e.substr(h)}i.submit()},Error:function(a,b,c){function d(a,b){return a===k?b:(typeof b===n&&typeof a!==n&&(a=a.toString()),a)}b=d(b,"Unknown"),c=d(c,"Error"),this._engineError(a,{errorType:c,errorMessage:b})}}),g.hd.HDInterview}),define("hdmain",["hd","language/hdlang_en","hdmain/blm_runtime","hdmain/icon_definitions","hdmain/hdinterview","hdmain/system","hdmain/stack"],function(a,b,c,d,e,f){return a.ImageDefinitions=d,f}),define("system/exception",[],function(){function a(a,b){this.message=a,this.InnerException=b}return a}),define("system/exception/systemexception",["hd","hdmain/system","system/exception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("system/exception/argumentexception",["hd","hdmain/system","system/exception/systemexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("dialog/customnavigationbarbuttondef",["hd","hdmain/system","system/exception/argumentexception"],function(a,b,c){function d(d,e,f,g,h,i,j,k,l){if(h.indexOf("/")<0&&h.indexOf("\\")<0)throw new c(a.Lc.GetStr("err_nopath"),"imageName");this.ID=b.Guid.NewGuid(),this.ButtonType=d,this.HasEnabledState=e,this.ButtonText=f,this.Tooltip=g,this.ImageName=h,this.Cell=i,this.ButtonIndex=j,this.SeparatorPos=k,this.Name=l}return d}),define("dialog/customnavigationbar",{s_customNavigationbarButtonDefs:[],AddButtonDefinition:function(a){this.s_customNavigationbarButtonDefs.push(a)},ButtonDefinitions:function(){return this.s_customNavigationbarButtonDefs}}),define("system/jq.menu/basemenucontrol",["hdmain/jq"],function(a){var b="hd-menu";return a.widget("hd.BaseMenuControl",{_create:function(){this.element.addClass(b+"-base").css("width","200px"),a("<div/>").addClass(b+"-iconbkgrd").appendTo(this.element),this.item=a("<div/>").addClass(b+"-item").css("width","98%").appendTo(this.element),this.icon=a("<div/>").addClass(b+"-icon").appendTo(this.item),this.caption=a("<div/>").addClass(b+"-caption").appendTo(this.item)}}),a.hd.BaseMenuControl}),define("system/jq.menu/menuitem",["hdmain/jq","system/jq.menu/basemenucontrol"],function(a,b){var c="hd-menu";return a.widget("hd.MenuItem",{_create:function(){b.prototype._create.apply(this,arguments),this.element.css("cursor","default"),this.option(this.options)},_setOption:function(b,d){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"Label":this.caption.html(d.replace(/ +/g,"&nbsp;"));break;case"IconImageSource":this.icon.addClass(d);break;case"Tag":this.element.attr("tag",d);break;case"IsEnabled":d?this.element.on("click",a.proxy(function(){this.element.parent().trigger("ItemSelected",parseInt(this.element.attr("tag")))},this)).hover(a.proxy(function(){this.item.toggleClass(c+"-hilite")},this)):this.caption.addClass(c+"-disabled")}}}),a.hd.MenuItem}),define("system/jquery.hd.popup",["hdmain/jq"],function(a){return a.widget("hd.Popup",{_create:function(){this._isOpen=!1,this.element.addClass("hd-popup-elem").hide().appendTo("#hdMainDiv")},open:function(){var a,b,c=this.options,d=c.anchor;this._isOpen=!0,this.element.show(),"function"==typeof c.open&&c.open(this),d&&(a="t"==c.anchorPos?d.offset().top-this.element.height():d.offset().top+d.height(),b=d.offset().left-this.element.width()+d.outerWidth(),this.element.css({top:a,left:b}))},close:function(){this._isOpen=!1,this.element.hide(),"function"==typeof this.options.close&&this.options.close(this)},toggle:function(){this._isOpen?this.close():this.open()},IsOpen:function(){return this._isOpen},Empty:function(){}}),a.hd.Popup}),define("system/jq.menu/menu",["hdmain/jq","system/jquery.hd.popup"],function(a){var b="hd-menu";return a.widget("hd.Menu",{_create:function(){this.element.addClass(b).on("mouseleave",function(){a("."+b).parent().Popup("close")})}}),a.hd.Menu}),define("system/exception/argumentnullexception",["hd","hdmain/system","system/exception/argumentexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("interview/sidebar",["hdmain/jq"],function(a,b){var c=a.proxy;return a.widget("hd.SideBar",{options:{icon:"hd-blank",side:"left",tip:""},_create:function(){this.container=a("<td/>").addClass("hd-sidebar-cell");var d=a("<div/>").css("position","relative").appendTo(this.container);this.floater=a("<div/>").appendTo(d).addClass("hd-sidebar").on("swipe",c(function(a,c){("left"==this.options.side?c:-c)<0&&this.Slide(a,b,!1)},this)).click(c(this.Slide,this)),this.element.children().appendTo(this.floater),this.element.addClass("hd-collapse-bar").click(c(this.Slide,this)),this.icon=a("<div/>").appendTo(this.element),this.title=a("<div><span/></div>").addClass("hd-rotate90").appendTo(this.element);var e=document.documentMode;"number"==typeof e&&9>e&&this.title.css("float","left"),this.option(this.options)},_setOption:function(b,c){switch(b){case"side":this.container["insert"+("right"==c?"Before":"After")](this.element);break;case"icon":this.icon.removeClass().addClass("hd-img "+c);break;case"tip":this.element.attr("title","string"==typeof c?c:c[0]);break;case"title":this.title.children("span").text(c)}a.Widget.prototype._setOption.apply(this,arguments)},Show:function(){this.floater.hide(),this.container.show(),this.element.show(),this.floater.css(this.options.side,"-"+this.floater.outerWidth()+"px").show()},Hide:function(){this.element.hide(),this.container.hide()},Slide:function(d,e,f){var g=this.options.side,h={},i=this.options.tip;"number"!=typeof e&&(e=400),f==b&&(f=parseInt(this.floater.css(g))<0),"function"==typeof i.push&&i.length>1&&this.element.attr("title",f?i[1]:i[0]),a(document.body).off(".toClose"+g),f&&(a(document.body).on("click.toClose"+g,c(function(c){c.target!=this.element[0]&&!a.contains(this.element[0],c.target)&&(this.Slide.call(this,c,b,!1),this.element.off(".toClose"))},this)),this.floater.find("#hdOutlineTree").scrollLeft(0),this.element.css("visibility","hidden")),h[g]="-"+(f?this.element:this.floater).outerWidth()+"px",this.floater.animate(h,{duration:e,complete:f?b:a.proxy(function(){this.element.css("visibility","visible")},this)})}}),a.hd.SideBar}),define("system/jq.treeview/basetreeviewcontrol",["hdmain/jq"],function(a){return a.widget("hd.BaseTreeViewControl",{options:{IsEnabled:!0,DisabledOpacity:.7},_create:function(){this.option(this.options)},_setOption:function(b,c){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"IsEnabled":this.OnEnabledChanged(c)}},UpdateVisualState:function(){},OnApplyTemplate:function(){},OnEnabledChanged:function(a){this.IsTabStop=a,this.UpdateVisualState()}}),a.hd.BaseTreeViewControl}),define("system/jq.treeview/expand",["hdmain/jq","system/jq.treeview/basetreeviewcontrol","hdmain/system"],function(a,b,c){var d=a.proxy,e="hd-img hd-lin-b",f="hd-img hd-mns-b",g="hd-img hd-pls-b";return a.widget("hd.Expand",b,{options:{width:11,height:11},_create:function(){this.element.mousedown(d(this.Expand_MouseDown,this))},_setOption:function(b){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"IsExpanded":this.UpdateVisualState()}},UpdateVisualState:function(){this.element.removeClass().addClass(this.options.Visibility==c.Windows.Visibility.Visible?this.options.IsExpanded?f:g:e)},OnApplyTemplate:function(){},Expand_MouseDown:function(a){1==a.which&&this.options.IsEnabled&&this._setOption("IsExpanded",!this.options.IsExpanded)}}),a.hd.Expand}),define("system/observablecollection",["hdmain/jq"],function(a){function b(a,b,c,d){this.Action=a,this.NewItems=[b],this.NewStartingIndex=d,this.OldItems=[c],this.OldStartingIndex=d}function c(){this.c=[]}var d="CollectionChanged",e={Add:"Add",Remove:"Remove",Replace:"Replace",Reset:"Reset"};return c.prototype={OnCollectionChanged:function(b){return a(this).on(d,b),this},OnPropertyChanged:function(b){return a(this).on("PropertyChanged",b),this},get:function(a){return this.c[a]},Add:function(c){this.c.push(c),a(this).trigger(d,new b(e.Add,c,null,this.c.length-1))},Clear:function(){this.c=[],a(this).trigger(d)},Count:function(){return this.c.length},Insert:function(c,f){this.c.splice(c,0,f),a(this).trigger(d,new b(e.Add,f,null,c))},RemoveAt:function(c){a(this).trigger(d,new b(e.Remove,null,this.c.splice(c,1),c))},Last:function(){return this.c.length>0?this.c[this.c.length-1]:null},IndexOf:function(a){return this.c.indexOf(a)},GetItemType:function(){return this.c.length>0?typeof this.c[0]:null}},c}),define("system/jq.treeview/treeeventargs",[],function(a){function b(b){b===a?(this.ID="",this.Copy=!1):(this.ID=b,this.Source=null,this.Target=null,this.Copy=!1)}return b}),define("system/jq.treeview/node",["hd","hdmain/jq","system/jq.treeview/basetreeviewcontrol","system/jq.treeview/expand","hdmain/system","system/observablecollection","system/jq.treeview/treeeventargs"],function(a,b,c,d,e,f,g){function h(){0==this._childrenToLoad&&this.element.trigger("NodeExpanded",new g(this.options.ID))}function i(){var a=this.options,b=a[s]&&a.IconExpanded.length>0?a.IconExpanded:a.Icon,c=a[s]&&null!=a.IconExpandedContent?a.IconExpandedContent:a.IconContent;b.length>0?this.ElementIcon.removeClass().addClass(b):null!=c&&this.ElementIcon.removeClass().addClass(c)}function j(a){null!=this.element&&(a?this.ElementChildren.show():this.ElementChildren.hide("slide"))}function k(){var a=new g(this.options.ID);this.element.trigger("PopulateChildren",a),this.SyncChildren(),this._setOption("ChildrenLoaded",!0)}function l(){if(this.element.prevAll("li").removeClass().addClass(y),this.element.nextAll("li").length>0)this.element.removeClass().addClass(y);else{this.element.removeClass();var a=this.element.children("ins").attr("class");"string"==typeof a&&(a+=" ",a=a.replace(/-m /,"-b "),this.element.children("ins").attr("class",a))}this.element.children("ul").children("li").each(function(){l.call(e.Cast(b(this),r))})}function m(){l.call(this)}function n(){this.SyncChildren()}function o(){var a=this.options;a[t]&&(a[s]?this.Collapse():this.Expand())}function p(){this._childrenToLoad--,this._childrenToLoad<=0&&(this._childrenToLoad=0,h.call(this))}var q=b.proxy,r="Node",s="IsExpanded",t="IsEnabled",u="HasChildren",v=e.Windows.Visibility,w="NodeChildTemplateApplied",x="mousedown",y="hd-lin-s";return b.widget("hd."+r,c,{options:{IsExpanded:!1,HasChildren:!1,IsEnabled:!0,Icon:"",IconExpanded:"",IsLabel:!1,TemplateApplied:!1,ChildrenLoaded:!1,IsBusy:!1},HasChildren:function(){return this.Nodes.Count()>0?!0:this.options[u]},_create:function(){this.ElementExpand=b('<ins class="hd-img "></ins>').Expand().appendTo(this.element).on("click",q(o,this)),this.element.is("div")&&this.ElementExpand.hide(),this.element.is("li")&&(this.element.addClass(y),this.Line=this.ElementExpand,this.Link=b("<a/>").appendTo(this.element),this.ElementIcon=b("<ins/>").appendTo(this.Link),this.ElementText=b("<span class='hd-ol-entry' />").appendTo(this.Link)),this.Nodes=(new f).OnCollectionChanged(q(n,this)),this.ElementChildren=b("<ul>").appendTo(this.element),this.element.is("li")&&this.ElementChildren.hide(),this.element.on("ApplyTemplate",q(this.OnApplyTemplate,this)).on("SizeChanged",q(m,this)),this.option(this.options)},_setOption:function(a,c){b.Widget.prototype._setOption.apply(this,arguments);var d=this.options;switch(a){case u:this.element.children("ins").removeClass().addClass("hd-img hd-lin-m"),c||(d.ChildrenLoaded=!1),this.UpdateVisualState();break;case t:this.element.find(".hd-ol-entry").toggleClass("hd-ol-entry-d",!c);break;case"IsSelected":this.UpdateVisualState();break;case"IconContent":d.Icon=c,this.ElementIcon.removeClass().addClass(c),this.UpdateVisualState();break;case"Title":this.UpdateVisualState()}},Expand:function(){var a=this.options,b=new g(a.ID);this!=this.Base&&!a[s]&&this.HasChildren()&&(b.Source=this,this.element.trigger("NodeExpand",b),b.Cancel||(this._setOption(s,!0),a.ChildrenLoaded?h.call(this):k.call(this),j.call(this,!0),this.element.trigger("NodeStateChange",{}),i.call(this),this.UpdateVisualState()))},Collapse:function(){this!=this.Base&&(this._setOption(s,!1),null!=this.element&&(j.call(this,!1),this.HasChildren()&&(this.element.trigger("NodeClosed",new g),this.element.trigger("NodeStateChange",{}))),i.call(this),this.UpdateVisualState())},Get:function(a){var b,c,d=null;for(b=0;b<this.Nodes.Count();b++){if(c=this.Nodes.get(b),c.InterviewTreeNode("option","ID")==a){d=c;break}if(d=c.InterviewTreeNode("Get",a),null!=d)break}return d},SyncChildren:function(){var a,b,c,d=this.Nodes.Count();for(a=0;d>a;a++)c=this.Nodes.get(a),c.Base=this.Base,c.ParentNode=this;for(0==this.HasChildren()&&d>0?this._setOption(u,!0):0==d&&this._setOption(u,!1),this.ElementChildren.children().detach(),this._childrenToLoad=0,a=0;d>a;a++)b=e.Cast(this.Nodes.get(a),r),b.options.TemplateApplied||(b.element.off(w,p).on(w,q(p,this)),this._childrenToLoad++),b.element.appendTo(this.ElementChildren),b.options.TemplateApplied||b.element.trigger("ApplyTemplate").trigger("SizeChanged");
this.UpdateVisualState(),this.UpdateVisuals()},UpdateVisualState:function(){var a=this.options;a.IsBusy||this.ElementExpand.Expand({Visibility:this.HasChildren()?v.Visible:v.Collapsed}),this.HasChildren()&&this.ElementExpand.Expand({IsExpanded:a[s]}).css("cursor",a[t]?"pointer":"default"),(a.Icon.length>0||null!=a.IconContent)&&(this.ElementIcon.css("cursor",a[t]&&!a.IsLabel?"pointer":"default"),i.call(this)),null!=a.Title&&this.ElementText.html(a.Title.replace(/</g,"&lt;").replace(/>/g,"&gt;")).attr("title",this.ElementText.text())},UpdateVisuals:function(){l.call(this)},OnApplyTemplate:function(){var a=this.element,c=this.options;a.children("a").off(x).on(x,a,q(function(a){b(a.data).closest("div").trigger("NodeClick",a.data)},this)),this.UpdateVisualState(),c.TemplateApplied=!0,this.element.trigger(w),c[s]&&(i.call(this),this.UpdateVisualState())}}),b.hd[r]}),define("system/jq.treeview/tree",["hd","hdmain/jq","system/jq.treeview/node","hdmain/system"],function(a,b,c,d,e){return b.widget("hd.Tree",c,{_create:function(){c.prototype._create.apply(this),this._selected=null,this.element.on("PopulateChildren",b.proxy(this.RaisePopulate,this))},_setOption:function(a,b){switch(c.prototype._setOption.apply(this,arguments),a){case"NodeClick":this.element.on(a,b)}},Selected:function(a){return a===e?this._selected:(this.ClearSelected(),this._selected=a,null!=this._selected&&(d.Cast(this._selected,"Node")._setOption("IsSelected",!0),this._selected.find(".hd-ol-entry:first").attr("id","hdOutlineCurrent").scrollintoview({direction:"vertical"})),void 0)},ClearSelected:function(){this.ElementChildren.find("#hdOutlineCurrent").removeAttr("id")},RaisePopulate:function(a,b){this.element.trigger("Populate",a,b)}}),b.hd.Tree}),define("dialog/stringformatter",["hdmain/system"],function(a){function b(a,b){this._text=a,this._textWrapping=b}return a.ExtendClass(b,null,{PreParse:function(){},PostParse:function(){},WriteText:function(a,b){this._text.Append(b)},WriteLineBreak:function(){this._text.Append(this._textWrapping==a.Windows.TextWrapping.NoWrap?" ":"\n")},WriteWebLink:function(a,b,c){this._text.Append(c)}}),b}),define("engine/stringparsersource",["hdmain/system"],function(a){function b(a){this._text=a}return a.ExtendClass(b,null,{SourceString:function(){return this._text}}),b}),define("engine/interviewnodeoutlinefontflags",{None:0,Bold:1,Italic:2,Underline:4}),define("engine/answeredstatus",{Unanswered:0,PartiallyAnswered:1,Answered:2}),define("engine/interviewnodetype",{Root:0,Dialog:1,DefaultDialog:2,Repeat:3,Iteration:4}),define("engine/dialogupdateflags",[],function(){var a={None:0,UserAnswer:1,ScriptAnswer:2,RequiredAnswer:4,RepeatAnswer:8,Gray:16,Hidden:32,Required:64,set:128,AddClear:256,Prompt:512,Title:1024,NodeTitle:2048,ChildCount:4096,NodeChildCount:8192,NewlyAdded:16384,NodeNewlyAdded:32768,AnsweredStatus:65536,NodeAnsStatus:131072,NodeRequired:262144,NodeEnabled:524288,Progress:1048576,AddButtonRefresh:2097152,NodeError:4194304,HasError:8388608,All:2147483647};return a.AnswerRelated=a.UserAnswer|a.ScriptAnswer|a.RequiredAnswer|a.RepeatAnswer|a.HasError,a.StatusRelated=a.NodeAnsStatus|a.NodeRequired|a.NodeError|a.NodeEnabled|a.Progress,a.OutlineRelated=a.StatusRelated|a.NodeTitle|a.NodeChildCount,a.DialogContentRelated=a.ScriptAnswer|a.RequiredAnswer|a.RepeatAnswer|a.Gray|a.Hidden|a.Required|a.set|a.AddClear|a.Prompt,a.DialogRelated=a.DialogContentRelated|a.Title|a.AddButtonRefresh|a.HasError,a.SinglePageRelated=a.DialogRelated|a.ChildCount,a.AllOutlineRelated=a.OutlineRelated|a.NodeNewlyAdded,a.AllDialogRelated=a.AnswerRelated|a.DialogRelated|a.ChildCount|a.NewlyAdded|a.AnsweredStatus,a}),define("dialog/tracehelper",["hd","hdmain/system"],function(a,b,c){b.String.Format;return this.DEBUG===c&&(this.DEBUG=a.DEBUG),{WriteLine:function(){},Focus:function(){}}}),define("dialog/builtinnavigationbarbuttonstate",["hdmain/system"],function(a,b){function c(a){this.ImageName(a),this.IsImageDefault=!0,this.Visible=!0}return a.ExtendClass(c,null,{ImageName:function(a){return a===b?this._imageName:(a!=this._imageName&&(this._imageName=a,this.IsImageDefault=!1),void 0)}}),c}),define("engine/pairedcode",{b:0,i:1,st:2,un:3,sc:4,fs:5,ac:6,lc:7,h:8,p:9,wl:10}),define("engine/htmlformatter",["hdmain/system","hdmain/jq","engine/pairedcode"],function(a,b,c){function d(a){this._text=a}function e(a){var b=a.substr(11);return b.indexOf("+")>=0&&(b=/%\d{2}?/.test(b)?/\x20|%20/.test(b)?b.replace("+","%2B"):b.replace(/\+/g,"%20"):b.replace(/\+/g,"%2B")),b=b.replace(/\x27/g,"%27").replace(/\x22/g,"%22"),b=b.replace(/\&#39;/g,"%27").replace(/\&quot;/g,"%22"),"javascript:"+b}function f(a,b){var c=d.MakeAbsoluteUrl(a,!0);return 0==c.indexOf("javascript:")?"HDAPI._DoWebLinkAction('"+c+"')":(a=c.replace(/\x27/g,"\\'"),"window.open('"+a+"', '_blank'"+(g(b)?"":", '"+b+"'")+"); return false;")}var g=a.String.IsNullOrEmpty;return a.ExtendClass(d,null,{PreParse:function(){},PostParse:function(){},WriteText:function(a,b){var d,e="";a.IsCodeEnabled(c.b)&&(e+="font-weight:bold; "),a.IsCodeEnabled(c.i)&&(e+="font-style:italic; "),a.IsCodeEnabled(c.st)&&(e+="text-decoration:line-through; "),a.IsCodeEnabled(c.un)&&(e+="text-decoration:underline; "),a.IsCodeEnabled(c.sc)&&(e+="font-variant:small-caps; "),a.IsCodeEnabled(c.fs)&&(d=a.ChangeFontSize(100),e+="font-size:"+d.toString()+"%; "),e.length>0&&(this._text.Append('<span style="'),this._text.Append(e),this._text.Append('">'));for(var f=0;f<b.length&&" "==b[f];f++)b=b.substr(0,f)+"&#160;"+b.substr(f+1),f+=5;b=b.replace("	","&#160;&#160;&#160;&#160;"),this._text.Append(b),e.length>0&&this._text.Append("</span>")},WriteLineBreak:function(){this._text.Append("<br/>")},WriteWebLink:function(a,b,c){this._text.Append('<a href="#" class="dot-w" '),this._text.Append('onclick="javascript:'),this._text.Append(f(b,null)),this._text.Append('">'),this.WriteText(a,c),this._text.Append("</a>")}},{MakeAbsoluteUrl:function(a,b){0==a.toLowerCase().indexOf("javascript:")&&(a=e(a));var c,d,f=a;return/^\w+:/.test(f)?f:(d=b&&"string"==typeof HDBaseURLForLinks?HDBaseURLForLinks:null,c=g(d)?"":d,c+f)}}),d}),define("dialog/navigationuistate",["hd","dialog/builtinnavigationbarbuttonstate","engine/htmlformatter"],function(a,b,c,d){this.DEBUG===d&&(this.DEBUG=a.DEBUG);var e,f={FirstButtonName:"First",PreviousUnansweredButtonName:"PreviousUnanswered",PreviousButtonName:"Previous",NextButtonName:"Next",NextUnansweredButtonName:"NextUnanswered",LastButtonName:"Last",FinishButtonName:"Finish",FinishPopupButtonName:"FinishPopup",SetDefaultButton:function(a,c){e[a]=new b(c)},IsValidBuiltInButtonInternalName:function(a){switch(a){case this.FirstButtonName:case this.PreviousUnansweredButtonName:case this.PreviousButtonName:case this.NextButtonName:case this.NextUnansweredButtonName:case this.LastButtonName:case this.FinishButtonName:case this.FinishPopupButtonName:return!0}return!1},GetBuiltInButtonInternalName:function(a){switch(a){case"HDFirstPage":return this.FirstButtonName;case"HDPrevUnans":return this.PreviousUnansweredButtonName;case"HDPrevPage":return this.PreviousButtonName;case"HDNextPage":return this.NextButtonName;case"HDNextUnans":return this.NextUnansweredButtonName;case"HDLastPage":return this.LastButtonName;case"HDFinish":return this.FinishButtonName;case"HDFinishPopup":return this.FinishPopupButtonName;default:return""}},SetBuiltInButtonVisible:function(a,b){e[a].Visible=b},GetBuiltInButtonVisible:function(a){var b=e[a];return b!==d?b.Visible:!1},IsBuiltInButtonUsingDefaultImage:function(a){var b=e[a];return b!==d?b.IsImageDefault:!1},SetBuiltInButtonImage:function(a,b){e[a].ImageName(b)},GetBuiltInButtonImage:function(a){var b=e[a];return b!==d?b.ImageName():""},MakeBuiltInButtonImageUri:function(a){var b=e[a];return b!==d?b.IsImageDefault?b.ImageName():c.MakeAbsoluteUrl(b.ImageName(),!1):null}};return f.NavigationbarVisible=!0,e={},f.SetDefaultButton(f.FirstButtonName,"hd-nav-First"),f.SetDefaultButton(f.PreviousUnansweredButtonName,"hd-nav-PrevU"),f.SetDefaultButton(f.PreviousButtonName,"hd-nav-Prev"),f.SetDefaultButton(f.NextButtonName,"hd-nav-Next"),f.SetDefaultButton(f.NextUnansweredButtonName,"hd-nav-NextU"),f.SetDefaultButton(f.LastButtonName,"hd-nav-Last"),f.SetDefaultButton(f.FinishButtonName,"hd-nav-Finish"),f.SetDefaultButton(f.FinishPopupButtonName,"hd-nav-FinishEM"),f}),define("engine/fontsizechange",[],function(){function a(a,b){this.Direction=a,this.Amount=b}return a}),define("engine/listpunctuation",["hd","hdmain/system"],function(a,b,c){function d(a,c){var d,h;for(this._codeIndex=0,this._part=new b.Text.StringBuilder,d=0;i>d;d++)this._part[d]=new b.Text.StringBuilder;if(this._codeCount=c,!e(a))for(h=0,d=0;d<a.length;d++)h<g.length&&a[d].toUpperCase()==g[h]?h++:this._part[h].Append(a[d]);this._mid1Len=this._part[f.MidPart1].Length,this._mid2Len=this._part[f.MidPart2].Length,this._mid1Char=this._mid1Len>0?this._part[f.MidPart1].s[0]:"x",this._mid2Char=this._mid2Len>0?this._part[f.MidPart2].s[0]:"x"}this.DEBUG===c&&(this.DEBUG=a.DEBUG);var e=b.String.IsNullOrEmpty,f={PrePart:0,MidPart1:1,MidPart2:2,PostPart:3},g="ABC",h=",;:/.-",i=f.PostPart+1;return b.ExtendClass(d,null,{IncrementCodeIndex:function(){this._codeIndex<this._codeCount&&this._codeIndex++},CodeCount:function(a){return a===c?this._codeCount:(this._codeCount=a,void 0)},GetPrePart:function(){return this._part[f.PrePart].ToString()},GetPunctuation:function(){if(this._codeCount<=0||this._codeIndex>=this._codeCount)return"";var a;return this._codeIndex==this._codeCount-1?a=this._part[f.PostPart].ToString():this._codeIndex==this._codeCount-2?(a=this._part[this._mid2Len>0?f.MidPart2:f.MidPart1].ToString(),2==this._codeCount&&this._mid2Len>0&&a.length>=3&&h.indexOf(a[0])>=0&&this._mid1Len<3&&(a=a.substr(1,a.length-1))):a=this._mid1Len<3||h.indexOf(this._mid1Char)<0||this._mid2Len>0?this._part[f.MidPart1].ToString():this._part[f.MidPart1].ToString().substring(0,2),a}}),d}),define("engine/changedirection",{Increase:0,Decrease:1}),define("engine/dotcodeparser",["hd","hdmain/jq","hdmain/system","hdmain/stack","engine/pairedcode","engine/fontsizechange","engine/listpunctuation","engine/changedirection"],function(a,b,c,d,e,f,g,h,i){function j(a){return a.replace(/^\s+/,"")}function k(a,c){if(a=b.trim(a),c!==i){for(;b.inArray(a[0],c)>=0;)a=a.substr(1);for(;b.inArray(a[a.length-1],c)>=0;)a=a.substr(0,a.length-1)}return a}function l(a){return/\s/.test(a)}function m(a){return/^[a-zA-Z]+$/.test(a)}function n(){}function o(a){return C[a]>0}function p(a,b){r.call(this,a),t(b)}function q(a,b){r.call(this,a),u(b)}function r(a){B.length>0&&(a.WriteText(this,B),B="")}function s(a,b,c,d){if(c-b>0){if(!o(e.h))if(o(e.ac))B+=a.substr(b,c-b).toUpperCase();else if(o(e.lc))for(var f=b;c>f;f++)l(a[f])?(d.v=!0,B+=a[f]):d.v?(B+=a[f].toUpperCase(),d.v=!1):B+=a[f];else B+=a.substr(b,c-b);B.length>0&&(d.v=l(B[B.length-1]))}}function t(a){C[a]=C[a]+1}function u(a){C[a]>0&&(C[a]=C[a]-1)}function v(a,b){B+=a,b.v=l(a)}function w(a,c){for(var d,e,f,g,h,i=0,k=1,m=!1,n=a.indexOf(z,c);!m&&n>=0;){if(n<a.length-1&&a[n+1]==z)c=n+2;else if(d=a.indexOf(A,++n),0>d)c=n;else{for(e=b.trim(a.substr(n,d-n)),f=0;f<e.length&&!l(e[f]);f++);switch(g=e.substr(0,f),c=d+1,g){case".p":h=f<e.length?j(e.substr(f,e.length-f)):null,x(h)?1==k&&++i:++k;break;case".pe":k>1?--k:m=!0}}n=a.indexOf(z,c)}return i}var x=c.String.IsNullOrEmpty;this.DEBUG===i&&(this.DEBUG=a.DEBUG);var y=e.wl+1,z="Â«",A="Â»",B="",C=[],D=new d,E=new d,F="";return c.ExtendClass(n,null,{IsCodeEnabled:o,ChangeFontSize:function(a){return D.Peek().Direction==h.Increase?a*=1+D.Peek().Amount/100:a-=a*D.Peek().Amount/100,a},FontSizeChange:function(){return D.Peek()},Parse:function(c,d,i){var n,G,H,I,J,K,L,M,N,O,P,Q,R;for("boolean"!=typeof i&&(i=!0),B="",n=0;y>n;n++)C[n]=0;for(D.Clear(),E.Clear(),G=c.SourceString(),G.indexOf("\\t")>=0&&(G=G.replace(/\\t/g,"Â«.tcÂ»")),G.indexOf("\\r")>=0&&(G=G.replace(/\\r/g,"Â«.lbÂ»")),G=G.replace(/%%lt%%/g,"&lt;"),G=G.replace(/%%gt%%/g,"&gt;"),i&&(G=G.replace(/</g,"&lt;"),G=G.replace(/>/g,"&gt;")),d.PreParse(this),H=[z,"\r"],B="",I={v:!0},J=0,K=a.IndexOfAny(G,H,J);K>=0;){if(s.call(this,G,J,K,I),"\r"==G[K])o(e.wl)?B+=" ":(r.call(this,d),d.WriteLineBreak()),J=K<G.length-1&&"\n"==G[K+1]?K+2:K+1,I=!0;else if(K<G.length-1&&G[K+1]==z)v(z,I),J=K+2;else if(L=G.indexOf(A,++K),0>L)J=K;else{for(M=k(G.substr(K,L-K)),n=0;n<M.length&&!l(M[n]);n++);if(N=M.substr(0,n),O=n<M.length?j(M.substr(n,M.length-n)):null,J=L+1,!o(e.wl)||".we"==N)switch(N){case".b":p.call(this,d,e.b);break;case".i":p.call(this,d,e.i);break;case".x":p.call(this,d,e.st);break;case".u":p.call(this,d,e.un);break;case".s":p.call(this,d,e.sc);break;case".z":p.call(this,d,e.fs),!x(O)&&O.length>=2&&("+"==O[0]||"-"==O[0])&&(P=parseInt(O.substr(1,O.length-1)),isNaN(P)||D.Push(new f("+"==O[0]?h.Increase:h.Decrease,P)));break;case".be":q.call(this,d,e.b);break;case".ie":q.call(this,d,e.i);break;case".xe":q.call(this,d,e.st);break;case".ue":q.call(this,d,e.un);break;case".se":q.call(this,d,e.sc);break;case".ze":q.call(this,d,e.fs),D.Count()>0&&D.Pop();break;case".h":t(e.h);break;case".a":t(e.ac);break;case".l":t(e.lc);break;case".he":u(e.h);break;case".ae":u(e.ac);break;case".le":u(e.lc);break;case".an":for(n=J;n<G.length&&l(G[n]);n++);n<G.length&&(B+="aeiou".indexOf(G[n].toLowerCase())>=0?"an":"a"),B+=G.substr(J,n-J),B.length>0&&(I=l(B[B.length-1])),J=n;break;case".c":J<G.length&&m(G[J])&&v(G[J++].toUpperCase(),I);break;case".la":v("â",I);break;case".ra":v("â",I);break;case".lq":v("â",I);break;case".rq":v("â",I);break;case".ps":v("Â¶",I);break;case".ss":v("Â§",I);break;case".tc":v("&#160;&#160;&#160;&#160;&#160;",I);break;case".ns":v("Â ",I);break;case".nh":v("â",I);break;case".oh":v("Â­",I);break;case".":case",":case";":case":":case"!":case"?":for(n=Math.min(J,G.length-1);n>=0&&G[n]!=z;n--);n>0&&(Q=B,".,:;?!".indexOf(Q[Q.length-1])<0&&(B+=N,I=!1));break;case".lb":case".pm":case".pb":r.call(this,d),d.WriteLineBreak(),I=!0;break;case".w":x(O)||(F=k(O,['"']),x(F)||p.call(this,d,e.wl));break;case".we":o(e.wl)&&(B.length>0&&(d.WriteWebLink(this,F,B),B=""),u(e.wl));break;case".p":x(O)?E.Count()>0&&(R=E.Peek().GetPunctuation(),x(R)||(B+=R,I=l(B[B.length-1])),E.Peek().IncrementCodeIndex()):E.Push(new g(O.replace(/^["]/,"").replace(/["]$/,""),w(G,J)));break;case".pe":E.Count()>0&&E.Pop()}}for(K=-1,n=J;n<G.length;n++)if(b.inArray(G[n],H)>=0){K=n;break}}s.call(this,G,J,G.length,I),r.call(this,d),d.PostParse(this)}}),n}),define("runtime/numbervalidationresult",{Valid:0,ErrorNotANumber:1,ErrorTooBig:2,ErrorTooSmall:3,ErrorOutOfRange:4}),define("engine/datasourceloadresult",[],function(){function a(a,b,c){this.Nodes=a,this.Rows=b,this.Error=c}return a}),define("system/exception/invalidoperationexception",["hd","hdmain/system","system/exception/systemexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("engine/formattingcontext",{PlainText:0,OutlineText:1,RichText:2}),define("system/exception/notimplementedexception",["hd","hdmain/system","system/exception/systemexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("engine/dotcode",["system/exception/notimplementedexception","engine/formattingcontext","engine/interviewnodeoutlinefontflags"],function(a,b,c){function d(a,d,e){return a?a.indexOf("Â«")<0?a:(d==b.PlainText?a=g.PreProcessForPlainText(a):d==b.OutlineText&&(e.val=c.None,a=g.PreProcessForOutlineText(a,e)),a):""}function e(b,d,e){if(e=c.None,b.indexOf("Â«")<0)return b;throw new a}function f(a,b){a=a.replace(/Â«Â«/gi,"{{FQ}}");for(var d,e=0,f=0,g=0,h=/Â«\s*\.(\w{1,2})\b\s*([^Â»]*)Â»/g,i=h.exec(a);null!=i;){if(3==i.length){switch(d=!0,i[1].toLowerCase()){case"b":e++;break;case"be":e--;break;case"i":f++;break;case"ie":f--;break;case"u":g++;break;case"ue":g--;break;case"f":break;case"fe":break;case"h":break;case"he":break;case"s":break;case"se":break;case"w":break;case"we":break;case"x":break;case"xe":break;case"z":break;case"ze":break;default:d=!1}d&&(a=a.substr(0,i.index)+a.substr(i.index+i[0].length),h.lastIndex=i.index)}i=h.exec(a)}return b&&(b.val=c.None,e>0&&(b.val|=c.Bold),f>0&&(b.val|=c.Italic),g>0&&(b.val|=c.Underline)),a=a.replace(/{{FQ}}/gi,"Â«")}var g={DefaultProcessor:d,HTMLProcessor:e,PreProcessForPlainText:function(a){return f(a)},PreProcessForOutlineText:function(a,b){return f(a,b)}};return g}),define("system/exception/ArgumentNullException",["hd","hdmain/system","system/exception/argumentexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("engine/answeredstatustabulator",["hdmain/system","engine/answeredstatus"],function(a,b){function c(){this._flags=0,this._explicitlyAnswered=0,this._implicitlyAnswered=0,this._unanswered=0}function d(a,b){a._explicitlyAnswered+=b._explicitlyAnswered,a._implicitlyAnswered+=b._implicitlyAnswered,a._flags|=b._flags&(e.O|e.I),b._unanswered>0&&(a._unanswered+=b._unanswered,b.IsUnansweredRequired()&&(a._flags|=e.D))}var e={N:0,O:1,I:2,R:4,D:8,E:16,DE:32};return a.ExtendClass(c,null,{Reset:function(){this._flags=0,this._explicitlyAnswered=this._implicitlyAnswered=this._unanswered=0},IncAnswered:function(a,b,c){a||b?c?this._implicitlyAnswered++:this._explicitlyAnswered++:this._flags|=c?e.I:e.O},IncUnanswered:function(a,b){(a||b)&&(this._unanswered++,b&&(this._flags|=e.R))},SetError:function(){this._flags|=e.E},ClearRequired:function(){this._flags&=~e.R},ClearError:function(){this._flags&=~e.E},IsAnswered:function(){return this._explicitlyAnswered>0||0!=(this._flags&e.O)},Status:function(){return 0==this._unanswered?b.Answered:this._explicitlyAnswered>0||this._implicitlyAnswered>0||0!=(this._flags&(e.O|e.I))?b.PartiallyAnswered:b.Unanswered},IsAllAnswered:function(){return 0==this._unanswered},IsAllWantedAnswered:function(a){if(this.IsAllAnswered())return!0;var b,c;for(b=0;b<a._itemNodes.Count();b++)if(c=a._itemNodes.get(b),!c.NoneOfTheAbove()&&!c.IsAnswered()&&c.WantsAnswer())return!1;return!0},IsUnansweredRequired:function(){return 0!=(this._flags&(e.R|e.D))},IsThisUnansweredRequired:function(){return 0!=(this._flags&e.R)},IsHasErrorText:function(){return 0!=(this._flags&(e.E|e.DE))},IsThisHasErrorText:function(){return 0!=(this._flags&e.E)},UnansweredCount:function(){return this._unanswered},AnsweredCount:function(){return this._explicitlyAnswered+this._implicitlyAnswered},TotalCount:function(){return this.AnsweredCount()+this.UnansweredCount()}},{Aggregate:d}),c}),define("engine/interviewnodelist",["hd","hdmain/jq","hdmain/system","engine/interviewnodetype","engine/dialogupdateflags"],function(a,b,c,d,e,f){function g(a){this._list=[],this._parent=a,this._updatedCount=0}return this.DEBUG===f&&(this.DEBUG=a.DEBUG),c.ExtendClass(g,null,{FindExisting:function(a,b,c,d){for(var e=null,f=this._updatedCount;f<this._list.length&&(this._list[f].Variable().name!=a||this._list[f].Owner()!=c||this._list[f].TemplateOfOrigin()!=d);)f++;return f<this._list.length&&(e=this._list[f],!1),e},PrepareToUpdate:function(a){"number"==typeof a?this._updatedCount=a:(this._updatedCount=b.inArray(a,this._list),!1)},FinishUpdating:function(){this._updatedCount=this._list.length},IndexOf:function(a,b,c){if("object"==typeof a){if(b)return this._list.IndexOf(a,b,c);for(var d=0;d<this._list.length;d++)if(this._list[d]==a)return d}else if("string"==typeof a){var e=b?b.name:null;for(d=0;d<this._list.length;d++){var f=this._list[d];if(f.Variable().name==a&&(!e||f._template.name==e))return d}}return-1},IndexOfID:function(a){var b,c=Count;for(b=0;c>b;b++)if(this._list[b]._id==a)return b;return-1},get:function(a,b){return"number"==typeof a?this._list[a]:(a=this.IndexOf(a,b),a>=0?this._list[a]:null)},Add:function(a){(this._updatedCount==this.Count()||this.get(this._updatedCount)!=a)&&(this._list.splice(this._updatedCount,0,a),a.SetUpdateFlags(e.NewlyAdded|e.ScriptAnswer),a.NotifyParentOfChildCountChange(!1)),this._parent.Type()==d.Root?this._updatedCount>0&&!this._list[this._updatedCount-1].Enabled()&&a.Enabled(!1):this._parent.Enabled()||a.Enabled(!1),this._updatedCount++,a.SendUpdateFlagsUpstream(e.All,!1)},Insert:function(a,b){var c;if(this._list.splice(a,0,b),this._parent.Type()==d.Repeat)for(c=a+1;c<this._list.length;c++)this._list[c].OffsetIndex(1,b.Indices().length-1);b.SetUpdateFlags(e.NewlyAdded),b.NotifyParentOfChildCountChange(!1),this._updatedCount++,b.SendUpdateFlagsUpstream(e.All,!1)},Move:function(a,b){var c=this._list[a];if(this._list.splice(a,1),this._list.splice(b,0,c),c.NotifyParentOfChildCountChange(!1),this._parent.Type()==d.Repeat){this._list[b].OffsetIndex(b-a,c.Indices().length-1);for(var e=b>a?-1:1,f=b+e;f!=a+e;f+=e)this._list[f].OffsetIndex(e,c.Indices().length-1)}},Remove:function(a){if(null==a)return!1;var b=this.IndexOf(a);return-1==b?!1:(this.RemoveAt(b),!0)},RemoveAt:function(a){var b,c={startIndex:0,endIndex:0},e=this._list[a],f=e.Indices().length-1;for(e.Children().Clear(),e.FindNodesAskedImplicitly(c);c.startIndex<c.endIndex;)this._parent._interview.Root().Children().RemoveAt(c.startIndex),c.endIndex--;if(e.NotifyParentOfChildCountChange(!1),e.Type()!=d.Repeat&&this._parent._interview.UnregisterNode(e),this._list.splice(a,1),this._parent.Type()==d.Repeat)for(b=a;b<this._list.length;b++)this._list[b].OffsetIndex(-1,f);a<this._updatedCount&&this._updatedCount--},RemoveUntil:function(a){for(;this._list[this._updatedCount]!=a;)this.RemoveAt(this._updatedCount)},Trim:function(){for(;this._updatedCount<this._list.length;)this.RemoveAt(this._list.length-1)},TrimUnanswered:function(){for(;this._updatedCount>0&&!this._list[this._updatedCount-1].AnsStatus().IsAnswered();)this._updatedCount--,this._parent._interview.DecRpt()},Clear:function(){for(;this._list.length>0;)this.RemoveAt(this._list.length-1);this.ClearUpdated()},ClearUpdated:function(){this._updatedCount=0},Contains:function(a){return this.IndexOf(a)>=0},CopyTo:function(a,b){for(var c=0;c<this._list.length;c++)a.splice(b+c,0,this._list[c])},Count:function(){return this._list.length},UpdatedCount:function(){return this._updatedCount},IsReadOnly:function(){return!1},toString:function(){var a=this.Count();return c.String.Format("{0} child{1} of {2}",a.toString(),1==a?"":"ren",this._parent.toString())}}),g}),define("engine/baseinterviewnode",["hd","hdmain/system","system/exception/notimplementedexception","system/exception/ArgumentNullException","engine/answeredstatustabulator","engine/interviewnodetype","engine/dialogupdateflags","require","engine/interviewnodelist","hdmain/jq"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b,c){switch(this._interview=a,this._type=b,this._parent=c,this._updateFlags=g.None,this._descendantUpdateFlags=g.None,this._answeredStatus=new e,this._enabled=!0,b){case f.DefaultDialog:this._children=h("engine/defaultdialognode")._emptyChildren();break;case f.Repeat:this._children=new i(this,8);break;default:this._children=new i(this)}}function m(){var a;return a=this.Type()==f.Root?[]:m.call(this._parent),a.push(this),a}function n(a){a.WriteStartElement(b.Enum.GetName(f,this._type))}function o(a){a.WriteEndElement()}var p=b.Cast,q=b.String.IsNullOrEmpty;return b.ExtendClass(l,null,{DoAnswerSync:function(){this._interview.DoAnswerSync()},InitializeId:function(){this._id=this._interview.GetIdForNode(this)},Enabled:function(a){return a===k?this._enabled:(this._enabled!=a&&(this._enabled=a,this.SetUpdateFlags(g.NodeEnabled)),void 0)},InitUpdate:function(){this._children.ClearUpdated()},GetResourceString:function(b){return a.Lc.GetStr(b)},GetResourceButtonCaption:function(){var b=this._interview.PreferenceCache().ResourceButtonText();return q(b)&&(b=a.Lc.GetStr("rs_bcap")),b},InterviewImageUrl:function(){return this._interview._engine.InterviewImageUrl()},SinglePageMode:function(){return this._interview.IsSinglePage()},UpdateFlags:function(){return this._updateFlags},DescendantUpdateflags:function(){return this._descendantUpdateFlags},SetUpdateFlags:function(a){var b,c;this._updateFlags|=a,this._type==f.Repeat&&(b=a&(g.RepeatAnswer|g.ChildCount|g.NodeChildCount),0!=b&&this.SetDescendantUpdateFlags(b,!1)),c=g.AnswerRelated,this._interview.InRebuild()||(c|=g.NodeChildCount|g.ChildCount,this.SinglePageMode()&&(c|=g.AddButtonRefresh)),0!=(a&c)&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(a&c,!0)},SetUpdateFlagsCascading:function(a){var b,c;for(b=0;b<this._children.Count();b++)c=this._children.get(b),0!=(a&(g.NodeChildCount|g.ChildCount))?c.Children().Count()>0?c.SetUpdateFlagsCascading(a):c.SetUpdateFlagsCascading(a^(g.NodeChildCount|g.ChildCount)):c.SetUpdateFlagsCascading(a);this.SetUpdateFlags(a)},NotifyParentOfChildCountChange:function(a){null!=this._parent&&(this._parent.Type()==f.Repeat&&this._parent.SetUpdateFlags(g.RepeatAnswer),this._parent.SetDescendantUpdateFlags(g.NodeChildCount|g.ChildCount,a))},SendUpdateFlagsUpstream:function(a,b){var c=(this._updateFlags|this._descendantUpdateFlags)&a&~g.NewlyAdded;c!=g.None&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(c,b)},SetDescendantUpdateFlags:function(a,b){this._descendantUpdateFlags|=a,b&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(a,!0)},ClearUpdateFlags:function(a){var b,c=a^g.All,d=this.Children();for(this._updateFlags&=c,this._descendantUpdateFlags&=c,b=0;b<d.Count();b++)d.get(b).ClearUpdateFlags(a)},AnsStatus:function(){return this._answeredStatus},NeedsAnsweredStatusUpdate:function(){return 0!=(this._updateFlags&(g.AnswerRelated|g.Required|g.NodeError))||0!=(this._descendantUpdateFlags&(g.StatusRelated|g.AnswerRelated))},UpdateAnsweredStatus:function(a){var b=h("engine/interviewnode");if(a||0!=(this._descendantUpdateFlags&(g.AnswerRelated|g.Required|g.NodeError))||0!=((this._updateFlags|this._descendantUpdateFlags)&g.NodeChildCount)||!this.Enabled()&&null==this._interview.RequiredNode()||this.Enabled()&&null!=this._interview.RequiredNode()||0!=(this._updateFlags&g.AnswerRelated)&&this._type==f.Iteration){var c=this._interview;j.each(this.Children()._list,function(b,d){d.UpdateAnsweredStatus(a||null!=c._reqNodeOld&&null==c.RequiredNode()&&c._reqNodeOld.IsDescendantOf(d))})}this.NeedsAnsweredStatusUpdate()&&this.TabulateAnsweredStatus(),this._answeredStatus.IsThisUnansweredRequired()&&null==this._interview.RequiredNode()?(this._interview.SetRequiredNode(p(this,b)),this.Enabled(!0)):!(null==this._interview.RequiredNode()&&null==this._interview._reqNodeOld||(this.Enabled(null==this._interview.RequiredNode()||this.ContainsDescendant(this._interview.RequiredNode())),this.Active()&&(this!=this._interview._reqNodeOld||null!=this._interview.RequiredNode())||null!=this._interview.RequiredNode()&&this._interview.RequiredNode().Active()||!this._interview.SetRequiredNode(null))),this._answeredStatus.IsThisHasErrorText()&&null==this._interview.ErrorNode()?(this._interview.SetErrorNode(p(this,b)),this.Enabled(!0)):(null!=this._interview.ErrorNode()||null!=this._interview._errNodeOld)&&(this.Enabled(null==this._interview.ErrorNode()||this.ContainsDescendant(this._interview.ErrorNode())),(!this.Active()||this==this._interview._errNodeOld&&null==this._interview.ErrorNode())&&this._interview.SetErrorNode(null)),null!=this._parent&&0!=((this._updateFlags|this._descendantUpdateFlags)&g.StatusRelated)&&this.SendUpdateFlagsUpstream(g.StatusRelated,!1)},DoAnsweredStatusTabulation:function(){throw new c},TabulateAnsweredStatus:function(){var a,b=this._answeredStatus.Status(),c=this._answeredStatus.IsUnansweredRequired(),d=this._answeredStatus.TotalCount(),e=this._answeredStatus.AnsweredCount();this.DoAnsweredStatusTabulation(),a=g.None,(b!=this._answeredStatus.Status()||c!=this._answeredStatus.IsUnansweredRequired())&&(a=g.NodeAnsStatus|g.AnsweredStatus),this._interview.WantProgressNotifications()&&(e!=this._answeredStatus.AnsweredCount()||d!=this._answeredStatus.TotalCount())&&(a|=g.Progress),a!=g.None&&this.SetUpdateFlags(a)},IsDescendantOf:function(a){if(null==a)throw new d("ancestor");if(this.Type()==f.Root)return!1;for(var b=this._parent;null!=b;){if(b==a)return!0;b=b._parent}return!1},ContainsDescendant:function(a){return a.IsDescendantOf(this)},OutlineParent:function(){var a=h("engine/interviewnode");return p(this._parent,a)},Type:function(){return this._type},Children:function(){return this._children},OutlineChildren:function(){return this._children._list},OutlineChildrenReverse:function(){var a,b=[];for(a=this._children.Count()-1;a>=0;a--)b.push(this._children.get(a));return b},New:function(){return!1},IsHiddenNew:function(){return!1},UserExtendible:function(){return!0},NewIterationNode:function(){var a=h("engine/iterationnode"),b=this,c=null;do b.Type()==f.Iteration&&b.New()&&(c=p(b,a)),b=b._parent;while(b.Type()!=f.Root);return c},AllNew:function(){for(var a=!1,b=this;b.Type()!=f.Root;){if(b.Type()==f.Iteration){if(!b.New()){a=!1;break}a=!0}b=b._parent}return a},Active:function(){return!0},AvailableForNavigation:function(){return!1},HasVisibleChildren:function(){var a,b=this.OutlineChildren();for(a=0;a<b.length;a++)if(b[a].ShowInOutline())return!0;return!1},OnSinglePage:function(){return this._parent._type==f.Root?!0:!1},HasAncestorOnSinglePage:function(a){var b,c,d=!1,e=h("engine/interviewnode");if(!this.OnSinglePage()){d=!0,b=this;do b=b._parent;while(null!=b&&!b.OnSinglePage());c=p(b,e),null!=c&&(a.v=c._id)}return d},DirtySinglePage:function(){if(this.OnSinglePage()){this.SetUpdateFlags(g.All);var a,b;for(a=0;a<this._children.Count();a++)b=this._children.get(a),b.DirtySinglePage()}},ComesAfter:function(a){if(null==a)return!1;if(this==a)return!1;for(var b,c,d=h("engine/interviewnode"),e=m.call(this),f=m.call(a),g=1,i=Math.min(e.length,f.length);i>g&&e[g]==f[g];)g++;return g==i?!1:(b=e[g-1].Children().IndexOf(p(e[g],d)),c=f[g-1].Children().IndexOf(p(f[g],d)),b>c)},Serialize:function(a){n.call(this,a),this.SerializeAttributes(a),this.SerializeElements(a),o(a)},SerializeAttributes:function(a){this._enabled||a.WriteAttributeString("Enabled",this._enabled.toString()),this._answeredStatus.IsThisUnansweredRequired()?a.WriteAttributeString("Required","true"):this._answeredStatus.IsUnansweredRequired()&&a.WriteAttributeString("Required","child"),this._answeredStatus.IsThisHasErrorText()?a.WriteAttributeString("ErrorText","true"):this._answeredStatus.IsHasErrorText()&&a.WriteAttributeString("ErrorText","child"),a.WriteAttributeString("Status",this._answeredStatus.Status().toString())},SerializeElements:function(a){var b,c;if(null!=this._children&&(b=this._children.Count(),b>0)){for(a.WriteStartElement("Children"),c=0;b>c;c++)this._children.get(c).Serialize(a);a.WriteEndElement()}},toString:function(){return b.String.Format("{0} Node",this.Type().toString())}}),l}),define("engine/dialogitemnodelist",["hd","hdmain/system","system/exception/argumentexception","engine/dialogupdateflags","require"],function(a,b,c,d,e,f){function g(){this._itemNodes=[],this._itemIndex=[]}return b.ExtendClass(g,null,{Update:function(){var a,b=d.None;for(a=0;a<this._itemNodes.length;a++)b|=this._itemNodes[a].Update();return b},ClearUpdateFlags:function(){for(var a=0;a<this._itemNodes.length;a++)this._itemNodes[a].ClearUpdateFlags()},get:function(a){return"number"==typeof a?this._itemNodes[a]:this._itemIndex[a]},Count:function(){return this._itemNodes.length},Add:function(b,d,g){var h,i=e("engine/dialogitemnode"),j=new i(d,this._itemNodes.length,g);if(this._itemNodes.push(j),this._itemIndex[b]!==f){if(h=j.DialogItem(),!(h instanceof a.DlgEl))throw new c("DialogItem already in collection")}else this._itemIndex[b]=j},IndexOfName:function(a){return this._itemNodes.IndexOf(this._itemIndex[a])}}),g}),define("engine/repeatindices",["hd","system/exception/argumentnullexception","system/exception/argumentexception"],function(a,b,c){function d(a,d){if(null==a)throw new b(f);if(0==a.length)throw new c(e.GetStr("err_emptyrptstk"),f);a[a.length-1]+=d}var e=a.Lc,f="indices",g={IsNullOrEmpty:function(a){return null==a||0==a.length
},Push:function(a){return this.PushIndex(a,0)},PushIndex:function(a,c){if(null==a)throw new b(f);var d=a.slice(0);return d.push(c),d},Pop:function(a){if(null==a)throw new b(f);if(0==a.length)throw new c(e.GetStr("errpoprpt"),f);return a.slice(0,a.length-1)},GetTopIndex:function(a){if(null==a)throw new b(f);if(0==a.length)throw new c("Cannot peek empty repeat stack",f);return a[a.length-1]},SetTopIndex:function(a,d){if(null==a)throw new b(f);if(0==a.length)throw new c("Cannot set empty repeat stack",f);a[a.length-1]=d},SetBaseIndices:function(a,b){if(null!=b&&0!=b.length){if(null==a&&(a=[]),b.length>a.length)throw new c("Invalid base indices.","newBaseIndices");var d,e=[];for(d=0;d<b.length;d++)e[d]=b[d];for(d=b.length;d<a.length;d++)e[d]=a[d];return e}},Increment:function(a){d(a,1)},Decrement:function(a){d(a,-1)},IsFirst:function(a){var b;for(b=0;b<a.length;b++)if(a[b]>0)return!1;return!0},ToString:function(a){if(null==a)return"";var b=a.length,c="",d=0;for(c+="[";b>d;)c+=a[d++],b>d&&(c+=",");return c+="]"},ValuesToInts:function(a){var b,c;if(this.IsNullOrEmpty(a))b=[];else for(b=[],c=0;c<a.length;c++){if("number"!=typeof a[c]){b=null;break}b[c]=Math.max(0,a[c]-1)}return b},IntsToValues:function(a){var b,c;if(this.IsNullOrEmpty(a))b=[];else for(b=[],c=0;c<a.length;c++)b[c]=a[c]+1;return b},AreEquivalent:function(a,b){if(null==a&&(a=[]),null==b&&(b=[]),0==a.length&&0==b.length)return!0;for(var c=b.length>a.length?b:a,d=b.length>a.length?a:b,e=0;e<d.length;e++)if(d[e]!=c[e]&&(d[e]>0||c[e]>0))return!1;for(;e<c.length;e++)if(c[e]>0)return!1;return!0},AreRelated:function(a,b){if(null==a&&(a=[]),null==b&&(b=[]),0==a.length&&0==b.length)return!0;var c,d=Math.min(a.length,b.length);for(c=0;d>c;c++)if(a[c]!=b[c])return!1;return!0},ToPrefixString:function(a){if(null==a)return"";var b,c="";for(b=0;b<a.length;b++)c+=a[b]+1,c+=":";return c.length>0&&(c+=" "),c}};return g}),define("engine/focusdirection",{Forward:0,Reverse:1}),define("system/dictionary",[],function(a){function b(){this.a={},this.Keys=[]}return b.prototype={TryGetValue:function(b){var c,d=this.a[b];if(d!==a){if("object"!=typeof b)return d;for(c in this.a)if(c===b)return this.a[c]}return null},Add:function(b,c){c!==a&&(this.a[b]=c,this.Keys.push(b))},Count:function(){return this.Keys.length},ContainsKey:function(b){return this.a[b]!==a},Remove:function(a){var b,c=!1;for(b=0;b<this.Keys.length;b++)if(this.Keys[b]==a){c=!0;break}return c&&(this.Keys.splice(b,1),delete this.a[a]),c}},b}),define("engine/focusoperation",{ReassertOnly:0,AdvanceIfNecessary:1,Advance:2}),define("runtime/component",["hdmain/system"],function(a){function b(a,b){this.name=a,this.ttlD=b}return a.ExtendClass(b,null,{eq:function(a){return a==this||a instanceof b&&a.name==this.name},EvTitle:function(){return this.ttlD?this.ttlD.toString():""}}),b}),define("runtime/variable",["hd","runtime/component","hdmain/system"],function(a,b,c){function d(a,b,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){d.baseConstructor.call(this,a,b),this.parent=c?c:null,this.prmtD=f,this.rsrc=g?g:null,this.fldWT=h?h:"D",this.fldWid="E"==this.fldWT&&i?i:0,this.colWT="E"==j&&k>0?"E":"C",this.colWid="E"==this.colWT?k:0,this.autoAsk=typeof l==e?l:!0,this.saveAns=typeof m==e?m:!0,this.warnUna=typeof n==e?n:!0,this.autoIA=o?o:"G",this.dFmt=p?p:"",this.dUTxt=q?q:"",this.dFillCh=r?r:" ",this.dFldW=s?s:0,this.dAlgn=t?t:"L"}var e="boolean";return c.ExtendClass(d,b,{type:"",valType:"??",EvPrompt:function(){return this.prmtD?this.prmtD.toString():""}}),d}),define("engine/datasourcecollection",["hd","hdmain/system","hdmain/jq","system/dictionary"],function(a,b,c,d){function e(a,b){this._dataCollection=a,this._query=b}function f(a,b){var c=!0;null!=b.Error&&(a._exception=b.Error),c&&null!=a.LoadCompleted&&a.LoadCompleted.call(a,{})}var g=c.proxy;return b.ExtendClass(e,null,{Rows:function(){return this._dataCollection},Load:function(){this._exception=null,c.getJSON(this._query,g(function(b){var e,g=this._dataCollection;c.each(b.value,function(b,f){e=new d,c.each(f,function(b,c){var d,f=b.replace("_0020"," ");0==f.indexOf("Prop")&&f.length>4&&(f=f.substr(4)),"string"==typeof c&&c.indexOf("T00:00:00")>0&&(d=new Date(c),c=a.Locale.FormatDateVal(new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours()),"d MMM yyyy")),e.a[f]=c}),g.push(e)}),f(this,{})},this))},Error:function(){return this._exception}}),e}),define("engine/datasourceloader",["hd","hdmain/jq","engine/datasourcecollection"],function(a,b,c,d){function e(a,c,d,e,f){var h={DataContext:a,Act:f};b.ajax({type:"GET",url:a.uri+"/DefineAnswerFileDataSource",data:{templateLocator:"'"+c+"'",templateName:"'"+d+"'",dataSourceId:"'"+e+"'"},complete:g,AsyncState:h})}function f(a){var b=i[a];return b===d&&(b={uri:a},i[a]=b),b}function g(c){try{var d=this.AsyncState,e=b(c.responseXML).text();d.Act(e)}catch(f){a.ExceptionAlert("err_serviceop",f)}}function h(a,b,d,e){var f=new c([],a.uri+"/"+e);return j[b]=f,f}var i={},j={},k={LoadAnswerFileDataSource:function(a,b,c,d,g,i){var j=k.GetDataSourceCollection(d);if(null!=j)i(j);else{var l=f(a);e(l,b,c,d,function(a){j=h(l,d,g,a),j.Load(),j.LoadCompleted=function(){i(j)}})}},LoadCustomDataSource:function(a,b,c,d,e){var g=k.GetDataSourceCollection(c);if(null!=g)e(g);else{var i=f(a);g=h(i,c,d,b),g.Load(),g.LoadCompleted=function(){e(g)}}},GetDataSourceCollection:function(a){var b=j[a];return b===d?null:b}};return k}),define("engine/rootnode",["hd","engine/answeredstatustabulator","engine/interviewnodetype","hdmain/system","engine/baseinterviewnode","hdmain/jq"],function(a,b,c,d,e,f){function g(a){g.baseConstructor.call(this,a,c.Root,null),this.InitializeId()}return d.ExtendClass(g,e,{DoAnsweredStatusTabulation:function(){this._answeredStatus.Reset();var a=this;f.each(this._children._list,function(c,d){b.Aggregate(a._answeredStatus,d.AnsStatus())})},OnSinglePage:function(){return!0},DirtySinglePage:function(){g.baseclass.DirtySinglePage.call(this)}}),g}),define("engine/interviewnode",["hd","hdmain/jq","runtime/numbervalidationresult","hdmain/system","engine/datasourceloadresult","system/exception","system/exception/invalidoperationexception","engine/formattingcontext","engine/interviewnodeoutlinefontflags","engine/dotcode","engine/interviewnodetype","engine/baseinterviewnode","engine/dialogupdateflags","require","engine/dialogitemnodelist","engine/repeatindices","engine/focusdirection","system/dictionary","engine/focusoperation","runtime/variable","engine/datasourceloader","engine/rootnode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(a,b,c,d,e){x.baseConstructor.call(this,a,b,c),this._autoHidden=!1,this._active=!0,this.EmptyItemNodes=new o(0),this._template=a.CurrentTemplate(),this._dialog=d,this._indices=e,this._owner=a.InRebuild()&&a.CurrentBuildNode()!=c?D(a.CurrentBuildNode(),x):null,this._itemNodes=this.EmptyItemNodes,this._focusedItem=-1}function y(){}this.DEBUG===w&&(this.DEBUG=a.DEBUG);var z=b.proxy,A="IsSpreadsheetRowInSpreadsheet",B=d.String.IsNullOrEmpty,C=d.String.Format,D=d.Cast,E=a.Lc;return d.ExtendClass(x,l,{Variable:function(){return this._dialog},TemplateOfOrigin:function(){return this._template},Indices:function(){return null!=this._indices?this._indices:[]},OutlineChildren:function(){var a,b,c,d=[];for(a=0;a<this._children.Count();a++)if(c=this._children.get(a),c.IsOnParent())for(b=0;b<c.OutlineChildren().length;b++)d.push(c.OutlineChildren()[b]);else d.push(c);return d},OutlineChildrenReverse:function(){var a,b,c,d=[];for(a=this._children.Count()-1;a>=0;a--)if(c=this._children.get(a),c.IsOnParent())for(b=0;b<c.OutlineChildrenReverse().length;b++)d.push(c.OutlineChildrenReverse()[b]);else d.push(c);return d},AskedImplicitly:function(){return null!=this._owner},Owner:function(){return this._owner},IsSpreadsheetRow:function(){return this.Type()==k.Iteration&&"S"==this._dialog.rType},IsSpreadsheetRowInEditMode:function(){return this.IsSpreadsheetRow()&&this._parent.EditRowMode()},IsSpreadsheetRowInSpreadsheet:function(){return this.IsSpreadsheetRow()&&!this._parent.EditRowMode()},IsOnParent:function(){return this._dialog.onPar?this._parent.Type()==k.Root?!1:this._parent.Type()==k.Iteration&&this._parent[A]()?!1:!0:!1},OnSinglePage:function(){return this.IsOnParent()?this._parent.OnSinglePage():x.baseclass.OnSinglePage.call(this)},ClearUpdateFlags:function(a){0!=(a&m.DialogContentRelated)&&this._itemNodes.ClearUpdateFlags(),x.baseclass.ClearUpdateFlags.apply(this,arguments)},SetIndex:function(a){var b,c,d=n("engine/iterationnode");if(!p.AreRelated(a,this._indices))for((this._type==k.Iteration&&!this[A]()||this._parent.Type()==k.Iteration&&D(this._parent,d)[A]())&&this.SetUpdateFlags(m.Title|m.NodeTitle),this._indices=p.SetBaseIndices(this._indices,a),b=0;b<this._children.Count();b++)c=this._children.get(b),c.SetIndex(a)},OffsetIndex:function(a,b){var c,d=n("engine/iterationnode");for(this._indices[b]+=a,(this._type==k.Iteration&&!this[A]()||this._parent.Type()==k.Iteration&&D(this._parent,d)[A]())&&this.SetUpdateFlags(m.Title|m.NodeTitle),this._interview.OffsetIndicesForId(this._id,a,b),c=0;c<this._children.Count();c++)child=this._children.get(c),child.OffsetIndex(a,b)},GetCaption:function(a,b,c){return c=i.None,this._parent.Type()==k.Iteration&&this._parent[A]()?this._parent.New()?E.GetStr("ui_new")+": "+(B(this._title)?this._dialog.name:b(x.FixAmpersands(this._title,!1),a,c)):p.ToPrefixString(this._indices)+(B(this._title)?this._dialog.name:b(x.FixAmpersands(this._title,!1),a,c)):null==this._title||""==this._title?this.Variable().name:b(x.FixAmpersands(this._title,!1),a,c)},New:function(){var a=n("engine/iterationnode");return this._parent.Type()==k.Iteration&&D(this._parent,a)[A]()?this._parent.New():x.baseclass.New.call(this)},IsHiddenNew:function(){var a=n("engine/iterationnode");return this._parent.Type()==k.Iteration&&D(this._parent,a)[A]()?this._parent.IsHiddenNew():x.baseclass.IsHiddenNew.call(this)},RequiredAsterisk:function(){return this._interview._engine.RequiredAsterisk()},RequiredIsEnforcable:function(){if(!this.Active())return!1;if(this._type==k.Iteration){var a=n("engine/iterationnode"),b=D(this,a);if(b.New()&&b.IterationNumber()>0)return!1}return this.AllNew()&&!p.IsFirst(this._indices)?!1:this.GetIsPartOfInterview()?!0:!1},GetIsPartOfInterview:function(){var a=!0;return this._parent.Type()!=k.Root&&(a=D(this._parent,x).GetIsPartOfInterview()),a&&(a=this._parent.Children().Contains(this)),a},Caption:function(){var a;return this.GetCaption(h.PlainText,j.DefaultProcessor,a)},GetOutlineCaption:function(a){return this.GetCaption(h.OutlineText,j.DefaultProcessor,a)},Title:function(a){return a===w?this._title:(a!=this._title&&this.SetUpdateFlags(m.Title|m.NodeTitle),this._title=a,void 0)},AutoHidden:function(a){return a===w?this._autoHidden:(this._autoHidden!=a&&(this._autoHidden=a,this.Active(!a)),void 0)},Active:function(a){if(a===w)return this._active;if(this._active!=a&&(this._active=a,this._parent.SetUpdateFlags(m.NodeChildCount|m.ChildCount),!this._active)){var b,c;for(b=0;b<this.Children().Count();b++)c=this.Children().get(b),c.Active(!1)}},IsOwnedBy:function(a){if(!this.AskedImplicitly())return!1;if(this._owner==a)return!0;if(this._owner.AskedImplicitly())return this._owner.IsOwnedBy(a);if(this._owner.IsDescendantOf(a))return!0;for(var b=D(this._owner.Parent,x);null!=b&&!b.AskedImplicitly();)b=D(b.Parent,x);return null!=b?b.IsOwnedBy(a):!1},FindNodesAskedImplicitly:function(a){for(var b,c=this;c._parent.Type()!=k.Root;)c=D(c._parent,x);for(b=D(c._parent,v),a.endIndex=b.Children().IndexOf(c),a.startIndex=a.endIndex;a.startIndex>0&&b._children.get(a.startIndex-1).AskedImplicitly();)a.startIndex--;for(;a.startIndex<a.endIndex&&!b._children.get(a.startIndex).IsOwnedBy(this);)a.startIndex++;for(;a.endIndex>a.startIndex&&b._children.get(a.endIndex-1).AskedImplicitly()&&!b._children.get(a.endIndex-1).IsOwnedBy(this);)a.endIndex--},GetNodesAskedImplicitly:function(){var a,b={startIndex:0,endIndex:0},c=[];for(this.FindNodesAskedImplicitly(b),a=b.startIndex;a<b.endIndex;a++)c.push(this._interview.Root.Children().get(a));return c},GenerateDefaultTitle:function(){var a,b,c,d=this._dialog,e=null,f=null,g=!1,h=0;for(h=0;h<d.vList.Count();h++){if(e=d.vList.GetItem(h),e instanceof t){for(a=h+1;a<d.vList.Count();a++)if(d.vList.GetItem(a)instanceof t){g=!0;break}b=e,f=b.EvTitle(),B(f)&&(f=x.TrimForUseAsTitle(b.EvPrompt()),B(f)&&(f=b.name));break}if("TXL"==e.type){if(c=e,f=x.TrimForUseAsTitle(c.EvText()),!B(f))break}else if("HDL"==e.type&&(c=e,f=c.EvCapt().replace(/^\s+|\s+$/g,""),!B(f)))break}return B(f)?f=E.GetStr("ui_emptydlg"):"NONE"==f&&(f="",g=!1),g&&(f+=E.GetStr("ui_etc")),f},EvTitle:function(){var a=this._dialog.EvTitle();return B(a)&&this._interview.PreferenceCache().GenerateDialogTitles()&&(a=this.GenerateDefaultTitle()),a},EvaluateText:function(){this.Title(this.EvTitle()),this._updateFlags|=this._itemNodes.Update()},ShowInOutline:function(){return this.AutoHidden()?!1:this.Active()&&!this.IsHiddenNew()},AvailableForNavigation:function(){return this.ShowInOutline.call(this)},DoImplicitAnswerProcessing:function(){},ClearGroupedItems:function(a,b,c){if(this._type!=k.Dialog&&this._type!=k.Iteration)throw new g(E.GetStr("err_grptf"));if(""==this._dialog.gType&&!IsSpreadsheetRow)throw new g(E.GetStr("err_grptf_un"));this._interview.BeginBulkAnswerChange();var d,e,f,h=!1;for(d=a;b>=d;d++)e=this._itemNodes.get(d),e!=c&&(f=e.DialogItem(),("TF"==f.type||"DI"==f.type)&&(this._interview._engine.LoadAnswerValue("TF",f.name,!1,D(f,t).saveAns,this._indices),e.SetUpdateFlags(m.ScriptAnswer),h=!0));if(this._dialog.nota&&(h||a==b)){if(!this._itemNodes.get(b+1).NoneOfTheAbove())throw new g("Failed to find None of the Above item in the expected position.");this._itemNodes.get(b+1).SetUpdateFlags(m.ScriptAnswer)}this._interview.EndBulkAnswerChange(!1)},ClearAnswers:function(a){"boolean"!=typeof a&&(a=!0),this._interview.BeginBulkAnswerChange(),a&&this.DoAnswerSync();var b,c;for(b=0;b<this._itemNodes.Count();b++)c=this._itemNodes.get(b),c.ClearAnswer(!1);this.DoImplicitAnswerProcessing(),this._interview.EndBulkAnswerChange(!0)},VariableHasAnswer:function(a){if(null!=a){var b=this._interview._engine.GetAnswer(a.name,a.type);if(b!==w)return b.IsAns(this._indices)}return!1},VariableIsUserModifiable:function(a){var b,c=!1;return null!=a&&(c=!0,b=this._interview._engine.GetAnswer(a.name,a.type),null!=b&&(c=b.GetUserModifiable(this._indices),c&&this.Type()==k.Iteration&&this.New()&&!this.UserExtendible()&&(c=!1))),c},GetVariableAnswerDouble:function(a){var b,c=this._interview._engine.GetAnswer(a.name,a.type);return null!=c&&(b=c.GetValue(this._indices),null!=b)?b:null},GetVariableAnswerDate:function(a,b){var c,d=this._interview._engine.GetAnswer(a.name,a.type);return null!=d&&(c=d.GetValue(this._indices),null!=c)?(b.v=c,!0):!1},GetVariableAnswerList:function(b,c){var d,e=this._interview._engine.GetAnswer(b.name,b.type);return e===w&&b.dv&&(e=a.Answers.CreateAnswer("MC",b.name)),null!=e&&(d={v:e.GetValue(this._indices)},null==d.v&&b.dv&&(!this[A]()||0==this._indices[this._indices.length-1])&&(e.SetValue(b.dv,this._indices),d.v=e.GetValue(this._indices)),b.ReconcileOptions(d,this._interview.GetRuntimeOptionsForVariable(b,this._template.name)),null!=d.v)?(c.push.apply(c,d.v),!0):(c=null,!1)},GetVariableAnswerOther:function(a,b){if(a.othr&&!a.MultipleSelect()){var c,d,e=this._interview._engine.GetAnswer(a.name,a.type);if(null!=e&&(c=e.GetValue(this._indices),null!=c&&(d=this._interview.GetRuntimeOptionsForVariable(a,this._template.name),!d.Contains(c[0]))))return b=c[0],!0}return b=null,!1},SetVariableAnswerDouble:function(a,b,d){d.v="";var e,f=E.ParseNumber(b);switch(null!=f&&(e=Math.pow(10,a.decPl),f=Math.round(f*e)/e),a.CheckMinMax(f)){case c.Valid:return this._interview._engine.LoadAnswerValue("NU",a.name,f,a.saveAns,this._indices),!0;case c.ErrorNotANumber:d.v=E.GetStr("val_invnum");break;case c.ErrorOutOfRange:d.v=E.GetStr("val_numrng",E.FormatNumberDef(a.min,a.decPl),E.FormatNumberDef(a.max,a.decPl));break;case c.ErrorTooSmall:d.v=E.GetStr("val_numgt",E.FormatNumberDef(a.min,a.decPl));break;case c.ErrorTooBig:d.v=E.GetStr("val_numlt",E.FormatNumberDef(a.max,a.decPl))}return!1},SetVariableAnswerDate:function(a,b){var c=b?new Date(b):null;this._interview._engine.LoadAnswerValue("DA",a.name,c,a.saveAns,this._indices)},SetVariableAnswerList:function(a,b){"string"==typeof b&&(""==b&&(this[A]()||"CO"==a.style||"SL"==a.style)&&(b=null),null!=b&&(b=[b])),this._interview._engine.LoadAnswerValue("MC",a.name,b,a.saveAns,this._indices)},GetItemWidth:function(a){for(var b,c=0,d=1,e=a;e>0&&(1==this._dialog.plcmt[e]||3==this._dialog.plcmt[e]);)e--;for(this._dialog.plcmt[e]>=2&&c++,b=e+1;b<this._dialog.plcmt.length&&(1==this._dialog.plcmt[b]||3==this._dialog.plcmt[b]);)d++,this._dialog.plcmt[b]>=2&&c++,b++;switch(d){case 1:return 100;case 2:return this._dialog.plcmt[a]>=2?67:c>0?33:50;case 3:return 33;default:throw new g("Found more than 3 variables on a single line in the dialog")}},IsItemOnPrevLine:function(a){return 1==this._dialog.plcmt[a]||3==this._dialog.plcmt[a]},GetItemMapName:function(a){var b,c=this._dialog.Mappings[a];return c!==w&&null!=c?c.n:(b=D(this._itemNodes.get(a).DialogItem(),t),null!=b&&"DI"!=b.type?b.name:null)},GetItemMapType:function(a){var b,c=this._dialog.Mappings[a];return c!==w&&null!=c&&"UN"!=c.ExpectedType&&"OT"!=c.ExpectedType?c.t:(b=D(this._itemNodes.get(a).DialogItem(),t),null!=b&&"DI"!=b.type?b.valType:"UN")},IsItemInProtectedGroup:function(a){if(""==this._dialog.gType)return!1;var b,c,d,e,f=D(this._itemNodes.get(a).DialogItem(),t),g={},h={};if(null==f||"TF"!=f.type&&"DI"!=f.type)return!1;if(this._dialog.GetTrueFalseGroupBounds(a,g,h),g.v<0)return!1;for(b=g.v;b<=h.v;b++)if(c=this._dialog.vList.GetItem(b),d=this._interview._engine.GetAnswer(c.name,"TF"),null!=d&&(e=d.GetValue(this.Indices()),null!=e&&e&&!d.GetUserModifiable(this.Indices())))return!0;return!1},IsAnyVariableProtected:function(){var a,b,c;for(a=0;a<this._dialog.vList.Count();a++)if(b=this._dialog.vList.GetItem(a),b instanceof t&&(c=this._interview._engine.GetAnswer(b.name,b.type),null!=c&&!c.GetUserModifiable(this.Indices())))return!0;return!1},NavigateTo:function(a,b,c){this._interview.GotoDialog(this,b,a,null,c)},HasAnswerSource:function(){return!(this.Type()!=k.Dialog&&this.Type()!=k.Iteration||null==this._dialog.DataSource||"CAF"!=this._dialog.DataSource.t&&"AF"!=this._dialog.DataSource.t&&"C"!=this._dialog.DataSource.t)},AnswerSourceColumns:function(){var a=[];return b.each(this.AllAnswerSourceColumns(),function(b,c){c.ConcealedOnAnswerSource()||a.push(c)}),a},AllAnswerSourceColumns:function(){var a=[];return b.each(this._itemNodes._itemNodes,function(b,c){c.DialogItem()instanceof t&&"DI"!=c.DialogItem().type&&!c.OmittedFromAnswerSource()&&a.push(c)}),a},AnswerSourceTypeIsCompatible:function(a,b){return a==b?!0:"TX"==a&&"MC"==b||"MC"==a&&"TX"==b},GetDataSourcePropertyName:function(a){if(null==this._dialog.DataSource)throw new NullReferenceException("Cannot get a property name when there is no data source defined.");switch(this._dialog.DataSource.t){case"CAF":case"AF":case"C":return a.MapName();default:throw new f(C("The data source type '{0}' is not supported.",this._dialog.DataSource.t))}},LoadDataSourceRows:function(c){if(null==this._dialog.DataSource)throw new NullReferenceException("Cannot load data source rows when there is no data source defined.");var d,g,h,i,j,k,l,m,n,o=this._dialog.DataSource;switch(o.t){case"CAF":d=[],g=[],h=this,b.each(this.AllAnswerSourceColumns(),function(a,b){if(j=h._interview._engine.GetAnswer(b.MapName(),h._interview.GetValueType(b.MapName())),null!=j&&h.AnswerSourceTypeIsCompatible(j.VT(),b.MapType())){for(i=null==j?0:j.GetChildCount(),k=0;i>k;k++)k>=g.length&&g.push(new r),value=j.GetValue([k]),g[k].Add(b.MapName(),value);d.push(b)}}),c(new e(d,g,null));break;case"AF":l=u.GetDataSourceCollection(o.id),null==l?(m="",y.call(this,m),u.LoadAnswerFileDataSource(a.DataSourceAddressDict[o.n.toLowerCase()].Address,a.TemplateLocator,this._template.name,o.id,m,z(function(a){c(new e(this.AllAnswerSourceColumns(),a.Rows(),a.Error()))},this))):c(new e(this.AllAnswerSourceColumns(),l.Rows(),l.Error()));break;case"C":l=u.GetDataSourceCollection(o.id),null==l?(m="",y.call(this,m),n=a.DataSourceAddressDict[o.n.toLowerCase()],u.LoadCustomDataSource(n.Address,n.Name,o.id,m,z(function(a){c(new e(this.AllAnswerSourceColumns(),a.Rows(),a.Error()))},this))):c(new e(this.AllAnswerSourceColumns(),l.Rows(),l.Error()));break;default:throw new f(C("Data sources of type {0} are not supported.",this._dialog.DataSource.t))}},SetAnswersFromAnswerSourceRow:function(a,b){this._interview.BeginBulkAnswerChange();var c,d,e;for(c=0;c<a.length;c++)switch(d=a[c],e=b.TryGetValue(this.GetDataSourcePropertyName(d)),d.DialogItem().type){case"TX":null!=e?"string"==typeof e?d.StringAnswer(e):"array"==typeof e&&d.StringAnswer(e.toString()):d.StringAnswer(null);break;case"NU":null!=e?d.DoubleAnswer(e):d.DoubleAnswer(null);break;case"DA":null!=e?d.DateAnswer(e):d.DateAnswer(null);break;case"TF":null!=e?d.BoolAnswer(e):d.BoolAnswer(null);break;case"MC":null!=e?"object"==typeof e&&e.length?d.ListAnswer(e):"string"==typeof e&&d.StringAnswer(e):d.ListAnswer(null)}this._interview.EndBulkAnswerChange(!0)},GetFocusedItemNode:function(){var a,b,c=null,d=n("engine/repeatnode");return this._type==k.Repeat&&D(this,d).IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?c=D(this,d).SpreadsheetItemNode()._parent.GetFocusedItemNode():this._focusedItem>=0&&(c=this._itemNodes.get(this._focusedItem),c.IsSpreadsheet()&&(a=c.SpreadsheetNode(),b=c.GetRowFocus(),b>=0&&b<a.Children().Count()&&(c=a.Children().get(b).GetFocusedItemNode()))),c},ClearFocusedItemNode:function(){var a=n("engine/iterationnode");this._type==k.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?this.SpreadsheetItemNode()._parent.ClearFocusedItemNode():this._focusedItem>=0&&this._itemNodes.get(this._focusedItem).ClearFocus(),this[A]()&&D(this,a).SpreadsheetItemNode().SetRowFocus(-1),this._focusedItem=-1},SetFocus:function(a){var b=n("engine/iterationnode");if(this._type==k.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode())return this.SpreadsheetItemNode()._parent.SetFocus(a),void 0;if(this._focusedItem=a,this[A]()){var c=D(this,b).SpreadsheetItemNode(),d=p.GetTopIndex(this._indices);d>=this._parent.Children().Count()&&(d=this._parent.Children().Count()-1),c.SetRowFocus(d)}},AdvanceFocus:function(a,b,c){function d(){this._focusedItem>=0&&this._focusedItem<this._itemNodes.Count()?this._itemNodes.get(this._focusedItem).AssertFocus(a?s.Advance:s.AdvanceIfNecessary,b,z(function(e){return e?(c(e),void 0):(this._focusedItem+=b==q.Forward?1:-1,a=!1,d.call(this),void 0)},this)):(this._focusedItem=-1,c(!1))}if(c===w&&(c=function(){}),this._type==k.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode())return this.SpreadsheetItemNode()._parent.AdvanceFocus(a,b,c),void 0;var e,f;return-1==this._focusedItem&&(this._focusedItem=b==q.Forward?0:this._itemNodes.Count()-1,a=!1),a&&!this[A]()&&(e=this.GetFocusedItemNode(),f=!1,null!=e&&(f=e.OnAnswerSync()),f)?(c(!1),void 0):(d.call(this),void 0)},ReassertFocus:function(a){return this._type==k.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?(this.SpreadsheetItemNode()._parent.ReassertFocus(a),void 0):(this._focusedItem>=0&&this._focusedItem<this._itemNodes.Count()&&this._itemNodes.get(this._focusedItem).AssertFocus(s.ReassertOnly,a),void 0)},GetNextFocusNode:function(a){if(!this._interview.IsSinglePage()||!this.OnSinglePage())return null;var b=this._parent.Children().IndexOf(this),c=null;return a==q.Reverse?b>0?c=this._parent.Children().get(b-1):this._parent.Type()!=k.Root&&(b=this._parent._parent.Children().IndexOf(D(this._parent,x)),b>0&&(c=this._parent._parent.Children().get(b-1))):b<this._parent.Children().Count()-1&&(this._parent.Type()!=k.Repeat||!this._parent.Children().get(b+1).IsHiddenNew())?c=this._parent.Children().get(b+1):this._parent.Type()!=k.Root&&(b=this._parent._parent.Children().IndexOf(D(this._parent,x)),b<this._parent._parent.Children().Count()-1&&(this._parent._parent.Type()!=k.Repeat||!this._parent._parent.Children().get(b+1).IsHiddenNew())&&(c=this._parent._parent.Children().get(b+1))),null!=c&&c.Type()==k.Repeat&&"S"!=c._dialog.rType&&(c=a==q.Forward?c.Children().get(0):c.Children().Count()>1&&c.Children().get(c.Children().Count()-1).IsHiddenNew()?c.Children().get(c.Children().Count()-2):c.Children().get(c.Children().Count()-1)),c},GenerateBookmark:function(){var a,b="";if(b+=this.Variable().name,this._type!=k.DefaultDialog)for(b+="|",b+=this._focusedItem>=0?this._type==k.Repeat?this.Children().get(0).ItemNodes.IndexOfName(this._itemNodes.get(this._focusedItem).DialogItem().name):this._focusedItem:"-1",a=0;a<this._indices.length;a++)b+="|",b+=this._indices[a];return b},SerializeAttributes:function(a){this._type!=k.DefaultDialog&&a.WriteAttributeString("Name",this.Variable().name),null!=this._indices&&this._indices.length>0&&a.WriteAttributeString("Indices",p.ToString(this._indices)),null!=this._owner&&a.WriteAttributeString("Owner",this._owner.Variable().name),this._active||a.WriteAttributeString("Active",this._active.toString()),this._autoHidden&&a.WriteAttributeString("AutoHidden",this._autoHidden.toString());var b=Caption;!B(b)&&b!=this.Variable().name&&a.WriteAttributeString("Caption",b),x.baseclass.SerializeAttributes(a)}},{HDEscQuots:function(a,b,c){return"boolean"!=typeof c&&(c=!0),"string"!=typeof a&&null!=typeof a.hdType&&"S"!=a.hdType?"":(b!==!1&&(b=!0),b?(a=a.replace(/&/g,"&amp;"),c&&(a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;")),a=a.replace(/\'/g,"&#39;"),a=a.replace(/\"/g,"&quot;")):(a=a.replace(/&#39;/g,"'"),a=a.replace(/&quot;/g,'"'),c&&(a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">")),a=a.replace(/&amp;/g,"&")),a)},FixAmpersands:function(a,b){"string"!=typeof a&&(a=""),"boolean"!=typeof b&&(b=!1);var c=b?"&amp;":"&";return a=a.replace(new RegExp("\\"+c+"\\"+c,"g"),"â»â"),a=a.replace(new RegExp("\\"+c+"(\\s|<BR>)","g"),"â»â$1"),a=a.replace(new RegExp("\\"+c+"nbsp;","g"),"â»ânbsp;"),a=a.replace(new RegExp("\\"+c,"g"),""),a=a.replace(new RegExp("â»â","g"),c),a+" "},TrimForUseAsTitle:function(a){if(!a)return"";if(""==a)return a;a=a.replace(/<br>/gi,"\n");var b=a.search(/[^-:;,.?! \n\t]/);return b>0&&(a=a.slice(b)),b=a.search(/[\n\t]/),b>0&&(a=a.slice(0,b)),b=a.search(/[-:;.,?! ]+$/),b>0&&(a=a.slice(0,b)),a}}),a.InterviewNode=x,x}),define("engine/dialognode",["hd","hdmain/system","system/exception/invalidoperationexception","system/exception/notimplementedexception","system/exception/argumentnullexception","engine/answeredstatustabulator","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","require","engine/dialogitemnodelist","runtime/variable"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b,c){c===m?(n.baseConstructor.call(this,a,g.Iteration,b,b._dialog,a.GetCurrentIndices()),this.SharedInit()):(n.baseConstructor.call(this,a,g.Dialog,b,c,b.Type()==g.Root?[]:a.GetCurrentIndices()),this.SharedInit(),this.InitializeId())}var o=b.Cast,p=b.String.IsNullOrEmpty;return this.DEBUG===m&&(this.DEBUG=a.DEBUG),b.ExtendClass(n,i,{SharedInit:function(){var b,c,d,e=this._dialog.vList.Count(),f=this._dialog.nota?this._dialog.TrueFalseGroupCount():0,g=f>0||"S"==this._dialog.gType&&this._dialog.TrueFalseGroupCount()>0,h=-1,i={v:-1},j={v:-1};for(this._itemNodes=new k(e+f),d=0;e>d;d++)g&&(d<=j.v?!1:j.v>=0?(this._dialog.nota&&(b=this._interview.GetNOTAProxyForDialog(this._dialog,h),this._itemNodes.Add(b.name,this,a.NoneOfTheAboveIndex)),i.v=j.v=-1):(this._dialog.GetTrueFalseGroupBounds(d,i,j),i.v>=0&&h++)),c=this._dialog.vList.GetItem(d),this._itemNodes.Add(c.name,this,d);j.v>=0&&this._dialog.nota&&(b=this._interview.GetNOTAProxyForDialog(this._dialog,h),this._itemNodes.Add(b.name,this,a.NoneOfTheAboveIndex)),this._interview.RegisterNode(this)},AutoHidden:function(a){if(a===m)return n.baseclass.AutoHidden.call(this);if(this._autoHidden!=a){n.baseclass.AutoHidden.call(this,a);var b=o(this._parent,i);null!=b&&b.Type()!=g.Repeat&&b._itemNodes.get(this.Variable().name).SetUpdateFlags(h.Hidden)}},DoAnsweredStatusTabulation:function(){var b,c,d,e,h,i,k,m=j("engine/iterationnode");for(this._answeredStatus.Reset(),k=0;k<this._itemNodes.Count();k++)if(b=this._itemNodes.get(k),!(b.NoneOfTheAbove()||(c=b.DialogItem(),c instanceof a.DlgEl)))if("DI"==c.type)b.NeedsProcessing()&&(i=this._children.get(c.name,this._template),null!=i&&f.Aggregate(this._answeredStatus,i.AnsStatus()));else{if(b.Gray()||b.Hidden()||b.SetByDialogScript())continue;if(d=o(c,l),e=!1,"TF"==d.type&&(""!=this._dialog.gType||this._type==g.Iteration&&o(this,m).IsSpreadsheetRowInSpreadsheet())){if(h={v:null},b.GetAnswerBool(h)){this._answeredStatus.IncAnswered(d.warnUna,b.Required(),!h.v);continue}e=!0}if(!e&&b.IsAnswered()){this._answeredStatus.IncAnswered(d.warnUna,b.Required(),!1);continue}this._answeredStatus.IncUnanswered(d.warnUna,b.Required())}this._answeredStatus.IsThisUnansweredRequired()&&!this._answeredStatus.IsAnswered()&&(this.RequiredIsEnforcable()||this._answeredStatus.ClearRequired()),p(this.ErrorText)?this._answeredStatus.ClearError():this._answeredStatus.SetError(),this._answeredStatus.IsThisHasErrorText()&&!this._answeredStatus.IsAnswered()&&(this.RequiredIsEnforcable()||this._answeredStatus.ClearError())},GetRequiredVarName:function(){throw new d},DoImplicitAnswerProcessing:function(){var b,d;if(""!=this._dialog.gType||this.IsSpreadsheetRowInSpreadsheet()){if(this._type!=g.Dialog&&this._type!=g.Iteration)throw new c(a.Lc.GetStr("err_grptf"));for(this._interview.BeginBulkAnswerChange(),b=0;b<this._dialog.vList.Count();b++)d=this._dialog.vList.GetItem(b),"TF"==d.type||"DI"==d.type&&""!=this._dialog.gType&&this._itemNodes.get(d.name).IsChildDialogButton()?this.VariableHasAnswer(o(d,l))||this._interview._engine.LoadAnswerValue("TF",d.name,!1,o(d,l).saveAns,this._indices):"DI"==d.type&&this._itemNodes.get(d.name).IsDialogOnParent()&&this.Children().get(d.name,this._template).DoImplicitAnswerProcessing();this._interview.EndBulkAnswerChange(!1)}},SerializeElements:function(a){a.WriteStartElement("DialogItems");for(var b=0;b<this._itemNodes.Count();b++)this._itemNodes.get(b).Serialize(a);a.WriteEndElement(),n.baseclass.SerializeElements(a)}},{CreateOrLocate:function(a,b,c,d){var f,h;if(null==a)throw new e("interview");if(null==b)throw new e("parent");if(null==c)throw new e("dialog");return f=a.CurrentBuildNode()!=b?o(a.CurrentBuildNode(),i):null,h=o(b.Children().FindExisting(c.name,g.Dialog,f,a.CurrentTemplate()),n),null==h?(h=new n(a,b,c),d.v=!0):d.v=!1,h.InitUpdate(),h}}),n}),define("engine/iterationnode",["hd","hdmain/system","system/exception/argumentnullexception","engine/interviewnodeoutlinefontflags","engine/dialogupdateflags","engine/interviewnode","engine/dialognode","engine/repeatindices","require"],function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c){k.baseConstructor.call(this,a,b),this._iterationId=b.NextIterationId(),this._flags=o.None,this.SetFlag(o.NewIteration,c),this.InitializeId()}var l=b.Cast,m=b.String.IsNullOrEmpty,n=b.Windows.Visibility;this.DEBUG===j&&(this.DEBUG=a.DEBUG);var o={None:0,NewIteration:1,Hidden:2};return b.ExtendClass(k,g,{OutlineParent:function(){return l(this._parent,i("engine/repeatnode")).IsSpreadsheetRow()?l(this._parent._parent,f):k.baseclass.OutlineParent.call(this)},IterationId:function(){return this._iterationId},GetFlag:function(a){return 0!=(this._flags&a)},SetFlag:function(a,b){b?this._flags|=a:this._flags&=~a},New:function(){return this.GetFlag(o.NewIteration)},IsHiddenNew:function(){if(this.New()&&this.IterationNumber()>0){var a=this._interview.CurrentOutlineNode();if(a!=this&&!this.ContainsDescendant(a))return!0}return!1},UserExtendible:function(){return this._parent.UserExtendible()},AddButtonText:function(){return m(this._addButtonCaption)?a.Lc.GetStr("ui_addbtn"):this._addButtonCaption},DisplayAddButton:function(){return!this.IsSpreadsheetRowInSpreadsheet()
},AddButtonVisibility:function(){if(!this._interview.IsSinglePage())return n.Visible;var a=this._parent.Children().Count(),b=this._parent.Children().get(a-1);return this==b||a>1&&b instanceof k&&l(b,k).IsHiddenNew()&&this==this._parent.Children().get(a-2)?n.Visible:n.Collapsed},AddButtonIsEnabled:function(){return this._parent.Children().get(this._parent.Children().Count()-1).New()?this._parent.Limit>0&&this.IterationNumber()==this._parent.Limit-1?!1:this.UserExtendible()?!0:!1:!1},DeleteIsEnabled:function(){return this.UserExtendible()?this.IsAnyVariableProtected()?!1:!0:!1},IterationNumber:function(){return h.GetTopIndex(this._indices)},IterationHidden:function(a){return a===j?this.GetFlag(o.Hidden):(this.IterationHidden()!=a&&(this.SetFlag(o.Hidden,a),this._parent.SetUpdateFlags(e.NodeChildCount)),void 0)},ShowInOutline:function(){return this.IsSpreadsheetRow()?!1:this.IsHiddenNew()?!1:k.baseclass.ShowInOutline.call(this)&&!this.IterationHidden()},AvailableForNavigation:function(){var a=i("engine/repeatnode"),b=l(this._parent,a);return b.IsSpreadsheet()&&null!=b.EditingRow()&&!this.New()?!0:k.baseclass.AvailableForNavigation.call(this)},SpreadsheetItemNode:function(){if(this.IsSpreadsheetRowInSpreadsheet()){var a=i("engine/repeatnode"),b=l(this._parent,a);return b.IsOnParent()?l(b._parent,f)._itemNodes.get(this._dialog.name):b._itemNodes.get(this._dialog.name)}return null},EndRowEdit:function(){var a=i("engine/repeatnode");l(this._parent,a).SetEditRow(-1)},EvTitle:function(){return this._addButtonCaption=this._dialog.EvAddBC(),k.baseclass.EvTitle.call(this)},GetCaption:function(b,c,e){return e=d.None,this.New()?a.Lc.GetStr("ui_new")+": "+(""==this._title?this._dialog.name:c(f.FixAmpersands(this._title,!1),b,e)):h.ToPrefixString(this._indices)+(""==this._title?this._dialog.name:c(f.FixAmpersands(this._title,!1),b,e))},OnSinglePage:function(){return this.IsSpreadsheetRowInEditMode()?!1:this._parent.OnSinglePage()},SerializeAttributes:function(a){k.baseclass.SerializeAttributes(a),this.New()&&a.WriteAttributeString("New","true")}},{CreateOrLocate:function(a,b,d,f){if(null==a)throw new c("interview");if(null==b)throw new c("parent");var g,h,i=null;if(b.Children().Count()>b.Children().UpdatedCount()){if(i=l(b.Children().get(b.Children().UpdatedCount()),k),i.SetIndex(a.GetCurrentIndices()),i.New()!=d){if(i.SetUpdateFlags(e.Title|e.NodeTitle|e.NodeAnsStatus),i.IsSpreadsheetRowInSpreadsheet()&&i._children.Count()>0)for(h=0;h<i._children.Count();h++)g=i._children.get(h),g.SetUpdateFlags(e.Title|e.NodeTitle);i.SetFlag(o.NewIteration,d)}f.v=!1}else i=new k(a,b,d),f.v=!0;return i.InitUpdate(),i}}),k}),define("engine/repeatnode",["hd","hdmain/system","system/exception/argumentnullexception","system/exception/argumentexception","engine/answeredstatustabulator","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode","engine/dialogitemnodelist","engine/repeatindices","engine/focusdirection","hdmain/jq","engine/focusoperation","runtime/variable"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a,b,c){q.baseConstructor.call(this,a,f.Repeat,b,c,a.GetCurrentIndices()),this.AnsweredIterationCount=0,this.Limit=0,this._editingRow=-1,this._iterationTally=0,this._userExtendible=this.GetUserExtendible(),this.InitializeId(),this.IsSpreadsheet()&&this.BuildItemNodes()}var r=b.Cast,s=b.String.IsNullOrEmpty;return this.DEBUG===p&&(this.DEBUG=a.DEBUG),b.ExtendClass(q,h,{BuildItemNodes:function(){var b,c,d,e=0,f=0;for(this.IsOnParent()||(b=!0,m.each(this._dialog.vList.list,function(c,d){d instanceof a.DlgEl?d instanceof a.TxDlgEl&&"E"==r(d,a.TxDlgEl).dspIn||(b?e++:f++):b=!1})),this._itemNodes=new j(e+f+1),c=0;e>c;c++)this._itemNodes.Add(this._dialog.vList.GetItem(c).name,this,c);for(this._itemNodes.Add(this._dialog.name,this,a.SpreadsheetIndex),c=e+1;c<this._dialog.vList.Count();c++)d=this._dialog.vList.GetItem(c),d instanceof a.DlgEl&&(!(d instanceof a.TxDlgEl)||"E"!=r(d,a.TxDlgEl).dspIn)&&this._itemNodes.Add(d.name,this,c)},GetUserExtendible:function(){for(var a=!0,b=0;b<this._dialog.vList.Count();b++){var c=this._dialog.vList.GetItem(b);if(c instanceof o){var d=this._interview._engine.GetAnswer(c.name,c.type);if(null!=d&&!d.ue){a=!1;break}}}return a},AddingIterationsIsEnabled:function(){return this._userExtendible&&(0==this.Limit||this.AnsweredIterationCount<this.Limit)},IsSpreadsheet:function(){return"S"==this._dialog.rType},SpreadsheetItemNode:function(){return this.IsSpreadsheet()&&!this.EditRowMode()?this.IsOnParent()?r(this._parent,h)._itemNodes.get(this._dialog.name):this._itemNodes.get(this._dialog.name):null},EditRowMode:function(){return this._editingRow>=0&&this._editingRow<this._children.Count()},EditingRow:function(){return this.EditRowMode()?r(this._children.get(this._editingRow),i):null},NewIteration:function(){var a=r(this.Children().get(this.Children().Count()-1),i);return a.New()?a:null},OutlineChildren:function(){var a,b,c,d=[];for(a=0;a<this._children.Count();a++)if(b=r(this._children.get(a),i),this.IsSpreadsheet())for(c=0;c<b.Children().Count();c++)d.push(b.Children().get(c));else d.push(b);return d},OutlineChildrenReverse:function(){var a,b,c,d=[];for(a=this._children.Count()-1;a>=0;a--)if(b=r(this._children.get(a),i),this.IsSpreadsheet())for(c=b.Children().Count()-1;c>=0;c--)d.push(b.Children().get(c));else d.push(b);return d},UserExtendible:function(){return this._userExtendible},AllIterationsAreHidden:function(){var a,b,c=!0;for(a=0;a<this.Children().Count();a++)if(b=this.Children().get(a),b.ShowInOutline()){c=!1;break}return c},ShowInOutline:function(){return this.IsSpreadsheet()&&this.IsOnParent()?!1:q.baseclass.ShowInOutline.call(this)&&(this.IsSpreadsheet()||!this.AllIterationsAreHidden())},AvailableForNavigation:function(){return"R"==this._dialog.rType?!1:q.baseclass.AvailableForNavigation.call(this)},NextIterationId:function(){return++this._iterationTally},SetEditRow:function(a){!this._interview.HasValidationErrors()&&this.IsSpreadsheet()&&(this._editingRow=a,this._interview.ForgetLocation())},ClearEditRowMode:function(){this._interview.HasValidationErrors()||(this.ClearFocusedItemNode(),this.SetEditRow(-1))},EvTitle:function(){var a=this._dialog.EvRptT();return s(a)&&(a=this._dialog.EvTitle()),a},DoAnsweredStatusTabulation:function(){var a,b;for(this._answeredStatus.Reset(),a=0;a<this._children.Count();a++)b=this._children.get(a),(!b.New()||0==a)&&e.Aggregate(this._answeredStatus,b.AnsStatus())},DoImplicitAnswerProcessing:function(){if(this.IsSpreadsheet()){var a,b;for(a=0;a<this._children.Count();a++)b=this._children.get(a),b.New()||b.DoImplicitAnswerProcessing()}},IterationIsAnswered:function(a){return this._children.get(a).AnsStatus().IsAnswered()},GetFirstFocusableNode:function(){return!this.IsSpreadsheet()||this.IsOnParent()?this._children.get(0):this},AddIteration:function(){var b={};if(this.DoAnswerSync(),this._interview.Navigator().CanProceedToNode(this.NewIteration(),b)){var c=this._interview.GetFocusItem();if(null!=c&&c.OnAnswerSync(),this._interview.CurrentOutlineNode()==this.NewIteration())return!1;this._interview.ClearFocusItem(),this._interview.IsSinglePage()&&this._interview.IgnoreNextFocus(),this.GotoNewIteration(!0)}else a.Alert(b);return!0},EditIteration:function(a,b,c){var d=this.GetFocusedItemNode();null!=d&&(d.OnAnswerSync(),d=null),this.SetEditRow(a),this._interview.GotoDialog(this.Children().get(a),b,!0,null,m.proxy(function(a){a?(b.s="",c(!0)):(this.SetEditRow(-1),c(!1))},this))},InsertIteration:function(b){if(0>b)throw new d(a.Lc.GetStr("err_idxgt0"),"atIndex");if(b>this.AnsweredIterationCount)throw new d(a.Lc.GetStr("err_idxexceeds"),"atIndex");var c,e,f,g=this.GetFocusedItemNode();return null!=g&&(g.OnAnswerSync(),g=null),this._children.get(b).New()?(this._children.get(b).AdvanceFocus(!1,l.Forward),void 0):(this.AddingIterationsIsEnabled()&&(this.ClearFocusedItemNode(),this._interview.ClearRpt(),this._interview.SyncRepeatStackWithNode(this),this._interview.PushRpt(this._dialog.name),this._interview.CurrentIndex(b),this.Children().Insert(b,new i(this._interview,this,!1)),this.AnsweredIterationCount++,(!this.IsSpreadsheet()||this.EditRowMode())&&this._interview.ForgetLocation(),c=k.PushIndex(this._indices,b),this._interview.BeginBulkAnswerChange(),this.InsertOrDeleteIterationAnswers(this._dialog,!1,c),this._interview.EndBulkAnswerChange(!1),this.IsSpreadsheet()&&!this.EditRowMode()?(e=this.SpreadsheetItemNode(),e.SetRowFocus(b),this._interview.TriggerFocusEnter(e,null,l.Forward),e.AssertFocus(n.AdvanceIfNecessary,l.Forward,m.proxy(function(){this._interview.InBulkAnswerChange()||this._interview.Update()},this))):(f={s:null},this._interview.GotoDialog(this.Children().get(b),f,!0,null,function(b){b||a.Alert(f),this._interview.InBulkAnswerChange()||this._interview.Update()}))),void 0)},DeleteIteration:function(b){if(0>b)throw new d(a.Lc.GetStr("err_idxgt0"),"atIndex");if(this._children.get(b).New())return this._children.get(b).AdvanceFocus(!1,l.Forward),void 0;var c,e,f,h,i=!1;b>0&&!this.IsSpreadsheet()&&(b==this._children.Count()-1?i=!0:b==this._children.Count()-2&&this._children.get(b+1).New()&&(i=!0)),this.IsSpreadsheet()&&this.ClearFocusedItemNode();var j=this.ContainsDescendant(this._interview.RequiredNode())||this.Children().get(b)==this._interview.RequiredNode();if(this.Children().RemoveAt(b),this.AnsweredIterationCount>0&&this.AnsweredIterationCount--,(!this.IsSpreadsheet()||this.EditRowMode())&&this._interview.ForgetLocation(),c=k.PushIndex(this._indices,b),this._interview.BeginBulkAnswerChange(),this.InsertOrDeleteIterationAnswers(this._dialog,!0,c),this._interview.EndBulkAnswerChange(!i||j),i){for(e=b-1;e>0&&!this._children.get(e).AnsStatus().IsAnswered();)e--;this._children.get(e).SetUpdateFlags(g.AddButtonRefresh),f={s:null},this._interview.GotoDialog(this._children.get(e),f,!0,null,function(b){b||a.Alert(f)})}else this.IsSpreadsheet()&&!this.EditRowMode()&&(h=b<this.Children().Count()?b:this.Children().Count()-1,this.SpreadsheetItemNode().SetRowFocus(h))},InsertOrDeleteIterationAnswers:function(b,c,d){var e,f,h;for(this.SetUpdateFlags(g.RepeatAnswer),e=0;e<b.vList.Count();e++)f=b.vList.GetItem(e),f instanceof o&&(h=this._interview._engine.GetAnswer(f.name,f.type),null!=h&&(c?h.DeleteIteration(d):h.InsertIteration(d)),f instanceof a.Dlg&&this.InsertOrDeleteIterationAnswers(r(f,a.Dlg),c,d))},MoveIteration:function(b,c){if(0>b||0>c)throw new d(a.Lc.GetStr("err_idxgt0"),0>b?"atIndex":"toIndex");if(b!=c){var e,f,h,i,j,l,m,n=this.GetFocusedItemNode();for(null!=n&&(n.OnAnswerSync(),n=null),e=this.IsSpreadsheet()&&!this.EditRowMode(),f=e?this.Children().get(b).GetFocusedItemNode().DialogItem().name:null,this.Children().Move(b,c),e&&this.SpreadsheetItemNode().SetRowFocus(c),this.SetUpdateFlags(g.RepeatAnswer|g.NodeChildCount|g.ChildCount),e||this._interview.ForgetLocation(),h=k.PushIndex(this._indices,b),this._interview.BeginBulkAnswerChange(),l=0;l<this._dialog.vList.Count();l++)m=this._dialog.vList.GetItem(l),m instanceof o&&(i=this._interview._engine.GetAnswer(m.name,m.type),null!=i&&i.MoveIteration(h,c));this._interview.EndBulkAnswerChange(),e?this.Children().get(c)._itemNodes.get(f).SetFocus(null):(j={s:null},this._interview.GotoDialog(this.Children().get(c),j,!0,null,function(b){b||a.Alert(j)}))}},GotoNewIteration:function(b){var c=this.NewIteration(),d={s:null};null!=c&&this._interview.GotoDialog(c,d,!0,null,function(e){e?b&&c.AdvanceFocus(!1,l.Forward):a.Alert(d)})},SerializeAttributes:function(a){a.WriteAttributeString("Type",this._dialog.rType.toString()),q.baseclass.SerializeAttributes(a),a.WriteAttributeString("Count",this.AnsweredIterationCount.toString()),this.Limit>0&&a.WriteAttributeString("Limit",this.Limit.toString()),this._editingRow>=0&&a.WriteAttributeString("EditingRow",this._editingRow.toString())}},{CreateOrLocate:function(a,b,d,e){var g,i;if(null==a)throw new c("interview");if(null==b)throw new c("parent");if(null==d)throw new c("dialog");return g=a.CurrentBuildNode()!=b?r(a.CurrentBuildNode(),h):null,i=r(b.Children().FindExisting(d.name,f.Repeat,g,a.CurrentTemplate()),q),null==i?(i=new q(a,b,d),e.v=!0):e.v=!1,i.InitUpdate(),i}}),q}),define("system/jquery.hd.gridsplitter",["hdmain/jq"],function(a){var b,c,d,e=a.proxy,f="GridSplitter",g="hd-gridsplitter",h=".hd"+f,i="touchstart",j="touchmove",k="touchend",l="mousemove",m="mouseup",n="mousedown";return a.widget("hd."+f,{options:{type:"v",minWidth:[80,225]},_create:function(){a.Widget.prototype._create.apply(this,arguments),this.option(this.options),this.element.attr("tabindex",4).addClass("HD3DObject "+g).on(n+h+" "+i+h,e(this._drag,this))},_setOption:function(b,c){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"type":this.element.addClass(g+"-"+c)}},_drag:function(f){if(f.preventDefault&&f.preventDefault(),!f||f.type!=n||1==f.which){var g=this.options,o=document.documentElement,p=document.body;switch(g.type){case"v":g.leftDiv=a(g.target),d=f.clientX+o.scrollLeft+p.scrollLeft,b=g.leftDiv.width(),isNaN(d)&&f.type==i&&(d=f.originalEvent.touches[0].pageX+o.scrollLeft+p.scrollLeft);break;case"h":g.leftDiv=a(g.elems[0]),g.rightDiv=a(g.elems[1]),d=o.scrollTop+p.scrollTop+f.clientY,b=g.leftDiv.height(),c=g.rightDiv.height(),isNaN(d)&&f.type==i&&(d=o.scrollTop+p.scrollTop+f.originalEvent.touches[0].pageY)}switch(f.type){case i:a(document).on(j+h,e(this._move,this)).on(k+h,e(this._drop,this));break;default:a(document).on(l+h+" "+j+h,e(this._move,this)).on(m+h+" "+k+h,e(this._drop,this))}}},_move:function(a){var e,f,g,h=this.options,i=document.documentElement,k=document.body;switch(h.type){case"v":e=i.scrollLeft+k.scrollLeft+a.clientX-d,isNaN(e)&&a.type==j&&(e=i.scrollLeft+k.scrollLeft+a.originalEvent.targetTouches[0].pageX-d),f=b+e,g=h.leftDiv.parent().width()-f,f>h.minWidth[0]&&g>h.minWidth[1]&&h.leftDiv.width(f).siblings().trigger("LayoutUpdated");break;case"h":e=i.scrollTop+k.scrollTop+a.clientY-d,isNaN(e)&&a.type==j&&(e=i.scrollTop+k.scrollTop+a.originalEvent.targetTouches[0].pageY-d),f=b+e,g=c-e,f>h.minWidth[0]&&g>h.minWidth[1]&&(h.leftDiv.height(f),h.rightDiv.height(g))}a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation(),a.returnValue=!1},_drop:function(){a(document).off(h)}}),a.hd[f]}),define("dialog/focusleavingeventargs",[],function(){function a(a){this.FocusDirection=a}return a}),define("dialog/htmlhostcontrol",["hdmain/system","hdmain/jq","engine/htmlformatter"],function(a,b){var c=a.String.Format;return b.widget("hd.HtmlHostControl",{_create:function(){this.element.hide(),this._id=c("HtmlHost{0}",a.Guid.NewGuid()),this._innerDiv=b("<div/>").appendTo(this.element).attr("id","inner_"+this._id)},SetText:function(a){a=a.replace(/\<\u0020|\u0020\>/gi,function(a){return"< "==a?"&lt; ":" &gt;"}),a=a.replace(/\<\w*\>|\<\/\w*\>/gi,function(a,b,d){var e,f;switch("/"==a.substr(1,1)?(f=a.substr(2,a.length-3).toUpperCase(),e=!1):(f=a.substr(1,a.length-2).toUpperCase(),e=!0),f){case"":return"/"==a.substr(1,1)?"":"&lt;&gt;";case"BR":case"HR":if(e){var g=d.substr(b+a.length).match(/\<\w*\>|\<\/\w*\>/i);if(null==g||g[0].toUpperCase()!=c("</{0}>",f))return c("<{0}/>",f)}return a;case"H1":case"H2":case"H3":case"IMG":case"P":case"DIV":case"SPAN":case"A":case"B":case"STRONG":case"I":case"ITALIC":case"U":case"UNDERLINE":return a;default:return""}}),this._innerDiv.html(a)}}),b.hd.HtmlHostControl}),define("dialog/navigateoperation",{First:0,PreviousUnanswered:1,Previous:2,Next:3,NextUnanswered:4,Last:5,Finish:6}),define("engine/pagemode",{NormalPaged:0,SinglePage:1}),define("dialog/dialogcontrol",["hd","api","hdmain/system","hdmain/jq","hdmain/stack","system/jq.menu/menuitem","system/jq.menu/menu","system/jquery.hd.popup","system/exception/argumentnullexception","dialog/tracehelper","dialog/navigationuistate","engine/stringparsersource","engine/dotcodeparser","engine/htmlformatter","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode","engine/repeatnode","engine/focusdirection","system/jquery.hd.gridsplitter","dialog/hdnavbarcell","dialog/hdnavseppos","dialog/focusleavingeventargs","dialog/htmlhostcontrol","dialog/navigateoperation","engine/pagemode","runtime/variable"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(a){if(0!=a.length){if(a.is("button")){var b=a.children(".hd-btn-text"),c=a.children("div");b.height()>c.height()?c.children("img").length>0?c.css("background-image","none"):c.css("margin-top",Math.round((b.height()-c.height())/2)+"px"):b.css("line-height",c.height()+"px")}a.children().each(function(){D(d(this))})}}function E(a,b,c,d,e){var f=a.substr(0,4).toUpperCase(),g='<a href="'+a+'"'+("HTTP"!=f&&"NTTP"!=f||b?">":' target="_blank">');return L(e,g+'<div class="hd-img hd-rsrc" border=0 style="visibility:visible"></div></a>&nbsp;'+g,d,"</a>",c)}function F(a){if(a===C)F.call(this,this.GetNavigationGroupPanel(v.Left)),F.call(this,this.GetNavigationGroupPanel(v.Middle)),F.call(this,this.GetNavigationGroupPanel(v.Right));else{var b,c,d,e,f,g,h=[];for(b=0;b<a.children().length;b++)e=J(a.children().eq(b),"Button"),null!=e&&e.options.Visibility==I.Visible&&h.push(b);for(d=h.length,b=d>0?h[0]:a.children().length,c=0;b>c;c++)f=a.children().eq(c),f.hasClass("hd-img")&&f.hide();if(0==d)return;for(b=1;d>b;b++)for(g=!0,c=h[b-1]+1;c<h[b];c++)f=a.children().eq(c),f.hasClass("hd-img")&&(f.css("display",g?null:"none"),g=!1);for(c=h[d-1]+1;c<a.children().length;c++)f=a.children().eq(c),f.hasClass("hd-img")&&f.hide()}}function G(){1==arguments.length?(this.InterviewNode=arguments[0],this.Type=W.DialogResource):(this.DialogItemNode=arguments[0],this.OptionName=arguments[1],this.Type=W.DialogItemResource),this.Equals=function(a){return null==a?!1:a.Type==this.Type?a.Type==W.DialogResource?a.InterviewNode==this.InterviewNode:a.DialogItemNode==this.DialogItemNode&&a.OptionName==this.OptionName:!1}}var H=d.proxy,I=c.Windows.Visibility,J=c.Cast,K=c.String.IsNullOrEmpty,L=c.String.Format,M=c.Windows.Controls.ToolTipService.SetToolTip,N="CurrentOutlineNode",O="IInterviewNodeControl",P="NavigationBarTextVisibility",Q="CustomNavigationbarButton",R="DialogControl",S="NavigationKeyPress",T="ResourceUpdate",U="keydown",V=new m,W={DialogResource:0,DialogItemResource:1};return a.ButtonGlyphWidth=18,d.widget("hd."+R,{_create:function(){var a,b,c=this.options;if(this.InitializeComponent(),null==c.interview)throw new i("interview");this.element.on("LayoutUpdated",H(this.DialogControl_LayoutUpdated,this)),c[P]=I.Visible,a=c.interview,d(a).on("PageModeChanging",H(this._interview_PageModeChanging,this)).on("RefreshDialogContent",H(this._interview_RefreshDialogContent,this)).on("RefreshInterviewProgress",H(this._interview_RefreshInterviewProgress,this)).on("Navigated",H(this._interview_Navigated,this)).on("MoveFocus",H(this._interview_MoveFocus,this)).on("Closing",H(this.OnClosed,this)),c.PageMode=a.IsSinglePage()?A.SinglePage:A.NormalPaged,a.wantsprog=!0,b=a.GetResourceString,this.First.Button({label:b("navb_First")}),this.Previous.Button({label:b("navb_Prev")}),this.Next.Button({label:b("navb_Next")}),this.Last.Button({label:b("navb_Last")}),this.Finish.Button({label:b("navb_Finish")}),this.More.Button({label:b("navb_More")}),this.CreateKeyboardAccelerators(),M(this.First,b("uitt_First")),M(this.PreviousUnanswered,b("uitt_PrevU")),M(this.Previous,b("uitt_Prev")),M(this.Next,b("uitt_Next")),M(this.NextUnanswered,b("uitt_NextU")),M(this.Last,b("uitt_Last")),M(this.Finish,b(a.IsPopup()?"nav_FinPopup":"nav_Finish")),M(this.More,b("nav_More")),this.Finish.on(U,H(this.Finish_KeyDown,this)),this._setOption("ProgressBarEnabled",a.ProgressBarEnabled()),this.UpdateProgressBar(a.HasRequiredUnansweredQuestions(),a.HasErrorText(),a.AnsweredCount(),a.TotalCount()),this.option(c)},_setOption:function(b,c){var e,f,g=this.options,h=g[b],i=g.interview;switch(b){case"ProgressBarEnabled":this.ProgressBar[c?"show":"hide"]();break;case"ResourcePaneVisibility":h===C&&(h="none"==this.ResourcePane.css("display")?I.Collapsed:I.Visible),h!=c&&(e=this.LayoutRoot.children().last(),c==I.Visible?(e.height(Math.max(Math.min(this._resourcePaneHeight>0?this._resourcePaneHeight:g.interview.ResourcePaneInitialHeight(),this.DialogGrid.height()/2),30)).css("min-height",30),this.DialogResourceSplitter.show(),this.ResourcePane.show(),this.UpdateResourcePane(),this.DialogGrid.height(this.DialogGrid.height()-e.outerHeight()-this.DialogResourceSplitter.outerHeight()-this.TitleGrid.outerHeight())):(this.DialogGrid.height(this.DialogGrid.height()+e.outerHeight()+this.DialogResourceSplitter.outerHeight()+this.TitleGrid.outerHeight()),this._resourcePaneHeight=e.height(),e.css("min-height",0).height(0),this.DialogResourceSplitter.hide(),this.ResourcePane.hide()));break;case P:c!=h&&this.SetTextBlockVisibility(this.Navigationbar(),c);break;case"PageMode":c!=h&&(i.DoAnswerSync(),f={s:null},i.SetPageMode(c,f,!0)?i.Update():a.Alert(f),this._reassertFocus=!0)}d.Widget.prototype._setOption.apply(this,arguments)},InitializeComponent:function(){this._resourcePaneHeight=0,this._navigationButtonMinHeight=0,this.LayoutRoot=this.element.addClass("hd-dialog-control").on(U,H(this.OnKeyDown,this)),this.TitleGrid=d("<div id='hdDlgTitle'/>").appendTo(this.LayoutRoot),this.DialogGrid=d("<div class='hd-dlg-content'/>").appendTo(this.LayoutRoot),this.ContentGrid=d('<table id="HDContentGrid" class="hd-content-grid"/>').appendTo(this.DialogGrid),d('<colgroup width="16%" span="6" style="width:16%"/>').appendTo(this.ContentGrid),this.NavigationGrid=d("<div/>").attr("id","hdNavBar").addClass("HD3DObject").appendTo(this.LayoutRoot);var a=d('<div class="hd-nav-table"/>').appendTo(this.NavigationGrid),b="hdResourcePane";this.NavGroupLeft=d('<div class="hd-nav-left"/>').appendTo(a),this.First=d('<button Name="First" tabindex="1"/>').appendTo(this.NavGroupLeft).Button({click:H(this.First_Click,this),type:2,icon:"hd-nav-First"}),this.NavGroupMiddle=d('<div class="hd-nav-middle"/>').appendTo(a),this.PreviousUnanswered=d('<button Name="PreviousUnanswered" tabindex="2"/>').appendTo(this.NavGroupMiddle).Button({click:H(this.PreviousUnanswered_Click,this),type:1,icon:"hd-nav-PrevU"}),this.Previous=d('<button Name="Previous" tabindex="2"/>').appendTo(this.NavGroupMiddle).Button({click:H(this.Previous_Click,this),type:2,icon:"hd-nav-Prev"}),this.Next=d('<button Name="Next" tabindex="2"/>').appendTo(this.NavGroupMiddle).Button({click:H(this.Next_Click,this),type:3,icon:"hd-nav-Next"}),this.NextUnanswered=d('<button Name="NextUnanswered" tabindex="2"/>').appendTo(this.NavGroupMiddle).Button({click:H(this.NextUnanswered_Click,this),type:1,icon:"hd-nav-NextU"}),this.NavGroupRight=d('<div class="hd-nav-right"/>').insertBefore(this.NavGroupMiddle),this.Last=d('<button Name="Last" tabindex="3"/>').appendTo(this.NavGroupRight).Button({click:H(this.Last_Click,this),type:3,icon:"hd-nav-Last"}),this.NavSep=d("<div class='hd-img hd-nav-Sep' style='margin:0'/>").appendTo(this.NavGroupRight),this.Finish=d('<button Name="Finish" tabindex="3"/>').appendTo(this.NavGroupRight).Button({click:H(this.Finish_Click,this),type:3,icon:"hd-nav-Finish"}),this.NavGroupSff=d('<div class="hd-nav-sff"/>').css({display:"table",width:"100%","table-layout":"fixed"}).insertAfter(this.NavGroupMiddle).hide(),d('<div style="float:left; text-align:left;"/>').appendTo(this.NavGroupSff),d('<div style="float:right; text-align:right;"/>').appendTo(this.NavGroupSff);var c=d('<div style="text-align:center;"/>').appendTo(this.NavGroupSff);d('<span class="hd-nav-sff-1 hd-nav-sff-placeholder"/>').insertBefore(this.Previous),this.Previous.addClass("hd-nav-lff-1"),d('<span class="hd-nav-sff-2 hd-nav-sff-placeholder"/>').insertBefore(this.Next),this.Next.addClass("hd-nav-lff-2"),d('<span class="hd-nav-sff-3 hd-nav-sff-placeholder"/>').insertBefore(this.Finish),this.Finish.addClass("hd-nav-lff-3"),this.More=d('<button Name="More" tabindex="2"/>').appendTo(c).Button({click:H(this.More_Click,this),type:3,icon:"hd-nav-More"}),this.MorePopup=null,this.ProgressBar=d("<div/>").appendTo(this.LayoutRoot).progressbar(),this.DialogResourceSplitter=d("<div/>").appendTo(this.LayoutRoot).hide().GridSplitter({type:"h",elems:[".hd-dlg-content","#"+b],minWidth:[40,30]}),this.ResourcePane=d("<div/>").attr("id",b).HtmlHostControl().appendTo(this.LayoutRoot)},CreateKeyboardAccelerators:function(){var a,b,c,d,e,f,g=[this.First,this.Previous,this.Next,this.Last,this.Finish];for(this.options.AccessKeys={},a=0;a<g.length;a++)b=g[a],c=b.children("span"),null!=c&&(d=c.text(),e=d.indexOf("&"),e>=0&&(f=d.substr(e+1,1),K(f)||(c.html(d.substr(0,e)+"<u>"+f+"</u>"+d.substr(e+2)),this.options.AccessKeys[f.toUpperCase().charCodeAt(0)]=b)))},CustomNavigationbarClicked:function(a){b._clickCustNBBtn(a)},CustomNavigationbarEnabled:function(a,c){b._custNBBtnIsEnabled(a,c)},ApplyCustomNavigationbarButtonDefinitions:function(a){var b,c,e,f,g,h,i,j;for(b=0;b<a.length;b++){for(e=a[b],f=d("<button/>")[Q]({id:e.ID,clickEnabledDel:d.hd[R].MayInvokeButton,clickedDel:this.CustomNavigationbarClicked,activeDel:e.HasEnabledState?this.CustomNavigationbarEnabled:null,type:e.ButtonType,sep:e.SeparatorPos,label:e.ButtonText,tip:e.Tooltip,image:e.ImageName}).attr({tabIndex:e.Cell+1,Name:e.Name}),null!=this._hiddenNavigationbarButtons&&this._hiddenNavigationbarButtons.indexOf(e.ID)>=0&&(f.hide(),this._hiddenNavigationbarButtons.splice(this._hiddenNavigationbarButtons.indexOf(e.ID),1)),g=[],h=this.GetNavigationGroupPanel(e.Cell),c=0;c<h.children().length;c++)h.children().eq(c).is("button")&&g.push(c);i=e.ButtonIndex,i>=g.length&&(i=-1),i>=0&&(i=g[i],this.HasLeftSeparator(h.children()[i])&&i--),(e.SeparatorPos==w.Left||e.SeparatorPos==w.Both)&&(j=this.CreateSeparatorImage(),0>i?j.appendTo(h):h.children().eq(i++).before(j)),0>i?f.appendTo(h):h.children().eq(i++).before(f),(e.SeparatorPos==w.Right||e.SeparatorPos==w.Both)&&(j=this.CreateSeparatorImage(),0>i?j.appendTo(h):h.children().eq(i++).before(j)),F.call(this,h),e.HasEnabledState&&(this._customESBtns===C&&(this._customESBtns=[]),this._customESBtns.push(f)),this.FirstCustomNavButton===C&&(this.FirstCustomNavButton=f),D(f)}},GetNavigationbarButtonInternalName:function(a){var b=k.GetBuiltInButtonInternalName(a);return K(b)?a:b},ClickTheButton:function(a){a.click()},CreateSeparatorImage:function(){return d("<div class='hd-img hd-nav-Sep'/>")},GetSeparator:function(a){var b=a;return null!=b?b.Separator:a.Name==k.FinishButtonName?w.Left:w.None},HasLeftSeparator:function(a){var b=this.GetSeparator(a);return b==w.Left||b==w.Both},GetNavigationGroupPanel:function(a){return a==v.Left?this.Navigationbar().find(".hd-nav-left"):a==v.Middle?this.Navigationbar().find(".hd-nav-middle"):this.Navigationbar().find(".hd-nav-right")},SetNavButtonMinHeight:function(a){D(a)},SetTextBlockVisibility:function(a,b){if(null!=a){if(null!=J(a,Q))return a[Q]("ShowText",b==I.Visible),void 0;if(a.data("hd-Button"))return a.children("span").css({width:b==I.Visible?"auto":"1px",visibility:b==I.Visible?"visible":"hidden"}),void 0;var c=this;d.each(a.find("button"),function(){c.SetTextBlockVisibility(d(this),b)})}},ToggleNavBar:function(){var a=this.options;this.Navigationbar().outerHeight()<this.Navigationbar()[0].scrollHeight?a[P]==I.Visible?(this._setOption(P,I.Collapsed),this.ToggleNavBar()):(this.NavGroupSff.show().siblings().hide(),this.Previous.appendTo(this.NavGroupSff.children().eq(0)),this.Next.appendTo(this.NavGroupSff.children().eq(0)),this.Finish.appendTo(this.NavGroupSff.children().eq(1))):this.NavGroupSff.is(":visible")?(this.NavGroupSff.hide().siblings().show(),this.Previous.insertAfter(".hd-nav-sff-1"),this.Next.insertAfter(".hd-nav-sff-2"),this.Finish.insertAfter(".hd-nav-sff-3"),this.ToggleNavBar()):a[P]==I.Collapsed&&(this._setOption(P,I.Visible),this.Navigationbar().outerHeight()<this.Navigationbar()[0].scrollHeight&&this._setOption(P,I.Collapsed))},DialogControl_LayoutUpdated:function(){var a,b,e,f,g,h=this.options;if(this._reassertFocus&&(this._reassertFocus=!1,h.interview[N]().ReassertFocus(t.Forward)),this._navigationButtonMinHeight<=0&&(a=this.element.find("button[name="+k.FirstButtonName+"]"),a.length>0))return this._navigationButtonMinHeight=a.outerHeight(),c.CallAsync(H(function(){D(this.Navigationbar())},this)),void 0;this.ToggleNavBar(),b=this.element.width();var i,j=450;this.ContentGrid.children("tbody").each(function(){i=J(d(this),O),null!=i&&(!i.options.sff&&j>=b&&(i.options.sff=!0,i.Update(!0)),b>j&&i.options.sff&&(i.options.sff=!1,i.Update(!0)))}),null!=i&&(e=d("#hdInterviewDiv"),f=e.children(".hd-dlg-content"),i.options.sff||(g=Math.max(10,e.width()/6-50),f.find(".hd-width-calc, .hd-width-exact").each(function(){var a=d(this),b=a.closest(".hd-cell-input"),c=b.attr("colspan")*g,e=a.width(),f=parseInt(a.attr("hdwidth"));(e>=f||c>f)&&a.width(f),(f>c&&c>e||e>c)&&a.width(c)})),f.find(".hd-grid").triggerHandler("LayoutUpdated"))},UpdateProgressBar:function(a,c,d,e){this.ProgressBar.progressbar({Maximum:e,Value:d});var f,g=null;g=a||c?"hd-progress-required":d>=e?"hd-progress-complete":"hd-progress-normal",null!=g&&this.ProgressBar.progressbar({Foreground:g}),f=a?c?4:2:c?3:d>=e?0:1,b._invokeHandler("OnHDProgress",!1,!1,"Answered",d,"Total",e,"State",f)},_interview_RefreshInterviewProgress:function(a,b){this.UpdateProgressBar(b.ru,b.et,b.aq,b.tq)},_interview_PageModeChanging:function(){this.ClearContentGrid()},UpdateBuiltInNavigationbarButtons:function(){var a=this.options.interview;this.First.Button("IsEnabled",a.IsFirstEnabled()),this.PreviousUnanswered.Button("IsEnabled",a.IsPreviousUnansEnabled()),this.Previous.Button("IsEnabled",a.IsPreviousEnabled()),this.Next.Button("IsEnabled",a.IsNextEnabled()),this.NextUnanswered.Button("IsEnabled",a.IsNextUnansEnabled()),this.Last.Button("IsEnabled",a.IsLastEnabled())},SetNavigationbarButtonVisible:function(a,b){var c,d=this.GetNavigationbarButtonInternalName(a);return K(d)?!1:(c=J(this.Navigationbar().find("[Name='"+(d==k.FinishPopupButtonName?k.FinishButtonName:d)+"']"),"Button"),null!=c&&(c._setOption("Visibility",b?I.Visible:I.Collapsed),F.call(this)),K(k.GetBuiltInButtonInternalName(a))&&(b?null!=this._hiddenNavigationbarButtons&&this._hiddenNavigationbarButtons[d]!==C&&this._hiddenNavigationbarButtons.splice(this._hiddenNavigationbarButtons.indexOf(d),1):(this._hiddenNavigationbarButtons===C&&(this._hiddenNavigationbarButtons=[]),this._hiddenNavigationbarButtons.push(d))),null!=c)},SetNavButtonImage:function(a,b){if(0!=a.length&&0!=a.width()){var c,e="hd-img",f=e+"-g",g=a.hasClass(f);return a.hasClass(e)||g?(a.removeClass().addClass("hd-blank "+(g?f:e)).css({width:"auto"}),c=a.children("img"),0==c.length&&(c=d("<img>").appendTo(a)),c.attr("src",b),void 0):(this.SetNavButtonImage(a.find("."+e+", ."+f),b),void 0)}},SetNavigationbarButtonImage:function(a,b){var c,d,e,f=this.GetNavigationbarButtonInternalName(a);K(f)||(c=this.Navigationbar().find("[Name="+(f==k.FinishPopupButtonName?k.FinishButtonName:f)+"]"),c.length>0&&(d=J(c,Q),e=null!=d?d.GetCustomButtonImageSource(b):k.MakeBuiltInButtonImageUri(f),this.SetNavButtonImage(c,e)))},IsNavigationbarButtonEnabled:function(a){if(d.hd[R].MayInvokeButton()){var b,c,e=this.GetNavigationbarButtonInternalName(a);if(!K(e)&&(b=this.Navigationbar().FindName(e==k.FinishPopupButtonName?k.FinishButtonName:e),null!=b&&(c=b,null!=c?c.CheckActive():UpdateBuiltInNavigationbarButtons(),b.IsEnabled)))return!0}return!1},InvokeNavigationbarButton:function(a){if(d.hd[R].MayInvokeButton()){var b,c,e=this.GetNavigationbarButtonInternalName(a);if(!K(e)&&(b=J(this.Navigationbar().find("[Name="+(e==k.FinishPopupButtonName?k.FinishButtonName:e)+"]"),"Button"),null!=b))return c=J(b.element,Q),null!=c?c.CheckActive():this.UpdateBuiltInNavigationbarButtons(),b.IsEnabled()&&this.ClickTheButton(b.element),!0}return!1},UpdateCustomNavigationbarButtons:function(){if(null!=this._customESBtns){var a,b;for(a=0;a<this._customESBtns.length;a++)b=this._customESBtns[a],b[Q]("CheckActive")}},_interview_RefreshDialogContent:function(a,b){var c,d,e,f=this.options.interview;
f.IsSinglePage()?this.SinglePageUpdate():this.MultiPageUpdate(b.CurrentNodeChanged),this._currentResource=null,this.UpdateBuiltInNavigationbarButtons(),this.UpdateCustomNavigationbarButtons(),f.InEditSpreadsheetRow()?(c="hd-nav-FinishEM",d="nav_FinEM"):f.IsPopup()?(c=k.MakeBuiltInButtonImageUri(k.FinishPopupButtonName),d="nav_FinPopup"):(c=k.MakeBuiltInButtonImageUri(k.FinishButtonName),d="nav_Finish"),(K(this._finishButtonToolTipKey)||this._finishButtonToolTipKey!=d)&&(e=this.Finish.children(".hd-img"),e.removeClass().addClass("hd-img "+c),M(this.Finish,f.GetResourceString(d)),this._finishButtonToolTipKey=d)},_interview_Navigated:function(b,d){var e,f,g,h,i,j,k=this.options,l=null;if(d.s)if(k.interview.IsSinglePage()){if(this.ContentGrid.height()>0&&(e=k.interview[N](),null!=e))for(f=null,g=0;g<this.ContentGrid.children("tbody").length;g++){if(f=J(this.ContentGrid.children("tbody").eq(g),O),null!=f)if(f.options.InterviewNode._id==e._id)l=f.element;else if(f.options.InterviewNode instanceof s)for(i=f.options.InterviewNode.OutlineChildren(),h=i.length;h--;)if(i[h]._id==e._id){l=f.LayoutRoot.children().eq(h);break}if(null!=l){l.scrollintoview();break}}}else this.DialogGrid.scrollTop(0);null!=k.interview.CurrentNode()&&null!=k.interview.CurrentNode()._dialog&&null!=k.interview.CurrentNode()._dialog.rsrc?(j=new G(k.interview.CurrentNode()),null!=this._currentResource&&this._currentResource.Equals(j)||(this._currentResource=j)):this._currentResource=null,this.UpdateResourcePane(),d.f&&c.CallAsync(H(function(){null!=a[N]()&&a[N]().AdvanceFocus(!1,t.Forward)},this))},ScrollFocusIntoView:function(){},_interview_MoveFocus:function(){this.ScrollFocusIntoView()},SinglePageUpdate:function(){this.TitleGrid.hide();var a,b,c,e,f,g,h,i=this.options;if(0!=(i.interview.Root().DescendantUpdateflags()&p.SinglePageRelated)){for(c=0;c<i.interview.Root().Children().Count();c++){if(a=i.interview.Root().Children().get(c),b=null,(a.UpdateFlags()&p.NewlyAdded)!=p.NewlyAdded){for(e=c;e<this.ContentGrid.children("tbody").length&&J(this.ContentGrid.children("tbody").eq(e),O).options.InterviewNode._id!=a._id;e++);if(e<this.ContentGrid.children("tbody").length){for(f=c;e>f;f++)this.RemoveInterviewNodeControl(c);g=J(this.ContentGrid.children("tbody").eq(c),O),g.Update(!1),b=g}}null==b&&(h=J(a,s),g=null==h||h.IsSpreadsheet()?d("<tbody/>").DialogContentControl({InterviewNode:a,caption:a.Type()!=o.DefaultDialog}):d("<tbody/>").RepeatControl({InterviewNode:h}),g.on(S,H(this.interviewNodeControl_NavigationKeyPress,this)).on(T,H(this.interviewNodeControl_ResourceUpdate,this)),J(g,O).Update(!0),b=g,b.appendTo(this.ContentGrid),window.setTimeout(function(){b.trigger("Loaded").trigger("LayoutUpdated")},1)),0==c}for(;c<this.ContentGrid.children("tbody").length;)this.RemoveInterviewNodeControl(c)}},MultiPageUpdate:function(b){this.TitleGrid.show();var c,f,g,h,i,j,k,l,m,n=!1;if(b){for(this.ClearContentGrid(),c=new e,f=null!=a[N]()?J(a[N]()._parent,q):null;null!=f;)!f.IsOnParent()&&(f.Type()==o.Dialog||f.Type()==o.Iteration&&!J(f,r).IsSpreadsheetRow()||f.Type()==o.Repeat&&J(f,s).IsSpreadsheet())&&c.Push(J(f,q)),f=J(f._parent,q);for(g=0;c.Count()>0;)h=d("<div/>").ParentTitleControl({node:c.Pop()}),h.appendTo(this.TitleGrid);null!=a[N]()&&(i=d("<tbody/>").appendTo(this.ContentGrid),window.setTimeout(function(){i.trigger("Loaded")},1),i.DialogContentControl({InterviewNode:a[N](),caption:!0}).on(S,H(this.interviewNodeControl_NavigationKeyPress,this)).on(T,H(this.interviewNodeControl_ResourceUpdate,this))),n=!0}if(n||0!=(this.options.interview.Root().DescendantUpdateflags()&p.DialogRelated)){for(j=0;j<this.TitleGrid.children().length;j++)h=this.TitleGrid.children(j),h.ParentTitleControl("Update",n);this.ContentGrid.children("tbody").length>0&&(i=this.ContentGrid.children("tbody"),i.appendTo(this.ContentGrid.LayoutRoot),this.ContentGrid.children("tbody").length>1&&this.ContentGrid.children("tbody:first").remove(),0==i.children(".hd-hidden-sizer").length&&d('<tr class="hd-hidden-sizer" style="visibility:hidden"><td/><td/><td/><td/><td/><td/></tr>').appendTo(i),i.find("*").load(),i.DialogContentControl("Update",n),i.trigger("LayoutUpdated"),i.DialogContentControl("option","InterviewNode").Type()==o.Iteration&&(k=J(i.DialogContentControl("option","InterviewNode"),r),k.DisplayAddButton()&&!k.IsHiddenNew()&&i.DialogContentControl("UpdateAddButton",n)))}l=d("#InterviewEngine").children().children(),m=l.InterviewControl("option","height"),l.InterviewControl({height:m}),!1},RemoveInterviewNodeControl:function(a){var b=this.ContentGrid.children("tbody").eq(a);b.off(S,this.interviewNodeControl_NavigationKeyPress).off(T,this.interviewNodeControl_ResourceUpdate),J(b,O).Dispose(),b.remove()},ClearContentGrid:function(){for(this.TitleGrid.empty();this.ContentGrid.children("tbody").length>0;)this.RemoveInterviewNodeControl(0)},Navigationbar:function(){return this.NavigationGrid},FindDialogContentControl:function(a,b){var c,d=null;for(c=0;null==d&&c<a.length;c++)d=J(a.eq(c),"DialogContentControl"),null!=d?d.options.InterviewNode._id!=b&&(d=null):d=this.FindDialogContentControl(J(a.eq(c),"RepeatControl").LayoutRoot.children(),b);return d},AdvanceFocus:function(b,c){function e(k){if(null!=k)j.interview.GotoDialog(k,i,!1,!1,function(j){return j||a.Alert(i.s),b==t.Reverse&&k.Type()==o.Iteration&&(f=k,f.DisplayAddButton&&f.AddButtonVisibility()==I.Visible&&f.AddButtonIsEnabled())?(g=this.FindDialogContentControl(ContentGrid.Children,f.ID),h=g.LayoutRoot.Children[g.LayoutRoot.Children.Count-1],h.Focus(),c(!0),void 0):(k.AdvanceFocus(!1,b,d.proxy(function(a){a?c(!0):e.call(this,k.GetNextFocusNode(b))},this)),void 0)});else{if(b==t.Forward){if("none"==this.Navigationbar().css("display"))return c(!1),void 0;if("none"!=this.Next.css("display"))this.Next.focus();else{if(null==this.FirstCustomNavButton||"none"==this.FirstCustomNavButton.css("display")||!this.FirstCustomNavButton.data("hd-"+Q).IsEnabled)return c(!1),void 0;this.FirstCustomNavButton.focus()}return c(!0),void 0}if(this.focuslv)return this.element.trigger("FocusLeaving",new x(t.Reverse)),c(!0),void 0;c(!1)}}c===C&&(c=function(){});var f,g,h,i={},j=this.options;return null==j.interview[N]()?(c(!1),void 0):(e.call(this,j.interview[N]().GetNextFocusNode(b)),void 0)},OnNavigationKeyPress:function(a){if(a.Handled)return!1;var b,e,f,g,h,i,j,k,l=this.options.interview;switch(a.which){case 9:if(b=a.shiftKey?t.Reverse:t.Forward,e=null,f=c.Windows.Input.FocusManager.GetFocusedElement(),null!=f&&(e=J(f,"Button")),null!=e&&null!=e.options.Tag&&e.options.Tag instanceof q)return g=e.element.parent(),h=e.element.index(),b==t.Forward?h<g.children().length-1?(g.children().eq(h+1).focus(),a.Handled=!0):this.AdvanceFocus(b,function(b){a.Handled=b}):h>0?(g.children().eq(h-1).focus(),a.Handled=!0):null!=l[N]()?l[N]().AdvanceFocus(!1,b,H(function(c){c?a.Handled=!0:this.AdvanceFocus(b,function(b){a.Handled=b})},this)):this.AdvanceFocus(b,function(b){a.Handled=b}),a.Handled&&a.preventDefault(),void 0;null!=l[N]()&&l[N]().AdvanceFocus(!0,b,H(function(c){if(c)a.Handled=!0;else if(null!=l[N]()){if(b==t.Forward&&(i=!1,d.hd[R].DisplayAnswerSourceButton(l[N]())?i=!0:l[N]().Type()==o.Iteration&&(j=l[N](),j.DisplayAddButton()&&j.AddButtonVisibility()==I.Visible&&j.AddButtonIsEnabled()&&(i=!0)),i))return k=this.FindDialogContentControl(this.ContentGrid.children("tbody"),l[N]()._id),null!=k&&(g=k.LayoutRoot.children(":last-child"),g.hasClass("hd-hidden-sizer")&&(g=g.prev()),g=g.children("td"),g.children(":first-child").focus()),a.Handled=!0,a.preventDefault(),void 0;this.AdvanceFocus(b,function(b){a.Handled=b})}},this));break;case 33:a.altKey||a.ctrlKey?a.ctrlKey&&(a.Handled=this.DoNavigation(z.PreviousUnanswered)):a.Handled=this.DoNavigation(z.Previous);break;case 34:a.altKey||a.ctrlKey?a.ctrlKey&&(a.Handled=this.DoNavigation(z.NextUnanswered)):a.Handled=this.DoNavigation(z.Next);break;case 36:a.ctrlKey&&(a.Handled=this.DoNavigation(z.First));break;case 35:a.ctrlKey&&(a.Handled=this.DoNavigation(z.Last))}return a.Handled?(a.stopImmediatePropagation(),a.preventDefault(),!1):void 0},OnKeyDown:function(a){if(33==a.which||34==a.which||36==a.which||35==a.which)this.OnNavigationKeyPress(a);else if(8==a.which&&"text"!=a.target.type&&"TEXTAREA"!=a.target.tagName)return!1},interviewNodeControl_NavigationKeyPress:function(a,b){this.OnNavigationKeyPress(b)},OnClosed:function(){this.element.trigger("Closed",{})},Close:function(){this.options.interview.Close()},DoNavigation:function(d){var e,f,g,h=b.ServerResponseVisible(),i=this.options.interview;if("function"!=typeof d){if(!h){switch(f=d,g=!1,f){case z.First:i.IsFirstEnabled()&&(c.CallAsync(H(function(){this.DoNavigation(i.GotoFirst)},this)),g=!0);break;case z.PreviousUnanswered:i.IsPreviousUnansEnabled()&&(c.CallAsync(H(function(){this.DoNavigation(i.GotoPrevUnans)},this)),g=!0);break;case z.Previous:i.IsPreviousEnabled()&&(c.CallAsync(H(function(){this.DoNavigation(i.GotoPrev)},this)),g=!0);break;case z.Next:i.IsNextEnabled()&&(c.CallAsync(H(function(){this.DoNavigation(i.GotoNext)},this)),g=!0);break;case z.NextUnanswered:i.IsNextUnansEnabled()&&(c.CallAsync(H(function(){this.DoNavigation(i.GotoNextUnans)},this)),g=!0);break;case z.Last:i.IsLastEnabled()&&(c.CallAsync(H(function(){this.DoNavigation(i.GotoLast)},this)),g=!0);break;case z.Finish:c.CallAsync(H(function(){this.DoNavigation(i.Finish)},this)),g=!0}g&&i.DoAnswerSync()}return g}if(!h){e=d;var j={s:""};e.call(i,j,function(b,c){!b&&!K(c)&&a.Alert(c)})}},First_Click:function(){return this.DoNavigation(z.First),!1},PreviousUnanswered_Click:function(){return this.DoNavigation(z.PreviousUnanswered),!1},Previous_Click:function(){return this.DoNavigation(z.Previous),!1},Next_Click:function(){return this.DoNavigation(z.Next),!1},NextUnanswered_Click:function(){return this.DoNavigation(z.NextUnanswered),!1},Last_Click:function(){return this.DoNavigation(z.Last),!1},Finish_Click:function(){return this.DoNavigation(z.Finish),!1},More_Click:function(){function a(a,c){this.Navigationbar().find(a).children("button").each(function(){var a=J(d(this),"Button"),e=!a.element.attr("disabled"),f=a.options.tip;K(f)&&(f=a.element.attr("title"));var g=q.FixAmpersands(a.options.label,!1);K(g)&&(g=f);var h=d("<div/>").attr("title",f).appendTo(c).MenuItem({Label:g,Tag:b.length,IsEnabled:e});h.find(".hd-menu-icon").replaceWith(a.icon.clone().addClass("hd-menu-icon").css("float","left")),b.push(a.element)})}var b=[];return null==this.MorePopup&&(this.MorePopup=d("<div/>").Popup({anchor:this.More,anchorPos:"t",open:function(a){var b=0;a.element.find(".hd-menu-item").css("width","auto").each(function(){b=Math.max(b,d(this).outerWidth())}),a.element.find(".hd-menu-item").css("width",.98*b),a.element.find(".hd-menu-base").width(b)}}).css("width","auto"),this.MoreMenu=d("<div/>").appendTo(this.MorePopup).Menu().on("ItemSelected",H(function(a,c){this.MorePopup.Popup("close"),b[c].click()},this))),this.MorePopup.Popup("IsOpen")?this.MorePopup.Popup("close"):(this.MoreMenu.empty(),a.call(this,".hd-nav-left",this.MoreMenu),a.call(this,".hd-nav-middle",this.MoreMenu),a.call(this,".hd-nav-right",this.MoreMenu),this.MorePopup.Popup("open")),!1},Finish_KeyDown:function(a){9==a.which&&!a.shiftKey&&this.element.trigger("FocusLeaving",new x(t.Forward))},UpdateResourcePane:function(){var a="",b=d(".sliding-resource-pane");if(null!=this._currentResource)if(this._currentResource.Type==W.DialogResource){var e=new c.Text.StringBuilder;d.hd[R].AppendResource(e,this._currentResource.InterviewNode._dialog.rsrc,this._currentResource.InterviewNode,this._currentResource.InterviewNode._dialog,null),a=e.ToString()}else a=d.hd[R].GetResourceText(this._currentResource.DialogItemNode,this._currentResource.OptionName,!0);b.html(a),d(".hd-collapse-bar:last").add("#hdResourceTitle").children(".hdtb-btnrs").removeClass("hd-img hd-img-g").addClass(K(a)?"hd-img-g":"hd-img"),this.ResourcePane.HtmlHostControl("SetText",a)},interviewNodeControl_ResourceUpdate:function(a,b){var c=new G(b.DialogItemNode,b.OptionName);null!=this._currentResource&&this._currentResource.Equals(c)||(j.Focus(b.DialogItemNode,L("ResourceUpdate({0})",K(b.OptionName)?"null":b.OptionName)),this._currentResource=c,this.UpdateResourcePane())}}),c.ExtendClass(d.hd[R],null,null,{ScrollIntoView:function(){},DotCodeParser:function(){return V},DisplayResourceWindow:function(c){b._OpenResourceWindow(c,a.Lc.GetStr("rs_title"))},StripAmpersand:function(a){return a.replace(/&/,"")},AppendResource:function(a,b,e,f,g){if(null!=b){var h,i,j,k,m="";"T"==b.type?m=b.EvText():"U"==b.type&&(m=b.EvText()),K(m)||(a.Length>0&&a.Append("<hr/>"),"U"==b.type?(h="",h="MC"!=f.type||K(g)?"DI"==f.type?e.GetResourceString("rs_dlg"):e.GetResourceString("rs_fld"):e.GetResourceString("rs_opt"),i=e.GetResourceButtonCaption(),j=e.GetResourceString("rs_ind"),a.Append(E(b.EvText(),!1,h,i,j))):(k=new c.Text.StringBuilder,d.hd[R].DotCodeParser().Parse(new l(b.EvText()),new n(k),!1),a.Append(k.ToString())))}},DisplayAnswerSourceButton:function(b){if(b.HasAnswerSource()){var c=b._dialog.DataSource;switch(c.t){case"CAF":return!0;case"AF":case"C":return null!=a.DataSourceAddressDict&&a.DataSourceAddressDict[c.n.toLowerCase()]!=C}}return!1},GetResourceText:function(b,e,f){for(var g,h,i,j,k=new c.Text.StringBuilder,l=b.DialogItem(),m=b._parent;null!=l&&(f||"DI"!=l.type||l.onPar)&&(g=J(l,B),null!=g&&("MC"==g.type&&!K(e)&&(h=J(g,a.McVar).opts.GetItem(e),null!=h&&d.hd[R].AppendResource(k,h.rsrc,b._parent,l,e)),d.hd[R].AppendResource(k,g.rsrc,b._parent,l,null)),"DI"!=l.type||null==m||m.Type()!=o.Iteration||!m.IsSpreadsheetRowInEditMode()||!l.onPar)&&(i="DI"==l.type,j=i&&J(l,a.Dlg).onPar,l=null!=l.parent||null==m||m._dialog.lnkVars?l.parent:m._dialog,null!=l&&null!=m&&(m=m.OutlineParent(),null!=m&&m.Type()==o.Repeat&&(m=m.OutlineParent())),!i||j||null==l||"DI"!=l.type););return k.ToString()},MayInvokeButton:function(){return b._assertSvrRspHidden()}}),d.hd[R]}),define("interview/interviewtreenode",["hdmain/jq","system/jq.treeview/node","engine/interviewnodeoutlinefontflags"],function(a,b,c){return a.widget("hd.InterviewTreeNode",b,{_create:function(){b.prototype._create.apply(this)},_setOption:function(a,c){switch(a){case"OutlineFontFlags":c!=this.options.OutlineFontFlags&&(null!=this.ElementText&&this.UpdateElementText(this.ElementText),null!=this.ElementSelectedText&&this.UpdateElementText(this.ElementSelectedText))}b.prototype._setOption.apply(this,arguments)},OnApplyTemplate:function(){b.prototype.OnApplyTemplate.apply(this),this.options.OutlineFontFlags!=c.None&&this.UpdateElementText(this.ElementText)},UpdateElementText:function(a){var b=this.options.OutlineFontFlags;a.css({"font-style":(b&c.Italic)==c.Italic?"italic":"normal","font-weight":(b&c.Bold)==c.Bold?"bold":"normal","text-decoration":(b&c.Underline)==c.Underline?"underline":"none"})}}),a.hd.InterviewTreeNode}),define("interview/nodeeventargs",["hd"],function(a,b){function c(a){this.NodeID=a}return this.DEBUG===b&&(this.DEBUG=a.DEBUG),c}),define("interview/outlinecontrol",["hd","hdmain/jq","system/jq.treeview/tree","hdmain/system","dialog/stringformatter","engine/stringparsersource","engine/interviewnodeoutlinefontflags","engine/answeredstatus","engine/interviewnodetype","engine/dialogupdateflags","dialog/dialogcontrol","interview/interviewtreenode","interview/nodeeventargs"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b.proxy,p="InterviewTreeNode";return this.DEBUG===n&&(this.DEBUG=a.DEBUG),b.widget("hd.OutlineControl",{_create:function(){var c=a.Lc;this.element.attr("id","hdOutlineDiv"),this.LayoutRoot=b('<div id="hdOutlineContent"/>').appendTo(this.element),this.Tree=b('<div id="hdOutlineTree"/>').appendTo(this.LayoutRoot).Tree({NodeClick:o(this.OutlineTree_NodeClick,this),EnableExpandFadeIn:!0}).on("NodeExpanded",o(this.Tree_NodeExpanded,this)),this.Caption=b("<div id='hdOutlineTitle'/>").appendTo(this.LayoutRoot).addClass("hd-float-title-bar"),b('<div class="hd-img hdtb-btnol" style="float:left;"/>').appendTo(this.Caption),this.CloseImage=b("<div style='float:right;' class='hd-img hd-closex' title='"+c.GetStr("tb_ol0")+"'/>").appendTo(this.Caption),this.PinImage=b("<div style='float:right;' class='hd-img hd-dock' title='"+c.GetStr("tb_ol4")+"'/>").appendTo(this.Caption),this.CaptionText=b("<div class='hd-ol-caption-text'/>").appendTo(this.Caption).text(c.GetStr("ui_io")),this.Tree.css("top",this.Caption.outerHeight()),this._setOption("height",this.element.height()),this._inUpdate=!1},_setOption:function(a,c){switch(b.Widget.prototype._setOption.apply(this,arguments),a){case"height":this.Tree.height(c-this.Caption.outerHeight())}},Tree_NodeExpanded:function(){this.element.trigger("NodeExpanded",this,{})},GetNodeAtPoint:function(){},CaptionWidth:function(){return this.CaptionText.width()},OnNodeSelected:function(a){this.element.trigger("NodeSelected",new m(a))},OutlineTree_NodeClick:function(a,c){if(!this._inUpdate){var d=c,e=b(d)[p]("option","ID");if(!b(d)[p]("option","IsEnabled"))return;e>0&&this.OnNodeSelected(e)}},UpdateNodeTitle:function(a,b){var c=new d.Text.StringBuilder,h=g.None;k.DotCodeParser().Parse(new f(a.GetOutlineCaption(h)),new e(c,d.Windows.TextWrapping.NoWrap)),b[p]({Title:c.ToString(),OutlineFontFlags:h})},UpdateNodeStatus:function(a,b){var c="",d=!1;a.Type()!=i.Repeat||a.IsSpreadsheet()?c+="hd-dlg-":(c+="hd-rpt-",d=!0),!d&&a.New()?c+="n":a.AnsStatus().IsHasErrorText()&&a.Enabled()?c+="r":a.AnsStatus().Status()==h.Answered?c+="a":a.AnsStatus().IsUnansweredRequired()&&a.Enabled()?c+="r":a.AnsStatus().Status()==h.PartiallyAnswered?c+="p":a.AnsStatus().Status()==h.Unanswered&&(c+="u"),0!=(a.UpdateFlags()&j.NodeEnabled)&&b[p]({IsEnabled:a.Enabled()}),b[p]({IconContent:(a.Enabled()?"hd-img":"hd-img-g")+" "+c})},UpdateTreeNode:function(a,c){var d,e,f,g,h,i=0;for(g=0;g<c.length;g++)if(h=c[g],h.ShowInOutline()){for(e=i;e<a.Count()&&a.get(e)[p]("option","ID")!=h._id;e++);if(e<a.Count()){for(f=i;e>f;f++)a.RemoveAt(i);d=a.get(i++),0!=(h.UpdateFlags()&j.NodeTitle)&&this.UpdateNodeTitle(h,d),0!=(h.UpdateFlags()&j.StatusRelated)&&this.UpdateNodeStatus(h,d)}else d=b("<li/>")[p]({Style:"InterviewOutlineStyle",ID:h._id,HasChildren:h.HasVisibleChildren()}),this.UpdateNodeTitle(h,d),this.UpdateNodeStatus(h,d),a.Insert(i++,d);(0!=(h.UpdateFlags()&j.NodeChildCount)||0!=(h.DescendantUpdateflags()&j.OutlineRelated))&&this.UpdateTreeNode(d.data("hd-"+p).Nodes,h.OutlineChildren())}for(;i<a.Count();)a.RemoveAt(i)},Update:function(a,b){var c,d,e=this;if(!e._inUpdate){if(e._inUpdate=!0,null!=a&&(a.HasVisibleChildren()?e.UpdateTreeNode(e.Tree.data("hd-Tree").Nodes,a.OutlineChildren()):e.Tree.data("hd-Tree").Nodes.Clear()),b>=0&&(c=e.Tree.Tree("Get",b),null!=c)){for(d=c.parents("li:first");d.length>0;)d[p]("option","IsExpanded")||d[p]("Expand"),d=d.parents("li:first");c[p]("option","IsExpanded")||c[p]("Expand"),e.Tree.Tree("Selected",c)}e._inUpdate=!1}}}),b.hd.OutlineControl}),define("interview/statustexteventargs",[],function(){function a(a){this.StatusText=a}return a}),define("interview/interviewcontrol",["hd","hdmain/jq","hdmain/system","dialog/customnavigationbarbuttondef","dialog/customnavigationbar","system/jq.menu/menuitem","system/jq.menu/menu","system/jquery.hd.popup","system/exception/argumentnullexception","interview/sidebar","interview/outlinecontrol","engine/dialogupdateflags","engine/interviewnode","system/jquery.hd.gridsplitter","dialog/hdnavbarcell","dialog/hdnavbtntype","dialog/hdnavseppos","dialog/dialogcontrol","dialog/navigateoperation","dialog/interviewstack","interview/statustexteventargs","engine/uistate","engine/pagemode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){function y(){this.OutlineVisibility(jb.Collapsed)}function z(){this.OutlineVisibility(jb.Visible)}function A(a){HDAPI._clickCustTBBtn(a)}function B(a,b){HDAPI._custTBBtnIsActive(a,b)}function C(){HDAPI.DocumentPreview()}function D(){HDAPI._ShowModalResponse(a.HDEngine.GetAnswerSummary(),this._interview[pb]("tb_as"),!0)}function E(){HDAPI._SaveAnswers()}function F(a,b){b(this._interview.IsSinglePage())}function G(){var a=this._dialogControl.DialogControl("option","ResourcePaneVisibility")==jb.Visible?jb.Collapsed:jb.Visible;this.rightBar.SideBar("Slide",null,0,!1),a==jb.Visible?this.rightBar.SideBar("Hide"):this.rightBar.SideBar("Show"),this._dialogControl.DialogControl({ResourcePaneVisibility:a}),this.element.resize()}function H(){this._dialogControl.DialogControl({PageMode:this._dialogControl.DialogControl("option","PageMode")==w.NormalPaged?w.SinglePage:w.NormalPaged})}function I(){HDAPI._showInterviewHelp()}function J(a){switch(a){case 0:return p.TextOnly;case 1:return p.ImageOnly;case 2:return p.ImageLeft;case 3:return p.ImageRight;default:return p.TextOnly}}function K(a){switch(a){case 0:return o.Left;case 1:return o.Middle;case 2:return o.Right;default:return o.Left}}function L(a){switch(a){case 0:return q.None;case 1:return q.Left;case 2:return q.Right;case 3:return q.Both;default:return q.None}}function M(){var a=this._buttonImageNames=[];a[sb]=new eb("btndp",null,"btndpc"),a[tb]=new eb("btnas"),a[ub]=new eb("btnsv"),a[xb]=new eb("btnpg",null,"btnpgc"),a[zb]=new eb("hdhelp")}function N(a){switch(a){case"HDDocPreview":return sb;case"HDAnsSummary":return tb;case"HDSaveAnswers":return ub;case"HDOutlineToggle":return vb;case"HDInstUpdateToggle":return"";case"HDSinglePageToggle":return xb;case"HDResourcePaneToggle":return yb;case"HDHelp":return zb;default:return a}}function O(a){this.element.trigger("StatusTextChanged",new u(a))}function P(a,b,c,d,e,f,g,h,i,j){i=U.call(this,null,A,a,b,c,d,e?B:null,e?f:null,e?g:null,e?h:null,i,j);var k=this.Toolbar.Children[i];return e&&(null==this._customActiveStateToolbarButtons&&(this._customActiveStateToolbarButtons=[]),this._customActiveStateToolbarButtons.push(k)),k.Tag.ID}function Q(a){var b=a.data;Y.call(this,b,!0,null).then(ib(function(){var a=b.Tag;kb(a.StatusText)||O.call(this,a.StatusText)},this))}function R(a){var b=a.data;Y.call(this,b,!1,null).then(ib(function(){var a=b.Tag;kb(a.StatusText)||O.call(this,"")},this))}function S(a){if(1==a.which){var b,c=a.data;b=c.Tag}}function T(a){if(1==a.which){var b,c=a.data;b=c.Tag,b.OnClick()}}function U(a,c,d,e,f,g,h,i,j,k,l,m){if(null==d)return X.call(this,a,c,f,g,h,k,m,l);var n=new cb(a,r.MayInvokeButton,c,d,e,f,g,h,i,j,k),o=b("<div/>");return o.Tag=n,o.addClass("hdtb-icon").attr("title",g).height(gb),null!==d&&(b("<div/>").appendTo(o).addClass("hd-img hdtb-"+n.ID),"btnod"==n.ID?o.css({"margin-left":"0px","padding-top":hb,"padding-bottom":hb}):o.css({padding:hb})),Y.call(this,o,!1,null).then(ib(function(){o.on("mouseenter",o,ib(Q,this)).on("mouseleave",o,ib(R,this)).on("mousedown",o,ib(S,this)).on("mouseup",o,ib(T,this)),!kb(a)&&this._hiddenToolbarButtons!==x&&this._hiddenToolbarButtons[a]!==x&&(o.hide(),delete this._hiddenToolbarButtons[a])},this)),n._updateDel=ib(function(){n.IsToggleButton()?n.IsActive().then(ib(function(a){Y.call(this,o,n.IsHot,a)},this)):Y.call(this,o,n.IsHot,!1)},this),V.call(this,o,l)}function V(a,c){var d,e,f=this.Toolbar.Children.length,g=this._outlineImageIndex>=0&&this._dropdownImageIndex>=0,h=this.ToolbarButtons;for(g&&f--,(0>c||c>f)&&(c=f),g&&c>=parseInt(this.Toolbar.Children[this._dropdownImageIndex].attr("GridColumn"))&&c++,d=0;d<this.Toolbar.Children.length;d++)e=this.Toolbar.Children[d],null!=e&&parseInt(e.attr("GridColumn"))>=c&&e.attr("GridColumn",parseInt(e.attr("GridColumn"))+1);return a.attr("GridColumn",c).appendTo(h),b.each(h.children(),function(){var d=b(this);return this!=a[0]&&parseInt(d.attr("GridColumn"))>=c?(a.insertBefore(d),!1):void 0}),this.Toolbar.Children.push(a),this.Toolbar.Children.length-1}function W(a,b,c,d,e,f){var g=this._buttonImageNames[a];return U.call(this,a,b,g.imageNormal,g.imageHot,c,d,e,g.imageActive,g.imageActiveHot,f,-1)}function X(a,c,d,e,f,g,h,i){var j=new cb(a,r.MayInvokeButton,c,null,null,d,e,null,null,null,g),k=b("<div/>");return k.Tag=j,k.addClass("hdtb-icon").attr({id:a,title:e}),b("<div/>").addClass("hdtb-text").text(null==h||""==h?" ":h).appendTo(k),Y.call(this,k,!1,null),k.on("mouseenter",k,ib(Q,this)).on("mouseleave",k,ib(R,this)).on("mousedown",k,ib(S,this)).on("mouseup",k,ib(T,this)),!kb(a)&&null!=this._hiddenToolbarButtons&&this._hiddenToolbarButtons[a]!==x&&(k.hide(),delete this._hiddenToolbarButtons[a]),V.call(this,k,i)}function Y(a,c,d){function e(d){d?kb(h.ToolTipActive())||(i=h.ToolTipActive()):kb(h.ToolTip())||(i=h.ToolTip()),0==a.children(".hdtb-text").length&&(d&&(j=c&&null!=h.ActiveHotBitmapImage()?h.ActiveHotBitmapImage():h.ActiveBitmapImage()),null==j&&(j=c&&null!=h.NormalHotBitmapImage?h.NormalHotBitmapImage:h.NormalBitmapImage),f=a.children("div"),f.hasClass("hdtb-"+j)||f.removeClass().addClass("hd-img hdtb-"+j),(h.IsCustom||0!=j.indexOf(h.ID))&&(f.removeClass("hdtb-"+h.ID).height(20).css({"background-image":"url("+j+")","background-size":"auto",width:"auto"}),f.children().length>0?f.children().attr("src",j):b('<img src="'+j+'" style="visibility:hidden"></img>').appendTo(f))),a.toggleClass(qb,c),null!=i&&(null==nb(a)||nb(a)!=i)&&mb(a,i),g.resolve()}var f,g=b.Deferred(),h=a.Tag,i=null,j=null;return h.IsHot=c,"boolean"!=typeof d&&(h.IsToggleButton()?h.IsActive().then(e):d=!1),"boolean"==typeof d&&e(d),g}function Z(b,c){this._outlineControl.OutlineControl("Update",0!=(c.UpdateFlags&l.OutlineRelated)?this._interview.Root():null,c.CurrentNodeChanged&&null!=a.CurrentOutlineNode()?a.CurrentOutlineNode()._id:-1)}function $(b,c){var d,e=this._interview.FindDialogByID(c.NodeID,!1);null!=e&&(d={s:null},this._interview.GotoDialog(e,d,!1,!0,function(b,c){b||a.Alert(c)}))}function _(a){9==a.which&&!a.shiftKey&&(this.OutlineDialogSplitter.focus(),a.preventDefault())}function ab(a){this._addCustomToolbarButton=a,this.RegisterToolbarButton=function(a,b,c,d,e,f,g,h,i,j){return this._addCustomToolbarButton(a,b,c,d,e,f,g,h,i,j)}}function bb(a){this._defineCustomNavigationbarButton=a,this.RegisterNavigationbarButton=function(a,b,c,d,e,f,g,h,i){return this._defineCustomNavigationbarButton(a,b,c,d,e,f,g,h,i)}}function cb(a,d,e,f,g,h,j,k,l,m,n){if(null==d)throw new i("clickEnabledDel");if(null==e)throw new i("clickedDel");var o=this.IsCustom=null==a||""==a;this.ID=o?c.Guid.NewGuid():a,o&&null!=f&&f.indexOf("/")<0&&f.indexOf("\\")<0&&(this.IsCustom=o=!1),this._clickEnabledDel=d,this._clickedDel=e,null!=f&&""!=f&&(this.NormalBitmapImage=db(f,o)),null!=g&&""!=g&&(this.NormalHotBitmapImage=db(g,o)),this._toolTip=j,null!=k&&(this._activeDel=k,null!=l&&""!=l&&(this._activeBitmapImage=db(l,o)),null!=m&&""!=m&&(this._activeHotBitmapImage=db(m,o)),this._toolTipActive=n),this.StatusText=h,this.SetImages=function(a,b,c,d){var e=this.IsCustom;this.NormalBitmapImage=kb(a)?null:db(a,e),this.NormalHotBitmapImage=kb(b)?null:db(b,e),null!=this._activeDel&&(this._activeBitmapImage=kb(c)?null:db(c,e),this._activeHotBitmapImage=kb(d)?null:db(d,e))},this.OnClick=function(){this._clickEnabledDel()&&(this._clickedDel.call(this,this.ID),this._updateDel&&this._updateDel())},this.ToolTip=function(){return this._toolTip},this.IsToggleButton=function(){return null!=this._activeDel},this.IsActive=function(){var a=b.Deferred();return null!=this._activeDel?this._activeDel.call(this,this.ID,function(b){a.resolve(b)}):a.resolve(!1),a},this.ActiveBitmapImage=function(a){return a===x?this._activeBitmapImage:(this._activeBitmapImage=a,void 0)},this.ActiveHotBitmapImage=function(a){return a===x?this._activeHotBitmapImage:(this._activeHotBitmapImage=a,void 0)},this.ToolTipActive=function(){return this._toolTipActive}}function db(a){return a}function eb(a,b,c,d){var e=this;e.imageNormal=a,e.imageHot=b,e.imageActive=c,e.imageActiveHot=d}this.DEBUG===x&&(this.DEBUG=a.DEBUG);var fb,gb,hb,ib=b.proxy,jb=c.Windows.Visibility,kb=c.String.IsNullOrEmpty,lb=c.Windows.Controls.ToolTipService,mb=lb.SetToolTip,nb=lb.GetToolTip,ob="hd-OutlineControl",pb="GetResourceString",qb="hdtb-hot",rb="hd-titlebar-buttons",sb="btndp",tb="btnas",ub="btnsv",vb="btnol",wb="btnod",xb="btnpg",yb="btnrs",zb="btnhp";return b.widget("hd.InterviewControl",{_create:function(){fb=b.Widget.prototype;var c,d,e,f,g,h,i=this,j=i.options.engine,k="boolean"!=typeof HDIconVisible||HDIconVisible,l=a.Lc.GetStr("ui_logo");i.element.css("height","100%"),b(document).on("keydown",ib(this.OnKeyDown,this)),i.Toolbar=b('<div id="hdHeading"/>').appendTo(i.element),i.Titlebar=b('<div class="hd-titlebar"/>').appendTo(i.Toolbar),i.ToolbarButtons=b("<div/>").addClass(rb).appendTo(i.Titlebar),i.ToolbarMenu=b("<div/>").addClass(rb).appendTo(i.Titlebar),h=null,f=b('<div><div class="hdtb-text">'+a.Lc.GetStr("tb_mnu")+'</div><div class="hd-img hd-dlg-btn"/></div>').appendTo(i.ToolbarMenu).hover(function(){b(this).toggleClass(qb)}).addClass("hdtb-icon").click(ib(function(){var a=[];if(null==h&&(h=b("<div/>").Popup({anchor:f,anchorPos:"b",open:function(a){var c=20,d=a.element.find(".hd-img"),e=0;d.each(function(){c=Math.max(c,b(this).width())}),d.each(function(){var a=b(this);a.css("margin-left",5+(c-a.width()))}),a.element.find(".hd-menu-iconbkgrd").width(c+20),a.element.find(".hd-menu-caption").css("padding-left",c+25),a.element.find(".hd-menu-item").css("width","auto").each(function(){e=Math.max(e,b(this).outerWidth())}),a.element.find(".hd-menu-item").css("width",.98*e),a.element.find(".hd-menu-base").width(e)}}).css("width","auto"),g=b("<div/>").appendTo(h).Menu().on("ItemSelected",ib(function(b,c){h.Popup("close"),a[c].Tag.OnClick()},this))),h.Popup("IsOpen"))h.Popup("close");else{g.empty();var c=this.Toolbar.Children;this.ToolbarButtons.children().each(function(){var d,e,f,h,i=b(this);if("none"!=i.css("display"))for(e=i.attr("title"),f=i.children().hasClass("hdtb-text")?i.text():e,h=b("<div/>").attr("title",e).appendTo(g).MenuItem({Label:f,Tag:a.length,IsEnabled:!0}),i.children().hasClass("hdtb-text")||h.find(".hd-menu-icon").replaceWith(i.children().clone().addClass("hd-menu-icon").css("float","left")),d=0;d<c.length;d++)if(i[0]==c[d][0]){a.push(c[d]);break}}),h.Popup("open")}return!1},this)).attr({title:a.Lc.GetStr("tb_mnu_tip")}),e=b('<div class="hdtb-icon"><div class="hdtb-text">5</div></div>').hide().appendTo(i.ToolbarButtons),gb=e.outerHeight(),hb=Math.max(0,(gb-22)/2)+"px",e.remove(),d=b('<div><div class="hd-img hdtb-logo"/></div>').addClass("hd-titlebar-icon hdtb-icon").attr({alt:l,title:l,Name:"HDIcon"}).css({display:k?"inline":"none",padding:hb}).height(gb).appendTo(i.Titlebar),i.TemplateTitle=b("<div/>").addClass("hd-titlebar-title").attr({valign:"baseline",title:k?"":a.Lc.GetStr("ui_logo")}).css("line-height",gb+"px").height(gb).appendTo(i.Titlebar),i.Toolbar.Children=[d,i.TemplateTitle],i.Interview=b('<table id="hdBodyDiv" style="table-layout:fixed; width:100%;" cellspacing="0"><tbody><tr id="hdBodyRow"/></tbody></table>').appendTo(i.element),i.leftBar=b('<td><table cellspacing=0 style="table-layout:fixed; width:100%;height:100%;"><tr id="RealOutlineContainer"/></table></td>').hide().appendTo(i.Interview.find("#hdBodyRow")).SideBar({side:"left",icon:"hdtb-btnol",tip:[a.Lc.GetStr("tb_ol1"),a.Lc.GetStr("tb_ol0")],title:a.Lc.GetStr("ui_io")}),i.OutlineDialogSplitter=b("<td/>").appendTo(i.Interview.find("#hdBodyRow")).GridSplitter({type:"v",target:"#hdOutlineDiv",minWidth:[100,300]}),M.call(this),b(j).on("ChangeUIState",j,ib(i._engine_ChangeUIState,i)),i._interview=i.options.interview,b(i._interview).on("RefreshDialogContent",ib(i._interview_RefreshDialogContent,i)).on("Closing",function(){t.PopInterview()}),i._dialogControl=b('<td id="hdInterviewDiv"/>').DialogControl({interview:i._interview}),i._dialogControl.TabIndex=3,i._dialogControl.focuslv=!0,i._dialogControl.on("FocusLeaving",ib(this._dialogControl_FocusLeaving,i)),i._dialogControl.appendTo(i.Interview.find("#hdBodyRow")),i.rightBar=b("<td/>").appendTo(i.Interview.find("#hdBodyRow"));var m=b("<div/>").appendTo(this.rightBar).attr("id","hdResourceTitle").addClass("hd-float-title-bar");b("<div/>").appendTo(m).addClass("hdtb-btnrs hd-img"),b("<div/>").appendTo(m).addClass("hd-float-title").text(a.Lc.GetStr("rs_title")),b("<div/>").appendTo(m).css({"float":"right"}).addClass("hd-img hd-dock").attr("title",a.Lc.GetStr("rs_dock")).click(ib(G,this)),b("<div/>").addClass("sliding-resource-pane").insertAfter(m),i.rightBar.SideBar({side:"right",icon:"hdtb-btnrs",tip:[a.Lc.GetStr("tb_rs1"),a.Lc.GetStr("tb_rs0")],title:a.Lc.GetStr("rs_title")}).SideBar("Show"),b("<div/>").prependTo("#hdResourcePane").css("float","right").addClass("hd-img hd-closex").attr("title",a.Lc.GetStr("tb_rs0")).click(ib(G,this)),0==i.Interview.closest("form").length&&(c=b('<form name="hdForm" action="'+b("#hdMainDiv").HDInterview("option","blankFrame")+'" method="post"/>').appendTo(i.Interview.parent()),i.Interview.appendTo(c)),t.PushInterview(i),i.OutlineDialogSplitter.on("keydown",ib(i.OutlineDialogSplitter_KeyDown,i)),i._interviewInitialized=!1,i._outlineImageIndex=-1,i._dropdownImageIndex=-1,mb(d,i._interview[pb]("ui_logo")),i._hiddenToolbarButtons={},i._reassertFocus=!1,i._navigationBarMinWidth=0,i._navigationButtonMinHeight=0
},_setOption:function(a,c){switch(b.Widget.prototype._setOption.apply(this,arguments),a){case"height":var d=c-("block"==this.Toolbar.css("display")?this.Toolbar.outerHeight(!0):0),e=this._dialogControl.children(".hd-dlg-content"),f=0;this.Interview.height(d),this._outlineControl&&this._outlineControl.OutlineControl({height:d}),b(".hd-sidebar").height(d),b(".sliding-resource-pane").outerHeight(d-b(".hd-float-title-bar").outerHeight()),e.siblings(":visible").each(function(){f+=b(this).outerHeight(!0)}),d-f!=e.height()&&e.height(d-f).trigger("LayoutUpdated");break;case"width":this.element.resize(),this._dialogControl.trigger("LayoutUpdated");break;case"tbMenu":c&&(this.ToolbarButtons.hide(),this.ToolbarMenu.show())}},_engine_ChangeUIState:function(a,c){if(!this._interviewInitialized&&c.State==v.Ready){var d,f,g=a.data,h=this,i=HDAPI;h.Title(m.HDEscQuots(g.TemplateTitle(),!0,!0)),g.DocPreviewEnabled&&W.call(h,sb,ib(C,h),g[pb]("tb_dpt"),g[pb]("tb_dp"),function(a,c){c(!b("#hdBodyRow").is(":visible"))},g[pb]("ui_rtntiv")),g.AnswerSummaryEnabled&&W.call(h,tb,ib(D,h),g[pb]("tb_ast"),g[pb]("tb_as"),null,null),kb(g.SaveAnswersUrl)||W.call(h,ub,E,g[pb]("tb_svt"),g[pb]("tb_sv"),null,null),g.PreferenceCache().HideInterviewOutline()?h.OutlineVisibility(jb.Collapsed):(h._outlineControl=b("<td/>").prependTo(b("#hdBodyRow")).OutlineControl().on("NodeSelected",ib($,h)).on("keydown",ib(_,h)),g.InterviewOutlineInitialWidth>0&&h._outlineControl.width(g.InterviewOutlineInitialWidth),b(h._interview).on("RefreshOutline",ib(Z,h)),h._interview.refrshevt=!0,h._interview.PreferenceCache().OutlineVisibleMod()?(h._outlineControl.data(ob).CloseImage.on("click",ib(y,h)),h._outlineControl.data(ob).PinImage.on("click",ib(z,h))):g.PreferenceCache().OutlineVisibleInitially()?h._outlineControl.data(ob).CloseImage.hide():(h._outlineControl.data(ob).PinImage.hide(),h._outlineControl.data(ob).CloseImage.show()),h.element.on("resize",ib(h.InterviewControl_SizeChanged,h)),h.OutlineVisibility(g.PreferenceCache().OutlineVisibleInitially()?jb.Visible:jb.Collapsed)),g.PreferenceCache().SinglePageMod()&&W.call(h,xb,ib(H,h),g[pb]("tb_pgt"),g[pb]("tb_pg1"),ib(F,h),g[pb]("tb_pg0")),h._dialogControl.DialogControl({ResourcePaneVisibility:g.PreferenceCache().ResourcePaneVisibleInitially()?jb.Visible:jb.Collapsed}),d=g[pb]("ui_helpcaption"),(null==d||""==d)&&(d="Help"),f=X.call(this,zb,I,g[pb]("tb_hlp"),g[pb]("ui_help"),null,null,d,-1),i._enumCustTBBtns(new ab(ib(P,h))),i._enumCustNBBtns(new bb(ib(h.DefineCustomNavigationbarButton,h))),h._dialogControl.DialogControl("ApplyCustomNavigationbarButtonDefinitions",e.ButtonDefinitions()).css("width","100%"),h._interviewInitialized=!0}},_interview_RefreshDialogContent:function(a){var b,c,d;if(this.rightBar.SideBar("Slide",a,0,!1),this.leftBar.SideBar("Slide",a,0,!1),this._customActiveStateToolbarButtons!==x){for(d=0;d<this._customActiveStateToolbarButtons.length;d++)c=this._customActiveStateToolbarButtons[d],b=c.Tag,Y.call(this,c,b.IsHot,null);this.element.resize()}},_dialogControl_FocusLeaving:function(){},OnKeyDown:function(a){var b=null;switch(a.which){case 33:a.ctrlKey||a.altKey?a.ctrlKey&&(b=s.PreviousUnanswered):b=s.Previous;break;case 34:a.ctrlKey||a.altKey?a.ctrlKey&&(b=s.NextUnanswered):b=s.Next;break;case 36:a.ctrlKey&&this._interview.IsFirstEnabled()&&(b=s.First);break;case 35:a.ctrlKey&&(b=s.Last);break;default:a.altKey&&(b=this._dialogControl.DialogControl("option","AccessKeys")[a.which],b&&(b.trigger("click"),a.Handled=!0))}"number"==typeof b&&(a.Handled=this._dialogControl.DialogControl("DoNavigation",b)),a.Handled&&a.stopPropagation()},Title:function(b){return"string"!=typeof b?this.TemplateTitle.text():(a.PsU(),this.TemplateTitle.html(""==a.Trm(b)?"&nbsp;":b),a.PpU(),this.element.resize(),void 0)},ScriptLinkDialogElementName:function(){return null},ComputationVariableName:function(){return null},DialogControl:function(){return this._dialogControl},CloseInterview:function(){},SetToolbarButtonImage:function(a,c,d,e,f){var g,h;g=kb(a)||"HDOutlineDropDown"!=a?N(a):wb,kb(g)||(h=this._buttonImageNames[g],h!==x&&(h.imageNormal=c,h.imageHot=d,h.imageActive=e,h.imageActiveHot=f),b.each(this.Toolbar.Children,function(a,h){var i,j,k;if(null!=h&&null!=h.Tag){if(i=h.Tag,null!=i&&i.ID==g)return i.SetImages(c,d,e,f),Y(h,i.IsHot,null),!1}else if(null!=h&&h.attr("Name")==g)return j=db(c,!0),k=h.children().removeClass("hdtb-logo").height(20).css({"background-image":"url("+j+")","background-size":"auto",width:"auto"}),k.children().length>0?k.children().attr("src",j):b('<img src="'+j+'" style="visibility:hidden"></img>').appendTo(k),!1}))},DefineCustomNavigationbarButton:function(a,b,c,f,g,h,i,j,k){var l=new d(J(a),b,c,f,g,K(h),i,L(j),k);return e.AddButtonDefinition(l),l.ID},SetToolbarButtonVisible:function(a,b){var c,d,e,f=N(a);if(!kb(f)){for(c=0;c<this.Toolbar.Children.length;c++)if(d=this.Toolbar.Children[c],null!=d&&null!=d.Tag){if(e=d.Tag,null!=e&&e.ID==f)return b?d.show():d.hide(),this.element.resize(),void 0}else if(null!=d&&d.attr("Name")==f)return d[b?"show":"hide"](),mb(this.TemplateTitle,b?null:this._interview[pb]("ui_logo")),this.element.resize(),void 0;b?this._hiddenToolbarButtons!==x&&this._hiddenToolbarButtons[f]!==x&&delete this._hiddenToolbarButtons[f]:(this._hiddenToolbarButtons===x&&(this._hiddenToolbarButtons={}),this._hiddenToolbarButtons[f]=!0)}},IsToolbarButtonEnabled:function(a){var c,d,e=!1;return r.MayInvokeButton()&&!t.InPopupInterview()&&(c=N(a),kb(c)||b(this.Toolbar.Children).each(function(a,b){return null!=b&&null!=b.Tag&&b.Visibility==jb.Visible&&(d=b.Tag,null!=d&&d.ID==c)?(e=!0,!1):void 0})),e},InvokeToolbarButton:function(a){if(r.MayInvokeButton()&&!t.InPopupInterview()){var c,d=N(a);kb(d)||b(this.Toolbar.Children).each(function(a,b){return null!=b&&null!=b.Tag&&(c=b.Tag,null!=c&&c.ID==d)?(c.OnClick(),!1):void 0})}},OutlineVisibility:function(a){return a===x?this._outlineVisibility:(a!=this._outlineVisibility&&(a==jb.Visible?(this.dw===x?this.dw=parseInt(this._outlineControl[0].style.width):this._outlineControl.css("width",this.dw+"px"),this.leftBar.SideBar("Hide"),this._outlineControl.data(ob).PinImage.hide(),this._interview.PreferenceCache().OutlineVisibleMod()&&this._outlineControl.data(ob).CloseImage.show(),this.OutlineDialogSplitter.show(),this._outlineControl.prependTo(b("#hdBodyRow")).show().width(Math.min(this._outlineControl.width(),this.Interview.width()/2)).find("#hdOutlineTree").css({"max-height":"100%","margin-bottom":"auto"}).height(this.Interview.height()-b("#hdOutlineTitle").outerHeight()),b("#hdOutlineContent").css("width","auto")):(this.OutlineDialogSplitter.hide(),this._outlineControl!=x&&(this._outlineControl.hide(),this._outlineControl.appendTo(b("#RealOutlineContainer")).show(),this._outlineControl.data(ob).CloseImage.hide(),this._interview.PreferenceCache().OutlineVisibleMod()&&this._outlineControl.data(ob).PinImage.show(),this.dw=parseInt(this._outlineControl[0].style.width),this._outlineControl.css("width","auto"),this.leftBar.SideBar("Show"))),this._dialogControl.trigger("LayoutUpdated"),this._outlineVisibility=a,this.element.resize()),void 0)},_outlineControl_NodeExpanded:function(){},InterviewControl_SizeChanged:function(){this.element.find(".hd-grid").triggerHandler("LayoutUpdated"),"block"==this.Toolbar.css("display")&&(this.ToolbarButtons.show(),this.ToolbarMenu.hide(),this._setOption("tbMenu",this.Toolbar[0].clientHeight<this.Toolbar[0].scrollHeight))},OutlineDialogSplitter_KeyDown:function(a){null!=this._outlineControl&&9==a.which&&a.shiftKey&&(this._outlineControl.focus(),a.Handled=!0)}}),b.hd.InterviewControl}),define("interview/page",["hd","hdmain/jq","hdmain/system","interview/interviewcontrol"],function(a,b,c,d,e){this.DEBUG===e&&(this.DEBUG=a.DEBUG);var f=b.proxy;return b.widget("hd.Page",{_create:function(){this._app=a.HDEngine,this.element.on("Loaded",f(this.Page_Loaded,this))},interviewControl:function(){return this._interviewControl},Page_Loaded:function(){this.element.off("Loaded"),this._interviewControl=b("<div/>").appendTo(this.element).InterviewControl({engine:this._app._engine,interview:a.CurrentInterview()}).on("StatusTextChanged",f(this.interviewControl_StatusTextChanged,this)),!1},LayoutRoot_LostFocus:function(){},LayoutRoot_GotFocus:function(){},interviewControl_StatusTextChanged:function(a,b){this._app.BrowserStatusBar(b.StatusText)}}),b.hd.Page}),define("engine/changeuistateeventargs",[],function(){function a(a,b){this.State=a,this.Message=b}return a}),define("system/xmlwriter",["hdmain/system"],function(a,b){function c(a,b){a&&(this.encoding=a),b&&(this.version=b)}function d(a){return null===a?"":a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")}function e(a){for(var b=a.c.length;b--;)"object"==typeof a.c[b]&&e(a.c[b]);a.n=a.a=a.c=null}function f(a,b,c,d){var e,g,h=b+"<"+a.n,i=a.c.length,j=0;for(e in a.a)h+=" "+e+'="'+a.a[e]+'"';if(h+=i?">":" />",d.push(h),i){do if(g=a.c[j++],"string"==typeof g){if(1==i)return d.push(d.pop()+g+"</"+a.n+">");d.push(b+c+g)}else"object"==typeof g&&f(g,b+c,c,d);while(i>j);d.push(b+"</"+a.n+">")}}return a.ExtendClass(c,null,{encoding:"UTF-16",version:"1.0",formatting:"indented",indentChar:"	",indentation:1,newLine:"\r\n",omitXmlDec:!1,initXml:"",WriteStartDocument:function(a){this.Close(),this.stack=[],this.standalone=a},WriteEndDocument:function(){this.active=this.root,this.stack=[]},WriteDocType:function(a){this.doctype=a},WriteStartElement:function(a,b){b&&(a=b+":"+a);var c={n:a,a:{},c:[]};this.active?(this.active.c.push(c),this.stack.push(this.active)):this.root=c,this.active=c},WriteEndElement:function(){this.active=this.stack?this.stack.pop()||this.root:this.root},WriteAttributeString:function(a,b){this.WriteStartAttribute(null,a,null),this.WriteString(b),this.WriteEndAttribute()},WriteStartAttribute:function(a,b){this.curAtt=b},WriteEndAttribute:function(){this.curAtt=null},WriteString:function(a){this.active&&(this.curAtt?this.active.a[this.curAtt]=d(a):this.active.c.push(d(a)))},WriteElementString:function(a,b,c){this.WriteStartElement(a,c),this.WriteString(b),this.WriteEndElement()},WriteCDATA:function(a){this.WriteString("<![CDATA["+a+"]]>")},WriteComment:function(a){this.WriteString("<!-- "+a+" -->")},Flush:function(){this.stack&&this.stack[0]&&this.WriteEndDocument();var a,c="",d="",e=this.indentation,g="indented"==this.formatting.toLowerCase(),h=[];if(this.omitXmlDec||(a='<?xml version="'+this.version+'" encoding="'+this.encoding+'"',this.standalone!==b&&(a+=' standalone="'+(this.standalone?"yes":"no")+'" '),a+=" ?>",h.push(a)),this.doctype&&this.root&&h.push("<!DOCTYPE "+this.root.n+" "+this.doctype+">"),g)for(;e--;)c+=this.indentChar;return this.root&&f(this.root,d,c,h),this.initXml+h.join(g?this.newLine:"")},Close:function(){this.root&&e(this.root),this.active=this.root=this.stack=null},toString:function(){return this.Flush()}},{Create:function(a,b){var d=new c;return"string"==typeof a&&(d.initXml=a),"boolean"==typeof b.OmitXmlDeclaration&&(d.omitXmlDec=b.OmitXmlDeclaration),"string"==typeof b.IndentChars&&(d.indentChar=b.IndentChars),"boolean"==typeof b.Indent&&(d.indentation=b.Indent?1:0),d}}),c}),define("engine/xmlwrappingwriter",["system/xmlwriter","hdmain/system"],function(a,b){function c(a){this.Writer=a}return b.ExtendClass(c,a,{Close:function(){this.Writer.Close()},Dispose:function(){this.Writer.Dispose()},Flush:function(){this.Writer.Flush()},LookupPrefix:function(a){return this.Writer.LookupPrefix(a)},WriteBase64:function(a,b,c){this.Writer.WriteBase64(a,b,c)},WriteCData:function(a){this.Writer.WriteCData(a)},WriteCharEntity:function(a){this.Writer.WriteCharEntity(a)},WriteChars:function(a,b,c){this.Writer.WriteChars(a,b,c)},WriteComment:function(a){this.Writer.WriteComment(a)},WriteDocType:function(a,b,c,d){this.Writer.WriteDocType(a,b,c,d)},WriteEndAttribute:function(){this.Writer.WriteEndAttribute()},WriteEndDocument:function(){this.Writer.WriteEndDocument()},WriteEndElement:function(){this.Writer.WriteEndElement()},WriteEntityRef:function(a){this.Writer.WriteEntityRef(a)},WriteFullEndElement:function(){this.Writer.WriteFullEndElement()},WriteProcessingInstruction:function(a,b){this.Writer.WriteProcessingInstruction(a,b)},WriteRaw:function(a){this.Writer.WriteRaw(a)},WriteRaw:function(a,b,c){this.Writer.WriteRaw(a,b,c)},WriteStartAttribute:function(a,b,c){this.Writer.WriteStartAttribute(a,b,c)},WriteStartDocument:function(){this.Writer.WriteStartDocument()},WriteStartDocument:function(a){this.Writer.WriteStartDocument(a)},WriteStartElement:function(a,b,c){this.Writer.WriteStartElement(a,b,c)},WriteString:function(a){this.Writer.WriteString(a)},WriteSurrogateCharEntity:function(a,b){this.Writer.WriteSurrogateCharEntity(a,b)},WriteValue:function(a){this.Writer.WriteValue(a)},WriteWhitespace:function(a){this.Writer.WriteWhitespace(a)}}),c}),define("engine/answerxmlwriter",["hdmain/system","system/xmlwriter","engine/xmlwrappingwriter"],function(a,b,c){function d(a,c,e){d.baseConstructor.call(this,b.Create(a,c)),this._forInterview=e,this._skipping=!1}return a.ExtendClass(d,c,{WriteStartAttribute:function(a,b,c){this._forInterview||"userModifiable"!=b&&"userExtendible"!=b?(this._skipping=!1,d.baseclass.WriteStartAttribute.call(this,a,b,c)):this._skipping=!0},WriteEndAttribute:function(){this._skipping?this._skipping=!1:d.baseclass.WriteEndAttribute.call(this)},WriteEndElement:function(){this._skipping=!1,d.baseclass.WriteEndElement.call(this)}}),d}),define("engine/answerchangedeventargs",[],function(){function a(a,b,c){this.v=a,this.i=b,this.t=c}return a}),define("runtime/unansweredvalue",["hd"],function(a,b){var c=a.UN===b?{}:a.UN;return c.Eq=function(a,b){return null==a&&null==b},c.Ne=function(a,b){return null==a&&null!=b},c.Nl=function(){return null},a.UN=c,c}),define("engine/valuenode",["hd","hdmain/system","require","runtime/unansweredvalue","hdmain/jq"],function(a,b,c,d,e,f){function g(a,b){this.T=a,this.v=b===f?null:b,this.c=null,this.um=!0}return this.DEBUG===f&&(this.DEBUG=a.DEBUG),b.ExtendClass(g,null,{GetType:function(){return this.T},IsAns:function(){return null!==this.v},HasCh:function(){return null!=this.c&&this.c.SetCount()>=0},Expand:function(a,b){var d=c("engine/valuenodelist");0>=a||(b||this.IsAns()||this.HasCh())&&(this.c?!1:(this.IsAns()?(this.c=new d(this.T,1),this.c.PrepareForIndex(0),this.c.Item(0).v=this.v,this.c.Item(0).um=this.um,this.v=null):this.c=new d(this.T),--a),0!=a&&e.each(this.c.GetEnumerator(),function(c,d){d.Expand(a,b)}))},Eq:function(b){return a[a.ToVT(this.v)].Eq(this.v,b.v)},Xml:function(b,c){0==c?a[this.T].Xml(b,this.v,this.um):null!=this.c?this.c.Xml(b,--c):b.WriteElementString("RptValue",null)}}),g}),define("engine/valuechangetype",{None:0,Changed:1,BecameAnswered:2,BecameUnanswered:3,IndexShift:4}),define("engine/answer",["hd","engine/valuenode","engine/valuechangetype","runtime/unansweredvalue","engine/repeatindices","hdmain/system","hdmain/jq"],function(a,b,c,d,e,f,g,h){function i(a,c,d){this._set=c,this.n=d,this.v=new b(a),this.d=0,this.s="string"==typeof d&&"("!=d[0],this.ue=!0}function j(a,b){a.ClearValue(b)}function k(a,b,c){if(c===h&&(c=b,b={}),b.v=-1,null==c||0==c.length)return[];var d=c.length;if(0!=(a&r.Z))for(;d>0&&c[d-1]<=0;)d--;else for(;d>0&&c[d-1]<0;)d--;return 0!=(a&r.I)&&d>0&&(b.v=c[d-1],d--),d>0?c.slice(0,d):[]}function l(a,b,c,d,f){var g,h,i,j;if(0==f.length&&b==this.d){if(g=a,d)for(;g.HasCh();)g=g.c.Item(0);return g}if(f.length>0)h=f[0],i=f.slice(1);else{if(!d)return a;for(h=0,i=new Array(this.d-b-1),j=i.length-1;j>=0;j--)i[j]=0}if(c)a.HasCh()||a.Expand(1,!0),h>=a.c.SetCount()&&a.c.PrepareForIndex(h);else{if(!a.HasCh())return d&&0==h&&e.IsFirst(i)?a:null;if(h>=a.c.SetCount())return null}return l.call(this,a.c.Item(h),++b,c,d,i)}function m(a,b,c,d){if(b.HasCh()){var e,f;for(f=0;f<b.c.Count();f++)e=c.slice(0),e.push(f),m.call(this,a,b.c.Item(f),e,d)}else c.length==this.d&&a(d,c)}function n(a,b){var c=k(a?r.D:r.Z,b);return this.GetNode(a?s.C:s.D,c)}function o(a){p(this.v,a)}function p(a,b){if(0!=b.length){var c=b[0],d=b.slice(1);a.HasCh()&&a.c.SetCount()>c&&p(a.c.Item(c),d),a.HasCh()&&a.c.SetCount()==c+1&&a.c.ResetCount()}}function q(a,b){b.HasCh()?g.each(b.c.GetEnumerator(),function(b,c){q(a,c)}):b.v=a(b.v)}this.DEBUG===h&&(this.DEBUG=a.DEBUG);var r={D:0,Z:1,I:2},s={D:0,C:1,N:2};return f.ExtendClass(i,null,{VT:function(){return this.v.T},IsRep:function(){return this.v.HasCh()||this.d>0},IsAns:function(a){var b=k(r.Z,a),c=this.GetNode(s.D,b);return c?c.IsAns():!1},GetUserModifiable:function(a){var b=k(r.Z,a),c=this.GetNode(s.D,b);return null!=c?c.um:!0},GetChildCount:function(a){var b=k(r.D,a);return this.GetCount(b)},GetSiblingCount:function(a){var b=k(r.I,a);return this.GetCount(b)},GetCount:function(a){var b=this.GetNode(s.N,a);return b?b.HasCh()?b.c.SetCount():b.IsAns()?1:0:(b=this.GetNode(s.D,a),b&&b.IsAns()?1:0)},GetNode:function(a,b){var c=a==s.C,d=a!=s.N;return c&&b.length>this.d&&(this.v.Expand(b.length-this.d,!1),this.d=b.length),l.call(this,this.v,0,c,d,b)},GetValue:function(a){var b=n.call(this,!1,a);return b?b.v:null},SetValue:function(b){var d,e,f,g,h,i=!1,j=1;if(f="boolean"==typeof arguments[j]?arguments[j++]:!1,g="boolean"==typeof arguments[j]?arguments[j++]:!0,h=arguments[j],d=n.call(this,null!==b,h),null==d&&(d=n.call(this,!0,h),i=!0),!1,null!=d){if(null===b||d.IsAns())if(null===b&&d.IsAns())e=c.BecameUnanswered;else{var k=!1;null!==b&&d.IsAns()&&(k="TX"==a.ToVT(b)&&"TX"==a.ToVT(d.v)?b!=d.v:a[a.ToVT(b)].Ne(b,d.v)),e=k?c.Changed:c.None}else e=c.BecameAnswered;d.v=b,d.um=g,(e!=c.None||i)&&(null!=h&&h.length>0&&null===b&&o.call(this,h),e!=c.None&&null!=this._set&&!f&&this._set.OnAnswerChanged(this,h,e))}},InitValue:function(a,b,c){this.SetValue(a,!0,b,c)},Clear:function(){this.EnumerateValues(this,j),this.v=new b(this.VT()),this.d=0},ClearValue:function(a){this.IsAns(a)&&this.SetValue(null,a)},ApplyValueMutator:function(a){q(a,this.v)},InsertIteration:function(a){var d,e={},f=k(r.I,e,a);e.v<0||(d=this.GetNode(s.N,f),null==d||null==d.c||e.v>=d.c.SetCount()||(d.c.Insert(e.v,new b(this.VT())),null!=this._set&&this._set.OnAnswerChanged(this,a,c.IndexShift)))},DeleteIteration:function(a){var b,d={},e=k(r.I,d,a);d.v<0||(b=this.GetNode(s.N,e),null==b||null==b.c||d.v>=b.c.SetCount()||(b.c.RemoveAt(d.v),null!=this._set&&this._set.OnAnswerChanged(this,a,c.IndexShift)))},MoveIteration:function(a,b){var d,e,f,g={},h=k(r.I,g,a);g.v<0||(d=this.GetNode(s.N,h),null==d||null==d.c||b<g.v&&b>=d.c.SetCount()||b>g.v&&g.v>=d.c.SetCount()||(e=Math.max(g.v,b),e>=d.c.SetCount()&&d.c.PrepareForIndex(e),f=d.c.RemoveAt(g.v),d.c.Insert(b,f),null!=this._set&&this._set.OnAnswerChanged(this,a,c.IndexShift)))},Xml:function(b){b.WriteStartElement("Answer"),b.WriteAttributeString("name",a.TX.XMLEscape(this.n)),this.s||b.WriteAttributeString("save","false"),this.ue||b.WriteAttributeString("userExtendible",this.ue.toString()),this.v.Xml(b,this.d),b.WriteEndElement()},EnumerateValues:function(a,b){m.call(this,b,this.v,[],a)}},{Create:function(a,b,c){return new i(a,b,c)},TrimIndices:k}),i}),define("engine/answerset",["hdmain/system","engine/answerxmlwriter","engine/answerchangedeventargs","engine/answer"],function(a,b,c,d,e){function f(){this.AnswerChanged=[],this.Clear()}return a.ExtendClass(f,null,{Clear:function(){this._answers={},this.Title="",this.Version=1.1,this.DTD=null},GetAnswerBucket:function(a){return("string"!=typeof a||2!=a.length)&&(a="UN"),a=a.toUpperCase(),"DI"==a&&(a="TF"),this._answers[a]==e&&(this._answers[a]={}),this._answers[a]},OnAnswerChanged:function(a,b,d){var e,f=new c(null!=a?a.n:null,b,d);for(e=this.AnswerChanged.length;e--;)this.AnswerChanged[e](a,f)},AnswerCount:function(){var a,b,c=0;for(b in this._answers)for(a in this._answers[b])c++;return c},XmlAnswers:function(){var b=new a.Text.StringBuilder;return this.WriteXml(b),b.ToString()},TryGetAnswer:function(a,b,c){if("UN"==b){for(var d in this._answers)if(c.v=this.GetAnswerBucket(d)[a],c.v!==e)break}else c.v=this.GetAnswerBucket(b)[a];return c.v!==e},CreateAnswer:function(a,b){var c=d.Create(a,this,b);return this.GetAnswerBucket(a)[b]=c,c},RemoveAnswer:function(a,b){return delete this.GetAnswerBucket(b)[a]},ReadXml:function(a){this.Clear(),this.OverlayXml(a)},OverlayXml:function(){},ReadValue:function(){},GetXMLString:function(b){var c=new a.Text.StringBuilder;return b&&c.Append(String.fromCharCode(65279)),this.WriteXml(c),c.ToString()},WriteXml:function(a){a.Append('<?xml version="1.0" standalone="yes"?>\r\n');var c,e,f,g,h={Indent:!0,IndentChars:"	",OmitXmlDeclaration:!0},i=!1,j=new b(a.ToString(),h,i);j.WriteStartDocument(),j.WriteStartElement("AnswerSet"),j.WriteAttributeString("title",this.Title),j.WriteAttributeString("version",this.Version.toString()),j.WriteAttributeString("useMangledNames","false");for(f in this._answers)if("CO"!=f&&"UN"!=f&&this._answers.hasOwnProperty(f)){g=this._answers[f];for(c in g)e=g[c],e instanceof d&&e.Xml(j)}j.WriteEndElement(),j.WriteEndDocument(),a.Clear(),a.Append(j.Writer.Flush())}}),f}),define("system/exception/argumentoutofrangeexception",["hd","hdmain/system","system/exception/argumentexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("runtime/preference",["hd","hdmain/system","runtime/component"],function(a,b,c){function d(a,b,c){d.baseConstructor.call(this,a,b),this.setting=null!=c?c:""}return b.ExtendClass(d,c,null,{ToString:function(a){return null==a?"":a.setting},ToInt:function(a){return null==a?0:parseInt(a.setting,10)},ToBool:function(a){return null==a?!1:"true"==a.setting.toLowerCase()},TPL_TITLE:"(TEMPLATE TITLE)",TPL_DESC:"(TEMPLATE DESCRIPTION)",POINTED_TO_CMP:"(POINTED TO CMP)",USE_SHARED_INTERVIEW_PROPS:"(USE_SHARED_INTERVIEW_PROPS)",USE_INTERVIEW_COMPUTATION:"(USE_INTERVIEW_COMPUTATION)",GENERATE_DEFAULT_INTERVIEW:"(GENERATE_DEFAULT_INTERVIEW)",HIDE_INTERVIEW_OUTLINE:"(HIDE_INTERVIEW_OUTLINE)",DISABLE_IRRELEVANT_ANSWERS:"(DISABLE_IRRELEVANT_ANSWERS)",HIDE_END_OF_INTERVIEW:"(HIDE_END_OF_INTERVIEW)",USE_DEFAULT_DLG_TITLE_ALWAYS:"(USE DEFAULT DLG TITLE ALWAYS)",HELP_BUTTON_TEXT:"(HELP BUTTON TEXT)",CUSTOM_INTERVIEW:"(CUSTOM_INTERVIEW)",ASKED_IRREL_VAR_ARCHIVE:"(ASKED_IRREL_VAR_ARCHIVE)",UNASKED_REL_VAR_ARCHIVE:"(UNASKED_REL_VAR_ARCHIVE)",IRREL_VAR_DEFAULT:"(IRREL_VAR_DEFAULT)",USE_RAGGED_PROMPTS:"(USE_RAGGED_PROMPTS)",COMBINE_DEF_DLGS:"(COMBINE_DEF_DLGS)",USE_SHARED_ASSEMBLY_PROPS:"(USE_SHARED_ASSEMBLY_PROPS)",MOVE_TO_TYPE_HERE:"(MOVE TO TYPE HERE)",NO_ANSWER_FILE:"(NO ANSWER FILE)",DEFAULT_DLG_TITLE:"(DEFAULT DLG TITLE)",USE_NAMES:"(USE NAMES)",UNANSWERED_VAR_PLACEHOLDER:"(UNANSWERED VAR PLACEHOLDER)",MAX_REPEAT_COUNT:"(MAX_REPEAT_COUNT)",MAX_STACK_DEPTH:"(MAX_STACK_DEPTH)",PROCESS_DLGS_WHILE_ASM_DOCS:"(PROCESS_DLGS_WHILE_ASM_DOCS)",MARK_ANSWER_FIELDS:"(MARK_ANSWER_FIELDS)",ENABLE_EDIT_ANSWER:"(ENABLE_EDIT_ANSWER)",UPDATE_TOC:"(UPDATE_TOC)",MACRO_TEMPLATE_FILE:"(MACRO_TEMPLATE_FILE)",COMMON_COMPONENT_FILE:"(COMMON_COMPONENT_FILE)",TEMPLATE_ID:"(TEMPLATE_ID)",ADDITIONAL_TEMPLATES:"(ADDITIONAL_TEMPLATES)",OTHER_ADDITIONAL_FILES:"(OTHER_ADDITIONAL_FILES)",USE_SHARED_HIDDENDATA_PROPS:"(USE_SHARED_HIDDENDATA_PROPS)",REMOVE_REVISION_IDS:"(REMOVE_REVISION_IDS)",REMOVE_PROPERTY_CODES:"(REMOVE_PROPERTY_CODES)",REMOVE_STYLES:"(REMOVE_STYLES)",REMOVE_METAFILES:"(REMOVE_METAFILES)",REMOVE_HD_ANSWER_MARKS:"(REMOVE_HD_ANSWER_MARKS)",REMOVE_ANNOTATIONS:"(REMOVE_ANNOTATIONS)",REMOVE_TRACKED_CHANGES:"(REMOVE_TRACKED_CHANGES)",REMOVE_CHANGE_TRACKING:"(REMOVE_CHANGE_TRACKING)",REMOVE_TITLE:"(REMOVE_TITLE)",REMOVE_SUBJECT:"(REMOVE_SUBJECT)",REMOVE_AUTHOR:"(REMOVE_AUTHOR)",REMOVE_MANAGER:"(REMOVE_MANAGER)",REMOVE_COMPANY:"(REMOVE_COMPANY)",REMOVE_CATEGORY:"(REMOVE_CATEGORY)",REMOVE_KEYWORDS:"(REMOVE_KEYWORDS)",REMOVE_COMMENTS:"(REMOVE_COMMENTS)",REMOVE_HYPERLINK_BASE:"(REMOVE_HYPERLINK_BASE)",REMOVE_STATISTICS:"(REMOVE_STATISTICS)",REMOVE_CUSTOM_PROPERTIES:"(REMOVE_CUSTOM_PROPERTIES)",REMOVE_EDITABLE_TEXT_BOOKMARKS:"(REMOVE_EDITABLE_TEXT_BOOKMARKS)",USE_SHARED_SERVER_PROPS:"(USE_SHARED_SERVER_PROPS)",ONLINE_COMPAT_MODE:"(ONLINE COMPATIBILITY MODE)",SERVER_INITIAL_INTERVIEW_OUTLINE:"(SERVER_INITIAL_INTERVIEW_OUTLINE)",SERVER_INITIAL_RESOURCE_PANE:"(SERVER_INITIAL_RESOURCE_PANE)",SERVER_INITIAL_INSTANT_UPDATE:"(SERVER_INITIAL_INSTANT_UPDATE)",SERVER_CAN_CHANGE_INTERVIEW_OUTLINE:"(SERVER_CAN_CHANGE_INTERVIEW_OUTLINE)",SERVER_CAN_CHANGE_RESOURCE_PANE:"(SERVER_CAN_CHANGE_RESOURCE_PANE)",SERVER_CAN_CHANGE_INSTANT_UPDATE:"(SERVER_CAN_CHANGE_INSTANT_UPDATE)",DISALLOW_DOCUMENT_PREVIEW:"(DISALLOW_DOCUMENT_PREVIEW)",SERVER_SINGLE_PAGE_INTERVIEW:"(SERVER_SINGLE_PAGE_INTERVIEW)",SERVER_CAN_CHANGE_SINGLE_PAGE_INTERVIEW:"(SERVER_CAN_CHANGE_SINGLE_PAGE_INTERVIEW)",USE_SHARED_ANSWERUPLOAD_PROPS:"(USE_SHARED_ANSWERUPLOAD_PROPS)",UPLOAD_URL:"(UPLOAD URL)",UPLOAD_URL_DESCRIPTION:"(UPLOAD URL DESCRIPTION)",UPLOAD_ALWAYS:"(UPLOAD ALWAYS)",PASSWORD:"(PASSWORD)",EXPIRATION:"(EXPIRATION)",CONTROL_FILE:"(CONTROL FILE)",REGISTER:"(REGISTER)",EXPIRE_MESSAGE:"(EXPIRE MESSAGE)",VIEWS_INI:"VIEWS_INI",VIEWS_COMMON_SWITCHES:"VIEWS COMMON SWITCHES",WARN_SET_AND_SAVED:"(WARN_SET_AND_SAVED)",WARN_SET_AND_ASKED:"(WARN_SET_AND_ASKED)",WARN_ASKED_TWICE:"(WARN_ASKED_TWICE)",WARN_USED_THEN_SET:"(WARN_USED_THEN_SET)",WARN_USED_THEN_ASKED:"(WARN_USED_THEN_ASKED)",WATCH_VARIABLES:"(WATCH_VARIABLES)",LIST_USED_IN_COMPONENTS:"(LIST_USED_IN_COMPONENTS)"}),a.Pref=d,d}),define("engine/placeholdertype",{Default:0,Nothing:1,Asterisks:2,Underscores:3,AsterisksAndVarName:4,BracketedVarName:5}),define("engine/preferencecache",["hd","hdmain/system","runtime/preference","engine/placeholdertype"],function(a,b,c,d,e){function f(a){this._template=a}var g=b.String.IsNullOrEmpty,h=500,i=500,j="INTERVIEW";return b.ExtendClass(f,null,{GetString:function(b,f){var h,i;return f!==e?(h=this._template.GetPreference(b),null==h?f:h.setting):("("!=b.substr(0,1)&&"VIEWS"!=b.substr(0,5)&&(b="("+b+")"),i=this.GetString(b,""),b==c.UNANSWERED_VAR_PLACEHOLDER?g(i)&&(i=a.PlaceholderTypeToString(d.Default)):b==c.CUSTOM_INTERVIEW&&g(i)&&this.GetBool(c.USE_INTERVIEW_COMPUTATION,!1)&&(i=j),i)},GetInt:function(a,b){var d;if("number"!=typeof b)switch("("!=a.substr(0,1)&&"VIEWS"!=a.substr(0,5)&&(a="("+a+")"),b=0,a){case c.MAX_REPEAT_COUNT:b=h;break;case c.MAX_STACK_DEPTH:b=i}return d=this._template.GetPreference(a),null==d?b:c.ToInt(d)},GetBool:function(a,b){var d;if("boolean"!=typeof b)switch("("!=a.substr(0,1)&&"VIEWS"!=a.substr(0,5)&&(a="("+a+")"),b=!1,a){case c.MARK_ANSWER_FIELDS:case c.SERVER_INITIAL_INTERVIEW_OUTLINE:case c.SERVER_CAN_CHANGE_INTERVIEW_OUTLINE:case c.SERVER_CAN_CHANGE_RESOURCE_PANE:case c.SERVER_INITIAL_INSTANT_UPDATE:case c.SERVER_CAN_CHANGE_INSTANT_UPDATE:b=!0;break;case c.GENERATE_DEFAULT_INTERVIEW:b=!this.GetBool(c.USE_INTERVIEW_COMPUTATION,!1)}return d=this._template.GetPreference(a),null==d?b:c.ToBool(d)},HideInterviewOutline:function(){return"boolean"!=typeof this._hio&&(this._hio=this.GetBool(c.HIDE_INTERVIEW_OUTLINE,!1)),this._hio},HideEndOfInterview:function(){return"boolean"!=typeof this._hei&&(this._hei=this.GetBool(c.HIDE_END_OF_INTERVIEW,!1)),this._hei},GenerateDialogTitles:function(){return"boolean"!=typeof this._gdt&&(this._gdt=this.GetBool(c.USE_DEFAULT_DLG_TITLE_ALWAYS,!1)),this._gdt},ResourceButtonText:function(){return"string"!=typeof this._rbt&&(this._rbt=this.GetString(c.HELP_BUTTON_TEXT,"")),this._rbt},ProductTitle:function(){return"string"!=typeof this._pt&&(this._pt=this.GetString(c.DEFAULT_DLG_TITLE,"")),this._pt},NoAnswerFile:function(){return"boolean"!=typeof this._naf&&(this._naf=this.GetBool(c.NO_ANSWER_FILE,!1)),this._naf},VarNamesInSummaries:function(){return"boolean"!=typeof this._vns&&(this._vns=this.GetBool(c.USE_NAMES,!1)),this._vns},MarkAnswerFields:function(){return"boolean"!=typeof this._maf&&(this._maf=this.GetBool(c.MARK_ANSWER_FIELDS,!0)),this._maf},UnansweredVarPlaceholder:function(){return"number"!=typeof this._up&&(this._up=a.StringToPlaceholderType(this.GetString(c.UNANSWERED_VAR_PLACEHOLDER))),this._up},DisableIrrelevantAnswers:function(){return"boolean"!=typeof this._dia&&(this._dia=this.GetBool(c.DISABLE_IRRELEVANT_ANSWERS,!1)),this._dia},OutlineVisibleInitially:function(){return"boolean"!=typeof this._ov&&(this._ov=this.GetBool(c.SERVER_INITIAL_INTERVIEW_OUTLINE,!0)),this._ov},OutlineVisibleMod:function(){return"boolean"!=typeof this._om&&(this._om=this.GetBool(c.SERVER_CAN_CHANGE_INTERVIEW_OUTLINE,!0)),this._om},ResourcePaneVisibleInitially:function(){return"boolean"!=typeof this._rpv&&(this._rpv=this.GetBool(c.SERVER_INITIAL_RESOURCE_PANE,!1)),this._rpv},ResourcePaneVisibleMod:function(){return"boolean"!=typeof this._rpm&&(this._rpm=this.GetBool(c.SERVER_CAN_CHANGE_RESOURCE_PANE,!0)),this._rpm},InstantUpdateOnInitially:function(){return"boolean"!=typeof this._iuo&&(this._iuo=this.GetBool(c.SERVER_INITIAL_INSTANT_UPDATE,!0)),this._iuo},InstantUpdateMod:function(){return"boolean"!=typeof this._ium&&(this._ium=this.GetBool(c.SERVER_CAN_CHANGE_INSTANT_UPDATE,!0)),this._ium},SinglePageOnInitially:function(){return"boolean"!=typeof this._spo&&(this._spo=this.GetBool(c.SERVER_SINGLE_PAGE_INTERVIEW,!1)),this._spo},SinglePageMod:function(){return"boolean"!=typeof this._spm&&(this._spm=this.GetBool(c.SERVER_CAN_CHANGE_SINGLE_PAGE_INTERVIEW,!1)),this._spm}}),f}),define("engine/templatedownloadedeventargs",[],function(){function a(a,b,c){this.TemplateName=a,this.AssemblyName=b,this.DownloadsInProgress=c}return a}),define("system/exception/targetinvocationexception",["hd","hdmain/system","system/exception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("runtime/resource",["hd","hdmain/system"],function(a,b,c){function d(a,b,d){a===c&&(a="T"),this.type=a,this.loc=b,this.txtD=d}return b.ExtendClass(d,null,{EvText:function(){return this.txtD?this.txtD.toString():""},IsDyn:function(){return this.txtD&&this.txtD instanceof a.DyTx}}),a.Rsrc=d,d}),define("runtime/computedvariable",["hd","runtime/variable","hdmain/system"],function(a,b,c){function d(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){d.baseConstructor.call(this,a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s),this.valType=t,this.scrD=u,this.sumD=v?v:null,this.t=w}return c.ExtendClass(d,b,{type:"CO",valType:"??",EvScr:function(){return this.scrD.apply(this.t,arguments)},GetSum:function(){return this.sumD?this.sumD.apply(this.t,arguments):null}}),a.CoVar=d,d}),define("runtime/datevariable",["hd","runtime/variable","hdmain/system"],function(a,b,c){function d(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){d.baseConstructor.call(this,a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s)}return c.ExtendClass(d,b,{type:"DA",valType:"DA"}),a.DaVar=d,d}),define("runtime/dialogitemlist",["hd","hdmain/system","system/exception/argumentexception","system/exception/argumentoutofrangeexception"],function(a,b,c,d,e){function f(a){this.list=a,this.idx={};for(var b=0;b<a.length;b++)this.idx[a[b].name]=b}return b.ExtendClass(f,null,{IndexOf:function(a){var b;return"string"==typeof a?b=this.idx[a]:null!==a&&a!==e&&(b=this.idx[a.name]),b===e?-1:b},GetItem:function(a){if("string"==typeof a&&(a=this.idx[a]),"number"!=typeof a)throw new c;if(0>a||a>=this.list.length)throw new d;return this.list[a]},Contains:function(a,b,d){var f,g;if(null===a||a===e)throw new c;if(g="string"==typeof a?a:a.name,g in this.idx)return!0;if(b)for(f=0;f<this.list.length;f++)if(a=this.list[f],"DI"==a.type&&a.name!==d&&a.vList.Contains(g,!0,d))return!0;return!1},Count:function(){return this.list.length}}),a.DiList=f,f}),define("runtime/dialogelement",["hd","hdmain/system","runtime/component"],function(a,b,c){function d(a,b){d[k].call(this,a,b)}function e(a,b,c,d){e[k].call(this,a,b),this.text=c,this.dspIn=d?d:""}function f(a,b,c,d,e){f[k].call(this,a,b),this.capt=c,this.fSize=d?d:100,this.just=e?e:"L"}function g(a,b,c){g[k].call(this,a,b),this.spacing=c?c:100}function h(a,b,c,d,e,f,g,i,j){h[k].call(this,a,b),this.dTyp=c?c:"B",this.style=d?d:1,this.env=e?e:3,this.bWid=f?f:0,this.bHgt=g?g:0,this.img=i?i:"",this.capt=j
}function i(a,b,c,d,e,f,g,h,j,l){i[k].call(this,a,b,c,d,e,f,g,h,j),this.varName=l}function j(a,b,c,d,e,f,g,h,i,l,m){j[k].call(this,a,b,c,d,e,f,g,h,i),this.url=l,this.openF=m?m:""}var k="baseConstructor";return b.ExtendClass(d,c,{type:"??",parent:null}),b.ExtendClass(e,d,{type:"TXL",EvText:function(){return this.text?this.text.toString():""}}),b.ExtendClass(f,d,{EvCapt:function(){return this.capt?this.capt.toString():""},type:"HDL"}),b.ExtendClass(g,d,{type:"VSL"}),b.ExtendClass(h,d,{EvCapt:function(){return this.capt?this.capt.toString():""}}),b.ExtendClass(i,h,{type:"SLL"}),b.ExtendClass(j,h,{type:"WLL"}),a.DlgEl=d,a.TxDlgEl=e,a.HdDlgEl=f,a.VsDlgEl=g,a.LDlgEl=h,a.SlDlgEl=i,a.WlDlgEl=j,d}),define("runtime/imagedialogelement",["hd","hdmain/system","runtime/dialogelement"],function(a,b,c){function d(a,b,c,e){d.baseConstructor.call(this,a,b),this.img=c,this.just=e?e:"L"}return b.ExtendClass(d,c,{type:"IML"}),a.ImDlgEl=d,d}),define("engine/template",["hd","hdmain/system","system/exception","system/exception/targetinvocationexception","system/exception/argumentexception","runtime/resource","runtime/computedvariable","runtime/datevariable","runtime/dialogitemlist","runtime/preference","runtime/imagedialogelement"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b,c,d){this._templateName=b,this._assemblyName=c,this._templateType=d,this.name=this._templateName,this.AssemblyName=this._assemblyName,this.InsertDepth=0,this.tplObj=a.Templates[c],this.interviewMethod=this.tplObj.Interview,this._templateInterviewMethod=this.tplObj.TemplateInterview,this.compDict={},this.TranslateComponents(this.tplObj.DefineComponents())}var n=b.String.Format,o=b.String.IsNullOrEmpty;return this.DEBUG===l&&(this.DEBUG=a.DEBUG),b.ExtendClass(m,null,{TE:function(b){return b===l||null===b?null:"string"==typeof b?new a.StTx(b):"function"==typeof b?new a.DyTx(b,this.tplObj):b},RS:function(a){return a===l||null===a?null:new f(a.t,a.l,this.TE(a.r))},DefineCmp:function(b){var c,d,e,f,l,m,n;if(c=this.compDict[b.n],!c){switch(b.t){case"VTX":c=new a.TxVar(b.n,this.TE(b.tl),null,this.TE(b.p),this.RS(b.r),b.fw,b.fx,b.cw,b.cx,b.aa,b.sa,b.wu,b.ai,b.df,b.du,b.dc,b.dw,b.da,b.h,b.ml,b.pt,b.ep);break;case"VNU":c=new a.NuVar(b.n,this.TE(b.tl),null,this.TE(b.p),this.RS(b.r),b.fw,b.fx,b.cw,b.cx,b.aa,b.sa,b.wu,b.ai,b.df,b.du,b.dc,b.dw,b.da,b.dp,b.cs,b.mn,b.mx);break;case"VDA":c=new h(b.n,this.TE(b.tl),null,this.TE(b.p),this.RS(b.r),b.fw,b.fx,b.cw,b.cx,b.aa,b.sa,b.wu,b.ai,b.df,b.du,b.dc,b.dw,b.da);break;case"VTF":c=new a.TfVar(b.n,this.TE(b.tl),null,this.TE(b.p),this.RS(b.r),b.fw,b.fx,b.cw,b.cx,b.aa,b.sa,b.wu,b.ai,b.df,b.du,b.dc,b.dw,b.da,b.sl);break;case"VMC":for(l=b.l?b.l.length:0,d=new Array(l),e=0;l>e;e++)f=b.l[e],d[e]=new a.McOpt(f.n,this.TE(f.p),this.RS(f.r));c=new a.McVar(b.n,this.TE(b.tl),null,this.TE(b.p),this.RS(b.r),b.fw,b.fx,b.cw,b.cx,b.aa,b.sa,b.wu,b.ai,b.df,b.du,b.dc,b.dw,b.da,d,b.s,b.ot,b.dm,b.dv);break;case"VCO":c=new g(b.n,this.TE(b.tl),null,this.TE(b.p),this.RS(b.r),b.fw,b.fx,b.cw,b.cx,b.aa,b.sa,b.wu,b.ai,b.df,b.du,b.dc,b.dw,b.da,b.y,b.s,b.sd,this.tplObj);break;case"VDI":for(l=b.l.length,m=[],e=0;l>e;e++)m.push(this.DefineCmp(b.l[e])),f&&(f[e]=0);d=new i(m),b.pl||(f=new Array(l)),c=new a.Dlg(b.n,this.TE(b.tl),null,this.TE(b.p),this.RS(b.r),b.fw,b.fx,b.cw,b.cx,b.aa,b.sa,b.wu,b.ai,b.df,b.du,b.dc,b.dw,b.da,d,b.s,b.rp,b.op,b.lv,b.al,b.rt,b.ac,b.mr,b.g,b.na,b.pp,b.pa,b.mp,b.hu,b.hc,b.hs,b.ti,f?f:b.pl,b.ds,b.m,this.tplObj);break;case"LTX":c=new a.TxDlgEl(b.n,null,this.TE(b.c),b.di);break;case"LHD":c=new a.HdDlgEl(b.n,null,this.TE(b.c),b.fs,b.j);break;case"LVS":c=new a.VsDlgEl(b.n,null,b.s);break;case"LSL":c=new a.SlDlgEl(b.n,null,b.dt,b.ds,b.de,b.w,b.h,b.i,this.TE(b.c),b.v);break;case"LWL":c=new a.WlDlgEl(b.n,null,b.dt,b.ds,b.de,b.w,b.h,b.i,this.TE(b.c),b.u,b.o);break;case"LIM":c=new k(b.n,null,b.i,b.j);break;case"FTX":c=new a.TxFmt(b.n,null,b.f);break;case"FNU":c=new a.NuFmt(b.n,null,b.f);break;case"FDA":c=new a.DaFmt(b.n,null,b.f);break;case"FTF":c=new a.TfFmt(b.n,null,b.f);break;case"FMC":for(n=[],e=0;e<b.m.length;e++)n.push(null===b.m[e]?null:new this.TE(b.m[e].t));c=new a.McFmt(b.n,null,b.f,n);break;case"FGR":c=new a.GrFmt(b.n,null,b.f);break;case"PRF":c=new j(b.n,null,b.s)}this.compDict[b.n]=c}return c},TranslateComponents:function(a){var b;for(b in a)this.DefineCmp(a[b])},RunInterview:function(){if(this.interviewMethod)try{this.interviewMethod.call(this.tplObj)}catch(b){throw b instanceof d&&null!=b.InnerException&&!o(b.InnerException.Message)?b.InnerException:new c(n(a.Lc.GetStr("err_proc"),"Interview",this.name),null==b.InnerException?b:b.InnerException)}else this.RunTemplateInterview()},HasTemplateInterview:function(){return null!=this._templateInterviewMethod},RunTemplateInterview:function(){try{this._templateInterviewMethod.call(this.tplObj)}catch(b){throw b instanceof d&&null!=b.InnerException&&!o(b.InnerException.Message)?b.InnerException:new c(n(a.Lc.GetStr("err_proc"),"TemplateInterview",this.name),null==b.InnerException?b:b.InnerException)}},GetComponent:function(b){var c=this.GetComponentSafe(b);if(null===c||c===l)throw new e(n(a.Lc.GetStr("err_nocmp"),b));return c},GetComponentSafe:function(a){var b=this.compDict[a];return b!=l?b:null},GetPreference:function(a){return"("!=a.charAt(0)&&"VIEWS"!=a.substr(0,5)&&(a="("+a+")"),this.GetComponentSafe(a)}}),m}),define("engine/templatemanager",["hd","hdmain/system","hdmain/jq","engine/templatedownloadedeventargs","engine/template","system/dictionary"],function(a,b,c,d,e,f,g){function h(a,b,c){o=a,this._templateDict=new f,this.q=new f,this.nq=[],this.completed=[];var d={};this.GetTemplate(b,c,d),this.New=!1}function i(b){if(a.Templates!==g){if("object"==typeof a.Templates[b.AssemblyName])return!0;for(var c in a.Templates)if("object"==typeof a.Templates[c]&&c.toUpperCase()==b.AssemblyName.toUpperCase())return c!=b.AssemblyName&&(a.Templates[b.AssemblyName]=a.Templates[c],delete a.Templates[c]),!0}return!1}function j(a){this._templateDict.Add(a.name,a),q>0?c(this).trigger("_templateDownloaded",new d(a.name,a.AssemblyName,this.IncompleteDownloads())):this.nq.push(new d(a.name,a.AssemblyName,this.IncompleteDownloads()))}function k(a,b){var c="TEMPLATE";this.q.Remove(b.TemplateName),this.completed.push(new n(1)),j.call(this,new e(b.TemplateName,b.AssemblyName,c,this._runtime)),this.Enqueue(null)}function l(){this.Template=null,this.Progress=null}function m(a,b){this.TemplateName=a,this.AssemblyName=b}function n(a,b,c){b===g&&(b=a),c===g&&(c=!1),this.started=c,this.total=a>0?a:b,this.received=b}var o,p=b.String.IsNullOrEmpty,q=0,r=c.proxy;return b.ExtendClass(h,null,{TemplateDownloaded:function(a,b){switch(a){case"add":q++,c(this).on("_templateDownloaded",b);for(var d=0;d<this.nq.length;d++)c(this).trigger("_templateDownloaded",this.nq[d]);this.nq=[];break;case"remove":q--,c(this).off("_templateDownloaded",b)}},IncompleteDownloads:function(){return this.q.Count()},CompletedDownloads:function(){return this.completed.length},GetTemplateInfoToDownload:function(){var a,b;for(a in this.q.a)if(b=this.q.a[a],!b.Progress)return b.Template;return null},Enqueue:function(b,d){var e,f,g=null,h=null==b;g=h?this.GetTemplateInfoToDownload():new m(b,d),null!=g&&(e=new l,e.Template=g,this.New=!0,h?this.q.a[g.TemplateName].Progress.started=!0:(e.Progress=new n(0,0,!0),this.q.Add(g.TemplateName,e)),p(o)?f="templates/"+encodeURIComponent(g.TemplateName)+".js":(f=o+encodeURIComponent(g.TemplateName),o.indexOf("stateString")<0&&(f+=".js"),0==f.indexOf("./")&&(f=HDJavascriptPath+f)),c("#hdMainDiv").HDInterview("LoadFile",a.FileType.JavaScript,g.AssemblyName,f,i,!0,r(k,this),g))},GetTemplate:function(a,b,c){var d,f;if(c.v=this._templateDict.TryGetValue(a),null!=c.v)return!0;if(!this.q.ContainsKey(a)){if(b===g&&a!==g&&(b=a.replace(/%20/g," "),b=b.replace(/([^a-zA-Z0-9])/g,function(a){return f=a.charCodeAt(0).toString(16).toUpperCase(),"_"+"0000".substr(f.length)+f}),d=b.substr(0,1),/^\d+$/.test(d)&&(f=d.charCodeAt(0).toString(16).toUpperCase(),b="_"+"0000".substr(f.length)+f+b.substr(1)),b="Tmpl_"+b),i({AssemblyName:b}))return j.call(this,new e(a,b,c,this._runtime)),!0;this.Enqueue(a,b)}return null},ResetNew:function(){this.New=!1}}),h}),define("system/dispatchertimer",["hdmain/system"],function(a){function b(){this._intervalIDs=[],this.Interval=0,this.Tick=null}return a.ExtendClass(b,null,{IsEnabled:function(){return this._intervalIDs.length>0},Start:function(a){if("function"==typeof this.Tick){var b=this.Tick;this._intervalIDs.push(window.setInterval(function(){b.call(a)},this.Interval))}},Stop:function(){for(;this._intervalIDs.length>0;)window.clearInterval(this._intervalIDs.pop())}},{BeginInvoke:function(a,c){var d=new b;d.Tick=function(){d.Stop(),c.call(a)},d.Start()}}),b}),define("engine/indexedvariableinfoflags",{None:0,Used:1,Interview:0,All:-1}),define("engine/variableinfoflags",{None:0,InterviewTrigger:1,AddedToInterview:2,WasSet:4,DialogTrigger:16,Marked:32,AddedToParent:64,All:-1}),define("engine/bitflagvalue",[],function(){function a(a){this._value=a}return a}),define("engine/variableinfo",["hd","hdmain/jq","engine/bitflagvalue","hdmain/system","system/exception/argumentnullexception","engine/indexedvariableinfoflags","engine/variableinfoflags","engine/answer"],function(a,b,c,d,e,f,g,h,i){function j(a,b){b===i?k.call(this,a):l.call(this,a,b)}function k(a){this._type=a,this._flags=g.None,this._iflags=null,this._interviewNodes=[],this._dialogItemNodes=[]}function l(a,b){this._type=a._type,b?(this._flags=a._flags,this._iflags=a._iflags,this._interviewNodes=a._interviewNodes,this._dialogItemNodes=a._dialogItemNodes):(this._flags=a._flags&(g.AddedToInterview|g.Marked),0!=(this._flags&g.AddedToInterview)&&(this._flags|=g.AddedToParent),this._iflags=null,this._interviewNodes=[],this._dialogItemNodes=[])}function m(a){return 0!=(this._flags&a)}function n(a,b){b?this._flags|=a:(m.call(this,g.AddedToParent)&&"function"!=typeof this.GetNOTAVariable&&(a&=~g.AddedToInterview),this._flags&=~a)}function o(a,b){if(null==this._iflags)return!1;var c=this._iflags.GetValue(b);return c=null==c?0:c._value,0!=(c&a)}function p(a,b,d){(null===this._iflags||this._iflags===i)&&(this._iflags=h.Create("BF",null,"(INDEXED RUNTIME VARIABLE INFO)"));var e=this._iflags.GetValue(d);e=null==e?0:e._value,b?e|=a:e&=~a,this._iflags.InitValue(new c(e),!0,d)}return this.DEBUG===i&&(this.DEBUG=a.DEBUG),d.ExtendClass(j,null,{Reset:function(a,b){n.call(this,a,!1),null!=this._iflags&&this._iflags.ApplyValueMutator(function(a){var d=null===a?0:a._value;return d&=~b,new c(d)})},ValueType:function(){return this._type},InterviewNodes:function(){return this._interviewNodes},DialogItemNodes:function(){return this._dialogItemNodes},InterviewTrigger:function(a){return a===i?m.call(this,g.InterviewTrigger):(n.call(this,g.InterviewTrigger,a),void 0)},DialogTrigger:function(a){return a===i?m.call(this,g.DialogTrigger):(n.call(this,g.DialogTrigger,a),void 0)},AddedToInterview:function(a){return a===i?m.call(this,g.AddedToInterview):(n.call(this,g.AddedToInterview,a),void 0)},WasSet:function(a){return a===i?m.call(this,g.WasSet):(n.call(this,g.WasSet,a),void 0)},Marked:function(a){return a===i?m.call(this,g.Marked):(n.call(this,g.Marked,a),void 0)},GetUsed:function(a){return o.call(this,f.Used,a)},SetUsed:function(a,b){p.call(this,f.Used,a,b)},toString:function(){return this._type}}),j}),define("engine/dialoginfo",["hd","hdmain/system","engine/indexedvariableinfoflags","engine/variableinfoflags","engine/variableinfo","engine/repeatindices","engine/answer"],function(a,b,c,d,e,f,g,h){function i(b,c){var d,f,g,h=i.baseConstructor;b instanceof a.Dlg?(d=b,h.call(this,"TF"),this.Initialize(d,null)):c instanceof e?(d=b,f=c,h.call(this,f,!0),this.Initialize(d,null)):(g=b,h.call(this,g,!1),this.Initialize(null,g))}return this.DEBUG===h&&(this.DEBUG=a.DEBUG),b.ExtendClass(i,e,{Initialize:function(b,c){if(this._limit=g.Create("NU",null,"(LIMIT)"),this._index=0,null!=b)if(b.nota){this._singleSelectGroups=[];for(var d=0;d<b.TrueFalseGroupCount();d++)this._singleSelectGroups.push({NOTA:new a.TfVar("$00NOTA"+(d+1)+b.name,null,b,a.Lc.GetStr("ui_nota"),null,"F",0,"C",0,!1,!1,!1,"I","",""," ",0,"L",!1)})}else this._singleSelectGroups=[];else this._singleSelectGroups=c._singleSelectGroups},Reset:function(a,b){i.baseclass.Reset.call(this,a,b),this._limit=g.Create("NU",null,"(LIMIT)"),this._index=0},Index:function(a){return a===h?this._index:(this._index=a,void 0)},GetNOTAVariable:function(a){return this._singleSelectGroups[a].NOTA},GetLimit:function(a){return a.length>0?this._limit.GetValue(f.Pop(a.slice(0))):0},SetLimit:function(a,b){b.length>0&&this._limit.SetValue(a,f.Pop(b))}}),i}),define("runtime/optionlist",["hd","hdmain/system"],function(a,b,c){function d(a){a instanceof d?this.Reset(a):(this.list=a,this.RebuildIndex())}var e=b.String.IsNullOrEmpty;return this.DEBUG===c&&(this.DEBUG=a.DEBUG),b.ExtendClass(d,null,{Reset:function(a){this.list=a.list,this.idx=a.idx,!1},RebuildIndex:function(){this.idx={};for(var a=0;a<this.list.length;a++)this.idx[this.list[a].name.toUpperCase()]=a},IndexOf:function(a){return"string"!=typeof a&&(a=a.Name()),a=this.idx[a.toUpperCase()],a===c?-1:a},IndexOfPrompt:function(a){if(!e(a)){a=a.toUpperCase();for(var b=0;b<this.list.length;b++)if(this.list[b].Prompt().toUpperCase()==a)return b}return-1},GetItem:function(a){return"string"==typeof a&&(a=this.idx[a.toUpperCase()]),this.list[a]},Contains:function(a){return"string"==typeof a?this.idx[a.toUpperCase()]!==c:this.list.indexOf(a)>=0},Count:function(){return this.list.length},FirstOrDefault:function(a){var b,c=null;for(b=0;b<this.Count();b++)if(a(this.GetItem(b))){c=this.GetItem(b);break}return c},Where:function(a){var b,c=[];for(b=0;b<this.Count();b++)a(this.GetItem(b))&&c.push(this.GetItem(b).name);return c},Select:function(a){var b,c=[];for(b=0;b<this.Count();b++)c.push(a(this.GetItem(b)));return c}}),a.McOptL=d,d}),define("engine/runtimeoptionlist",["hdmain/system","runtime/optionlist","hdmain/jq"],function(a,b,c,d){function e(a){e.baseConstructor.call(this,a),this._origOptions=a,this._usingOrig=!0,this._prOps=[],f.call(this)}function f(){var a=this;a._prOps.length>0&&(a._prOps=[]),c.each(a.list,function(b,c){a._prOps.push(c.Copy())})}return a.ExtendClass(e,b,{Reset:function(){var a=e.baseclass.Reset;arguments.length>0?a.call(this,arguments[0]):this._usingOrig||(a.call(this,this._origOptions),this._usingOrig=!0)},PrepareForMod:function(a){this.list=a?this._origOptions.list.slice(0):[],e.baseclass.RebuildIndex.call(this),this._usingOrig=!1},EvaluatePrompts:function(){for(var a=0;a<this.list.length;a++)this.list[a].EvPrompt()},HaveOptionsChanged:function(){var a,b=!1;if(this._prOps.length!=this.list.length)b=!0;else for(a=0;a<this._prOps.length;a++)if(this._prOps[a].name!=this.list[a].name||this._prOps[a].prompt!=this.list[a].prompt){b=!0;break}return b&&f.call(this),b},Add:function(a){this._usingOrig&&this.PrepareForMod(!0),this.list.push(a);var b=a.name.toUpperCase();this.idx[b]===d&&(this.idx[b]=this.list.length-1)},Clear:function(){this._usingOrig?this.PrepareForMod(!1):(this.list=[],this.idx={})},IsReadOnly:function(){return!1},CopyTo:function(a,b){for(var c=0;c<this.list.length;c++)a.splice(b+c,0,this.list[c])}}),e}),define("engine/multiplechoiceinfo",["hd","hdmain/system","system/exception/argumentnullexception","engine/variableinfo","engine/runtimeoptionlist","runtime/optionlist"],function(a,b,c,d,e,f,g){function h(a){var b,d;if(a===g)h.baseConstructor.call(this,"MC"),this._options=null;else if(a instanceof f){if(b=a,h.baseConstructor.call(this,"MC"),null==b)throw new c("options");this._options=new e(b)}else d=a,h.baseConstructor.call(this,d,!1),this._options=d._options}return this.DEBUG===g&&(this.DEBUG=a.DEBUG),b.ExtendClass(h,d,{Options:function(){return this._options},InitializeRuntimeOptions:function(a){this._options=new e(a)}}),h}),define("engine/variableinfostore",["hd","hdmain/jq","hdmain/system","engine/interviewnodetype","engine/dialoginfo","engine/multiplechoiceinfo","engine/variableinfo","system/dictionary","runtime/variable","system/exception"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a){this._varInfo={},this._shadows=a?a._shadows:{},this._markedVars={},this._parent=a}function m(b,d){var h,i,l,m,n=this.GetBucket(d),o=n.TryGetValue(b.name);if(null!=o){if("DI"==b.type)o instanceof e||(o=new e(b,o),n.a[b.name]=o);else if("MC"==b.type){if("MC"!=o._type)throw new j(c.String.Format(a.Lc.GetStr("err_mixedtypes"),b.name,o._type));h=c.Cast(o,f),l=h.Options(),null==l?h.InitializeRuntimeOptions(c.Cast(b,a.McVar).opts):(m=this._shadows[b.name],m!=k&&this.ApplyShadow(m,b.name))}}else if(null!=this._parent)i=this._parent.GetInfo(b,d),o=i instanceof e?new e(i):i instanceof f?new f(i):new g(i,!1),n.Add(b.name,o),this.CheckShadow(b.name),this._markedVars[b.type]&&1==this._markedVars[b.type][b.name]&&o.Marked(!0);else{switch(b.type){case"DI":o=new e(b);break;case"MC":o=new f(b.opts);break;default:o=new g(b.valType)}n.Add(b.name,o),this.CheckShadow(b.name),this._markedVars[b.type]&&1==this._markedVars[b.type][b.name]&&o.Marked(!0)}return o}function n(a,b){var c,d=this.GetBucket(b),h=null;return h=d.TryGetValue(a),null!=h?h:(null!=this._parent&&(c=this._parent.GetInfo(a,b),null!=c&&(h=c instanceof e?new e(c):c instanceof f?new f(c):new g(c,!1))),h)}function o(d,e,f){var g,h=this.GetInfo(d,f);h.AddedToInterview(e),"DI"==d.type&&(g=this,b.each(d.vList.list,function(b,d){d instanceof a.DlgEl||o.call(g,c.Cast(d,i),e,f)}))}return this.DEBUG===k&&(this.DEBUG=a.DEBUG),c.ExtendClass(l,null,{GetBucket:function(a){var b=this._varInfo[a];return b==k&&(b=new h,this._varInfo[a]=b),b},MarkVar:function(a,b){this._markedVars[b]==k&&(this._markedVars[b]={}),this._markedVars[b][a]=!0},ApplyShadow:function(a,b){if(a){var c,d,e;for(c in this._varInfo)this._varInfo.hasOwnProperty(c)&&(d=this._varInfo[c],e=d.TryGetValue(b),null!==e&&e._type==a._type&&"MC"==e._type&&(e._options=a._options))}},CheckShadow:function(a){var b=this._shadows[a];this.ApplyShadow(b,a)},Shadow:function(a,b){var c=this._shadows[a];c==k&&(this._shadows[a]=b,this.ApplyShadow(b,a))},Reset:function(a,b){var c,d,e,f,g=this._varInfo;for(d in g)if(g.hasOwnProperty(d))for(f=g[d],c=0;c<f.Keys.length;c++)e=f.a[f.Keys[c]],e.Reset(a,b)},AlreadyAdded:function(a,b,c){var d,e;for(e in this._varInfo)if(e!=c&&this._varInfo.hasOwnProperty(e)&&(d=n.call(this,a,e),null!=d&&d.ValueType()==b&&d.AddedToInterview()))return!0;return!1},GetInfo:function(a,b){return a instanceof i?m.call(this,a,b):n.call(this,a,b)},SetAddedToInterview:function(a,b){o.call(this,a,!0,b)},ClearAddedToInterview:function(a){if(a._type==d.Iteration){var b,c,e=a.Children(),f=e.Count();for(b=f;b--;)c=e.get(b),o.call(this,c.Variable(),!1,c._template.name)}else o.call(this,a.Variable(),!1,a._template.name)}}),l}),define("engine/interviewnodepath",["hd","system/exception/invalidoperationexception","hdmain/system","system/exception/argumentnullexception","engine/baseinterviewnode","engine/interviewnodetype","engine/interviewnode","engine/iterationnode"],function(a,b,c,d,e,f,g,h,i){function j(a){if(null==a)throw new d("node");this._hash=0,this._template=a._template,a.Type()!=f.Root&&k.call(this,a,0,0)}function k(a,b,d){var e,i,j,l;if(a.Type()!=f.Root)k.call(this,a._parent,b+1,a.Type()==f.Iteration?d+1:d),a._type==f.Iteration?(j=c.Cast(a,h),l=this._indices.length-d-1,this._indices[l]=l<j._indices.length?j._indices[l]:0,i=j._iterationId,!1):i=c.Cast(a,g).Variable().name,this._path.push(i);else for(this._path=[],this._indices=[],e=0;d>e;e++)this._indices[e]=0}function l(c,d,e,f){if(null==e||c==this._path.length)return e;var g,h,i=this._path[c];if(g=parseInt(i),!isNaN(g)){if(g=this._indices[d],h=e.Children().Count(),0==h)throw new b(a.Lc.GetStr("err_zeroiter"));return g>=h?f?e.Children().get(h-1):null:l.call(this,++c,++d,e.Children().get(g),f)}return l.call(this,++c,d,e.Children().get(i,this._template),f)}return this.DEBUG===i&&(this.DEBUG=a.DEBUG),c.ExtendClass(j,null,{Path:function(){return this._path},Indices:function(){return this._indices},IsEmpty:function(){return null==this._path},DialogName:function(){for(var c=this._path.length;c>0&&"number"==typeof this._path[--c];);if(c>=0)return this._path[c];throw new b(a.Lc.GetStr("err_invldloc"))},FindNode:function(a,b){if(null==a)throw new d("rootNode");return l.call(this,0,0,a,b)},OffsetIndex:function(a,b){this._indices[b]+=a},Equals:function(a){var b,d=c.Cast(a,j);if(null!=d){if(d.GetHashCode()!=this.GetHashCode())return!1;if(d.IsEmpty()||this.IsEmpty())return d.IsEmpty()&&this.IsEmpty();if(d._path.length!=this._path.length)return!1;for(b=0;b<this._path.length;b++)if(d._path[b]!=this._path[b])return!1;return!0}return this==a},GetHashCode:function(){if(0==this._hash&&null!=this._path)for(var a=0;a<this._path.length;a++)this._hash=this._hash^this._path[a].GetHashCode();return null!=this._template&&(this._hash=this._hash^this._template.name.GetHashCode()),this._hash}}),j}),define("engine/dialogitemnodeerror",["hd","hdmain/system"],function(a,b){function c(a,b){this.ItemNode=a,this.ErrorValue=b}var d=b.Cast;return b.ExtendClass(c,null,{GetErrorMessage:function(){var b,c,e,f,g=this.ItemNode.DialogItem(),h=a.Lc;if("DA"==g.type)return h.GetStr("val_invdate");if("NU"==g.type){if(b=h.ParseNumber(this.ErrorValue),isNaN(b))return h.GetStr("val_invnum");if(c=d(g,a.NuVar),e=0!=c.max,f=e||0!=c.min,e&&f)return h.GetStr("val_numrng",h.FormatNumberDef(c.min,c.decPl),h.FormatNumberDef(c.max,c.decPl));if(e)return h.GetStr("val_numlt",h.FormatNumberDef(c.max,c.decPl));if(f)return h.GetStr("val_numgt",h.FormatNumberDef(c.min,c.decPl))}return""}}),c}),define("engine/refreshinterviewprogresseventargs",[],function(){function a(a,b,c,d){this.aq=a,this.tq=b,this.ru=c,this.et=d}return a}),define("engine/navigatedeventargs",[],function(){function a(a,b){this.f=a,this.s=b}return a}),define("engine/movefocuseventargs",[],function(){function a(a,b,c){this.ItemNode=a,this.OptionName=b,this.Direction=c}return a}),define("engine/pagemodechangingeventargs",[],function(){function a(a){this.Mode=a}return a}),define("engine/refreshintervieweventargs",[],function(){function a(a,b,c,d,e,f){this.UpdateFlags=a,this.CurrentNodeChanged=b,this.FullUpdateTime=c,this.DialogUpdateTime=d,this.UsageUpdateTime=e,this.StatusUpdateTime=f}return a}),define("engine/navigator",["hd","system/exception/invalidoperationexception","hdmain/system","system/exception/argumentnullexception","engine/interviewnodetype","engine/interviewnode","engine/iterationnode","engine/repeatnode"],function(a,b,c,d,e,f,g,h){function i(a){this._interview=a}var j=c.Cast,k="AvailableForNavigation";return c.ExtendClass(i,null,{Update:function(){if(0==this._interview.Root().Children().Count()||null==this._interview.FirstRootChild())return this.First=null,this.Last=null,this.PreviousUnanswered=null,this.NextUnanswered=null,this.Previous=null,this.Next=null,void 0;if(null==this._interview.CurrentOutlineNode())throw new b(a.Lc.GetStr("err_navstate"));this.First=this.FindFirst(),this.Last=this.FindLast(),this.PreviousUnanswered=this.FindPreviousUnanswered(),this.NextUnanswered=this.FindNextUnanswered(),this.Previous=this.FindPrevious(),this.Next=this.FindNext()},CanProceedToNext:function(a){return this.CanProceedToNode(this.Next,a)},CanProceedToNextUnanswered:function(a){return this.CanProceedToNode(this.NextUnanswered,a)},CanProceedToLast:function(a){return this.CanProceedToNode(this.Last,a)},CanProceedToNode:function(b,c){return this._interview.HasValidationErrors()?(c.s=a.Lc.GetStr("val_err"),!1):null!=b&&(c.s=this._interview.GetErrorText("d",b.ComesAfter(this._interview.ErrorNode()),b.ComesAfter(this._interview.RequiredNode())),""!=c.s)?!1:(c.s="",!0)},FindFirst:function(){var a=null;return this._interview.Root().Children().Count()>0&&(a=this._interview.CurrentOutlineNode(),null!=a&&a.Type()==e.Iteration&&j(a,g).IsSpreadsheetRowInEditMode()?a=a._parent.Children().get(0):(a=this._interview.FirstRootChild(),null!=a&&a.Type()==e.Repeat&&"S"==j(a,h)._dialog.rType&&(a=a.Children().get(0)))),a},FindPreviousUnanswered:function(){var a=null;if(this._interview.Root().Children().Count()>0)for(a=this.GetPreviousNodeInTreeOrder(this._interview.CurrentOutlineNode());null!=a&&a.AnsStatus().IsAllWantedAnswered(a);)a=this.GetPreviousNodeInTreeOrder(a);return a},FindPrevious:function(){var a=null;return this._interview.Root().Children().Count()>0&&(a=this._interview.CurrentOutlineNode(),a=this.GetPreviousNode(a,this._interview.NextFollowsOutline())),a},FindNext:function(){var a=null;return this._interview.Root().Children().Count()>0&&(a=this._interview.CurrentOutlineNode(),a=this.GetNextNode(a,this._interview.NextFollowsOutline())),a},FindNextUnanswered:function(){var a=null;if(this._interview.Root().Children().Count()>0)for(a=this.GetNextNodeInTreeOrder(this._interview.CurrentOutlineNode());null!=a&&a.AnsStatus().IsAllWantedAnswered(a);)a=this.GetNextNodeInTreeOrder(a);return a},FindLast:function(){var a,b=null;return this._interview.Root().Children().Count()>0&&(b=this._interview.CurrentOutlineNode(),null!=b&&b.Type()==e.Iteration&&j(b,g).IsSpreadsheetRowInEditMode()?(a=b._parent.Children().Count()-1,a>0&&b._parent.Children().get(a).IsHiddenNew()&&a--,b=b._parent.Children().get(a)):b=this.GetLastChild(this._interview.Root())),b},GetLastChild:function(a){var b,c,d,f=a.OutlineChildrenReverse(),g=null;for(b=0;b<f.length;b++)if(f[b].ShowInOutline()){g=f[b];break}return null!=g&&g.Type()==e.Repeat&&!j(g,h).IsSpreadsheet()&&(c=g.Children().Count()-1,c>0&&!g.Children().get(c)[k]()&&c--,g=g.Children().get(c)),this._interview.NextFollowsOutline()&&null!=g&&(d=this.GetLastChild(g),null!=d)?d:g},GetNextNode:function(a,b){if(null==a)throw new d("node");return b?this.GetNextNodeInTreeOrder(a):this.GetNextNodeInTraditionalOrder(a)},GetNextNodeInTraditionalOrder:function(a){var b,c=a,d=!1;if(c.Type()==e.Iteration)if(b=c._parent.Children().IndexOf(c)+1,b>=0&&b<c._parent.Children().Count()&&c._parent.Children().get(b)[k]())c=c._parent.Children().get(b);else if(j(c,g).IsSpreadsheetRowInEditMode())c=c._parent[k]()?j(c._parent,f):j(c._parent._parent,f);else{for(;c._parent.Type()!=e.Root;)if(c=j(c._parent,f),!c[k]()&&c._parent.Type()!=e.Root){c=j(c._parent,f);break}c.Type()==e.Repeat&&"R"==j(c,h)._dialog.rType&&(d=!0)}else if(c._parent.Type()!=e.Root)for(c=j(c._parent,f);c.Type()!=e.Root&&!c[k]();)c=j(c._parent,f);else d=!0;if(null!=c&&d)if(b=c._parent.Children().IndexOf(c)+1,b>=0&&b<this._interview.Root().Children().Count())for(c=this._interview.Root().Children().get(b);!c.ShowInOutline()&&++b<this._interview.Root().Children().Count();)c=this._interview.Root().Children().get(b);else c=null;return c},GetNextNodeInTreeOrder:function(a){var b,c=a,d=-1;do if(c.HasVisibleChildren())c=c.Children().get(0),d=0;else if(-1==d?d=c._parent.Children().IndexOf(c)+1:d++,d>=0&&d<c._parent.Children().Count())c=c._parent.Children().get(d);else if(c.Type()==e.Iteration&&j(c._parent,h).EditRowMode())c=c._parent[k]()?j(c._parent,f):j(c._parent._parent,f);else{for(;c._parent.Type()!=e.Root;)if(c=j(c._parent,f),d=c._parent.Children().IndexOf(c)+1,d<c._parent.Children().Count()&&(b=c._parent.Children().get(d),b.Type()!=e.Iteration||!b.IsHiddenNew())){c=b;break}d>=c._parent.Children().Count()&&(c=null)}while(null!=c&&!c[k]());return c},GetPreviousNode:function(a,b){if(null==a)throw new d("node");return b?this.GetPreviousNodeInTreeOrder(a):this.GetPreviousNodeInTraditionalOrder(a)},GetPreviousNodeInTraditionalOrder:function(a){var b,c=a;if(bAdvToSib=!1,c.Type()==e.Iteration)if(b=c._parent.Children().IndexOf(c)-1,b>=0)c=c._parent.Children().get(b);else if(j(c,g).IsSpreadsheetRowInEditMode())c=c._parent[k]()?j(c._parent,f):j(c._parent._parent,f);else{for(;c._parent.Type()!=e.Root;)if(c=j(c._parent,f),c.Type()==e.Repeat&&"R"==j(c,h)._dialog.rType&&c._parent.Type()!=e.Root){c=j(c._parent,f);break}c.Type()==e.Repeat&&"R"==j(c,h)._dialog.rType&&(bAdvToSib=!0)}else c._parent.Type()!=e.Root?c=j(c._parent,f):bAdvToSib=!0;if(null!=c&&bAdvToSib)if(b=c._parent.Children().IndexOf(c)-1,b>=0){for(c=this._interview.Root().Children().get(b);!c.ShowInOutline()&&--b>=0;)c=this._interview.Root().Children().get(b);c.Type()==e.Repeat&&(b=c.Children().Count()-1,c.Children().get(b).IsHiddenNew()&&b--,c=c.Children().get(b))}else c=null;return c},GetPreviousNodeInTreeOrder:function(a){var b=a,c=-1;do if(-1==c?c=b._parent.Children().IndexOf(b)-1:c--,c>=0)for(b=b._parent.Children().get(c);b.HasVisibleChildren();){if(c=b.Children().Count()-1,b.Children().get(c).Type()==e.Iteration)for(;c>0&&b.Children().get(c).IsHiddenNew();)c--;b=b.Children().get(c)}else b._parent.Type()!=e.Root?(b=b.Type()==e.Iteration&&j(b,g).IsSpreadsheetRowInEditMode()?b._parent[k]()?j(b._parent,f):j(b._parent._parent,f):j(b._parent,f),c=b._parent.Children().IndexOf(b)):b=null;while(null!=b&&!b[k]());return b}}),i}),define("engine/interview_scriptstack",["hdmain/system","hdmain/stack"],function(a,b){function c(){c.baseConstructor.call(this)}return a.ExtendClass(c,b,{TopDlgScript:function(){return this.Count()>0&&"D"==this.Peek().type?this.Peek().vName:null},InDlgScript:function(){return null!==this.TopDlgScript()},CurDlgScript:function(){var a,b;for(a=this.a.length-1;a>=0;a--)if(b=this.a[a],"D"==b.type)return b.vName;return null},InDialogScriptOrCallee:function(){return null!==this.CurDlgScript()},InComputationScript:function(){for(var a=this.a.length-1;a>=0;a--)if("C"==this.a[a].type)return!0;return!1},InDoNotAskProperty:function(){for(var a=this.a.length-1;a>=0;a--)if("N"==this.a[a].type)return!0;return!1},InAskProperty:function(){var a,b;for(a=this.a.length-1;a>=0;a--){if(b=this.a[a],"N"==b.type)return!1;if("A"==b.type)return!0}return!1}}),c}),define("engine/repeatstack",["system/exception/invalidoperationexception","hdmain/stack","hdmain/system"],function(a,b,c){function d(){d.baseConstructor.call(this)}return c.ExtendClass(d,b,{GetIndices:function(){var a,b=[];for(a=0;a<this.a.length;a++)b[a]=this.a[a].index;return b}}),d}),define("engine/hotdocsintrinsicexception",["hdmain/system","system/exception"],function(a,b){function c(){c.baseConstructor.apply(this,arguments)}return a.ExtendClass(c,b),c}),define("engine/interview",["hd","hdmain/system","hdmain/jq","hdmain/stack","system/exception/invalidoperationexception","system/dispatchertimer","system/exception/targetinvocationexception","system/exception/argumentnullexception","system/exception/argumentexception","engine/variableinfostore","engine/indexedvariableinfoflags","engine/variableinfoflags","engine/interviewnodepath","engine/interviewnodetype","engine/valuechangetype","engine/dialoginfo","engine/dialogitemnodeerror","engine/dialogupdateflags","engine/interviewnode","engine/dialognode","engine/iterationnode","engine/refreshinterviewprogresseventargs","engine/navigatedeventargs","engine/movefocuseventargs","engine/pagemodechangingeventargs","engine/refreshintervieweventargs","engine/navigator","engine/interview_scriptstack","engine/repeatstack","engine/repeatindices","engine/repeatnode","engine/focusdirection","system/dictionary","engine/uistate","engine/pagemode","runtime/variable","engine/hotdocsintrinsicexception","engine/rootnode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M){function N(c,e,g,h,i){this._itvID=b.Guid.NewGuid(),this._engine=c,a.Answers.AnswerChanged.push(ab(O,this)),this._templateName=e,this._assemblyName=g,this._computationName=h,this._interviewTriggered=!0,this._dialogTriggered=!1,this._reTriggered=!1,this._newNodeId=this._prevNodeId=this._prevOutlineNodeId=-1,this._curNode=this._reqNode=this._errNode=null,this._reqNodeWasSet=!1,this._errNodeWasSet=!1,this._varInfo=new j(i),this._validationErrors=[],this._pathCache=[],this._pathIndex=new G,this._templateStack=new d,this._unansStack=new d,this._scriptStack=new B,this._repeatStack=new C,this._outlineStack=new d,this._paraNum=[],this._ancestorOnSinglePage={v:0},this._navigator=new A(this),this._refreshDialogTimer=new f,this._refreshDialogTimer.Tick=this._refreshDialogTimer_Tick,this._moveFocus=!0,this._performScroll=!0,this._navigateInProgress=!0,this._dialogRefreshEventArgs=new z(r.None,!1,0,0,0,0),this._focusTimer=new f,this._focusTimer.Tick=ab(Q,this),this._focusEnterQueue=[],this._templateProcessingDepth=0
}function O(b,c){var d,e,f,g,h,i,j,k,l=null,m={},q=this._templateStack.Count()>0?this.CurrentTemplate():null;if(eb(c.v)||(l=q?this._varInfo.GetInfo(c.v,q.name):null),null==this._root||null==l)return this._interviewTriggered=!0,this._dialogTriggered=!0,void 0;for(e in this._varInfo._varInfo)if(l=this._varInfo.GetInfo(c.v,e),null!=l&&(this._inInterview||(l.InterviewTrigger()||0==l.DialogItemNodes().length?this._interviewTriggered=!0:0!=(this._root.DescendantUpdateflags()&r.RepeatAnswer)&&(this._interviewTriggered=!0),this._inDialog||(l.DialogTrigger()?this._dialogTriggered=!0:l instanceof p&&(this._dialogTriggered=!0))),l.DialogItemNodes().length>0))for(d=0;d<l.DialogItemNodes().length;d++)if(f=l.DialogItemNodes()[d],D.AreEquivalent(f._parent.Indices(),c.i)&&(g=this.InRebuild()||this._scriptStack.Count()>0||this.InBulkAnswerChange()?r.ScriptAnswer:r.UserAnswer,f.Required()&&(g|=r.RequiredAnswer),f.SetUpdateFlags(g),"TF"==l.ValueType()&&l instanceof p&&(h=!1,c.t!=o.BecameUnanswered&&a.Answers.TryGetAnswer(c.v,"TF",m)&&(i=m.v.GetValue(c.Indices),null!=i&&(h=i)),f._parent.Children().Count()>0&&f._parent.Children().get(c.v,f._parent._template).Active(h)),f._parent.Type()==n.Iteration||f._parent.Type()==n.Dialog&&f._parent.Indices().length>0)){j=null,k;do j=null==j?f._parent:cb(j._parent,s),k=j.AnsStatus().IsAnswered(),j.TabulateAnsweredStatus();while(k!=j.AnsStatus().IsAnswered()&&j.Type()!=n.Iteration);j.Type()==n.Iteration&&k!=j.AnsStatus().IsAnswered()&&(this._interviewTriggered=!0)}!this.InBulkAnswerChange()&&!this.Suspended()&&0==this._templateProcessingDepth&&this.Update()}function P(a){return 0>a||a>=this._pathCache.length?null:this._pathCache[a]}function Q(){var a,b;if(!this._refreshDialogTimer.IsEnabled()){for(this._focusTimer.Stop(),a=0;a<this._focusEnterQueue.length;a++)b=this._focusEnterQueue[a],b.ItemNode.OnFocusEntering(b.OptionName,b.Direction),b.ItemNode.IsSpreadsheet()||c(this).trigger("MoveFocus",b.ItemNode,b);this._focusEnterQueue=[]}}function R(a,b){c(this).trigger("Navigated",new w(a,b))}function S(){$=bb.TickCount(),this._inUsagePass=!0,this._varInfo.Reset(l.None,k.Used),this.PrepareForFullUpdate();var a=this.ProcessScript(this._engine.RootTemplateName(),this._engine.RootAssemblyName(),null);return this._inUsagePass=!1,$=bb.TickCount()-$,a}function T(a){var b,c,d,e,f,g,h,i,j,k;for(b=0;b<a.Children().Count();b++)c=a.Children().get(b),T.call(this,c);if(a.Type()!=n.Root&&(d=!1,a instanceof s&&(d=a._dialog.hideIfUn),d)){if(e=!0,f=a,a.Type()==n.Repeat){for(b=0;b<f.Children().Count();b++)c=f.Children().get(b),e=e&&c.AutoHidden();f.AutoHidden(e)}else{for(g=!1,b=0;b<f._itemNodes.Count()&&(h=f._itemNodes.get(b),!(h.DialogItem()instanceof J)||(g=!0,i=this._varInfo.GetInfo(h.DialogItem().name,f.TemplateOfOrigin().name),e=e&&(h.Gray()||h.Hidden()||"DI"!=h.DialogItem().type&&!i.GetUsed(f.Indices())),e));b++);f.AutoHidden(e&&g)}f._parent instanceof t&&(j=f._parent,k=j._dialog,this._templateStack.Push(j.TemplateOfOrigin()),this.PsS(k.name,"D"),this.AutoHideVar(f._dialog.name,f.AutoHidden()),this.PpS(),this._templateStack.Pop()!=j.TemplateOfOrigin()&&!1,j._itemNodes.get(f._dialog.name).AfterScriptEvaluation())}}function U(a){if(null==a)throw new h("intNode");var b,c,d,e;for(this._templateStack.Push(a.TemplateOfOrigin()),this._templateProcessingDepth++,this._outlineStack.Push(a.AskedImplicitly()?a.Owner():a._parent),this._varInfo.ClearAddedToInterview(a),b=a._parent,b.Children().PrepareToUpdate(a),c={startIndex:0,endIndex:0},d=null,a.FindNodesAskedImplicitly(c),b.Type()!=n.Root&&(d=this._root.Children().get(c.endIndex)),this._root.Children().PrepareToUpdate(c.startIndex),e=c.startIndex;e<c.endIndex;e++)this._varInfo.ClearAddedToInterview(this._root.Children().get(e));this.SyncRepeatStackWithNode(a),this.DefineInterviewNode(a.Variable(),a.AskedImplicitly(),a.Type()==n.Iteration&&a.New()),b.Type()!=n.Root&&this._root.Children().RemoveUntil(d),b.Children().FinishUpdating(),this._root.Children().FinishUpdating(),a.SendUpdateFlagsUpstream(r.All,!0),this.ClearRpt(),this._outlineStack.Pop(),this._templateProcessingDepth--,this._templateStack.Pop()}function V(){var a=bb.TickCount();this._reqNodeOld=this._reqNode,this._errNodeOld=this._errNode,this._reqNode=null,this._reqNodeWasSet=!1,this._errNode=null,this._errNodeWasSet=!1,this._root.UpdateAnsweredStatus(!1),!this._reqNodeWasSet&&null!=this._reqNodeOld&&this._reqNodeOld.RequiredIsEnforcable()&&(this._reqNode=this._reqNodeOld),!this._errNodeWasSet&&null!=this._errNodeOld&&this.Root().Children().IndexOf(this._errNodeOld)>=0&&(this._errNode=this._errNodeOld),c(this).trigger("RefreshInterviewProgress",new v(this.AnsweredCount(),this.TotalCount(),null!=this._reqNode,null!=this._errNode)),_+=bb.TickCount()-a}function W(){for(var a=0;fb>a;a++)this._paraNum[a]=0}function X(){var a,b=this.FirstRootChild();return null!=b?(a=this._newNodeId<=0?b:null==this._curNode||this._curNode._id!=this._newNodeId?this.FindDialogByID(this._newNodeId,!0):this._curNode,null==a&&(a=b),a!=this._curNode&&(a.Type()==n.Repeat&&(a=cb(a,E).GetFirstFocusableNode()),this._curNode=a),this._newNodeId<=0&&this._curNode.DoImplicitAnswerProcessing(),this._newNodeId=this._curNode._id):this._curNode=null,null==this._curNode?(this._newNodeId=-1,this.IsPopup()||this._engine.SetError(this.GetResourceString("err_noint")),!1):!0}var Y,Z,$,_,ab=c.proxy,bb=b.Environment,cb=b.Cast,db=b.String.Format,eb=b.String.IsNullOrEmpty,fb=9;return b.ExtendClass(N,null,{Suspended:function(){return a.CurrentInterview()!=this},IsPopup:function(){return!eb(this._computationName)},Navigator:function(){return this._navigator},ProgressBarEnabled:function(){return this._engine.ProgressBarEnabled},IsFirstEnabled:function(){return this._navigator.First!=this.CurrentOutlineNode()},IsPreviousUnansEnabled:function(){return null!=this._navigator.PreviousUnanswered},IsPreviousEnabled:function(){return null!=this._navigator.Previous},IsNextEnabled:function(){return!0},IsNextUnansEnabled:function(){return null!=this._navigator.NextUnanswered},IsLastEnabled:function(){return this._navigator.Last!=this.CurrentOutlineNode()},InEditSpreadsheetRow:function(){var a=this.CurrentNode();return null!=a&&a.Type()==n.Iteration&&a.IsSpreadsheetRowInEditMode()},PreferenceCache:function(){return this._engine.PreferenceCache()},BeginBulkAnswerChange:function(){this._engine.BeginBulkAnswerChange()},EndBulkAnswerChange:function(a){this._engine.EndBulkAnswerChange(a)},InBulkAnswerChange:function(){return this._engine.InBulkAnswerChange()},IsProcessing:function(){return this._templateProcessingDepth>0},GetIdForNode:function(a){var b=new m(a),c=this._pathIndex.TryGetValue(b);return null===c&&(c=this._pathCache.length,this._pathCache.push(b),this._pathIndex.Add(b,c)),c},OffsetIndicesForId:function(a,b,c){P.call(this,a).OffsetIndex(b,c)},GetRuntimeOptionsForVariable:function(a,b){var c=this._varInfo.GetInfo(a,b);return c.Options()},GetNOTAProxyForDialog:function(a,b){var c=this._varInfo.GetInfo(a,this.CurrentTemplate().name);return c.GetNOTAVariable(b)},RegisterNode:function(a){var b,c,d=a.TemplateOfOrigin().name,e=this._varInfo.GetInfo(a.Variable(),d),f=a._dialog.vList,g=f.Count();for(e._interviewNodes.push(a),b=0;g>b;b++)c=cb(f.GetItem(b),J),null!=c&&(e=this._varInfo.GetInfo(c,d),e._dialogItemNodes.push(a._itemNodes.get(b)))},UnregisterNode:function(a){if(null!=a){var b,c,d,e,f=a._template?a._template.name:null;for(c=0;c<a._dialog.vList.Count();c++)if(d=cb(a._dialog.vList.GetItem(c),J),null!=d){for(e=0;e<this._validationErrors.length;e++)if(this._validationErrors[e].ItemNode==a._itemNodes.get(c)){this._validationErrors.splice(e,1);break}for(b=this._varInfo.GetInfo(d,f),e=0;e<b.DialogItemNodes().length;e++)if(b.DialogItemNodes()[e]==a._itemNodes.get(c)){b.DialogItemNodes().splice(e,1);break}}for(b=this._varInfo.GetInfo(a.Variable(),f),e=0;e<b.InterviewNodes().length;e++)if(b.InterviewNodes()[e]==a){b.InterviewNodes().splice(e,1);break}}},AddDialogItemNodeError:function(a,b){var c,d,e,f=!0;for(d=0;d<this._validationErrors.length;d++)if(c=this._validationErrors[d],c.ItemNode==a){c.ErrorValue=b,f=!1;break}f&&(e=new q(a,b),this._validationErrors.push(e),a.OnChangeErrorState(e))},RemoveDialogItemNodeError:function(a){var b,c;for(b=0;b<this._validationErrors.length;b++)if(c=this._validationErrors[b],c.ItemNode==a)return this._validationErrors.splice(b,1),a.OnChangeErrorState(null),!0;return!1},HasValidationErrors:function(){return this._validationErrors.length>0},GetErrorText:function(b,c,d){c===M&&(c=null!=this.ErrorNode()),d===M&&(d=null!=this.RequiredNode());var e="";return c&&(e+=a.Lc.GetStr("val_dlg_err"+b,this.ErrorNode().Caption(),this.ErrorNode().ErrorText)),d&&(c&&(e+="\r\n\r\n"),e+=a.Lc.GetStr("val_req"+b,this.RequiredNode().Caption())),e},GetErrorValue:function(a){for(var b=0;b<this._validationErrors.length;b++)if(this._validationErrors[b].ItemNode==a)return this._validationErrors[b].ErrorValue;return null},GetValueType:function(a){var b,c=this._varInfo.GetInfo(a,this.CurrentTemplate().name),d="UN";return null==c?(b=this.GetComponentSafe(a),null!=b&&(d=b.valType)):d=c.ValueType(),d},VarIsMarked:function(a){var b=this._varInfo.GetInfo(a,this.CurrentTemplate().name);return null!=b?b.Marked():!1},SetValueType:function(a,b,c){c&&this._varInfo.MarkVar(a,b)},ResourcePaneInitialHeight:function(){return a.ResourcePaneInitialHeight},GetResourceString:function(b){return a.Lc.GetStr(b)},Engine:function(){return this._engine},Answers:function(){return this._engine.Answers},CurrentTemplate:function(){return this._templateStack.Peek()},CurrentNode:function(){return this._curNode},CurrentNodeId:function(){return this._newNodeId},CurrentOutlineNode:function(){if(null!=this._curNode){if(this._curNode.IsSpreadsheetRowInEditMode())return this._curNode;if(this._curNode.IsSpreadsheetRow())return cb(this._curNode._parent,E).IsOnParent()?cb(this._curNode._parent._parent,s):cb(this._curNode._parent,s)}return this._curNode},RequiredNode:function(){return this._reqNode},ErrorNode:function(){return this._errNode},SetRequiredNode:function(a){a!=this._reqNodeOld&&(null!=a&&a.SetUpdateFlags(r.NodeRequired),null!=this._reqNodeOld&&this._reqNodeOld.SetUpdateFlags(r.NodeRequired)),this._reqNode=a,this._reqNodeWasSet=!0},SetErrorNode:function(a){null!=a&&a.SetUpdateFlags(r.NodeError|r.HasError),a!=this._errNodeOld&&null!=this._errNodeOld&&this._errNodeOld.SetUpdateFlags(r.NodeError|r.HasError),this._errNode=a,this._errNodeWasSet=!0},CurrentBuildNode:function(){if(!this.InRebuild())throw new e(a.Lc.GetStr("err_retrvbn"));return this._outlineStack.Peek()},InRebuild:function(){return this._outlineStack.Count()>0},InFullRebuild:function(){return this._inInterview},Root:function(){return this._root},SinglePageReturnId:function(){return this._ancestorOnSinglePage.v},NextFollowsOutline:function(){return this._engine.NextFollowsOutline},TriggerFocusEnter:function(a,b,c){a.IsSpreadsheet()||this.SetFocusNode(a._parent),this._focusEnterQueue.push(new x(a,b,c)),this._focusTimer.Start(this)},SetFocusNode:function(a){(this._curNode!=a||this._newNodeId!=a._id)&&(this._prevNodeId=this._newNodeId,this._curNode=a,this._newNodeId=a._id,this._curNode.DoImplicitAnswerProcessing())},GetFocusItem:function(){var a=null,b=this.CurrentNode();return null!=b&&(a=b.GetFocusedItemNode()),a},ClearFocusItem:function(){var a=this.CurrentNode();null!=a&&a.ClearFocusedItemNode()},IgnoreNextFocus:function(){this._ignoreNextSetFocus=!0},IgnoringNextFocus:function(){return this._ignoreNextSetFocus?(this._ignoreNextSetFocus=!1,!0):!1},PrepareForFullUpdate:function(){this._templateStack.Clear(),this._unansStack.Clear(),this._scriptStack.Clear(),W.call(this),this._engine.AskNone(!1),null==this._root&&(this._root=new L(this))},TryProcessTemplate:function(b,c){var d=this;d.PrepareForFullUpdate(),d._outlineStack.Push(d._root),d._root.Children().ClearUpdated(),window.setTimeout(function(){try{d.ProcessScript(b,c,null),d._outlineStack.Pop(),!1}catch(e){var f=e.message;null!=e.InnerException&&(f+=" ("+e.InnerException.message+")"),a.HDEngine._engine.OnChangeUIState(H.Error,f)}},0)},ProcessScript:function(b,c,d){var e,f=!1,g={};if(this._engine.TryGetTemplate(b,c,g)){if(g=g.v,this._templateStack.Push(g),this._templateProcessingDepth++,null==d){if(g.InsertDepth++,g.InsertDepth>20)throw new K(a.Lc.GetStr("err_insrtlev"));this._inUsagePass&&g.HasTemplateInterview()?g.RunTemplateInterview():g.RunInterview(),g.InsertDepth--}else e=this.GetComponentSafe(d),null!=e&&(this.PsU(),e.EvScr(),this.PpU());this._templateProcessingDepth--,this._templateStack.Pop(),f=this._engine.CheckForNewInserts()}return f?this._engine.AutoInterviews()&&T.call(this,this._root):this._interviewTriggered=!0,f},CanUpdate:function(){return 0==this._templateProcessingDepth},ClearRpt:function(){for(;a.InR();)a.PpR()},Update:function(b,d){function e(){try{this._inUpdate=!0,this._engine.AutoInterviews()&&this._interviewTriggered&&S.call(this),b?window.setTimeout(ab(f,this),0):f.call(this)}catch(a){i.call(this,a)}}function f(){try{this._engine.AllTemplatesLoaded()&&(j=this._interviewTriggered,this._interviewTriggered&&(Y=bb.TickCount(),this._varInfo.Reset(l.InterviewTrigger|l.DialogTrigger|l.AddedToInterview|l.WasSet,k.None),this.PrepareForFullUpdate(),this._curNode=null,this._inInterview=!0,this._outlineStack.Push(this._root),this._root.Children().ClearUpdated(),this.ComputationInsertTracker=null,this.ProcessScript(this._templateName,this._assemblyName,this._computationName),this._root.Children().Trim(),this._outlineStack.Pop(),this._inInterview=!1,this._engine.AllTemplatesLoaded()?(this._interviewTriggered=!1,this._dialogTriggered=!0):this._prevNodeId>0&&(this._dialogTriggered=!1,this._curNode=this.FindDialogByID(this._prevNodeId,!0)),Y=bb.TickCount()-Y),this._dialogTriggered&&this._engine.AllTemplatesLoaded()&&(Z=bb.TickCount(),X.call(this)&&(this._inDialog=!0,U.call(this,j?this.CurrentOutlineNode():this._curNode),this._inDialog=!1),this._dialogTriggered=!1,this._interviewTriggered&&!j&&(this._reTriggered=!0),Z=bb.TickCount()-Z)),b?window.setTimeout(ab(h,this),0):h.call(this)}catch(a){i.call(this,a)}}function h(){var d;try{this._inUpdate=!1,d=this._reTriggered?function(){this.Update()}:this._engine.AllTemplatesLoaded()?function(){this._engine.OnChangeUIState(H.Ready,null),V.call(this),this._navigator.Update(),null!=this._curNode&&(this._templateStack.Push(this._curNode.TemplateOfOrigin()),this.SyncRepeatStackWithNode(this._curNode)),m=null==this.CurrentOutlineNode()?-1:this.CurrentOutlineNode()._id,n=m!=this._prevOutlineNodeId,c(this).trigger("RefreshOutline",new z(this._root.UpdateFlags()|this._root.DescendantUpdateflags(),n,Y,Z,$,_)),this._root.ClearUpdateFlags(r.AllOutlineRelated),this.BeginDisplayUpdate(n),this._prevNodeId=this._newNodeId,null!=this._curNode&&(this._prevOutlineNodeId=m),this._engine.OnAfterInterviewUpdate()}:function(){this._engine.OnChangeUIState(H.Busy,a.Lc.GetStr("ui_wait_cmp"))},b?window.setTimeout(ab(d,this),0):d.call(this)}catch(e){i.call(this,e)}}function i(a){this._inUpdate=!1,o=a,p=o.message,o instanceof K||null!=o.InnerException&&(o=o.InnerException,o instanceof g&&null!=o.InnerException&&(o=o.InnerException),p+=" ("+o.message+")"),this._engine.OnChangeUIState(H.Error,p)}b===M&&(b=!1),d===M&&(d=!0),b=!1;var j,m,n,o,p;if(!this.Suspended()){for(this._reTriggered?this._reTriggered=!1:(this._engine.OnBeforeInterviewUpdate(),Z=0,Y=0,$=0,_=0),"boolean"!=typeof this._singlePageMode&&(this._singlePageMode=this._engine.InterviewStack().Count()>1?this._engine.InterviewStack().ElementAt(1).IsSinglePage():this.PreferenceCache().SinglePageOnInitially()),d&&this.ClearRpt();this._templateStack.Count()>0;)this._templateStack.Pop();b?window.setTimeout(ab(e,this),0):e.call(this)}},BeginDisplayUpdate:function(a){var b=this;b._dialogRefreshEventArgs=new z(b._dialogRefreshEventArgs.UpdateFlags|b._root.UpdateFlags()|b._root.DescendantUpdateflags(),b._dialogRefreshEventArgs.CurrentNodeChanged||a,Y,Z,$,_),b._refreshDialogTimer.Interval=b._navigateInProgress&&(new Date-b._lastDialogRefresh).TotalMilliseconds<300?300:0,b._refreshDialogTimer.Start(b),b._lastDialogRefresh=new Date},_refreshDialogTimer_Tick:function(){this._refreshDialogTimer.Stop(),c(this).trigger("RefreshDialogContent",this._dialogRefreshEventArgs),this._dialogRefreshEventArgs.UpdateFlags=r.None,this._dialogRefreshEventArgs.CurrentNodeChanged=!1,this._root.ClearUpdateFlags(r.All),this._navigateInProgress&&R.call(this,this._moveFocus,this._performScroll),this._moveFocus=!0,this._performScroll=!0,this._navigateInProgress&&(this._navigateInProgress=!1,this._engine.DoNavigatedJSAPI(this.CurrentOutlineNode()))},AddToVarUsageList:function(a,b){this._varInfo.GetInfo(a,this.CurrentTemplate().name).SetUsed(!0,b),null!=a.parent&&this._varInfo.GetInfo(a.parent,this.CurrentTemplate().name).SetUsed(!0,b)},SyncRepeatStackWithNode:function(a){if(null==a)throw new h("intNode");var b=cb(a._parent,s);null!=b&&this.SyncRepeatStackWithNode(b),a.Type()==n.Iteration&&(this.PushRpt(a.Variable().name),this.CurrentIndex(a.Indices()[a.Indices().length-1]))},WantProgressNotifications:function(){return this.wantsprog?!0:!1},UnansweredCount:function(){return null!=this.Root()?this.Root().AnsStatus().UnansweredCount():1},AnsweredCount:function(){return null!=this.Root()?this.Root().AnsStatus().AnsweredCount():0},TotalCount:function(){return null!=this.Root()?this.Root().AnsStatus().TotalCount():1},HasRequiredUnansweredQuestions:function(){return null!=this._reqNode},HasErrorText:function(){return null!=this._errNode},Progress:function(){return"{"+db('"Answered":{0},"Total":{1},"State":{2}',this.AnsweredCount(),this.TotalCount(),this.HasRequiredUnansweredQuestions()?2:this.AnsweredCount()>=this.TotalCount()?0:1)+"}"},FirstRootChild:function(){for(var a=null,b=0;b<this._root.Children().Count()&&(a=this._root.Children().get(b),!a.ShowInOutline());)a=null,b++;return a},FindDialogByID:function(a,b){if(null!=a){var c,d,e,f,g,h=null;if(c=P.call(this,a),d=c.DialogName(),e=this._varInfo.GetInfo(d,c._template.name),e instanceof p){for(g=e.InterviewNodes().length,f=0;g>f&&e.InterviewNodes()[f]._id!=a;f++);g>f&&(h=e.InterviewNodes()[f])}else 0!=e.InterviewNodes().length&&(h=e.InterviewNodes()[0]);return null==h&&(h=cb(c.FindNode(this._root,b),s)),h}},SetPageMode:function(b,d,e){if(this.HasValidationErrors())return d=a.Lc.GetStr("val_err"),!1;var f=null!=this.GetFocusItem();return this._singlePageMode=b==I.SinglePage,c(this).trigger("PageModeChanging",new y(b)),b==I.SinglePage?(this._curNode.IsSpreadsheetRowInEditMode()&&(cb(this._curNode,u).EndRowEdit(),e&&this.GotoDialog(cb(this._curNode.Parent,E),d,f,!0,function(a){return a?void 0:!1})),this._root.DirtySinglePage()):(this._curNode.SetUpdateFlags(r.All),this._curNode.SendUpdateFlagsUpstream(r.All,!0)),this.ForgetLocation(),e&&(this._navigateInProgress=!0,this._moveFocus=f),d.s="",!0},ForgetLocation:function(){this._prevOutlineNodeId=-1},IsSinglePage:function(){return"boolean"==typeof this._singlePageMode?this._singlePageMode:!1},DoAnswerSync:function(){this._engine.DoAnswerSync()},GotoNext:function(b,d){var e=this.CurrentOutlineNode(),f=a.Lc;return b={s:b},null!=this.Navigator().Next&&!this.Navigator().CanProceedToNext(b)||null==this.Navigator().Next&&!this.Navigator().CanProceedToLast(b)?(d(!1,b.s),void 0):e!=this.Navigator().Last||this.IsRowEdit()?(this.GotoDialog(this.Navigator().Next,b,!0,null,d),void 0):this.IsPopup()?(this.Finish(b.s,d),void 0):this.HasValidationErrors()?(b.s=f.GetStr("val_err"),d(!1,b.s),void 0):null!=this.RequiredNode()||null!=this.ErrorNode()?(b.s=this.GetErrorText("p"),d(!1,b.s),void 0):((a.DisableFinishWarning||a.Confirm((this.AnsweredCount()<this.TotalCount()?f.GetStr("nav_warnfin_unans",this.TotalCount()-this.AnsweredCount()):f.GetStr("nav_warnfin"))+"\r\n"+f.GetStr("nav_warnfin_ok")))&&this._engine.DoPreNavigateJSAPI(null!=e?e.Variable().name:"","{Finish}",b.s,ab(function(a,e){return b={s:e},a?(this._engine.OnInterviewComplete()&&c(this).trigger("Closing",{}),void 0):(d(!1,b.s),void 0)},this)),d(!0,""),void 0)},GotoPrev:function(a,b){null!=this.Navigator().Previous&&this.GotoDialog(this._engine.Navigator().Previous,a,!0,null,b)},GotoNextUnans:function(a,b){this.Navigator().CanProceedToNextUnanswered(a)?this.GotoDialog(this.Navigator().NextUnanswered,a,!0,null,b):(a.s=this._engine.ResolveDotCodes(a.s),b(!1,a.s))},GotoPrevUnans:function(a,b){this.GotoDialog(this.Navigator().PreviousUnanswered,a,!0,null,b)},GotoFirst:function(a,b){this.GotoDialog(this.Navigator().First,a,!0,null,b)},GotoLast:function(a,b){this.Navigator().CanProceedToLast(a)?this.GotoDialog(this.Navigator().Last,a,!0,null,b):(a.s=this._engine.ResolveDotCodes(a.s),b(!1,a.s))},Finish:function(b,d,e){var f,g,h,i,j=a.Lc.GetStr;if("boolean"==typeof b?(f=b,g=d,h=e):(f=!1,g=b,h=d),this.IsPopup()){if(!f){if(this.HasValidationErrors())return g.s=j("val_err"),h(!1,g.s),void 0;if(null!=this.RequiredNode()||null!=this.ErrorNode())return g.s=this.GetErrorText("p"),h(!1,g.s),void 0}return c(this).trigger("Closing",{}),a.Answers.AnswerChanged.pop(),this._engine.InterviewStack().Pop(),a.CurrentInterview().Update(),h(!0,""),void 0}return i=this.CurrentOutlineNode(),null!=i&&i.Type()==n.Iteration&&i.IsSpreadsheetRowInEditMode()?(i=i._parent.ShowInOutline()?cb(i._parent,s):cb(i._parent._parent,s),this.GotoDialog(i,g.s,!0,null,h),void 0):(this._engine.DoPreNavigateJSAPI(null!=i?i.Variable().name:"","{Finish Button}",g.s,ab(function(b,d){if(g={s:d},b){if(null!=i){if(null!=this.RequiredNode()||null!=this.ErrorNode())return g.s=this.GetErrorText("g"),h(!1,g.s),void 0;if(!this.Navigator().CanProceedToLast(g))return h(!1,this._engine.ResolveDotCodes(g.s)),void 0;if(!a.DisableFinishWarning&&this.AnsweredCount()<this.TotalCount()&&!a.Confirm(j("nav_warnfin_unans",this.TotalCount()-this.AnsweredCount())+"\r\n"+j("nav_warnfin_ok")))return h(!1,""),void 0}this._engine.OnInterviewComplete()&&c(this).trigger("Closing",{}),h(!0,"")}else h(!1,g.s)},this)),void 0)},IsRowEdit:function(){var a=this.CurrentNode();if(null!=a){if(a.Type()==n.Iteration&&cb(a,u).IsSpreadsheetRowInEditMode())return!0;if(a.Type()==n.Repeat&&cb(a,E).IsSpreadsheet())return cb(a,E).EditRowMode()}return!1},GotoDialog:function(b,c,d,e,f){if("boolean"!=typeof e&&(e=!0),b===M)throw new h("target");var g,i,j,k=this.CurrentOutlineNode();if(k!==M&&this.DoAnswerSync(),this.HasValidationErrors()){if(!this.IsSinglePage()||k!==M&&(!k.OnSinglePage()||!b.OnSinglePage()))return c.s=a.Lc.GetStr("val_err"),f(!1),void 0}else if(!this.Navigator().CanProceedToNode(b,c))return f(!1,c),void 0;this._engine.DoPreNavigateJSAPI(k.Variable().name,b.Variable().name,c,ab(function(a,h){if(!a)return f(!1,h),void 0;if(k!==M&&(k.ClearFocusedItemNode(),k.Type()==n.Iteration&&b._parent!=k._parent&&cb(k._parent,E).EditRowMode()&&cb(k._parent,E).ClearEditRowMode()),b.Type()==n.Repeat?b=cb(b,E).GetFirstFocusableNode():b.Type()==n.Iteration&&cb(b._parent,E).EditRowMode()&&cb(b._parent,E).SetEditRow(cb(b,u).IterationNumber()),this._newNodeId=b._id,this.IsSinglePage()){if(b.HasAncestorOnSinglePage(this._ancestorOnSinglePage)&&!this.SetPageMode(I.NormalPaged,c,!1))return f(!1),void 0}else if(0!=this._ancestorOnSinglePage.v&&(g=!0,b.ID!=this._ancestorOnSinglePage.v&&b.HasAncestorOnSinglePage(this._ancestorOnSinglePage)&&(g=!1),g)){if(!this.SetPageMode(I.SinglePage,c,!1))return f(!1),void 0;this._ancestorOnSinglePage.v=0}this._newNodeId!=this._prevNodeId&&(this._navigateInProgress=!0,this._dialogTriggered=!0,b.DoImplicitAnswerProcessing(),i=k.NewIterationNode(),null!=i?(i.IterationNumber()>0?(i.NotifyParentOfChildCountChange(!0),j=i._parent.Children().get(i._parent.Children().Count()-2)):j=i,j.SetUpdateFlags(r.AddButtonRefresh)):null==i&&k.Type()==n.Iteration&&cb(k,u).IterationNumber()>=k._parent.Children().Count()&&(k._parent.Children().get(k._parent.Children().Count()-1).SetUpdateFlags(r.AddButtonRefresh),k.NotifyParentOfChildCountChange(!0)),b.IsHiddenNew()&&(b.SetUpdateFlagsCascading(r.NewlyAdded|r.NodeChildCount|r.ChildCount),b.NotifyParentOfChildCountChange(!0),b.Type()==n.Iteration&&cb(b,u).IterationNumber()>0&&b._parent.Children().get(b._parent.Children().Count()-2).SetUpdateFlags(r.AddButtonRefresh))),this._moveFocus=d,this._performScroll=e,this.Update(),c.s="",f.call(this.CurrentNode(),!0)},this))},GetBookmark:function(){var a=this.CurrentOutlineNode(),b=a.GetFocusedItemNode();return null!=b?b._parent.GenerateBookmark():a.GenerateBookmark()},GotoBookmark:function(b){if(!this.refrshevt)return this.QueuedBookmark=b,void 0;if(this.QueuedBookmark=null,!eb(b)){var d,e,f,g,h,i,j,k,l=b.split("|"),m=this._varInfo.GetInfo(l[0],this.CurrentTemplate().name);if(null!=m){if(f=!1,d=parseInt(l[1]),l.length>1&&!isNaN(d))for(e=[],g=2;g<l.length;g++)e[g-2]=parseInt(l[g]),isNaN(e[g-2])&&(f=!0);else d=-1,e=[];f||(h=null,c.each(m.InterviewNodes(),function(a,b){D.AreEquivalent(e,b.Indices())&&(h=b)}),null!=h&&(i=h.IsOnParent(),j=d>=0&&d<h._itemNodes.Count(),k={s:null},this.GotoDialog(i?cb(h._parent,s):h,k,!j,null,ab(function(b){b?j&&this.TriggerFocusEnter(h._itemNodes.get(d),null,F.Forward):a.Alert(k)},this))))}}},ProcessComputationScript:function(a,b){this.BeginBulkAnswerChange();var c=new N(this._engine,b.name,b.AssemblyName,a,this._varInfo);return c._repeatStack=this._repeatStack,this._engine.InterviewStack().Push(c),c.Update(!1,!1),null==c.CurrentOutlineNode()?(this._engine.InterviewStack().Pop(),c=null,this._dialogTriggered=!0,this.EndBulkAnswerChange(!1),this.Update()):(this.EndBulkAnswerChange(!1),this._interviewTriggered=!0),c},Close:function(){if(this.IsPopup()){var a={s:null};this.Finish(!0,a,function(){})}},GetComponent:function(b){var c=this.GetComponentSafe(b);if(null==c)throw new i(db(a.Lc.GetStr("err_nocmp"),b));return c},GetComponentSafe:function(a){var b,c=null,d=this._templateStack.a,e=d.length;for(b=e;b--&&(c=d[b].GetComponentSafe(a),null==c););return c},PushTemplate:function(a){this._templateStack.Push(a)},PopTemplate:function(){this._templateStack.Pop()}}),N}),define("engine/prenavigatejsapieventargs",[],function(){function a(a,b){this.DialogName=a,this.TargetName=b,this.Cancel=!1,this.CancelMessage=""}return a}),define("engine/navigatedjsapieventargs",[],function(){function a(a){this.DialogName=a}return a}),define("engine/engine",["hd","hdmain/jq","hdmain/system","engine/answerset","hdmain/stack","system/exception/invalidoperationexception","system/exception/argumentoutofrangeexception","engine/preferencecache","engine/stringparsersource","engine/templatemanager","engine/dotcodeparser","engine/htmlformatter","engine/placeholdertype","engine/valuechangetype","engine/changeuistateeventargs","engine/interview","engine/prenavigatejsapieventargs","engine/navigatedjsapieventargs","engine/uistate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(c,f,g){w=f,x=g,a.Answers=new d,this._initialAnswersLoaded=!1,this._allTemplatesLoaded=!1,C=1,z=null,this.NextFollowsOutline=!1,A=new k,B=new e,B.Push(new p(this,w,x,null,null)),this._templateTitle="",this.DocPreviewEnabled=!1,this.AnswerSummaryEnabled=!0,this.ProgressBarEnabled=!0,this.SaveAnswersUrl="",this.ShowAllResourceButtons=!1,y=new j(c,w,x),y.TemplateDownloaded("add",b.proxy(this.TemplateDownloaded,this)),a.TestInBrowser=window.HDTestInBrowser,a.TemplateLocator=window.HDTemplateLocator;var h,i=window.HDDataSources;if(i!=t)for(a.DataSourceAddressDict={},h=0;h<i.length;h++)a.DataSourceAddressDict[i[h].Name.toLowerCase()]=i[h]}this.DEBUG===t&&(this.DEBUG=a.DEBUG);var v,w,x,y,z,A,B,C,D,E="Default",F="Nothing",G="Underscores",H="Asterisks",I=H+"AndVarName",J="BracketedVarName";return c.ExtendClass(u,null,{InterviewStack:function(){return B},DoNavigatedJSAPI:function(a){b(this).trigger("NavigatedJSAPI",new r(null==a?"":a.Variable().name))},DoPreNavigateJSAPI:function(a,c,d,e){var f=new q(a,c);b(this).trigger("PreNavigateJSAPI",[f,function(a){a.Cancel?e(!1,a.CancelMessage):e(!0,a.CancelMessage)}])},Templates:function(){return y},Navigator:function(){return v().Navigator()},DotCodeParser:function(){return A},InterviewImageUrl:function(a){return a===t?this._imageUrl:(this._imageUrl=a,void 0)},TestMode:function(a){return a===t?this._testMode:(this._testMode=a,void 0)},RootTemplateName:function(){return w},RootAssemblyName:function(){return x},PreferenceCache:function(){return z},BeginBulkAnswerChange:function(){C++},EndBulkAnswerChange:function(a){if("boolean"!=typeof a&&(a=!0),0==C)throw new f("EndBulkAnswerChange() called when Engine was not in a bulk answer change.");C--,0==C&&a&&!v().IsProcessing()&&v().Update()},InBulkAnswerChange:function(){return C>0},HasValidationErrors:function(){return v().HasValidationErrors()},GetValueType:function(a){return v().GetValueType(a)},VarIsMarked:function(a){return v().VarIsMarked(a)},SetValueType:function(a,b,c){v().SetValueType(a,b,c)},TemplateTitle:function(a){return a===t?this._templateTitle:(this._templateTitle=a,void 0)},AllTemplatesLoaded:function(){return this._allTemplatesLoaded},AutoInterviews:function(){return this._autoInterviews},TryGetTemplate:function(a,b,c){var d=y.GetTemplate(a,b,c);return d||(y.ResetNew(),this._allTemplatesLoaded=!1),d},CheckForNewInserts:function(){var a=!y.New&&0==y.IncompleteDownloads();return y.ResetNew(),this._allTemplatesLoaded=a,a},AnswerLoadingComplete:function(){var a=this;a.EndBulkAnswerChange(!1),a._initialAnswersLoaded=!0,a.TryInterviewUpdate()},LoadAnswerValue:function(b,c,d){var e,f,g,h,i={},j=3;e="boolean"==typeof arguments[j]?arguments[j++]:!0,f="boolean"==typeof arguments[j]?arguments[j++]:!0,g="boolean"==typeof arguments[j]?arguments[j++]:!0,h=arguments[j],a.Answers.TryGetAnswer(c,b,i)||(i.v=a.Answers.CreateAnswer(b,c)),e||(i.v.s=!1),this._initialAnswersLoaded?i.v.SetValue(d,h):(i.v.InitValue(d,g,h),f||(i.v.ue=f))},ClearAnswer:function(a,b,c){var d=this.GetAnswer(a,b);null!=d&&d.ClearValue(c)},ClearAnswers:function(){this.BeginBulkAnswerChange(),a.Answers=new d,a.Answers.OnAnswerChanged(null,null,n.BecameUnanswered),this.EndBulkAnswerChange()},GetAnswer:function(b,c){var d={};return a.Answers.TryGetAnswer(b,c,d),d.v},GetAnswerValue:function(a,b,c){var d=this.GetAnswer(a,b);return d!==t?d.GetValue(c):null},GetResourceString:function(b){return a.Lc.GetStr(b)},DefaultUnansweredText:function(b){return b===t?a.PlaceholderTypeToString(D):(D=a.StringToPlaceholderType(b),void 0)},ResolveDotCodes:function(a){var b=new c.Text.StringBuilder;return this.DotCodeParser().Parse(new i(a),new l(b)),b.ToString()},OnChangeUIState:function(a,c){a!=this._uiState&&(this._uiState=a,b(this).trigger("ChangeUIState",new o(a,c)))},OnBeforeInterviewUpdate:function(){b(this).trigger("BeforeInterviewUpdate",{})},OnAfterInterviewUpdate:function(){b(this).trigger("AfterInterviewUpdate",{})},OnInterviewComplete:function(){var a={Cancel:!1};return b(this).trigger("InterviewComplete",a),!a.Cancel},TemplateDownloaded:function(b,d){var e=this;v().InFullRebuild()||(null==z&&d.TemplateName==w&&e.InitializePreferences(),e._allTemplatesLoaded=0==d.DownloadsInProgress,c.CallAsync(function(){try{!e.TryInterviewUpdate()&&e._initialAnswersLoaded&&v().CanUpdate()&&v().TryProcessTemplate(d.TemplateName,d.AssemblyName)}catch(b){var c=b.message;null!=b.InnerException&&(c+=" ("+b.InnerException+")"),a.HDEngine._engine.OnChangeUIState(s.Error,c)}}))},InitializePreferences:function(){var a={};y.GetTemplate(w,x,a)&&(z=new h(a.v),this._autoInterviews=a.v.HasTemplateInterview()?z.DisableIrrelevantAnswers():!1)},TryInterviewUpdate:function(){return this._initialAnswersLoaded&&this._allTemplatesLoaded&&v().CanUpdate()?(v().Update(!0),!0):!1},SetError:function(b){a._errorStr=b},DoAnswerSync:function(){var a=v().GetFocusItem();null!=a&&a.OnAnswerSync()},UnansweredPlaceholder:function(){var a=z.UnansweredVarPlaceholder();return a==m[E]&&(a=D!=m[E]?D:m[I]),a}}),v=a.CurrentInterview=function(){return B.Peek()},a.Alert=function(a){var b=a?a:"";if("string"!=typeof b&&(b=a.s),!c.String.IsNullOrEmpty(b)){var d=new c.Text.StringBuilder,e=new k,f=new i(b),g=new l(d);e.Parse(f,g),HDAPI.ShowMessageBox(d.ToString())
}},a.ExceptionAlert=function(b,d){var e=new c.Text.StringBuilder(a.Lc.GetStr(b));for(e.AppendLine(),e.Append(d.Message);null!=d.InnerException;)d=d.InnerException,e.AppendLine(),e.Append(d.Message);a.Alert(e.ToString())},a.ResourcePaneInitialHeight=0,a.SetAnswerDTD=function(b){a.Answers.DTD=b},a.GetXMLAnswers=function(b){return a.Answers.GetXMLString(b)},a.CurrentOutlineNode=function(){return v().CurrentOutlineNode()},a.RequiredAsterisk=!1,a.DisableFinishWarning=!1,a.StringToPlaceholderType=function(a){switch(a){case F:return m[F];case H:return m[H];case G:return m[G];case"*** Variable ***":return m[I];case"[Variable]":return m[J];default:return m[E]}},a.PlaceholderTypeToString=function(a){switch(a){case m[E]:return E;case m[F]:return F;case m[H]:return H;case m[G]:return G;case m[I]:return"*** Variable ***";case m[J]:return"[Variable]"}throw new g("value")},a.Confirm=function(a){return window.confirm(a)},a.GetBookmark=function(){return v().GetBookmark()},a.QueuedBookmark=function(){return v().QueuedBookmark},a.GotoBookmark=function(a){v().GotoBookmark(a)},a.PushTemplate=function(a){v().PushTemplate(a)},a.PopTemplate=function(a){v().PopTemplate(a)},u}),define("interview/app",["hd","hdmain/jq","hdmain/system","interview/page","dialog/navigationuistate","engine/stringparsersource","engine/htmlformatter","engine/interviewnodetype","engine/interviewnode","engine/changeuistateeventargs","engine/repeatnode","dialog/interviewstack","engine/engine","engine/uistate","runtime/variable"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a,c){var d=this;d._engine=new m(c.TemplatePath,c.Template,c.AssemblyName),b(d._engine.Templates).on("TemplateDownloadProgressChanged",E(d.TemplateDownloadProgressChanged)),b(d._engine).on("ChangeUIState",x).on("NavigatedJSAPI",E(z,d)).on("PreNavigateJSAPI",E(y,d)).on("InterviewComplete",E(A,d)),d.Host.resize(E(d.Content_Resized,d)),b(l).on("PopupInterviewOpened",E(d.InterviewStack_PopupInterviewOpened,d)).on("PopupInterviewClosed",E(d.InterviewStack_PopupInterviewClosed,d)),t.call(d)}function r(){}function s(a,b){x(this,new j(n.Error,"Unhandled Exception: \n"+b.ExceptionObject.ToString()))}function t(){u.call(this)}function u(){this.RootVisual=b("<div/>").Page().appendTo(this.element).trigger("Loaded")}function v(){this.option({_ansSumColumns:1,_ansSumIndentPrompts:!0,_ansSumBulletPrompts:!1,_ansSumIndentAnswers:!0,_ansSumBulletAnswers:!1,_ansSumBorders:I.None,_ansSumCol1Width:30,_ansSumCol2Width:70})}function w(b){var c={s:null},d=b.call(D(),c);!d&&!G(c.s)&&a.Alert(c.s)}function x(b,c){var d=a.HDEngine.PageStateUpdate;d!==p?d(this,new C(c.State,0,null==c.Message||""==c.Message?c.Message:c.Message.replace("\r\n","<br />"))):c.State==n.Error&&alert(c.Message)}function y(a,b,c){var d={v:null},e={v:null};B("PreHDNavigate",!0,!0,d,e,"DialogName",b.DialogName,"TargetName",b.TargetName,"Callback",function(a,d){b.Cancel=a,b.CancelMessage=d,c(b)})}function z(b,c,d){var e={v:null},f={v:null};B("OnHDNavigated",!1,!1,e,f,"DialogName",c.DialogName),G(a.QueuedBookmark())||d.GotoBookmark(a.QueuedBookmark())}function A(a,b){b.Cancel=!this.OnInterviewComplete()}function B(a,b,c){var d,e,f=-1,g=[a,b,c];for(d=5;d<arguments.length;d++)g.push(arguments[d]),"Callback"==arguments[d]&&(f=g.length,e=arguments[d+1],d++);0>f&&(g.push("Callback"),f=g.length),g[f]=function(a,b){"function"==typeof e&&e.call(this,c?a:!1,c?b:"")},HDAPI._invokeHandler.apply(this,g)}function C(a,b,c){this.State=a,this.Progress=b,this.Message=c}var D,E=b.proxy,F=c.Text.Encoding,G=(c.Environment,c.String.IsNullOrEmpty),H=c.Windows.Browser.HttpUtility,I={None:0,Plain:1,Sculptured:2};return b.widget("hd.App",{_create:function(){D=a.CurrentInterview;var b=this,c=b.options;b.Host=b.element.on("Startup",E(q,b)).on("Exit",E(r,b)).on("UnhandledException",E(s,b)),v.call(b),b.option(c),a.HDEngine=b,b.element.trigger("Startup",{TemplatePath:c.initParams.TemplatePath,Template:c.initParams.Template}),c.onLoad(b.element[0])},_setOption:function(a,c){switch(b.Widget.prototype._setOption.apply(this,arguments),a){case"height":this.RootVisual&&this.RootVisual.children().InterviewControl({height:c}),this.options.ContentResized&&this.options.ContentResized(),this.element.trigger("Resized");break;case"width":this.RootVisual&&this.RootVisual.children().InterviewControl({width:c});break;case"onError":this.element.on(a.substr(2),c)}},BrowserStatusBar:function(a){return a===p?window.status:(window.status=a,void 0)},TemplateDownloadProgressChanged:function(c,d){b(this).trigger("PageStateUpdate",new C(n.Busy,d.ProgressPercentage,a.Lc.GetStr("ui_addl")))},Content_Resized:function(){if(this.RootVisual!=p){var a=this.Host.outerHeight(!0);a!=this._hostOuterHeight&&(this._hostOuterHeight=a,this.RootVisual.height(a))}},LocaleHelper:function(){return this._localeHelper},InterviewControl:function(){return this.RootVisual?this.RootVisual.Page("interviewControl"):null},ToolbarHeight:function(){return this.RootVisual&&this.ToolBarVisible()?this.InterviewControl().data("hd-InterviewControl").Toolbar.outerHeight(!0):0},ToolBarVisible:function(a){if(a===p)return this.InterviewControl()?"block"==this.InterviewControl().data("hd-InterviewControl").Toolbar.css("display"):!1;var b=this.InterviewControl(),c=b.InterviewControl("option","height");b.data("hd-InterviewControl").Toolbar.css("display",a?"block":"none"),b.InterviewControl({height:c})},NavigationBarVisible:function(a){if(a===p)return e.NavigationbarVisible;if(a!=e.NavigationbarVisible){e.NavigationbarVisible=a,l.Depth()>0&&l.CurrentInterview().DialogControl().DialogControl("Navigationbar")[a?"show":"hide"]();var b=this.InterviewControl();b.InterviewControl({height:b.InterviewControl("option","height")})}},SetToolbarButtonImage:function(a,b,c,d,e){this.InterviewControl().InterviewControl("SetToolbarButtonImage",a,b,c,d,e)},SetNavigationbarButtonImage:function(a,b){var c=e.GetBuiltInButtonInternalName(a);G(c)||e.SetBuiltInButtonImage(c,b),l.Depth()>0&&l.CurrentInterview().DialogControl().DialogControl("SetNavigationbarButtonImage",a,b)},SetButtonVisible:function(a,b){var c=e.GetBuiltInButtonInternalName(a);G(c)||e.SetBuiltInButtonVisible(c,b),l.Depth()>0&&!l.CurrentInterview().DialogControl().DialogControl("SetNavigationbarButtonVisible",a,b)&&this.InterviewControl().InterviewControl("SetToolbarButtonVisible",a,b)},IsButtonEnabled:function(a){return l.Depth()>0&&l.CurrentInterview().DialogControl().IsNavigationbarButtonEnabled(a)||this.InterviewControl().IsToolbarButtonEnabled(a)},InvokeButton:function(a){l.Depth()>0&&!l.CurrentInterview().DialogControl().DialogControl("InvokeNavigationbarButton",a)&&this.InterviewControl().InterviewControl("InvokeToolbarButton",a)},InPopupInterview:function(){return l.InPopupInterview()},ClosePopupInterview:function(){l.InPopupInterview()&&l.CurrentInterview().CloseInterview()},InterviewStack_PopupInterviewOpened:function(a,c){b(this).trigger("PopupInterviewOpened",c)},InterviewStack_PopupInterviewClosed:function(a,c){b(this).trigger("PopupInterviewClosed",c)},TemplateTitle:function(a){var b=this._engine;return"string"!=typeof a?b.TemplateTitle():(b.TemplateTitle(a),null!=this.InterviewControl()&&this.InterviewControl().InterviewControl("Title",a),void 0)},DocPreviewEnabled:function(a){var b=this._engine;return a===p?b.DocPreviewEnabled:(b.DocPreviewEnabled=a,void 0)},AnswerSummaryEnabled:function(a){var b=this._engine;return a===p?b.AnswerSummaryEnabled:(b.AnswerSummaryEnabled=a,void 0)},ProgressBarEnabled:function(a){var b=this._engine;return a===p?b.ProgressBarEnabled:(l.CurrentInterview().DialogControl().DialogControl({ProgressBarEnabled:a}),b.ProgressBarEnabled=a,void 0)},SaveAnswersUrl:function(a){var b=this._engine;return a===p?b.SaveAnswersUrl:(b.SaveAnswersUrl=a,void 0)},ShowAllResourceButtons:function(a){var b=this._engine;return a===p?b.ShowAllResourceButtons:(b.ShowAllResourceButtons=a,void 0)},ResourcePaneInitialHeight:function(b){return b===p?a.ResourcePaneInitialHeight:(a.ResourcePaneInitialHeight=b,void 0)},InterviewOutlineInitialWidth:function(a){var b=this._engine;return"number"!=typeof a?b.InterviewOutlineInitialWidth:(b.InterviewOutlineInitialWidth=a>0?a:200,void 0)},GetStr:function(b){return a.Lc.GetStr(b)},Trace:function(){},ClearFocus:function(){D().ClearFocusItem()},SetRequiredAsterisk:function(b){a.RequiredAsterisk=b},SetDisableFinishWarning:function(b){a.DisableFinishWarning=b},SetAnswerDTD:function(b){null!=b&&a.SetAnswerDTD(b)},SetTemplateImageUrl:function(a){this._engine.InterviewImageUrl(a)},SetTestMode:function(a){this._engine.TestMode(a)},SetNextFollowsOutline:function(a){this._engine.NextFollowsOutline=a},SetUnansweredText:function(a){this._engine.DefaultUnansweredText(a)},SetAnswerSummaryPrefs:function(a,b,c,d,e,f,g){var h=this.options;this.option({_ansSumColumns:1==a?1:2,_ansSumIndentPrompts:b,_ansSumBulletPrompts:c,_ansSumIndentAnswers:d,_ansSumBulletAnswers:e,_ansSumBorders:"P"==f?I.Plain:"S"==f?I.Sculptured:I.None,_ansSumCol1Width:10>g||g>90?30:g}),h._ansSumCol2Width=100-h._ansSumCol1Width,2==h._ansSumColumns&&this.option({_ansSumIndentPrompts:!1,_ansSumBulletPrompts:!1,_ansSumIndentAnswers:!1,_ansSumBulletAnswers:!1})},InterviewVersion:function(){return"6.7.0.0"},InBulkAnswerUpdate:function(){return this._engine.InBulkAnswerChange()},BeginBulkAnswerUpdate:function(){this._engine.BeginBulkAnswerChange()},EndBulkAnswerUpdate:function(a){"boolean"!=typeof a&&(a=!0),this._engine.EndBulkAnswerChange(a)},GetValType:function(a){switch(this._engine.GetValueType(a)){case"TX":return"TX";case"TF":return"TF";case"NU":return"NU";case"DA":return"DA";case"MC":return"MC"}return null},ValuesAdded:function(){this._engine.AnswerLoadingComplete()},ClearAnswers:function(){a.ClearAnswers()},SetValue:function(a,b,c,d){this.AddValue(a,b,c,d,!1,!0,!0)},AddValue:function(a,b,c,d,e,f,g,h){c===p&&(c=null),d===p&&(d=null),"boolean"!=typeof e&&(e=!1),"boolean"!=typeof f&&(f=!1),"boolean"!=typeof g&&(g=!0),"boolean"!=typeof h&&(h=!0);var i,j,k,l,m,n,o,q=null,r=this,s=r._engine;switch(null!=c&&(q=c),a){case"TX":s.SetValueType(b,a,e),null!=d?(i=H.HtmlDecode(d),i=i.replace(/<br\s*\/?>/gi,"\r\n"),s.LoadAnswerValue(a,b,i,!0,g,h,q)):g&&h?f&&s.ClearAnswer(b,a,q):s.LoadAnswerValue(a,b,null,!0,g,h,q);break;case"NU":s.SetValueType(b,a,e),null!=d?s.LoadAnswerValue(a,b,d,!0,g,h,q):g&&h?f&&s.ClearAnswer(b,a,q):s.LoadAnswerValue(a,b,null,!0,g,h,q);break;case"TF":s.SetValueType(b,a,e),null!=d?s.LoadAnswerValue(a,b,d,!0,g,h,q):g&&h?f&&s.ClearAnswer(b,a,q):s.LoadAnswerValue(a,b,null,!0,g,h,q);break;case"DA":s.SetValueType(b,a,e),null!=d&&(j=null,d instanceof Date?j=d:"string"==typeof d&&(k=d,l=k.split(" "),3==l.length&&(m=parseInt(l[0],10),n=parseInt(l[1],10)-1,o=parseInt(l[2],10),j=new Date(o,n,m),isFinite(j)||(j=null)))),null!=j?s.LoadAnswerValue(a,b,j,!0,g,h,q):g&&h?f&&s.ClearAnswer(b,a,q):s.LoadAnswerValue(a,b,null,!0,g,h,q);break;case"MC":s.SetValueType(b,a,e),null!=d?(k=d.replace(/\2/g,"|"),s.LoadAnswerValue(a,b,H.HtmlDecode(k).split("|"),!0,g,h,q)):g&&h?f&&s.ClearAnswer(b,a,q):s.LoadAnswerValue(a,b,null,!0,g,h,q)}},GetValue:function(a,b,c){var d=null,e=this._engine;switch(null!=c&&(d=c),b||(b=e.GetValueType(a)),b){case"TX":case"NU":case"TF":case"DA":case"MC":return e.GetAnswerValue(a,b,d)}return null},GetProgress:function(){return a.CurrentInterview().Progress()},GetXMLAnswers:function(){return this._engine.DoAnswerSync(),a.GetXMLAnswers(!1)},GetEncodedAnswers:function(){this._engine.DoAnswerSync();var b,d=a.GetXMLAnswers(!0),e="string"==typeof HDAnswerState?HDAnswerState:null;return e?(b=a.Base64.encode(d,F.UTF8,!0),d=c.String.Format("[HDSANS({0},{1})]{2}|{3}",b.length.toString(),e.length.toString(),b,e)):d=a.Base64.encode(d,F.UTF16LE,!0),d},EncodeString:function(b,c,d){null==c&&(c="");var e;switch(c.toUpperCase()){case"UTF-16":case"UTF-16LE":e=F.UTF16LE;break;case"UTF-16BE":e=F.UTF16BE;break;default:e=F.UTF8}return d&&(b=String.fromCharCode(65279)+b),a.Base64.encode(b,e,d)},GotoNext:function(){w(D().GotoNext)},GotoPrev:function(){w(D().GotoPrev)},GotoNextUnans:function(){w(D().GotoNextUnans)},GotoPrevUnans:function(){w(D().GotoPrevUnans)},GotoFirst:function(){w(D().GotoFirst)},GotoLast:function(){w(D().GotoLast)},Finish:function(){w(D().Finish)},OnInterviewComplete:function(){if(this.InterviewComplete!==p){var a={Cancel:!1};return this.InterviewComplete(this,a),!a.Cancel}return!0},Confirm:function(a){return window.confirm(a)},GetAnswerSummary:function(){this._engine.DoAnswerSync();var b="<br><b>"+a.Lc.GetStr("ui_astitle")+"</b>"+this._engine.TemplateTitle()+this.GetAnsSumHtml(D().Root());return b},GetAnsSumHtml_ChildVars:function(a,b){var c,d,e="",f=a.IsSpreadsheetRow();for(c=0;c<a._itemNodes.Count();c++)d=!0,d=a.IsSpreadsheetRow()?a._parent.Children().get(0)._itemNodes.get(c).Visible():a._itemNodes.get(c).Visible(),d&&(e+=this.GetAnsSumHtml_Var(a._itemNodes.get(c),0,f,b));return e},CheckForDotCodes:function(a){var b=new c.Text.StringBuilder;return this._engine.DotCodeParser().Parse(new f(a),new g(b),!0),b.ToString()},GetAnsSumHtml:function(b){var d,e,f,g;if(b.Type()==h.Iteration&&b.New()&&b.IterationNumber()>0)return"";for(d=c.Cast(b,i),e="",null!=d&&a.PushTemplate(d.TemplateOfOrigin()),b.Type()==h.Repeat&&a.PsR(d._dialog.name),null!=d&&(d.Type()!=h.Repeat||c.Cast(d,k).IsSpreadsheet())&&(e+=this.GetAnsSumHtml_Dlg(d)),f=0;f<b.Children().Count();f++)g=b.Children().get(f),g.IsSpreadsheetRow()||(e+=this.GetAnsSumHtml(g));return b.Type()==h.Iteration&&a.IcR(),b.Type()==h.Repeat&&a.PpR(),null!=d&&a.PopTemplate(d.TemplateOfOrigin()),e},GetAnsSumHtml_Dlg:function(a){if(!a.ShowInOutline()&&!a.IsOnParent())return"";var b,d,e=this,f=e.options,g=e.CheckForDotCodes(a.Caption()),h="<br><br><table class='HDASDlg' width=100%";if(2==f._ansSumColumns&&(f._ansSumBorders==I.Plain&&(h+=" border='1' cellspacing='0' "),f._ansSumBorders==I.Sculptured&&(h+=" border='2' ")),h+=">",h+="<tr width=100%><td class='HDASDlgTitle' colspan=2>",h+=g.replace(/</g,"&lt;").replace(/>/g,"&gt;"),h+="<br></td></tr>",b=c.Cast(a,k),null!=b&&b.IsSpreadsheet())for(d=0;0==d||d<b.AnsweredIterationCount;d++)null!=b.Children().get(d)&&(h+=e.GetAnsSumHtml_ChildVars(b.Children().get(d),b.Children().get(d).Indices(),d));else h+=e.GetAnsSumHtml_ChildVars(a,a.Indices(),0);return h+="</table>"},GetAnsSumHtml_Var:function(b,d,e,f){var g,h,j,k,l,m,n,p,q,r,s,t,u="",v=b.DialogItem().type,w="",x="",y="",z="",A="",B=this,C=B.options,D=B._engine;if("TX"==v||"NU"==v||"DA"==v||"TF"==v||"MC"==v){switch(u+="<tr width=100%>",g=c.Cast(b.DialogItem(),o),h="_________________",j=B.CheckForDotCodes(b.Caption()),j=i.FixAmpersands(j,j.indexOf("&amp;")>-1),"NONE"==j&&(j=""),e&&(j+=B.HDASRptTag(f)),1==C._ansSumColumns?(C._ansSumIndentPrompts&&(x="padding-left:2.5em;",z="padding-left:2.5em;"),C._ansSumBulletPrompts&&(w+="&bull;"),C._ansSumIndentAnswers&&(z="padding-left:5.0em;"),C._ansSumBulletAnswers&&(y+="&bull;")):2==C._ansSumColumns&&(A+=" width:"+C._ansSumCol2Width+"% ",C._ansSumBorders==I.None&&(h="&nbsp;")),u+="<td class='HDASVarPrompt' style='"+x+"' >"+w+j+"</td>",u+=1==C._ansSumColumns?"</tr><tr><td class='HDASAnsValue' style='"+z+"'>":"<td class='HDASAnsValue' style='"+A+"' >",k=null!=D.GetAnswer(g.name,g.type)&&D.GetAnswer(g.name,g.type).IsAns(f),l=h,v){case"TX":k&&(l=D.GetAnswerValue(g.name,v,f));break;case"DA":k&&(l=D.GetAnswerValue(g.name,v,f).toDateString());break;case"NU":k&&(l=a.Lc.FormatNumberDef(D.GetAnswerValue(g.name,v,f),g.decPl));break;case"TF":k?(m=D.GetAnswerValue(g.name,v,f),l="("+(m?"X":" ")+") "+a.Lc.GetStr("ui_yes")+"  ("+(m?" ":"X")+") "+a.Lc.GetStr("ui_no")):l="( ) "+a.Lc.GetStr("ui_yes")+"  ( ) "+a.Lc.GetStr("ui_no");break;case"MC":if(k){if(n=D.GetAnswerValue(g.name,v,f),1==n.length)p="",q=b.GetOptions(),p=q.Contains(n[0])&&q.GetItem(n[0]).name==n[0]?q.GetItem(n[0]).Prompt():n[0],G(p)||(l="(X) "+p);else if(n.length>1)for(l="",r=n.length,t=0;r>t;t++)p="",q=b.GetOptions(),p=q.Contains(n[t])?q.GetItem(n[t]).Prompt():n[t],G(p)||(l+=(C._ansSumBulletAnswers&&t>0?"&bull;":"")+"[X] "+p+"\n");l=B.CheckForDotCodes(l)}}"MC"!=v&&(l=l.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/%%lt%%/g,"&lt;").replace(/%%gt%%/g,"&gt;").replace(/\n/gi,"<br/>")),u+=y+l+"</td></tr>"}else("TXL"==v||"HDL"==v||"SLL"==v||"WLL"==v)&&(s=B.CheckForDotCodes(b.Caption()),!G(s)&&"NONE"!=s&&(1==C._ansSumColumns?C._ansSumIndentPrompts&&(x="padding-left:2.5em;"):2==C._ansSumColumns&&(A+=" colspan='2'"),u+="<td class='HDASDlgElem' style='"+x+"'"+A+">"+s+"</td></tr>"));return u},HDASRptTag:function(a){var b,c="";for(b=0;b<a.length&&-1!=a[b];b++)c.length>0&&(c+=","),c+=a[b]+1;return c.length>0&&(c=" ["+c,c+="]"),c},GetCurrentRepeatIndex:function(){var b,c,d,e=a.CurrentOutlineNode();if(null==e)return"-1:-1:-1:-1";for(b=e.Indices(),c="",d=0;d<b.length&&-1!=b[d];d++)c.length>0&&(c+=":"),c+=b[d];return c},GetBookmark:function(){return a.GetBookmark()},GotoBookmark:function(b){a.GotoBookmark(b)}}),b.hd.App}),define("interview",["interview/app"],function(){}),define("runtime/datevalue",["hd"],function(a){function b(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours())}function c(a){return a.getHours()||a.getMinutes()||a.getSeconds()||a.getMilliseconds()?b(a).getTime():a.getTime()}function d(a,c,d){var f,g=b(a);if("D"==d)g.setTime(g.getTime()+c*e);else if("M"==d){for(f=g.getMonth()+c,g.setMonth(f);0>f;)f+=12;for(;f>11;)f-=12}else{if("Y"!=d)return null;f=g.getMonth(),g.setFullYear(g.getFullYear()+c)}return("M"==d||"Y"==d&&1==f)&&g.getMonth()>f&&g.setTime(g.getTime()-g.getDate()*e),g.setHours(0),g}var e=864e5,f={Pls:function(a,b){return a&&b?d(a,b.v,b.p):null},Mns:function(a,b){return a&&b?d(a,-b.v,b.p):null},Eq:function(a,b){return a&&b?c(a)==c(b):null},Ne:function(a,b){return a&&b?c(a)!=c(b):null},Lt:function(a,b){return a&&b?c(a)<c(b):null},Gt:function(a,b){return a&&b?c(a)>c(b):null},LtE:function(a,b){return a&&b?c(a)<=c(b):null},GtE:function(a,b){return a&&b?c(a)>=c(b):null},Xml:function(a,b,c){a.WriteStartElement("DateValue"),c||a.WriteAttributeString("userModifiable","false"),b?a.WriteString(b.getDate()+"/"+(b.getMonth()+1)+"/"+b.getFullYear()):a.WriteAttributeString("unans","true"),a.WriteEndElement()}};return a.DA=f,f}),define("runtime/dialog",["hd","hdmain/system","runtime/variable","system/exception/argumentnullexception"],function(a,b,c,d,e){function f(a,b,c,d,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V){f.baseConstructor.call(this,a,b,c,d,m,n,o,p,q,r,s,t,u,v,w,x,y,z);var W,X;if(this.lnkVars="boolean"==typeof E?E:!0,this.vList=A,this.lnkVars)for(W=0;W<A.Count();W++)switch(X=A.GetItem(W),X.type){case g:case h:case i:case j:case k:case l:X.parent=this}this.scrD=B?B:null,this.rType=C?C:"",this.onPar=D?!0:!1,this.alwaysStop=F?!0:!1,this.rptTtl=G,this.addBtnCap=H,this.maxRows=I?I:10,this.gType=J?J:"",this.nota=K?!0:!1,this.prmtPos=L?L:"T",this.prmtAlgn="boolean"==typeof M?!M:!1,this.maxPWid=N?N:12,this.hideIfUn="boolean"==typeof O?O:!0,this.hideCB=P?!0:!1,this.hideSB=Q?!0:!1,this.trimIter="boolean"==typeof R?R:!0,this.plcmt=S===e?[]:S,this.DataSource=T,this.Mappings=U===e?[]:U,this.InitializeTrueFalseGrouping(),this.t=V}this.DEBUG===e&&(this.DEBUG=a.DEBUG);var g="TX",h="NU",i="DA",j="TF",k="MC",l="DI";return b.ExtendClass(f,c,{type:l,valType:"TF",EvScr:function(){null!=this.scrD&&this.scrD.call(this.t)},EvRptT:function(){return this.rptTtl===e||null===this.rptTtl?"":"function"==typeof this.rptTtl?this.rptTtl.call(this.t):this.rptTtl.toString()},EvAddBC:function(){return this.addBtnCap===e||null===this.addBtnCap?"":"function"==typeof this.addBtnCap?this.addBtnCap.call(this.t):this.addBtnCap.toString()},IsRepeated:function(){return""!=this.rType},TrueFalseGroupCount:function(){return this._tfGroups.length},GetTrueFalseGroupNumber:function(a){if(this._tfGroups.length>0){var b=this.vList.GetItem(a);if("TF"!=b.type&&"DI"!=b.type)return-1;for(var c=0;c<this._tfGroups.length;c++)if(a<=this._tfGroups[c][1]){if(a>=this._tfGroups[c][0])return c;break}}return-1},GetTrueFalseGroupBounds:function(a,b,c){if(this._tfGroups.length>0)for(var d=0;d<this._tfGroups.length;d++){var e=this._tfGroups[d];if(a<=e[1]){if(a>=e[0])return b.v=e[0],c.v=e[1],void 0;break}}b.v=c.v=-1},InitializeTrueFalseGrouping:function(){if(""==this.gType)return this._tfGroups=[],void 0;var a,b=[],c=this.vList.Count(),d=-1,e=-1;if("M"==this.gType){for(d=0;c>d&&(a=this.vList.GetItem(d),"TF"!=a.type&&"DI"!=a.type);)d++;for(e=c-1;e>d&&(a=this.vList.GetItem(e),"TF"!=a.type&&"DI"!=a.type);)e--;e>=d&&b.push([d,e])}else{for(var f=0;c>f;f++)a=this.vList.GetItem(f),0>d?("TF"==a.type||"DI"==a.type&&!a.onPar)&&(d=e=f):"TF"==a.type||"DI"==a.type?e=f:(b.push([d,e]),d=e=-1);d>=0&&b.push([d,e])}this._tfGroups=b}}),a.Dlg=f,f}),define("runtime/format",["hd","hdmain/system","runtime/component"],function(a,b,c){function d(a,b,c){d[k].call(this,a,b),this.text=c}function e(a,b,c){e[k].call(this,a,b,c)}function f(a,b,c){f[k].call(this,a,b,c)}function g(a,b,c){g[k].call(this,a,b,c)}function h(a,b,c){h[k].call(this,a,b,c)}function i(a,b,c,d){i[k].call(this,a,b,c),this.list=d}function j(a,b,c){j[k].call(this,a,b,c)}var k="baseConstructor";return b.ExtendClass(d,c),b.ExtendClass(e,d),b.ExtendClass(f,d),b.ExtendClass(g,d),b.ExtendClass(h,d),b.ExtendClass(i,d,{Count:function(){return this.list.length},EvChoice:function(a){var b=this.list[a];return b?b.toString():""}}),b.ExtendClass(j,d),a.TxFmt=e,a.NuFmt=f,a.DaFmt=g,a.TfFmt=h,a.GrFmt=j,a.McFmt=i,a.Format=d,d}),define("runtime/multiplechoicevalue",["hd"],function(a){var b={nota:"None of the Above",Eq:function(b,c){if(null===b||null===c)return null;var d,e,f,g;if(a.IsArray(b)?(f=b,g=c):(f=c,g=b),f="function"==typeof f.join?f.join("|").toUpperCase().split("|"):[f.toUpperCase()],a.IsArray(g)){if(f.length!=g.length)return!1;for(g=g.join("|").toUpperCase().split("|"),d=0;d<f.length;d++){for(e=0;e<f.length&&f[d]!=g[e];)e++;if(e>=f.length)return!1}return!0}for(g=g.toUpperCase(),d=0;d<f.length;d++)if(f[d]==g)return!0;return!1},Ne:function(a,b){return null===a||null===b?null:!this.Eq(a,b)},Format:function(a,b){var c,d=[];for(c=0;c<a.length;c++)c>0&&d.push("\r\n"),b&&c+1<b.length&&b[c+1]?d.push(b[c+1]):d.push(a[c]);return d.join("")},Xml:function(b,c,d){if(b.WriteStartElement("MCValue"),d||b.WriteAttributeString("userModifiable","false"),c)for(var e=0;e<c.length;e++)b.WriteElementString("SelValue",a.TX.XMLEscape(c[e]));else b.WriteAttributeString("unans","true");b.WriteEndElement()}};return a.MC=b,b}),define("runtime/multiplechoicevariable",["hd","hdmain/system","runtime/variable","runtime/optionlist","hdmain/jq"],function(a,b,c,d,e,f){function g(a,b,c){this.name=a,this.prompt="",this.hasEvPrmt=!1,this.prmtD=b,this.rsrc=c?c:null}function h(a,b,c,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){h.baseConstructor.call(this,a,b,c,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t),this.opts=new d(u),this.style=v?v:"RB",this.othr=w?!0:!1,this.dMrg=x?x:"",this.dv=y}var i=b.String.IsNullOrEmpty;return this.DEBUG===f&&(this.DEBUG=a.DEBUG),b.ExtendClass(g,null,{eq:function(a){return a==this||a instanceof g&&a.name.toUpperCase()===this.name.toUpperCase()},Prompt:function(){return i(this.prompt)?this.name:this.prompt},EvPrompt:function(){(!this.hasEvPrmt||this.prmtD instanceof a.DyTx)&&(this.prompt=this.EvPromptImmed(),this.hasEvPrmt=!0)},EvPromptImmed:function(){return this.prmtD?this.prmtD.toString():""},Copy:function(){var a=new g(this.name,null,null);return a.prompt=this.prompt,a}}),b.ExtendClass(h,c,{type:"MC",valType:"MC",MultipleSelect:function(){return"CB"==this.style||"CG"==this.style||"ML"==this.style},ReconcileOptions:function(b,c){var d,f,g,h,i,j=!1;return null!=b.v&&0==b.v.length&&(b.v=null,j=!0),null!=b.v&&(d=this.MultipleSelect(),f=!d&&this.othr,g=d&&this.othr,null==c&&(c=this.opts),h=[],i=!1,e.each(b.v,function(b,e){if(f||0===c.Count()||c.IndexOf(e)>=0){if(h.push(e),!d)return!1}else g&&e==a.MC.nota&&(i=!0)}),0==h.length&&i&&h.push(a.MC.nota),0==h.length?(b.v=null,j=!0):h.length!=b.v.length&&(b.v=h,j=!0)),j}}),a.McOpt=g,a.McVar=h,h}),define("runtime/numbervalue",["hd"],function(a){var b,c=[1e-5,1e-6,1e-7,1e-8,1e-9,1e-10,1e-11,1e-12,1e-13],d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];return a.NU={Neg:function(a){return null===a?null:-a},Pls:function(a,b){return null===a||null===b?null:a+b},Mns:function(a,b){return null===a||null===b?null:a-b},Mul:function(a,b){return null===a||null===b?null:a*b},Div:function(a,b){return null===a||null===b||0==b?null:a/b},Eq:function(a,c){return null===a||null===c?null:b(a,7,!0)==b(c,7,!0)},Ne:function(a,c){return null===a||null===c?null:b(a,7,!0)!=b(c,7,!0)},Lt:function(a,c){return null===a||null===c?null:b(a,7,!0)<b(c,7,!0)},Gt:function(a,c){return null===a||null===c?null:b(a,7,!0)>b(c,7,!0)},LtE:function(a,c){return null===a||null===c?null:b(a,7,!0)<=b(c,7,!0)},GtE:function(a,c){return null===a||null===c?null:b(a,7,!0)>=b(c,7,!0)},Xml:function(a,c,d){a.WriteStartElement("NumValue"),d||a.WriteAttributeString("userModifiable","false"),null!==c?a.WriteString(b(c,7,!1).toString()):a.WriteAttributeString("unans","true"),a.WriteEndElement()},Fudge:function(a,b,e){var f,g=0;return g=0>a?a-Math.ceil(a):a-Math.floor(a),0!=g&&(0>a?a-=c[b]:a+=c[b],f=d[b],a*=f,e&&(0>a?a-=.5:a+=.5),a=0>a?Math.ceil(a):Math.floor(a),a/=f),a}},b=a.NU.Fudge,a.NU}),define("runtime/numbervariable",["hd","hdmain/system","runtime/variable","runtime/numbervalidationresult"],function(a,b,c,d){function e(a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){e.baseConstructor.call(this,a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s),this.decPl=t?t:0,this.currS=u?u:"",this.min=v?v:0,this.max=w?w:0}return b.ExtendClass(e,c,{type:"NU",valType:"NU",CheckMinMax:function(b){if(null==b)return d.Valid;if(isNaN(a.Lc.ParseNumber(b)))return d.ErrorNotANumber;var c,e=0!=this.max,f=e||0!=this.min;return f||e?(c=a.NU.Fudge(b,this.decPl,!0),f&&e&&(c<this.min||c>this.max)?d.ErrorOutOfRange:e&&c>this.max?d.ErrorTooBig:f&&c<this.min?d.ErrorTooSmall:d.Valid):d.Valid}}),a.NuVar=e,e}),define("runtime/textvalue",["hd"],function(a,b){var c=a.TX===b?{}:a.TX,d=null;c.Pls=function(b,c){return null===b||null===c?null:(a.IsArray(b)&&(b=b.join("|")),a.IsArray(c)&&(c=c.join("|")),b+c)},c.Eq=function(c,d){return null===c||null===d||c===b||typeof d==b?null:(a.IsArray(c)&&(c=c.join("|")),a.IsArray(d)&&(d=d.join("|")),c.toUpperCase()==d.toUpperCase())},c.Ne=function(a,b){return null===a||null===b?null:!this.Eq(a,b)},c.Lt=function(b,c){return null===b||null===c?null:(a.IsArray(b)&&(b=b.join("|")),a.IsArray(c)&&(c=c.join("|")),b.toUpperCase()<c.toUpperCase())},c.Gt=function(b,c){return null===b||null===c?null:(a.IsArray(b)&&(b=b.join("|")),a.IsArray(c)&&(c=c.join("|")),b.toUpperCase()>c.toUpperCase())},c.LtE=function(a,b){return null===a||null===b?null:!this.Gt(a,b)},c.GtE=function(a,b){return null===a||null===b?null:!this.Lt(a,b)},c.Xml=function(a,b,c){a.WriteStartElement("TextValue"),c||a.WriteAttributeString("userModifiable","false"),null!==b?a.WriteString(b):a.WriteAttributeString("unans","true"),a.WriteEndElement()},c.XMLEscape=function(a){return null==d&&(d=/[\x00-\x08\x0B-\x0C\x0E-\x1F\\]/g),a.replace(d,function(a){return"\\"+a.charCodeAt(0).toString(16).toUpperCase()})},a.TX=c}),define("runtime/textvariable",["hd","hdmain/system","runtime/variable","system/dictionary"],function(a,b,c,d,e){function f(a,b,c,d,e,g,h,i,j,k,l,n,o,p,q,r,s,t,u,v,w,x){f.baseConstructor.call(this,a,b,c,d,e,g,h,i,j,k,l,n,o,p,q,r,s,t),this.fldHgt="number"==typeof u&&u>0?u:1,this.maxLen="number"==typeof v&&v>=0?v:0,this.patrn="string"==typeof w?w:"",this.entPar="boolean"==typeof x&&x?!0:!1,m=null}function g(a){null==m&&(m=new d,m.a.X=m.a.x=new k(".",!1),m.a[9]=new k("\\d",!1),m.a.L=m.a.l=new k("[a-z\\xDF-\\xF6\\xF8-\\xFF\\u0153\\u0161\\u017E]",!1),m.a.U=m.a.u=new k("[A-Z\\xC0-\\xD6\\xD8-\\xDE\\u0152\\u0160\\u0178\\u017D]",!1),m.a.A=m.a.a=new k("[A-Za-z\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\xFF\\u0152\\u0153\\u0160\\u0161\\u0178\\u017D\\u017E]",!1),m.a.N=m.a.n=new k("[0-9A-Za-z\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\xFF\\u0152\\u0153\\u0160\\u0161\\u0178\\u017D\\u017E]",!1),m.a.H=m.a.h=new k("[0-9A-Fa-f]",!1));var b,c,e=m.TryGetValue(a);return null==e&&(b=a[0],"/"==b&&(a.length>1?b=a[1]:a="//"),c=new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),e=new k(b.replace(c,"\\$&"),!0),m.a[a]=e),e}function h(a){return"99:99"==a.substring(0,5)&&(5==a.length||"99:99 am"==a.toLowerCase()||"99:99 a.m."==a.toLowerCase())}function i(a,b,c){null==n&&(n=/(\d+)(.*)/,o=/\b([APap])(.*)/);var d,e,f,g,h,i=b.length>6&&"A"==b.substr(6,1),j="99:99"==b?23:12,k=!1,m=!1,p=!1,q=null,r=null,s=null;for(e=a,g=1;2>=g;g++)2==g&&e.length>0&&(k=!0),f=e.match(n),f&&(d=f[1],e=f[2],d.length>2&&(e=d.substr(2)+e,d=d.substr(0,2)),parseInt(d,10)>(1==g?j:59)&&(e=d.substr(1)+e,d=d.substr(0,1)),1==g?q=d:(r=d,e.length>0&&(m=!0)));return f=e.match(o),f&&(s=f[1],e=f[2],e.length>0&&(p=!0),s=i?s.toUpperCase():s.toLowerCase()),h="",l(q)||(1==q.length&&(h+=" ",a.length>0&&" "!=a.charAt(0)&&c.v>=0&&++c.v),h+=q,k&&(h+=":",-1==a.indexOf(":")&&c.v>=h.length&&++c.v),l(r)||(m&&1==r.length&&(h+="0"),h+=r,12==j&&(m&&(h+=" ",c.v>=h.length&&++c.v),l(s)||(h+=s,c.v>=h.length&&(c.v+=s.length)),p&&b.length>7&&(h+=b.substr(7))))),h}function j(a,b){for(var c,d,e=a.length,f=b.length,g=0,h=0,i=a;e>h;)"/"==b.charAt(g)&&g++,g++,h++;for(;f>g;)c=b.charAt(g).toUpperCase(),"X"==c||"9"==c||"L"==c||"U"==c||"A"==c||"N"==c||"H"==c?d=" ":(c="/"==c&&g<b.length-1?b.charAt(++g):b.charAt(g),d=c),i+=d,g++;return i}function k(a,b){var c=new RegExp(a);return c.Literal=b,c}var l=b.String.IsNullOrEmpty;this.DEBUG===e&&(this.DEBUG=a.DEBUG);var m=null,n=null,o=null;return b.ExtendClass(f,c,{type:"TX",valType:"TX",ValidateText:function(a){var b,c,d=!1;return null!=a&&""==a.v&&(a.v=null,d=!0),null!=a&&null!=a.v&&!l(this.patrn)&&(b={v:-1},c=j(f.FitTextToPattern(a.v,this.patrn,b),this.patrn),c!=a.v&&(a.v=c,d=!0)),d}},{FitTextToPattern:function(a,b,c){if(null==a)return"";if(h(b))return i(a,b,c);var d,e,f,j,k,l="",m=!1;for(d=0,e=0;d<a.length&&e<b.length;d++,e++)c.v>=0&&!m&&d==c.v&&(c.v=l.length,m=!0),j=b.substr(e,1),"/"==j[0]&&e<b.length-1&&(j=b.substr(e++,2)),k=g(j),f=a.substr(d,1),"U"==j.toUpperCase()?f=f.toUpperCase():"L"==j.toUpperCase()&&(f=f.toLowerCase()),k.test(f)?l+=f:k.Literal?(l+=1==j.length?j[0]:j[1],d--):e--;return c.v>=0&&!m&&d==c.v&&(c.v=l.length),l},GetPatternLength:function(a){var b,c=0,d=a.length;for(b=0;d>b;b++)"/"==a.charAt(b)&&b++,c++;return c}}),a.TxVar=f,f}),define("runtime/timespanvalue",["hd"],function(a){function b(a,b){"number"==typeof a&&(this.v=a,this.p=b?b:"D")}return a.Ts=b,b}),define("runtime/truefalsevalue",["hd"],function(a,b){var c=a.TF===b?{}:a.TF;c.Eq=function(a,b){return null===a||null===b?null:a==b},c.Ne=function(a,b){return null===a||null===b?null:a!=b},c.Not=function(a){return null===a?null:!a},c.Xml=function(a,b,c){a.WriteStartElement("TFValue"),c||a.WriteAttributeString("userModifiable","false"),null!==b?a.WriteString(b?"true":"false"):a.WriteAttributeString("unans","true"),a.WriteEndElement()},a.TF=c}),define("runtime/truefalsevariable",["hd","hdmain/system","runtime/variable"],function(a,b,c){function d(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){d.baseConstructor.call(this,a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s),this.sameLine=t?!0:!1}return b.ExtendClass(d,c,{type:"TF",valType:"TF"}),a.TfVar=d,d}),define("runtime",["runtime/datevalue","runtime/datevariable","runtime/dialog","runtime/dialogelement","runtime/format","runtime/multiplechoicevalue","runtime/multiplechoicevariable","runtime/numbervalue","runtime/numbervariable","runtime/textvalue","runtime/textvariable","runtime/timespanvalue","runtime/truefalsevalue","runtime/truefalsevariable"],function(){}),define("system/frameworkelement",["hdmain/jq"],function(a,b){return a.widget("hd.FrameworkElement",{options:{Bindings:{}},SetBinding:function(a,b){this.options.Bindings[a]=b},IsEnabled:function(a){return a===b?this.options.IsEnabled:(this._setOption("IsEnabled",a),void 0)}}),a.hd.FrameworkElement}),define("system/control",["hdmain/jq","system/frameworkelement","hdmain/system"],function(a,b,c){return a.widget("hd.Control",b,{_create:function(){b.prototype._create.apply(this,arguments),this.element.on("focus",function(){a(this).trigger("GotFocus")
}).on("blur",function(){a(this).trigger("LostFocus")})},_setOption:function(a,d){switch(b.prototype._setOption.apply(this,arguments),a){case"IsTabStop":this.element.attr("tabIndex",d?1:"");break;case"Style":"string"==typeof d?this.element.removeClass().addClass(d):"string"==typeof d.c&&this.element.removeClass().addClass(d.c),d.s&&this.option(d.s);break;case"Visibility":this.element[d==c.Windows.Visibility.Visible?"show":"hide"]()}}}),a.hd.Control}),define("system/jquery.hd.datepicker",["hd","hdmain/system","system/control","hdmain/jq"],function(a,b,c,d,e){var f,g=d.proxy,h="hd-datepicker",i="DatePicker",j="mouseup";return d.widget("hd."+i,c,{options:{mon:5,yr:1990,IsEnabled:!0,calVis:!1},_create:function(){this.element.css("position","relative"),this._wrap=d('<div class="hd-input-date-wrapper"/>').appendTo(this.element),this._textBox=d('<input type="text" class="hd-input hd-input-date"/>').attr("tabIndex",1).attr("placeholder","<"+a.Lc._GetProp("shortDateFormat")+">").appendTo(this._wrap),a.iOS&&this._textBox.attr("pattern","[0-9]*"),this._button=d('<div class="hd-img hd-cal-calendar"/>').on("click",g(this._button_Clicked,this)).appendTo(this.element),this.option(this.options),this.element.parent().length>0&&this._wrap.css("padding-left",this.element.siblings("div").width())},_setOption:function(b,c){switch(d.Widget.prototype._setOption.apply(this,arguments),b){case"IsEnabled":this._textBox.prop("disabled",!c).toggleClass("hd-input-readonly GrayField",!c).parents(".hd-cell-input").toggleClass("GrayText",!c),this._button.toggleClass("hd-img",c).toggleClass("hd-img-g",!c).prop("disabled",!c);break;case"yr":case"mon":this._updateCal();break;case"selDay":case"selMon":case"selYr":null!==this._curSelDate()&&(this._setOption("SelectedDate",this._curSelDate()),this._updateCal());break;case"SelectedDate":this._textBox.val(c?a.Lc.FormatDate(c.getDate(),c.getMonth()+1,c.getFullYear()):null),this.element.trigger("SelectedDateChanged");break;case"calVis":if(this._renderCal(),c){if(this._textBox.disabled)return;datval=a.Lc.ParseDate(this._textBox.val()),null!==datval&&"err"!=datval?this.option({mon:datval.getMonth(),yr:datval.getFullYear(),selDay:datval.getDate(),selMon:datval.getMonth(),selYr:datval.getFullYear()}):(datval=new Date,this.option({selDay:e,selMon:e,selYr:e,mon:datval.getMonth(),yr:datval.getFullYear()}));var j=f.outerHeight(),k=this._textBox.outerHeight(!0),l=this._textBox.offset().top,m=l+k;m+j>d(window).height()&&l>j&&(m=l-j-(k-this._textBox.outerHeight()));var n=parseInt(this._wrap.closest(".hd-interview-base").css("z-index"),10);f.css({"z-index":isNaN(n)?"":n+1,top:m,left:this._wrap.offset().left}).show(),d(document.body).on("mousedown."+i,g(function(a){0===d(a.target).parents("."+h).length&&(this._showCal(!1),d(document.body).off("."+i))},this))}else f.hide()}},_button_Clicked:function(){var a=this.options;return a.IsEnabled?(this._setOption("calVis",!a.calVis),void 0):!1},_changeYear:function(a){var b=this.options.yr+a.data;9999>=b&&b>=1e3&&this.option({yr:b})},_changeMonth:function(a){var b=this.options,c=b.mon+a.data,d=b.yr;0>c?(c=11,d--):c>11&&(c=0,d++),9999>=d&&d>=1e3&&this.option({yr:d,mon:c})},_curSelDate:function(){var a=this.options,b=a.selDay,c=a.selMon,d=a.selYr,e="undefined"!=typeof b&&"undefined"!=typeof c&&"undefined"!=typeof d;return e?new Date(d,c,b):null},_showCal:function(a){this.options.calVis=a,a?f.show():f.hide()},_renderCal:function(){var b,c,e,i,k,l,m,n,o,p,q;if(!f){for(f=d("<div/>").addClass(h).hide(),b=a.Lc,c=this.options.mon,e=this.options.yr,i=b.FirstDayOfWeek(),i=0>i?0:i%7,m=d("<table cellpadding=0 cellspacing=0></table>").appendTo(f).addClass(h+"-grid"),n=d("<tr/>").appendTo(m),o=d('<td class="'+h+'-titlebar" colspan=7></td>').appendTo(n),p=d("<table cellpadding=0 cellspacing=1 border=0></table>").appendTo(o),q=d("<tr/>").appendTo(p),this._titleBtn("py").appendTo(q),this._titleBtn("pm").appendTo(q),d('<td class="'+h+'-title"/>').appendTo(q).text(b.GetMonthName(c,!1)+" "+e),this._titleBtn("nm").appendTo(q),this._titleBtn("ny").appendTo(q),l=d('<tr class="'+h+'-days"/>').appendTo(m),k=0;7>k;k++)d('<td class="'+h+"-day "+h+'-label">'+b.GetWeekdayName((k+i)%7,!0).substr(0,2)+"</td>").appendTo(l);d("<tr/>").appendTo(m)}f.find(".hd-cal-py").off(j).on(j,null,-1,g(this._changeYear,this)),f.find(".hd-cal-pm").off(j).on(j,null,-1,g(this._changeMonth,this)),f.find(".hd-cal-nm").off(j).on(j,null,1,g(this._changeMonth,this)),f.find(".hd-cal-ny").off(j).on(j,null,1,g(this._changeYear,this)),f.appendTo("#hdMainDiv")},_updateCal:function(){var b,c,e,i,j,k,l,m,n,o,p,q=a.Lc,r=this.options,s=r.mon,t=r.yr,u=new Date,v=this._curSelDate(),w=q.FirstDayOfWeek(),x=q._GetProp("calWeekend"),y=q.DaysInMonth(s,t);for(w=0>w?0:w%7,x||(x=[0,6]),b=new Date(t,s,1),b.dayOfWeek=b.getDay(),c=t==u.getFullYear()&&s==u.getMonth()?u.getDate():255,e=v&&t==r.selYr&&s==r.selMon?v.getDate():255,f||this._renderCal(),n=f.children("table"),n.find("."+h+"-title").text(q.GetMonthName(s,!1)+" "+t),o=d("."+h+"-days").next(),o.empty(),i=1;42>=i;i++){for(j=(i+w+6)%7,k=i+w-b.dayOfWeek,w>b.dayOfWeek&&(k-=7),l=0;l<x.length&&j!=x[l];l++);if(m=l<x.length,p=d("<td/>").appendTo(o),p.addClass(h+"-day"+(m?" "+h+"-weekend":"")),(k==e||k==c)&&p.addClass(k==e?h+"-selected":h+"-today"),k>0&&y>=k?p.on("click",null,k,g(this._select,this)).css("cursor","pointer").text(k):p.text("Â "),i%7===0&&36>i){if(i>=28&&k>=y)break;o=o.next(),o.length<=0&&(o=d("<tr/>").appendTo(n)),o.empty()}}o.next().length>0&&o.next().remove()},_select:function(b){this._showCal(!1),this._setOption("selDay",b.data);var c=a.Lc.FormatDate(b.data,this.options.mon+1,this.options.yr);this._textBox.val(c).focus()},_titleBtn:function(a){return d('<td><div class="hd-img hd-cal-'+a+'"/></td>')},SetFocus:function(){this._textBox.focus()},DisplayDate:function(){return b.String.IsNullOrEmpty(this._textBox.val())?"":a.Lc._localeHelper.InterpretDate(this._textBox.val())}}),d.hd[i]}),define("dialog/answerdatepicker",["hd","hdmain/jq","system/jquery.hd.datepicker"],function(a,b,c,d){var e=b.proxy,f="AnswerDatePicker",g="TextChanged.DateInputControl";return b.widget("hd."+f,c,{_textBox:null,_create:function(){this.element.on("Loaded",e(this.AnswerDatePicker_Loaded,this)).on("Unloaded",e(this.AnswerDatePicker_Unloaded,this)).on("SelectedDateChanged",e(this.AnswerDatePicker_SelectedDateChanged,this)),c.prototype._create.apply(this,arguments)},OnApplyTemplate:function(){null!=this.RawText()&&this._textBox.val(this.RawText())},AnswerDatePicker_Loaded:function(){null!=this._textBox&&this._textBox.on(g,e(this._textBox_TextChanged,this))},AnswerDatePicker_Unloaded:function(){null!=this._textBox&&this._textBox.off(g,this._textBox_TextChanged)},SynchText:function(){this.RawText(this._textBox.val())},OnKeyDown:function(a){(9==a.which||33==a.which||34==a.which||36==a.which||35==a.which)&&this.SynchText(),c.prototype.OnKeyDown.apply(this,arguments)},_textBox_TextChanged:function(){this.SynchText()},AnswerDatePicker_SelectedDateChanged:function(){this.RawText(this.options.SelectedDate?a.Lc._localeHelper.FormatDate(this.options.SelectedDate.getDate(),this.options.SelectedDate.getMonth()+1,this.options.SelectedDate.getFullYear()):"")},RawText:function(a){return a===d?this._textBox.val():(this._textBox.val(a),void 0)}}),b.hd[f]}),define("system/jquery.hd.childwindow",["hdmain/jq"],function(a){var b=a.ui.dialog.prototype;return a.widget("hd.ChildWindow",a.ui.dialog,{options:{dialogClass:"hd-interview-base hd-popup",overlay:{backgroundColor:"#000CCC",opacity:.5},autoOpen:!1,resizable:!1,draggable:!0,modal:!0,show:"scale",hide:"scale"},_create:function(){b._create.apply(this,arguments),this._setOption("close",a.proxy(function(){this.element.trigger("Closed")},this)),this.option(this.options)},open:function(){b.open.apply(this,arguments),this.element.resize()},close:function(){var a=this,c=a.options.hdClose;b.close.apply(a,arguments),"function"==typeof c&&c.apply(a,arguments)},DialogResult:function(a){return"boolean"!=typeof a?"boolean"!=typeof this._dialogResult?null:this._dialogResult:(this._dialogResult="boolean"==typeof a?a:null,b.isOpen.apply(this)===!0&&this.close(),void 0)}}),a.hd.ChildWindow}),define("dialog/answersourcevalueconverter",["hd","hdmain/system"],function(a,b){function c(){}return b.ExtendClass(c,null,{Convert:function(b){if(null==b)return"";switch(typeof b){case"string":case"boolean":return b;case"object":if(b instanceof Date)return a.Lc.FormatDateVal(b,"d MMM yyyy");if(b.length)return b.join("|");default:return b.toString()}},ConvertBack:function(){}}),c}),define("system/contentcontrol",["system/control","hdmain/jq"],function(a,b){return b.widget("hd.ContentControl",a,{_setOption:function(b,c){switch(b){case"Content":this.OnContentChanged(this.options[b],c);break;case"ContentTemplate":}a.prototype._setOption.apply(this,arguments)},OnContentChanged:function(a,b){"object"!=typeof b?this.element.children("span").html(b):(this.element.children().detach(),b.appendTo(this.element).trigger("Loaded"))}}),b.hd.ContentControl}),define("system/jq.datagrid/datagridlength",["hdmain/system","system/exception/argumentexception"],function(a,b,c){function d(a,d){if(d===c&&(d=f.Pixel),isNaN(a)||!isFinite(a)||0>a)throw new b("DataGridLength: invalid value");if(d!=f.Auto&&d!=f.Pixel)throw new b("DataGridLength: invalid type");this.Value=d==f.Auto?g:a,this.T=d}var e,f={Auto:0,Pixel:1},g=1;return e=new d(g,f.Auto),a.ExtendClass(d,null,{IsAbsolute:function(){return this.T==f.Pixel},IsAuto:function(){return this.T==f.Auto}},{Auto:function(){return e}}),d}),define("system/jq.datagrid/datagridcolumnheader",["hd","system/contentcontrol","hdmain/jq","system/jq.datagrid/datagridlength"],function(a,b,c,d,e){function f(){x=s.None,l=null,o=null,k=null}function g(a){if(1==a.which){var b,d,e,f,g,q,u,w=this.options;null==w.OwningColumn||a.Handled||this.element.is(":disabled")||(c(document).on(t,p(h,this)),this.element.closest("tr").on(v,p(i,this)),g={X:a.clientX,Y:a.clientY},q={v:a.Handled},!q.v&&null!=this.OwningGrid()&&(x=s.MouseDown,k=g,u=g.X,b=u-this.element.offset().left,d=this.element.offset().left+this.element.outerWidth()-u,e=w.OwningColumn,f=null,f=this.OwningGrid().options.Columns.GetPreviousVisibleColumn(e),x==s.MouseDown&&null==l&&r>=d?q.v=j(e):x==s.MouseDown&&null==l&&r>=b&&null!=f&&(q.v=j(f)),x==s.Resize&&null!=l&&(o=k,n=l.ActualWidth(),m=n,q.v=!0)),a.Handled=q.v)}}function h(a){if(this.element.closest("tr").off(v,i),c(document).off(t,p(h,this)),null!=this.options.OwningColumn&&!a.Handled&&!this.element.is(":disabled")){var b={v:a.Handled};b.v||(this.element.trigger(w),b.v=!0),a.Handled=b.v}}function i(a){if(null!=this.options.OwningColumn&&!this.element.is(":disabled")){var b,c,e,f,g,h,i={X:a.clientX,Y:a.clientY},j={v:!1};j.v||(b=c=i,e=i.X,f=this.element.offset().left+this.element.outerWidth()-e,j.v||x==s.Resize&&null!=l&&null!=o&&(g=c.X-o.X,h=n+g,m>=l.MinWidth()&&h!=m&&(h=Math.max(h,0),l.Width(new d(h)),m=h),j.v=!0),k=c),a.preventDefault()}}function j(a){return l=a,x=s.Resize,!0}this.DEBUG===e&&(this.DEBUG=a.DEBUG);var k,l,m,n,o,p=c.proxy,q="DataGridColumnHeader",r=5,s={None:0,MouseDown:1,Resize:3},t="mouseup.DataGrid",u="mousedown.DataGrid",v="mousemove.DataGrid",w="LostMouseCapture",x=s.None;return c.widget("hd."+q,b,{_create:function(){b.prototype._create.apply(this,arguments),this.element.disableSelection().addClass("hd-grid-col-title hd-grid-line").on(w,f).on(u,p(g,this)),c("<span/>").appendTo(this.element),c('<div class="hd-grid-col-splitter"/>').appendTo(this.element)},_setOption:function(a){switch(b.prototype._setOption.apply(this,arguments),a){case"Visibility":this.options.OwningColumn.OwningGrid._rowsPresenter.find(".hd-grid-row-cells").children(":nth-child("+(this.element.index()+1)+")").hide()}},ColumnIndex:function(){var a=this.options;return null==a.OwningColumn?-1:a.OwningColumn.Index},OwningGrid:function(){var a=this.options;return null!=a.OwningColumn&&null!=a.OwningColumn.OwningGrid?a.OwningColumn.OwningGrid:null}}),c.hd[q]}),define("system/jq.datagrid/datagridcolumn",["hd","hdmain/system","hdmain/jq","system/contentcontrol","system/jq.datagrid/datagridcolumnheader","system/jq.datagrid/datagridlength","system/exception/argumentnullexception"],function(a,b,c,d,e,f,g,h){function i(){this._desiredWidth=0,this._width=null,this._visibility=b.Windows.Visibility.Visible,this._displayIndex=-1,this.OwningGrid=null}var j="DataGridColumnHeader";return this.DEBUG===h&&(this.DEBUG=a.DEBUG),b.ExtendClass(i,null,{ActualWidth:function(){if(null==this.OwningGrid)return 0;var a=this.EffectiveWidth().IsAbsolute()?this.EffectiveWidth().Value:this.DesiredWidth();return Math.min(Math.max(a,this.ActualMinWidth()),this.ActualMaxWidth())},DisplayIndex:function(a){return a===h?this._displayIndex:(this._displayIndex!=a&&(this._displayIndex=null!=this.OwningGrid?a:a),void 0)},HeaderStyle:function(a){return a===h?this._headerStyle:(this._headerStyle!=a&&(this._headerStyle=a,null!=this._headerCell&&(this._headerCell.Style=a)),void 0)},Header:function(a){return a===h?this._header:(this._header!=a&&(this._header=a,null!=this._headerCell&&this._headerCell[j]({Content:this._header})),void 0)},IsReadOnly:function(a){return a===h?null==this.OwningGrid?null!=this._isReadOnly?this._isReadOnly:!1:null!=this._isReadOnly?this._isReadOnly||this.OwningGrid.IsReadOnly():!1:(a!=this._isReadOnly&&(this._isReadOnly=a),void 0)},MaxWidth:function(a){return a===h?null!=this._maxWidth?this._maxWidth:1/0:((null==this._maxWidth||this._maxWidth!=a)&&(this._maxWidth=a,null!=this.OwningGrid&&this._maxWidth<this.ActualWidth()&&this.OwningGrid.OnColumnWidthChanged(this)),void 0)},MinWidth:function(a){return a===h?null!=this._minWidth?this._minWidth:0:((null==this._minWidth||this._minWidth!=a)&&(this._minWidth=a,null!=this.OwningGrid&&this._minWidth>this.ActualWidth()&&this.OwningGrid.OnColumnWidthChanged(this)),void 0)},Visibility:function(a){return a===h?this._visibility:(a!=this.Visibility()&&(this._visibility=a,null!=this._headerCell&&this._headerCell[j]({Visibility:this._visibility})),void 0)},Width:function(a){return a===h?null!=this._width?this._width:null!=this.OwningGrid?this.OwningGrid.options.ColumnWidth:f.Auto():((null==this._width||this._width!=a)&&(this._width=a,a.IsAbsolute()&&this.DesiredWidth(a),null!=this.OwningGrid&&this.OwningGrid.OnColumnWidthChanged(this)),void 0)},ActualMaxWidth:function(){return this._maxWidth?this._maxWidth:null!=this.OwningGrid?this.OwningGrid.options.MaxColumnWidth:1/0},ActualMinWidth:function(){return this._minWidth?this._minWidth:null!=this.OwningGrid?this.OwningGrid.options.MinColumnWidth:0},DesiredWidth:function(a){if(a===h)return this._desiredWidth;if(this._desiredWidth!=a){var b=this.ActualWidth();this._desiredWidth=a,null!=this.OwningGrid&&b!=this.ActualWidth()&&this.OwningGrid.OnColumnWidthChanged(this)}},EffectiveWidth:function(){return this._width?this._width:this.OwningGrid.options.ColumnWidth},HeaderCell:function(){if(null==this._headerCell){this._headerCell=c("<div/>")[j]();var a=this.HeaderStyle();null==a&&null!=this.OwningGrid&&(a=this.OwningGrid.options.ColumnHeaderStyle),null!=a&&this._headerCell[j]({Style:a}),this._headerCell[j]({OwningColumn:this,Content:this._header})}return this._headerCell},GetCellContent:function(a){var c,d,e;if(null==a)throw new g("dataGridRow/dataItem");if(null==b.Cast(a,"DataGridRow")){if(c=a,d=this.OwningGrid.GetRowFromItem(c),null==d)return null}else d=a;return d.DataGridRow("option","OwningGrid")==this.OwningGrid&&(e=d.DataGridRow("option","Cells").get(this.Index),null!=e)?e.DataGridCell("option","Content"):null},RefreshCellContent:function(){}}),i}),define("system/jq.datagrid/datagridboundcolumn",["hd","hdmain/system","hdmain/jq","system/jq.datagrid/datagridcolumn"],function(a,b,c,d,e){function f(){}function g(){g.baseConstructor.apply(this,arguments)}return this.DEBUG===e&&(this.DEBUG=a.DEBUG),b.ExtendClass(f,null,{Convert:function(a){return a},ConvertBack:function(a,b){return null!=b&&b.IsNullableType()&&""==a.toString()?null:a}}),b.ExtendClass(g,d,{Binding:function(a){if(a===e)return this._binding;if(this._binding!=a){if(null!=this.OwningGrid&&!this.OwningGrid.CommitEdit(b.Windows.Controls.DataGridEditingUnit.Row,!0))throw"CommitFailedCannotCompleteOperation";this._binding=a,null!=this._binding&&(b.String.IsNullOrEmpty(this._binding.Path)||(this._binding.Mode=b.Windows.Data.BindingMode.TwoWay),null==this._binding.Converter&&(this._binding.Converter=new f))}},ElementStyle:function(a){return a===e?this._elementStyle:(this._elementStyle!=a&&(this._elementStyle=a),void 0)}}),g}),define("system/textblock",["hdmain/jq","system/frameworkelement"],function(a,b,c){return a.widget("hd.TextBlock",b,{_create:function(){b.prototype._create.apply(this,arguments),this.option(this.options)},_setOption:function(a,b){switch(a){case"Text":"INPUT"==this.element.prop("tagName")?this.element.val(b?b:""):this.element.text(b?b:"")}},Text:function(a){return a===c?this.options.Text:(this._setOption("Text",a),void 0)},Foreground:function(a){this.element.removeClass().addClass(a).prop("disabled",a.indexOf("-gray")>0||a.indexOf("-readonly")>0)}}),a.hd.TextBlock}),define("system/jq.datagrid/datagridtextcolumn",["hdmain/system","hdmain/jq","system/jq.datagrid/datagridboundcolumn","system/textblock"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}return a.ExtendClass(d,c,{GenerateElement:function(){var a=b("<div/>").TextBlock().html("&nbsp;");return a.TextBlock("SetBinding","Text",this.Binding()),a},RefreshCellContent:function(){}}),d}),define("system/jquery.hd.togglebutton",["hdmain/system","system/contentcontrol","hdmain/jq"],function(a,b,c,d){var e="ToggleButton",f="IsChecked";return c.widget("hd."+e,b,{options:{Style:"hd-input-tf"},_create:function(){c.Widget.prototype._create.apply(this,arguments),this.element.attr("tabIndex",1).change(function(a){c(a.target).trigger("focus").trigger(a.target.checked?"Checked":"Unchecked"),"radio"==a.target.type&&c('input[name="'+a.target.name+'"]').not(a.target).each(function(){c(this).trigger(this.checked?"Checked":"Unchecked")})}),this.option(this.options)},_setOption:function(b,d){switch(c.Widget.prototype._setOption.apply(this,arguments),b){case"Style":this.element.removeClass().addClass(d);break;case"Content":var e=a.Guid.NewGuid();d.attr("for",e).insertAfter(this.element),this.element.attr("id",e);break;case f:this.element.prop("checked",d);break;case"IsEnabled":this.element.attr("disabled",!d)}},IsChecked:function(a){return a===d?this.options[f]:(this._setOption(f,a),void 0)}}),c.hd[e]}),define("system/checkbox",["hdmain/jq","system/jquery.hd.togglebutton"],function(a,b){return a.widget("hd.CheckBox",b,{}),a.hd.CheckBox}),define("system/jq.datagrid/datagridcheckboxcolumn",["hd","hdmain/system","hdmain/jq","system/jq.datagrid/datagridboundcolumn","system/exception/argumentnullexception","system/checkbox"],function(a,b,c,d,e,f,g){function h(){h.baseConstructor.apply(this,arguments)}return this.DEBUG===g&&(this.DEBUG=a.DEBUG),b.ExtendClass(h,d,{GenerateElement:function(){var a=c('<input type="checkbox"/>').CheckBox().addClass("hd-input-tf-readonly").on("click",function(){return!1}).CheckBox("SetBinding","IsChecked",this.Binding);return a},RefreshCellContent:function(a){if(null==a)throw new e("element")}}),h}),define("system/jq.datagrid/datagridtemplatecolumn",["hd","system/jq.datagrid/datagridcolumn","hdmain/system"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments),this.CellEditingTemplate=null,this.CellTemplate=null}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),c.ExtendClass(e,b,{GenerateElement:function(){return this.CellTemplate.LoadContent()}}),e}),define("system/jq.datagrid/datagridbeginningediteventargs",[],function(){function a(a,b,c){this.Column=a,this.Row=b,this.EditingEventArgs=c}return a}),define("system/jq.datagrid/datagridpreparingcellforediteventargs",[],function(){function a(a,b,c,d){this.Column=a,this.Row=b,this.EditingEventArgs=c,this.EditingElement=d}return a}),define("system/jq.datagrid/datagridroweventargs",[],function(){function a(a){this.Row=a}return a}),define("system/jq.datagrid/datagridcellcoordinates",["hdmain/system"],function(a){function b(a,c){a instanceof b?(this.C=a.C,this.R=a.R):(this.C=a,this.R=c)}return a.ExtendClass(b,null,{Equals:function(a){return a instanceof b?a.C==this.C&&a.R==this.R:!1}}),b}),define("system/jq.datagrid/datagriddataconnection",["hd","hdmain/system","hdmain/jq"],function(a,b,c,d){function e(a){this._owner=a}function f(a,b){var c,d;switch(b.Action){case"Add":if(c=b.NewItems,null==c)return;this._owner.InsertRow(b.NewStartingIndex);break;case"Remove":if(c=b.OldItems,null==c||b.OldStartingIndex<0)return;for(d=0;d<b.OldItems.length;d++)this._owner.RemoveRowAt(b.OldStartingIndex,b.OldItems[d])}}this.DEBUG===d&&(this.DEBUG=a.DEBUG);var g=c.proxy;return b.ExtendClass(e,null,{Count:function(){var a,b,c,d=this.List(),e=0;if(null!=d)return"number"==typeof d.length?d.length:d.c.length;if(a=this.DataSource,null!=a)return a.Count;if(b=this.DataSource,null!=b&&(c=b.GetEnumerator(),null!=c))for(;c.MoveNext();)e++;return e},DataType:function(){return null==this._owner.options.ItemsSource?null:this._owner.options.ItemsSource.GetItemType()},List:function(){return this.DataSource},BeginEdit:function(a){if(null==a)return!1;var b=a;return null!=b?!0:!0},EndEdit:function(a){var b=a;return null!=b?!0:!0},GetDataItem:function(a){var b,c,d,e=this.List(),f=-1;if(null!=e)return"number"==typeof e.length?a<e.length?e[a]:null:a<e.c.length?e.c[a]:null;if(b=this.DataSource,null!=b)return b.GetItemAt(a);if(c=this.DataSource,null!=c)for(d=c.GetEnumerator();d.MoveNext()&&a>f;)if(f++,f==a)return d.Current;return null},IndexOf:function(a){var b=this.List();return null!=b?"number"==typeof b.length?b.indexOf(a):b.c?b.c.indexOf(a):b.IndexOf(a):void 0},UnWireEvents:function(a){null!=a&&c(a).off("CollectionChanged",f)},WireEvents:function(a){null!=a&&c(a).on("CollectionChanged",g(f,this))}}),e}),define("system/jq.datagrid/range",["hdmain/system"],function(a){function b(a,b,c){this.L=a,this.U=b,this.V=c}return a.ExtendClass(b,null,{Count:function(){return this.U-this.L+1},ContainsIndex:function(a){return this.L<=a&&this.U>=a},ContainsValue:function(a){return null==this.V?null==a:this.V==a}}),b}),define("system/jq.datagrid/indextovaluetable",["hd","hdmain/system","system/jq.datagrid/range"],function(a,b,c,d){function e(){this._list=[]}function f(a,b,d,e){var f,i,j,l,m=a+b-1,n=new c(a,m,d);if(0==this._list.length)this._list.push(n);else{for(f=null!=e?e:g.call(this,a),i=0>f?null:this._list[f],null==i?(0>f&&(f=0),this._list.splice(f,0,n)):i.V!=d&&i.U>=a?(i.U>m&&this._list.splice(f+1,0,new c(m+1,i.U,i.V)),i.U=a-1,k.call(this,i,f)||f++,this._list.splice(f,0,n)):(this._list.splice(f+1,0,n),h.call(this,f)||f++),j=f+1;j<this._list.length&&this._list[j].U<m;)this._list.splice(j,1);j<this._list.length&&(l=this._list[j],l.L<=m&&(l.L=m+1,k.call(this,l,j)),h.call(this,f))}}function g(a){if(0==this._list.length)return-1;for(var b,c=0,d=this._list.length-1,e=null;d>c;)if(b=Math.floor((c+d)/2),e=this._list[b],e.U<a)c=b+1;else{if(!(e.L>a))return b;d=b-1}return c==d?(e=this._list[c],e.ContainsIndex(a)||e.U<a?c:c-1):d}function h(a){var b,c,d=a+1;return a>=0&&d<this._list.length&&(b=this._list[a],c=this._list[d],b.U+1>=c.L&&b.V==c.V)?(b.U=Math.max(b.U,c.U),this._list.splice(d,1),!0):!1}function i(a,b,d){var e,f,g=d>=0?d:0;for(e=g;e<this._list.length;e++){if(f=this._list[e],f.L>=a)f.L+=b;else if(f.U>=a){e++,this._list.splice(e,0,new c(a,f.U+b,f.V)),f.U=a-1;continue}f.U>=a&&(f.U+=b)}}function j(a,b){return-1!=a&&this._list[a].ContainsIndex(b)}function k(a,b){return a.U<a.L?(this._list.splice(b,1),!0):!1}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,null,{IndexCount:function(){var a,b=0;for(a=0;a<this._list.length;a++)b+=this._list[a].Count();return b},IsEmpty:function(){return 0==this._list.length},RangeCount:function(){return this._list.length},SingleIndex:function(){return this._list[0].L},AddValue:function(a,b){this.AddValues(a,1,b)},AddValues:function(a,b,c){f.call(this,a,b,c,null)},Clear:function(){this._list=[]},Contains:function(a){return j.call(this,g.call(this,a),a)},ContainsAll:function(a,b){var c,d,e=-1,f=-1;for(c=0;c<this._list.length;c++)if(d=this._list[c],-1==e&&d.U>=a){if(a<d.L)return!1;if(e=a,f=d.U,f>=b)return!0}else if(-1!=e){if(d.L>f+1)return!1;if(f=d.U,f>=b)return!0}return!1},ContainsIndexAndValue:function(a,b){var c=g.call(this,a);return j.call(this,c,a)&&this._list[c].ContainsValue(b)},GetIndexCount:function(a,b,c){if(0==this._list.length)return 0;var d=0,e=g.call(this,a);for(j.call(this,e,a)&&this._list[e].ContainsValue(c)&&(d+=this._list[e].U-a),e++;e<this._list.length&&this._list[e].U<b;)this._list[e].ContainsValue(c)&&(d+=this._list[e].length),e++;return e<this._list.length&&j.call(this,e,b)&&this._list[e].ContainsValue(c)&&(d+=b-this._list[e].L),d},GetIndexes:function(){var a,b,c,d=[];for(a=0;a<this._list.length;a++)for(b=this._list[a],c=b.L;c<=b.U;c++)d.push(c);return d},GetValueAt:function(a,b){b===d&&(b={});var c=g.call(this,a);return j.call(this,c,a)?(b.v=!0,this._list[c].V):(b.v=!1,null)},IndexOf:function(a){var b,c,d=0;for(b=0;b<this._list.length;b++){if(c=this._list[b],d+c.Count()>a)return c.L+a-d;d+=c.Count()}return-1},InsertIndex:function(a){this.InsertIndexes(a,1)},InsertIndexAndValue:function(a,b){this.InsertIndexesAndValues(a,1,b)},InsertIndexes:function(a,b){i.call(this,a,b,g.call(this,a))},InsertIndexesAndValues:function(a,b,c){var d=g.call(this,a);i.call(this,a,b,d),f.call(this,a,b,c,d)},RemoveIndex:function(a){this.RemoveIndexes(a,1)},RemoveIndexAndValue:function(a){this.RemoveIndexesAndValues(a,1)},RemoveIndexes:function(a,b){var d,e,f,i=g.call(this,a);for(0>i&&(i=0),d=i;d<this._list.length;)e=this._list[d],e.U>=a&&(e.L>=a+b?(e.L-=b,e.U-=b):(f=d,e.L<=a?(e.U>=a+b&&(d++,this._list.splice(d,0,new c(a,e.U-b,e.V))),e.U=a-1):(e.L=a,e.U-=b),k.call(this,e,f)&&d--)),d++;h.call(this,i)||h.call(this,i+1)},RemoveIndexesAndValues:function(a,b){this.RemoveValues(a,b),this.RemoveIndexes(a,b)},RemoveValue:function(a){this.RemoveValues(a,1)},RemoveValues:function(a,b){var d=g.call(this,a);for(0>d&&(d=0);d<this._list.length&&this._list[d].U<a;)d++;if(!(d>=this._list.length)){for(this._list[d].L<a&&(this._list.splice(d,0,new c(this._list[d].L,a-1,this._list[d].V)),d++),this._list[d].L=a+b,k.call(this,this._list[d],d)||d++;d<this._list.length&&this._list[d].U<a+b;)this._list.splice(d,1);d<this._list.length&&this._list[d].U>=a+b&&this._list[d].L<a+b&&(this._list[d].L=a+b,k.call(this,this._list[d],d))}}}),e}),define("system/jq.datagrid/datagridselecteditemscollection",["hd","hdmain/system","system/jq.datagrid/indextovaluetable"],function(a,b,c,d){function e(a){this.OwningGrid=a,this._selectedItemsTable=new c}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,null,{get:function(a){var b=this._selectedItemsTable.IndexOf(a);return this.OwningGrid.DataConnection.GetDataItem(b)},IsReadOnly:function(){return!1},Contains:function(a){if("number"==typeof a)return this.Contains_int(a);var b=this.OwningGrid.DataConnection.IndexOf(a);return-1==b?!1:this.Contains_int(b)},Contains_int:function(a){return this._selectedItemsTable.Contains(a)},IndexOf:function(a){var b,c=this.OwningGrid.DataConnection.IndexOf(a),d=0;if(-1==c)return-1;for(b in this._selectedItemsTable){if(b.U>=c)return b.L<=c?d+c-b.L:-1;d+=b.Count}return-1},Count:function(){return this._selectedItemsTable.IndexCount()},ClearRows:function(){for(var a in this._selectedItemsTable.GetIndexes())this.OwningGrid.OnRemovedSelectedItem(a);this._selectedItemsTable.Clear()},Delete:function(a,b){this.OwningGrid.OnRemovedSelectedItem(a,b),this._selectedItemsTable.RemoveIndex(a)},GetIndexes:function(){return this._selectedItemsTable.GetIndexes()},InsertIndexes:function(a,b){this._selectedItemsTable.InsertIndexes(a,b)},SelectRow:function(a,b){b?(this.OwningGrid.OnAddedSelectedItem(a),this._selectedItemsTable.AddValue(a,!0)):(this.OwningGrid.OnRemovedSelectedItem(a),this._selectedItemsTable.RemoveValue(a))}}),e}),define("system/jq.datagrid/datagridcolumncollection",["hd","hdmain/system","system/exception/argumentnullexception"],function(a,b,c,d){function e(a){this._owningGrid=a,this.ItemsInternal=[],this.CollectionChanged=[]}var f=b.Windows.Visibility;return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,null,{Count:function(){return this.ItemsInternal.length},Add:function(a){this.InsertItem(this.ItemsInternal.length,a)},get:function(a){return this.ItemsInternal[a]},FirstColumn:function(){return this.GetFirstColumn(null,null,null)},FirstVisibleColumn:function(){return this.GetFirstColumn(!0,null,null)},VisibleColumnCount:function(){var a,b=0;for(a=0;a<this.ItemsInternal.length;a++)this.ItemsInternal[a].Visibility()==f.Visible&&b++;return b},InsertItem:function(a,b){if(null==b)throw new c("dataGridColumn");var d,e,f=b.DisplayIndex();-1==f&&b.DisplayIndex(a);try{d=this._owningGrid.OnInsertingColumn(a,b)}finally{b._displayIndex=f}for(this._sortedColumns=null,this.ItemsInternal.splice(a,0,b),b.Index=a,b.OwningGrid=this._owningGrid,this._owningGrid.OnInsertedColumn_PreNotification(b),this._owningGrid.OnColumnCollectionChanged_PreNotification(!0),e=0;e<this.CollectionChanged.length;e++)this.CollectionChanged[e]();this._owningGrid.OnInsertedColumn_PostNotification(d)},GetFirstColumn:function(a,b,c){null==this._sortedColumns&&this.UpdateColumnOrderCache();for(var d,e=0;e<this._sortedColumns.length;){if(d=this._sortedColumns[e],!(null!=a&&d.Visibility()==f.Visible!=a||null!=c&&d.IsReadOnly()!=c)&&this._owningGrid.element.is(":visible"))return d;e++}return null},GetLastColumn:function(a,b,c){null==this._sortedColumns&&this.UpdateColumnOrderCache();for(var d,e=this._sortedColumns.length-1;e>=0;){if(d=this._sortedColumns[e],!(null!=a&&d.Visibility()==f.Visible!=a||null!=c&&d.IsReadOnly()!=c))return d;e--}return null},GetNextColumn:function(a,b,c,e){b===d&&(b=null,c=null,e=null),null==this._sortedColumns&&this.UpdateColumnOrderCache();var g,h,i,j=this.GetColumnSortedIndex(a);if(-1==j){for(g=!1,h=Int32.MaxValue,displayIndexMin=Int32.MaxValue,j=0;j<this.ItemsInternal.length;j++)i=this.ItemsInternal[j],(null==b||i.Visibility()==f.Visible==b)&&(null==e||i.IsReadOnly()==e)&&(i.DisplayIndex()>a.DisplayIndex()||i.DisplayIndex()==a.DisplayIndex()&&i.Index>a.Index)&&(i.DisplayIndex()<displayIndexMin||i.DisplayIndex()==displayIndexMin&&i.Index<h)&&(h=j,displayIndexMin=i.DisplayIndex,g=!0);return g?this.ItemsInternal[h]:null}for(j++;j<this._sortedColumns.length;){if(i=this._sortedColumns[j],!(null!=b&&i.Visibility()==f.Visible!=b||null!=e&&i.IsReadOnly()!=e))return i;j++}return null},GetNextVisibleColumn:function(a){return this.GetNextColumn(a,!0,null,null)},GetPreviousColumn:function(a,b,c,d){null==this._sortedColumns&&this.UpdateColumnOrderCache();var e,g,h,i=this.GetColumnSortedIndex(a);if(-1==i){for(e=!1,g=-1,displayIndexMax=-1,i=0;i<this.ItemsInternal.length;i++)h=this.ItemsInternal[i],(null==b||h.Visibility()==f.Visible==b)&&(null==d||h.IsReadOnly()==d)&&(h.DisplayIndex()<a.DisplayIndex||h.DisplayIndex()==a.DisplayIndex&&h.Index<a.Index)&&(h.DisplayIndex()>displayIndexMax||h.DisplayIndex()==displayIndexMax&&h.Index>g)&&(g=i,displayIndexMax=h.DisplayIndex,e=!0);return e?this.ItemsInternal[g]:null}for(i--;i>=0;){if(h=this._sortedColumns[i],!(null!=b&&h.Visibility()==f.Visible!=b||null!=d&&h.IsReadOnly()!=d))return h;i--}return null},GetPreviousVisibleColumn:function(a){return this.GetPreviousColumn(a,!0,null,null)},GetColumnSortedIndex:function(a){for(var b=0;b<this._sortedColumns.length;){if(a.Index==this._sortedColumns[b].Index)return b;b++}return-1},UpdateColumnOrderCache:function(){this._sortedColumns=this.ItemsInternal.slice(0)}}),e}),define("system/jq.datagrid/datagridrowheader",["hdmain/jq"],function(a){var b=a.proxy;return a.widget("hd.DataGridRowHeader",{_create:function(){a.Widget.prototype._create.apply(this,arguments),a("<div/>").addClass("hd-grid-arrow hd-img").appendTo(this.element),this.label=a("<div/>").addClass("hd-grid-rh-num").appendTo(this.element),this.element.addClass("hd-grid-rh").on("mousedown",b(function(a){if(1==a.which){var b=this.OwningGrid();
null!=b&&(null!=this.options.OwningRow&&b.UpdateStateOnMouseLeftButtonDown(a,-1,this.RowIndex())&&a.stopPropagation(),b.options.IsTabStop&&b.element.focus())}},this)),this.option(this.options)},_setOption:function(c,d){switch(a.Widget.prototype._setOption.apply(this,arguments),c){case"Content":d.PropertyChanged.push(b(function(a){switch(a.PropertyName){case"RowNumber":this.label.text(d[a.PropertyName]())}},this))}},OwningGrid:function(){return null==this.options.OwningRow?null:this.options.OwningRow.options.OwningGrid},RowIndex:function(){return null==this.options.OwningRow?-1:this.options.OwningRow.element.index()}}),a.hd.DataGridRowHeader}),define("system/jq.datagrid/datagridcelleventargs",["hd"],function(a,b){function c(a){this.Cell=a}return this.DEBUG===b&&(this.DEBUG=a.DEBUG),c}),define("system/jq.datagrid/datagridcell",["system/contentcontrol","hdmain/jq"],function(a,b){function c(a){null!=this.options.OwningRow&&this.OwningGrid().UpdateStateOnMouseLeftButtonDown(a,this.ColumnIndex(),this.RowIndex())&&a.stopPropagation()}return b.widget("hd.DataGridCell",a,{_create:function(){a.prototype._create.apply(this,arguments),this.element.addClass("hd-grid-cell hd-grid-line").on("mousedown",b.proxy(c,this))},ColumnIndex:function(){var a=this.options;return null==a.OwningColumn?-1:a.OwningColumn.Index},OwningGrid:function(){var a=this.options;return null!=a.OwningRow&&null!=a.OwningRow.options.OwningGrid?a.OwningRow.options.OwningGrid:null!=a.OwningColumn?a.OwningColumn.OwningGrid:null},RowIndex:function(){var a=this.options;return null==a.OwningRow?-1:a.OwningRow.element.index()}}),b.hd.DataGridCell}),define("system/jq.datagrid/datagridcellcollection",["hd","system/jq.datagrid/datagridcelleventargs","hdmain/system","system/jq.datagrid/datagridcell"],function(a,b,c,d,e){function f(a,b,c){this._owningRow=a,this._cells=[],this.CellAdded=b,this.CellRemoved=c}return this.DEBUG===e&&(this.DEBUG=a.DEBUG),c.ExtendClass(f,null,{IndexOf:function(a){return this._cells.indexOf(a)},Insert:function(a,c){c.DataGridCell({OwningRow:this._owningRow}),this._cells.splice(a,0,c),null!=this.CellAdded&&this.CellAdded(this,new b(c))},RemoveAt:function(a){var c=this._cells[a];this._cells.splice(a,1),c.DataGridCell({OwningRow:null}),null!=this.CellRemoved&&this.CellRemoved(this,new b(c))},get:function(a){return this._cells[a]},Clear:function(){this._cells=[]},Contains:function(a){return this._cells.indexOf(a)>-1},Count:function(){return this._cells.length},IsReadOnly:function(){return!1},Remove:function(a){var b,c=-1,d=this._cells.length;for(b=0;d>b;++b)if(this._cells[b]==a){c=b;break}return-1==c?!1:(this.RemoveAt(c),!0)}}),f}),define("system/jq.datagrid/datagridrow",["hdmain/jq","system/jq.datagrid/datagridrowheader","system/jq.datagrid/datagridcellcollection"],function(a,b,c){function d(a,b){null!=this._cellsElement&&b.Cell.appendTo(this._cellsElement)}function e(a,b){null!=this._cellsElement&&this._cellsElement.Children.Remove(b.Cell)}function f(a){null!=this.options.OwningGrid&&this.options.OwningGrid.UpdateStateOnMouseLeftButtonDown(a,-1,this.element.index())&&a.stopPropagation()}var g=a.proxy,h=a.Widget.prototype,i="DataGridRowHeader";return a.widget("hd.DataGridRow",{_create:function(){h._create.apply(this,arguments);var b=this.options;this.element.addClass("hd-grid-row").on("mousedown",g(f,this)),b.Cells=new c(this,g(d,this),g(e,this)),this._headerElement=a("<div/>").prependTo(this.element)[i]({OwningRow:this}),this._cellsElement=a("<div/>").addClass("hd-grid-row-cells").appendTo(this.element),this.option(b)},_setOption:function(a,b){switch(h._setOption.apply(this,arguments),a){case"Header":null!=this._headerElement&&this._headerElement[i]({Content:b});break;case"HeaderStyle":null!=b&&null!=this._headerElement&&this._headerElement[i]("option","Style")!=b&&this._headerElement[i]({Style:b})}}}),a.hd.DataGridRow}),define("system/jq.datagrid/datagrid",["hd","hdmain/jq","hdmain/system","system/control","system/jq.datagrid/datagridtemplatecolumn","system/jq.datagrid/datagridboundcolumn","system/jq.datagrid/datagridbeginningediteventargs","system/jq.datagrid/datagridpreparingcellforediteventargs","system/jq.datagrid/datagridroweventargs","system/jq.datagrid/datagridcellcoordinates","system/jq.datagrid/datagriddataconnection","system/jq.datagrid/datagridlength","system/jq.datagrid/datagridselecteditemscollection","system/jq.datagrid/datagridcolumncollection","system/jq.datagrid/datagridrow","system/jq.datagrid/datagridcell"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){var a,b,c=this.options,d=c.Columns;for(c.RowWidth=this.element.find(".hd-grid-left").outerWidth(),a=0;a<d.ItemsInternal.length;a++)b=d.ItemsInternal[a],b.Visibility()==U.Visible&&(c.RowWidth+=b.ActualWidth()+2);this.InvalidateColumnHeadersMeasure(),this.InvalidateRowsMeasure()}function s(a,b){return null===this._editingRow?!0:(a&&(this.DataConnection.EndEdit(this._editingRow[O]("option","DataContext")),b||this.DataConnection.BeginEdit(this._editingRow[O]("option","DataContext"))),b&&(this._editingRow=null),!0)}function t(a){return a>=this.ColumnsItemsInternal().length||0>a}function u(a,b){return t.call(this,a)||v.call(this,b)}function v(a){return a>=this.options.RowCount||-1>a}function w(a,b,c,d,f){var g,h,i,j,k,l,m,n,o=null,p=W(c,e);if(null!==p){if(a||p.CellTemplate!=p.CellEditingTemplate)g=null,b?(g=p.CellEditingTemplate,null===g&&(g=p.CellTemplate)):(g=p.CellTemplate,null===g&&(g=p.CellEditingTemplate)),o=g.LoadContent().attr("tabIndex",1);else if(b)return C.call(this,f.DataGridCell("option","Content")),void 0;if(h=d[O]("option","DataContext").Cells[c.Index],null!==g.Control.Bindings){h.PropertyChanged.push(L(function(a){var b,c;for(b=0;b<this.Bindings.length;b++)if(this.Bindings[b].Path==a.PropertyName){c=W(o,Q),null!==c&&c[this.Bindings[b].Property](h[this.Bindings[b].Path]());break}},g.Control));var q=function(){h[this.Path](!0)},r=function(){h[this.Path](!1)};for(i=0;i<g.Control.Bindings.length;i++){j=g.Control.Bindings[i];for(var s=0;s<h.PropertyChanged.length;s++)h.PropertyChanged[s]({PropertyName:j.Path});"IsChecked"==j.Property&&o.on("Checked",L(q,j)).on("Unchecked",L(r,j))}}if(l=f.DataGridCell("option","Content"),null!==l){if(n=null,m=W(l,"AnswerDatePicker"),null!==m)null!==h._editControl&&h.SaveAnswer(m.RawText()),n=m.RawText();else if(l.children("input").length>0)n=l.children("input").val();else if(null!==W(l,"MultChoiceComboBox")){var t=l.MultChoiceComboBox("SelectedItem");null!==t&&(n=t.Prompt())}else n=l.val();null!==n&&(null!==W(o,"MultChoiceEditableComboBoxControl")?o.children("input").val(n):o.val(n))}}else k=c,o=c.GenerateElement(f,d[O]("option","DataContext")),o.is("input")?f.css("text-align","center"):o.addClass("hd-ss-text"),null!==o&&null!==k&&null!==k.ElementStyle()&&null===o.Style&&(o.Style=k.ElementStyle());f.DataGridCell({Content:o}),b&&null!==o&&C.call(this,o)}function x(){var a=this.options;a.RowCount>0&&(D.call(this,-1,-1,!1),this.ClearRowSelection(!0),a.DisplayData=[],null!==this._rowsPresenter&&this._rowsPresenter.children().each(function(){var a=b(this);a.Visibility==U.Visible&&this.OnUnloadingRow(new i(a))}),this._rowsPresenter.children().empty()),a.RowCount=0}function y(a){var c,d,e,f,g,h,j,k,m,n,o,p,q,r,s,t=this.options,u=b("#hdMainDiv"),v=b("<div/>")[O]({RowHeaderStyle:t.RowHeaderStyle,OwningGrid:this,DataContext:this.DataConnection.GetDataItem(a)});if(f=v[O]("option","Cells").Count(),this.ColumnsItemsInternal().length>f)for(g=f;g<this.ColumnsItemsInternal().length;g++)j=this.ColumnsItemsInternal()[g],r=b("<div/>").DataGridCell(),w.call(this,!0,!1,j,v,r),null!==v[O]("option","OwningGrid")&&r.DataGridCell({OwningColumn:j,Visibility:j.Visibility()}),v[O]("option","Cells").Insert(j.Index,r);for(t.LoadingOrUnloadingRow=!0,this.element.trigger("LoadingRow",new i(v)),t.LoadingOrUnloadingRow=!1,c=v[O]("option","DataContext"),d=0;d<v[O]("option","Cells").Count();d++)try{if(h=v[O]("option","Cells").get(d),j=h.DataGridCell("option","OwningColumn"),k=W(h.DataGridCell("option","Content"),Q),s="function"==typeof j.Binding,s&&(m=j.Binding().Path,c.a[m]))for(e in k.options.Bindings)k._setOption(e,j.Binding().Converter.Convert(c.a[m]));(j.Width().IsAuto()||s)&&(p=j._headerCell.clone().appendTo(u),q=h.clone().hide().appendTo(u).css("width","auto"),q.children().css({display:"block",height:"auto",width:"auto"}),n=o=Math.max(j.Width().Value,p.width()),o=Math.max(o,q.outerWidth()),(o>n||1==j.Width().Value)&&(s?j.Width(new l(o)):j._headerCell.width(o)),p.remove(),q.remove()),h.width(j._headerCell.outerWidth())}catch(x){}return v}function z(a,b,c){try{if(!D.call(this,a,b))return!1;if(u.call(this,a,b))return!1;if(!this.GetRowSelection(b))if(c)G.call(this,b,!0),this._selectionChanged=!0;else{if(1==this.options.SelectedItems.Count()){var d=this.DataConnection.IndexOf(this.SelectedItem);if(d!=b)return!0}G.call(this,b,!0),this._selectionChanged=!0}}catch(e){}return!0}function A(a){return this.DataConnection.BeginEdit(a[O]("option","DataContext"))?(this._editingRow=a,!0):!1}function B(a){if(-1==this[M]()||!this.GetRowSelection(this.CurrentRowIndex()))return!1;var b,c,d,e=this.options;return-1!=e.EditingColumnIndex?!0:(b=this._editingRow,null===b&&(b=e.DisplayData[this.CurrentRowIndex()]),c=b[O]("option","Cells").get(this[M]()),d=new g(this.CurrentColumn(),b,a),this.element.trigger("BeginningEdit",d),d.Cancel?!1:null!==this._editingRow||A.call(this,b)?(e.EditingColumnIndex=this[M](),this._editingEventArgs=a,w.call(this,!1,!0,this.CurrentColumn(),b,c),!0):!1)}function C(a){if(-1!=this.options.EditingColumnIndex&&-1!=this[M]()&&this._editingRow[O]("option","Cells").get(this[M]()).children()[0]==a[0]){0===a.closest(".hd-grid-cell").prev().length&&this._rowsPresenter.scrollLeft(0),window.setTimeout(function(){document.activeElement!=a[0]&&a.find(document.activeElement).length<1&&a.focus()},100);var b=this.CurrentColumn();this.OnPreparingCellForEdit(new h(b,this._editingRow,this._editingEventArgs,a))}}function D(a,b,c){var d,e,f,g=this.options;if(c===q&&(c=!0),a==this[M]()&&b==this.CurrentRowIndex())return!0;if(e=null,f=new j(g.CurrentCellCoordinates),this[M]()>-1){if(!this._tmpReset&&(d=this.ContainsFocus,c)){if(!this.EndCellEdit(!0,!0,d))return!1;if(-1!=a&&-1!=b&&u.call(this,a,b)||u.call(this,f.C,f.R))return!1;if(f.R!=b&&!s.call(this,!0,!0))return!1}u.call(this,f.C,f.R)||(e=g.DisplayData[f.R])}return this[M](a),this.CurrentRowIndex(b),this._tmpReset&&-1!=a&&(this._tmpReset=!1),!this._tmpReset&&-1!=g.EditingColumnIndex&&(g.EditingColumnIndex=a),this.element.trigger("CurrentCellChanged"),!0}function E(a,b){var c,d=this.options,e=Math.max(0,a),f=Math.min(d.DisplayData.length-1,b);if(e>=0)for(c=e;f>=c;c++)d.DisplayData[c].toggleClass("hd-grid-row-alt",c%2===0)}function F(a,b){null!==this._rowsPresenter&&(b[O]("option","IsRecycled")?b[O]({Visibility:U.Visible}):this._rowsPresenter.children().length>=a+1?b.insertBefore(this._rowsPresenter.children().eq(a)):b.appendTo(this._rowsPresenter)),this.options.DisplayData.splice(a,0,b)}function G(a,b){var c,d=this.options;d.SelectedItems.SelectRow(a,b),c=d.DisplayData[a],c.addClass("hd-grid-selected").siblings().removeClass("hd-grid-selected")}function H(a){var c,d,f=this.options;this.ContainsFocus||(this._focusedRow=null,this.ContainsFocus=!0,c=b(a.target),c.length>0&&c[0]!=this.element[0]&&(d=this.GetOwningCell(c),null!==d&&d.options.OwningColumn instanceof e&&(this._editingTemplateControl=c)),E.call(this,0,f.DisplayData.length-1))}function I(){this.ContainsFocus&&(this.ContainsFocus=!1,E.call(this,0,this.options.DisplayData.length-1))}function J(a){var c=b(a.target),d=this.options,e=currentColumn=this.CurrentColumn(),f=currentRowIndex=d.CurrentCellCoordinates.R,g="text"==a.target.type?c.caret():null;switch(a.which){case 37:(null===g||0===g.start)&&(e=d.Columns.GetPreviousVisibleColumn(currentColumn));break;case 39:(null===g||g.end==c.val().length)&&(e=d.Columns.GetNextVisibleColumn(currentColumn));break;case 38:(null!==g||"checkbox"==a.target.type||d.IsReadOnly)&&currentRowIndex>0&&f--;break;case 40:(null!==g||d.IsReadOnly)&&currentRowIndex<d.RowCount-1&&f++}null!==e&&e!=currentColumn&&(d.DisplayData[currentRowIndex][O]("option","DataContext").SetCurrentCell(e.Index,!0,null),a.preventDefault()),f!=currentRowIndex&&(this.UpdateStateOnMouseLeftButtonDown(a,currentColumn?currentColumn.Index:-1,f),a.preventDefault())}function K(){var a=b("<div/>").css({display:"hidden",overflow:"scroll"}).appendTo(document.body),c=a[0].offsetHeight-a[0].clientHeight;return a.remove(),c}this.DEBUG===q&&(this.DEBUG=a.DEBUG);var L=b.proxy,M="CurrentColumnIndex",N="DataGrid",O=N+"Row",P="hd-grid",Q="FrameworkElement",R="AddedSelectedItems",S="RemovedSelectedItems",T="CommitFailedCannotCompleteOperation",U=c.Windows.Visibility,V=c.Windows.Controls.DataGridEditingUnit,W=c.Cast,X=K();return b.widget("hd.DataGrid",d,{options:{IsReadOnly:!1,RowCount:0,SelectedIndex:-1,AnchorRowIndex:-1,VerticalScrollBarVisibility:"auto",RowWidth:0,EditingColumnIndex:-1,MaxColumnWidth:1/0,MinColumnWidth:20},_create:function(){b.hd.Control.prototype._create.apply(this,arguments);var a,c=this.options;this._editingRow=null,this.element.attr("tabIndex",1).addClass(P).on("GotFocus",L(H,this)).on("LostFocus",L(I,this)).on("keydown",L(J,this)).on("LayoutUpdated",L(r,this)),this.DataConnection=new k(this),this.option({DisplayData:[],AddedSelectedItems:[],RemovedSelectedItems:[],Columns:new n(this),CurrentCellCoordinates:new j(-1,-1)}),a=b("<table/>").appendTo(this.element),b("<colgroup><col></col><col></col></colgroup>").appendTo(a),b('<tr class="hd-grid-header hd-grid-line"><td class="hd-grid-left hd-grid-line"/><td class="hd-grid-right"/></tr>').appendTo(a),b('<tr class="hd-grid-body"><td colspan="2"><div style="position:relative; overflow:hidden;"/></td></tr>').appendTo(a),this.chp=b("<div/>").appendTo(a.find(".hd-grid-header > .hd-grid-right")),this._rowsPresenter=b('<div style="overflow:scroll;"/>').appendTo(a.find(".hd-grid-body").children("td").children("div")).on("scroll",L(function(a){var c=b(a.target).scrollLeft();this.chp.css("left",-c),this.rowHdrs.css("left",c)},this)),this.option({ColumnWidth:l.Auto(),SelectedItems:new m(this)}),this.option(c)},_setOption:function(a,c){b.Widget.prototype._setOption.apply(this,arguments);var d,e,f,g=this.options;switch(a){case"ItemsSource":this.DataConnection.UnWireEvents(this.DataConnection.DataSource),this.DataConnection.DataSource=c,null!==c&&this.DataConnection.WireEvents(c),x.call(this),this.RefreshRows();break;case"Height":this._rowsPresenter.height(c+X),r.call(this);break;case"SelectedItem":if(e=null===c?-1:this.DataConnection.IndexOf(c),-1==e){if(!this.CommitEdit(V.Row,!0))throw T;this.ClearRowSelection(!0)}else{if(g.SelectedIndex=e,e!=this.CurrentRowIndex()){if(!this.CommitEdit(V.Row,!0))throw T;if(v.call(this,e))return}try{if(this.ClearRowSelection(e,!0),d=this[M](),-1==d&&(d=null===g.Columns.FirstVisibleColumn()?-1:g.Columns.FirstVisibleColumn().Index),-1==d||v.call(this,e))return;D.call(this,d,e)}catch(h){}}break;case"VerticalScrollBarVisibility":this._rowsPresenter.css({"overflow-y":c});break;case"ColumnWidth":r.call(this);break;case"IsReadOnly":if(c&&!this.CommitEdit(V.Row,!0))throw T;break;case"SelectedIndex":f=c,this._setOption("SelectedItem",0>f?null:this.DataConnection.GetDataItem(f))}},CurrentColumn:function(a){var b,c,d=this.options;if(a===q)return-1==this[M]()?null:d.Columns.get(this[M]());if(b=a,this.CurrentColumn()!=b){if(c=-1!=d.EditingColumnIndex,!this.EndCellEdit(!0,!0,this.ContainsFocus))throw T;D.call(this,b.Index,this.CurrentRowIndex()),c&&-1==d.EditingColumnIndex&&-1!=this.CurrentRowIndex()&&-1!=this[M]()&&this[M]()==b.Index&&b.OwningGrid==this&&B.call(this)}},ColumnsItemsInternal:function(){return this.options.Columns.ItemsInternal},CurrentColumnIndex:function(a){var b=this.options;return a===q?b.CurrentCellCoordinates.C:(b.CurrentCellCoordinates.C=a,void 0)},CurrentRowIndex:function(a){var b=this.options;return a===q?b.CurrentCellCoordinates.R:(b.CurrentCellCoordinates.R=a,a>=0?b.SelectedItem=this.DataConnection.GetDataItem(a):this._editingRow=null,void 0)},BeginEdit:function(a){return a===q&&(a=null),-1!=this[M]()&&this.GetRowSelection(this.CurrentRowIndex())?B.call(this,a):!1},CommitEdit:function(a,b){return this.EndCellEdit(!0,b,this.ContainsFocus)?a==V.Row?s.call(this,!0,b):!0:!1},OnPreparingCellForEdit:function(a){c.CallAsync(L(function(){this.element.trigger("PreparingCellForEdit",a)},this))},OnSelectionChanged:function(a){var b=null,c=-1,d=this.options;d.SelectedItems.Count()>0&&(b=d.SelectedItems.get(0)),d.SelectedItem=b,null!==b&&(c=this.DataConnection.IndexOf(b)),d.SelectedIndex=c,this._selectionChanged=!1,this.element.trigger("SelectionChanged",a)},OnUnloadingRow:function(a){var b=this.options;b.LoadingOrUnloadingRow=!0,this.element.trigger("UnloadingRow",a),b.LoadingOrUnloadingRow=!1},GetOwningCell:function(a){for(var b=W(a,"DataGridCell");null!==a&&a.length>0&&null===b;)a=a.parent(),b=W(a,"DataGridCell");return b},OnAddedSelectedItem:function(a){var b,c,d=this.DataConnection.GetDataItem(a),e=this.options;if(e[S].indexOf(d)>-1){for(b=[],c=0;c<e[S].length;c++)e[S][c]!=d&&b.push(e[S][c]);e[S]=b}else!e.SelectedItems.Contains(a)&&e[R].indexOf(d)<0&&e[R].push(d)},OnRemovedSelectedItem:function(a){var b,c,d=arguments.length>1?arguments[1]:this.DataConnection.GetDataItem(a),e=this.options;if(e[R].indexOf(d)>-1){for(b=[],c=0;c<e[R].length;c++)e[R][c]!=d&&b.push(e[R][c]);e[R]=b}else e.SelectedItems.Contains(a)&&e[S].indexOf(d)<0&&e[S].push(d)},ScrollIntoView:function(){},UpdateStateOnMouseLeftButtonDown:function(a,b,c){var d,e,f,g=this.options;if(e=-1!=g.EditingColumnIndex,this.CurrentRowIndex()!=c&&!this.CommitEdit(V.Row,!0))return!0;if(v.call(this,c))return!0;try{if(this.ClearRowSelection(c,!0),v.call(this,c)||-1!=b&&t.call(this,b))return!0;d=!g.IsReadOnly&&this.CurrentRowIndex()==c&&-1!=b&&(e||this[M]()==b),(this.CurrentRowIndex()!=c||this[M]()!=b&&-1!=b)&&(-1==b&&(-1!=this[M]()?b=this[M]():(f=g.Columns.FirstVisibleColumn(),null!==f&&(b=f.Index))),-1!=b&&D.call(this,b,c))}catch(h){}return d&&B.call(this,a),!0},InvalidateColumnHeadersMeasure:function(){var a=this.options.RowWidth;null!==this.chp&&this.chp.width(a)},InvalidateRowsMeasure:function(){if(null!==this._rowsPresenter){var a,c,d,e,f=this._rowsPresenter.parents(".hd-grid-body").children("td").outerWidth(),g=Math.max(this.options.RowWidth,f);this._rowsPresenter.children().each(function(){a=b(this),a.width(g),c=a.find(".hd-grid-cell"),c.each(function(){d=b(this),e=d.DataGridCell("option","OwningColumn").Width().Value,d.width(e)})})}},EndCellEdit:function(a,b){var c,d,e,g=this.options;if(-1==g.EditingColumnIndex||null===this._editingRow)return!0;if(c=this.CurrentRowIndex(),d=this[M](),c!=this.CurrentRowIndex()||d!=this[M]())return!0;if(b&&(g.EditingColumnIndex=-1,this._editingTemplateControl=null,this._setOption("IsTabStop",!0)),b||a){if(null===this._editingRow&&!1,e=this._editingRow[O]("option","Cells").get(this[M]()),null!==e){var h=W(e.find(".hd-input-mc.active"),"EditableComboBox");null!==h&&h._togglelist()}this.CurrentColumn()instanceof f||w.call(this,!1,!b,this.CurrentColumn(),this._editingRow,e)}return!0},OnColumnCollectionChanged_PreNotification:function(a){a&&1==this.ColumnsItemsInternal().length&&this.RefreshRows()},OnColumnWidthChanged:function(a){a._headerCell.width(a.Width().Value),a.Visibility()==U.Visible&&r.call(this)},OnInsertedColumn_PostNotification:function(a){-1!=a.C&&z.call(this,a.C,a.R,1==this.options.Columns.VisibleColumnCount())},OnInsertedColumn_PreNotification:function(a){(-1==a.DisplayIndex()||a.DisplayIndex()>=this.ColumnsItemsInternal().length)&&(a._displayIndex=a.Index),null!==this.chp&&(a.HeaderCell()[a.Visibility()==U.Visible?"show":"hide"](),a.HeaderCell().attr("Tag",a.DisplayIndex()).appendTo(this.chp),c.CallAsync(L(function(){this.options.ColumnHeaderLoaded&&this.options.ColumnHeaderLoaded(a.HeaderCell())},this))),a.Visibility()==U.Visible&&r.call(this)},OnInsertingColumn:function(a){var b;if(-1!=this.CurrentColumnIndex()){if(b=new j(a<=this.CurrentColumnIndex()?this.CurrentColumnIndex()+1:this.CurrentColumnIndex(),this.CurrentRowIndex()),-1!=this[M]()&&!D.call(this,-1,-1))throw T}else b=new j(-1,-1);return b},ClearRowSelection:function(a,b){var c,d,e,f,g,h=this.options;if(b===q){if(c=a,c&&(h.AnchorRowIndex=-1),h.SelectedItems.Count()>0)try{for(d=0;d<=h.DisplayData.length-1;d++)h.SelectedItems.Contains(d)&&G.call(this,d,!1);h.SelectedItems.ClearRows(),this._selectionChanged=!0}catch(i){}}else try{if(e=!1,h.SelectedItems.Count()>0){for(d=0;d<=h.DisplayData.length-1;d++)a!=d&&h.SelectedItems.Contains(d)&&(G.call(this,d,!1),this._selectionChanged=!0);e=h.SelectedItems.Contains(a),f=h.SelectedItems.Count(),f>0&&(f>1?this._selectionChanged=!0:(g=h.SelectedItems.GetIndexes()[0],g!=a&&(this._selectionChanged=!0)),h.SelectedItems.ClearRows())}e?(h.SelectedItems.SelectRow(a,!0),b&&(h.AnchorRowIndex=a)):this.SetRowSelection(a,!0,b)}catch(i){}},GetRowFromItem:function(a){var b=this.DataConnection.IndexOf(a);return 0>b?null:this.options.DisplayData[b]},GetRowSelection:function(a){return this.options.SelectedItems.Contains(a)},RefreshRows:function(){if(x.call(this),null!==this.DataConnection&&this.ColumnsItemsInternal().length>0)for(var a,b=this.DataConnection.Count(),c=0;b>c;)a=y.call(this,c),F.call(this,c,a,!0),this.options.RowCount++,this.OnRowsChanged(!0),c++},RemoveRowAt:function(a,b){var c=this.OnRemovingRow(a,b);this.options.RowCount--,this.OnRemovedRow(a,c),this.OnRowsChanged(!1)},SetRowSelection:function(a,b,c){var d,e=this.options;try{b&&e.SelectedItems.Count()>0&&(d=e.SelectedItems.GetIndexes()[0],d!=a&&(G.call(this,d,!1),this._selectionChanged=!0)),e.SelectedItems.Contains(a)!=b&&(G.call(this,a,b),this._selectionChanged=!0),c&&(e.AnchorRowIndex=a)}catch(f){}},InsertRow:function(a){var b,c={v:new j(-1,-1)},d=this.options;-1!=this.CurrentRowIndex()&&a<=this.CurrentRowIndex()?(c.v=new j(this.CurrentColumnIndex(),this.CurrentRowIndex()+1),this._tmpReset=!0,D.call(this,-1,-1)):c.v=new j(-1,-1),d.SelectedItems.InsertIndexes(a,1),a<=d.SelectedIndex&&(d.SelectedIndex+=1),b=y.call(this,a),b[O]({OwningGrid:this}),F.call(this,a,b,!0),d.RowCount++,-1!=c.v.R&&z.call(this,c.v.C,c.v.R,1==d.RowCount),E.call(this,a,a),this.OnRowsChanged(!0)},OnRemovedRow:function(a,b){var c=null,d=this.options;a<=d.DisplayData.length-1&&a>=0&&(c=d.DisplayData[a],this.OnUnloadingRow(new i(c)),c.detach(),d.DisplayData.splice(a,1)),-1!=b.R&&z.call(this,b.C,b.R,!1),this._selectionChanged&&(this.OnSelectionChanged({A:d[R],R:d[S]}),d[R]=[],d[S]=[])},OnRemovingRow:function(a,b){var c,d,e,f,g=this.options;return this._tmpReset=!1,c=new j(-1,-1),-1!=this.CurrentRowIndex()&&a<=this.CurrentRowIndex()&&(a==this.CurrentRowIndex()?(e=a-1,f=a==g.RowCount-1?-1:a+1,d=f>-1?f-1:e):d=this.CurrentRowIndex()-1,c=new j(this.CurrentColumnIndex(),d),a==this.CurrentRowIndex()?D.call(this,-1,-1,!1):(this._tmpReset=!0,D.call(this,-1,-1))),g.SelectedItems.Contains(a)&&(this._selectionChanged=!0),g.SelectedItems.Delete(a,b),a<g.SelectedIndex&&(g.SelectedIndex=g.SelectedIndex-1),c},OnRowsChanged:function(){var a=this.rowHdrs=this.element.find(".hd-grid-rh"),b=25+10*(a.length+"").length;a.outerWidth(b).css({"float":"left"}),this.element.find("col").eq(0).width(b-1),this.element.find(".hd-grid-row-cells").css({"margin-left":b,width:"auto"}),r.call(this)}}),b.hd.DataGrid}),define("dialog/answersourcewindow",["hd","hdmain/system","system/jquery.hd.childwindow","hdmain/jq","dialog/answersourcevalueconverter","system/jq.datagrid/datagridtextcolumn","system/jq.datagrid/datagridcheckboxcolumn","system/jq.datagrid/datagrid","dialog/stringformatter","engine/stringparsersource","engine/interviewnode","system/dictionary","dialog/dialogcontrol"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){this.DialogResult(!0)}function o(){this.DialogResult(!1)}function p(b){try{this._dslr=b,null!=b.Error?a.ExceptionAlert("err_datarequest",b.Error):(0==b.Rows.length&&b.Rows.push(new l),this[s][s]({ItemsSource:b.Rows,SelectedIndex:0}))}finally{}}function q(a){return a.preventDefault(),0==d(a.target).parents(".hd-grid-header").length&&this.DialogResult(!0),!1}var r=d.proxy,s="DataGrid",t=k.FixAmpersands;return d.widget("hd.AnswerSourceWindow",c,{_setOption:function(a){switch(c.prototype._setOption.apply(this,arguments),a){case"width":case"height":this.element.children().resize(),this[s]&&this[s].triggerHandler("LayoutUpdated")}},_create:function(){c.prototype._create.apply(this,arguments);var b=this.options.node;this[s]=d("<div/>").appendTo(this.element)[s]({CanUserSortColumns:!0,IsReadOnly:!0}),this._setOption("buttons",[{icons:{primary:"hd-img hd-selbtn"},click:r(n,this)},{text:t(a.Lc.GetStr("ui_cancel"),!1),icons:{primary:"hd-img hd-blank"},click:r(o,this)}]),this.element.siblings(".ui-dialog-buttonpane").find(".hd-selbtn").siblings().html(t(a.Lc.GetStr("ui_select"),!1)),this[s].on("mousedown",function(a){a.preventDefault()}).on("dblclick",r(q,this)),this._setOption("title",a.Lc.GetStr("ui_selectcaption")),this.DefineColumns(b.AnswerSourceColumns()),b.LoadDataSourceRows(r(p,this))},Show:function(){this.open();var a=this[s],b=a.width(),c=0,d=window.setInterval(function(){newGridWidth=a.width(),(c>5||newGridWidth==b&&0!=newGridWidth)&&window.clearInterval(d),newGridWidth!=b?(b=newGridWidth,c=0,a.triggerHandler("LayoutUpdated")):c++},50)},DefineColumns:function(a){var c,h,k=this[s],l=this.options.node;d.each(a,function(a,d){switch(c=null,d.DialogItem().type){case"TX":case"NU":case"DA":case"MC":c=new f;break;case"TF":c=new g;break;default:c=null}null!=c&&(b.String.IsNullOrEmpty(d.Prompt())?c.Header(t(d.DialogItem().name,!1)):(h=new b.Text.StringBuilder,m.DotCodeParser().Parse(new j(d.Prompt()),new i(h,b.Windows.TextWrapping.NoWrap)),c.Header(t(h.ToString(),!1))),c.Binding({Path:l.GetDataSourcePropertyName(d),Mode:b.Windows.Data.BindingMode.OneTime,Converter:new e}),k[s]("option","Columns").Add(c))})},SelectedRow:function(){return this[s][s]("option","SelectedItem")},MappedNodes:function(){return null!=this._dslr?this._dslr.Nodes:null}}),d.hd.AnswerSourceWindow}),define("system/textbox",["system/control","hdmain/jq"],function(a,b,c){return b.widget("hd.TextBox",a,{_create:function(){a.prototype._create.apply(this,arguments),this.option(this.options)},Text:function(a){return a===c?this.element.val():(this.element.val(a),void 0)},SelectionStart:function(a){return a===c?this.element.caret().start:(this.element.caret(a,a),void 0)}}),b.hd.TextBox}),define("dialog/answertextbox",["hdmain/jq","system/textbox"],function(a,b){var c=a.proxy;return a.widget("hd.AnswerTextBox",b,{options:{Style:"",IsReadOnly:!1,LineCount:1},_create:function(){b.prototype._create.apply(this,arguments),this.element.attr({tabIndex:1,spellcheck:!0}).on("keydown",c(this.OnKeyDown,this)).on("keyup",c(this._onKeyUp,this)),this.option(this.options)},_setOption:function(a,c){switch(a){case"Text":this.element.text(c);break;case"IsReadOnly":this.element.prop("disabled",c),c?this.element.removeAttr("autocapitalize"):this.element.attr("autocapitalize","off");break;case"BorderThickness":this.element.css("border-width",c);break;case"Background":this.element.css("background-color",c)}b.prototype._setOption.apply(this,arguments)},OnKeyDown:function(a){(33==a.which||34==a.which)&&this.element.trigger("NavigationKeyPress",a)},_onKeyUp:function(){var a=this.element.val();this.val!=a&&(this.val=a,this.element.trigger("TextChanged"))}}),a.hd.AnswerTextBox}),define("system/radiobutton",["hdmain/jq","system/jquery.hd.togglebutton"],function(a,b){return a.widget("hd.RadioButton",b,{}),a.hd.RadioButton}),define("dialog/childdialogcontrol",["hd","hdmain/system","system/control","hdmain/jq","system/checkbox","system/radiobutton","engine/answeredstatus"],function(a,b,c,d,e,f,g,h){function i(a){return this.OnNavigate(a),!1}function j(a){1==a.which&&(this.NavigateButton.attr("disabled")||this.NavigateButton.click())}function k(a,b){this._setOption(y,!0),this.element.trigger("Checked",b)}function l(a,b){this._setOption(y,!1),this.element.trigger("Unchecked",b)}this.DEBUG===h&&(this.DEBUG=a.DEBUG);var m=d.proxy,n=" hd-img",o="hd-dlg-a"+n,p=o+"-g",q="hd-dlg-p"+n,r=q+"-g",s="hd-dlg-u"+n,t=s+"-g",u="hd-child-btn",v="NavigateToChildCommand",w="IsButtonEnabled",x="AnsweredStatus",y="IsChecked",z="IsEnabled";return d.widget("hd.ChildDialogControl",c,{options:{IsEnabled:!0,GroupType:""},_create:function(){c.prototype._create.apply(this,arguments);var a=this.NavigateButton=d("<button/>").appendTo(this.element).addClass(u).click(m(i,this)),b=d("<div/>").appendTo(a).mouseup(m(j,this));this.AnswerStatusImage=d('<div class="hd-img"/>').appendTo(b),this.PromptText=d("<span/>").appendTo(b),this._setOption(x,g.Unanswered),this.option(this.options)},_setOption:function(a,e){switch(c.prototype._setOption.apply(this,arguments),a){case x:this.UpdateImage();break;case"GroupType":""==e?(this._toggleButton&&this._toggleButton.remove(),this._toggleButton=null):(this._toggleButton="S"==e?d('<input type="radio"/>').RadioButton({GroupName:b.Guid.NewGuid()}):d('<input type="checkbox"/>').CheckBox().on("Unchecked",m(l,this)),this._toggleButton.on("Checked",m(k,this)).prependTo(this.element));break;case y:null!=this._toggleButton&&this._toggleButton.prop("checked",e);break;case w:null!=this._toggleButton&&this._toggleButton.prop("disabled",!e);case z:this.NavigateButton.prop("disabled",!e),this.UpdateImage();break;case v:this.NavigateButton.on("click",e)}},IsChecked:function(a){return a===h?this.options[y]:(this._setOption(y,a),void 0)},IsButtonEnabled:function(a){return a===h?this.options[w]:(this._setOption(w,a),void 0)},NavigateToChildCommand:function(a){return a===h?this.options[v]:(this._setOption(v,a),void 0)},UpdateImage:function(){var a=this.options,b=this.AnswerStatusImage;a[x]==g.Answered?b.removeClass().addClass(a[z]?o:p):a[x]==g.PartiallyAnswered?b.removeClass().addClass(a[z]?q:r):b.removeClass().addClass(a[z]?s:t)},AnsweredStatus:function(a){return a===h?this.options[x]:(this._setOption(x,a),void 0)},OnNavigate:function(){this.element.trigger("NavigateToChild")},SetFocus:function(b){""!=this.options.GroupType&&null!=b&&b==a.GroupedChildOptionName?this._toggleButton.focus():this.NavigateButton.focus()}}),d.hd.ChildDialogControl}),define("dialog/command",{EraseAnswers:0,AddIteration:1,EditIteration:2,InsertIteration:3,DeleteIteration:4,MoveIterationUp:5,MoveIterationDown:6}),define("dialog/commandhandler",["hd","dialog/command"],function(a,b){return{IsRepeatCommandEnabled:function(a,c,d){var e=!1;switch(a){case b.AddIteration:e=c.AddingIterationsIsEnabled();break;case b.EditIteration:e=!0;break;case b.InsertIteration:e=c.AddingIterationsIsEnabled();break;case b.DeleteIteration:e=c.Children().get(d).DeleteIsEnabled();break;case b.MoveIterationUp:e=d>0&&c.UserExtendible();break;case b.MoveIterationDown:e=d<c.AnsweredIterationCount-1&&c.UserExtendible()}return e},GetRepeatCommandImage:function(a,c){var d="hd-";switch(a){case b.AddIteration:d+="adit";break;case b.EditIteration:c=!0,d+="sser";break;case b.InsertIteration:d+="ssir";break;case b.DeleteIteration:d+="ssdr";break;case b.MoveIterationUp:d+="mov-u";break;case b.MoveIterationDown:d+="mov-d"}return d+=" hd-img",c||(d+="-g"),d},ExecuteRepeatCommand:function(c,d,e){var f=a.Alert;switch(c){case b.AddIteration:d.AddIteration()||f(d.GetResourceString("err_cantadd"));break;case b.EditIteration:var g={s:null};d.EditIteration(e,g,function(a){a||f(g)});break;case b.InsertIteration:d.InsertIteration(e);break;case b.DeleteIteration:d.DeleteIteration(e);break;case b.MoveIterationUp:d.MoveIteration(e,e-1);break;case b.MoveIterationDown:d.MoveIteration(e,e+1)}}}}),define("system/jq.menu/menudivider",["hdmain/jq","system/jq.menu/basemenucontrol"],function(a,b){return a.widget("hd.MenuDivider",b,{_create:function(){b.prototype._create.apply(this,arguments),a("<hr/>").addClass("hd-menu-divider").appendTo(this.caption),this.icon.height(10),this.element.height(10)}}),a.hd.MenuDivider}),define("dialog/contextmenucontrol",["hd","dialog/commandhandler","hdmain/jq","dialog/command","system/jq.menu/menudivider","system/jq.menu/menuitem","system/jq.menu/menu","system/jquery.hd.popup","engine/interviewnodetype"],function(a,b,c,d,e,f,g,h,i){var j=c.proxy,k="ContextMenuControl";
return c.widget("hd."+k,{options:{node:null,ersAll:!1},_create:function(){this.InitializeComponent(),a.HDEngine.Host.on("resize",this.Content_Resized)},InitializeComponent:function(){this.Image=this.element,this.element.addClass("hd-img hd-dlg-btn hd-dlg-title-btn"),this.element.on("mousedown",j(this.Image_MouseLeftButtonDown,this))},Image_MouseLeftButtonDown:function(a){if(1==a.which){a.stopPropagation(),a.preventDefault();var b=this.options.node;if(c(".hd-menu").parent().Popup("close"),null!=b&&(this.options.ersAll||b.Type()==i.Iteration)){if(null==this._popup){var e=c("<div/>").Menu();if(e.on("ItemSelected",j(this.menu_ItemSelected,this)).on("SizeChanged",j(this.menu_SizeChanged,this)),this.options.ersAll&&c("<div/>").appendTo(e).MenuItem({Label:b.GetResourceString("hdmnuEraseAllAns"),Tag:d.EraseAnswers,IsEnabled:!0,IconImageSource:"hd-img hd-dlg-clr"}),b.Type()==i.Iteration){e.children().length>0&&c("<div/>").appendTo(e).MenuDivider();var f=b._parent,g=b.IterationNumber();this.CreateRepeatCommandMenuItem("hdmnuNewRep",d.AddIteration,f,g).appendTo(e),this.CreateRepeatCommandMenuItem("hdmnuInsRep",d.InsertIteration,f,g).appendTo(e),this.CreateRepeatCommandMenuItem("hdmnuDelRep",d.DeleteIteration,f,g).appendTo(e),c("<div/>").appendTo(e).MenuDivider(),this.CreateRepeatCommandMenuItem("hdmnuMoveUp",d.MoveIterationUp,f,g).appendTo(e),this.CreateRepeatCommandMenuItem("hdmnuMoveDn",d.MoveIterationDown,f,g).appendTo(e)}this._popup=c("<div/>").Popup({open:j(this.popup_Opened,this)}),this._popup.Popup("Empty"),e.appendTo(this._popup)}this._popup.Popup("open")}}},CreateRepeatCommandMenuItem:function(a,d,e,f){var g=b.IsRepeatCommandEnabled(d,e,f);return c("<div/>").MenuItem({Label:this.options.node.GetResourceString(a),Tag:d,IsEnabled:g,IconImageSource:b.GetRepeatCommandImage(d,g)})},UpdateContextMenuLayout:function(){if(null!=this._popup){var a=this.element.offset();this._popup.css({left:Math.max(0,a.left-this._popup.width()+this.Image.width()),top:a.top+this.Image.height()})}},menu_SizeChanged:function(){this.UpdateContextMenuLayout()},Content_Resized:function(){null!=this._popup&&this._popup.Popup("IsOpen")&&this.UpdateContextMenuLayout()},popup_Opened:function(){var a=this.options.node;null!=a&&a.Type()==i.Iteration,this.UpdateContextMenuLayout()},menu_ItemSelected:function(a,c){if(this._popup.Popup("close"),null!=this.options.node)switch(c){case d.EraseAnswers:this.options.node.ClearAnswers();break;case d.AddIteration:case d.InsertIteration:case d.DeleteIteration:case d.MoveIterationUp:case d.MoveIterationDown:b.ExecuteRepeatCommand(c,this.options.node._parent,this.options.node.IterationNumber())}},canvas_MouseLeftButtonDown:function(){this._popup.Popup("close")}}),c.hd[k]}),define("system/jquery.hd.button",["hdmain/system","hdmain/jq","dialog/hdnavbtntype"],function(a,b,c,d){var e=a.Windows.Visibility;return b.widget("hd.Button",{options:{type:c.TextOnly,icon:"hd-blank",Visibility:e.Visible},_create:function(){this.label=b("<span/>").addClass("hd-btn-text").html("&nbsp;").appendTo(this.element),this.icon=b("<div/>").appendTo(this.element),this.option(this.options)},_setOption:function(a,c){switch(b.Widget.prototype._setOption.apply(this,arguments),a){case"type":switch(c){case 0:this.icon.width(0);break;case 1:this.label.width(0);break;case 3:this.icon.css("float","right")}break;case"icon":this.icon.removeClass().addClass("hd-img "+c);break;case"label":1!=this.options.type&&this.label.html(c.replace("&","&amp;"));break;case"click":c&&this.element.on("click",c);break;case"image":c&&this.options.type>0&&(this.icon.addClass("hd-blank").css("width","auto"),b('<img src="'+this.options.image+'"/>').appendTo(this.icon));break;case"Visibility":this.element[c==e.Visible?"show":"hide"]()}},IsEnabled:function(a){return a===d?!this.element.prop("disabled"):(a?(this.element.prop("disabled",!1),this.icon.removeClass("hd-img-g").addClass("hd-img")):(this.element.prop("disabled",!0),this.icon.removeClass("hd-img").addClass("hd-img-g")),void 0)}}),b.hd.Button}),define("dialog/customnavigationbarbutton",["hdmain/system","system/jquery.hd.button","hdmain/jq","system/exception/argumentnullexception","engine/htmlformatter","dialog/hdnavbtntype"],function(a,b,c,d,e,f){function g(){this.CheckActive()}function h(){this.CheckActive()}function i(){this.CheckActive()}function j(){var a=this.options;return a.clickEnabledDel()&&a.clickedDel(a.id),!1}var k=c.proxy,l=a.String.IsNullOrEmpty,m="CustomNavigationbarButton";return c.widget("hd."+m,b,{options:{image:null,_showText:!0,_isTextOnly:!1,_origText:""},_create:function(){b.prototype._create.apply(this,arguments);var a=null,c=null;if("function"!=typeof this.options.clickEnabledDel)throw new d("clickEnabledDel");if("function"!=typeof this.options.clickedDel)throw new d("clickedDel");this.Name=this.options.id,this.options.type!=f.TextOnly&&!l(this.options.icon)&&(this._normalBitmapImage=this.GetCustomButtonImageSource(this.options.icon)),this._textblock=null,this.options.type!=f.TextOnly&&null!=this._normalBitmapImage&&(a=this._normalBitmapImage),this.options.type!=f.ImageOnly&&!l(this.options.label)&&(c=this.element.children(".hd-btn-text")),null!=a&&null!=c?(this._textblock=c,this.options._origText=c.text()):null==a&&null!=c&&(this._textblock=c,this.options._isTextOnly=!0,this.options._origText=c.text()),this.element.on("mouseenter",k(g,this)).on("mouseleave",k(h,this)).on("click",k(i,this)),this._setOption("click",k(j,this)),this.CheckActive()},_setOption:function(c,d){switch(b.prototype._setOption.apply(this,arguments),c){case"tip":l(d)||a.Windows.Controls.ToolTipService.SetToolTip(this.element,d)}},GetCustomButtonImageSource:function(a){return e.MakeAbsoluteUrl(a,!1)},CheckActive:function(){var a=this.options,b=c.Deferred();return null==a.activeDel?(this.element.prop("disabled",!1),b.resolve()):a.activeDel(a.id,k(function(a){this.element.prop("disabled",!a).children(".hd-blank").toggleClass("hd-img",a).toggleClass("hd-img-g",!a),b.resolve()},this)),b},IsToggleButton:function(){return null!=this.options.activeDel},Separator:function(){return this.options.sep},ShowText:function(a){var b=this.options;return"undefined"==typeof a?b._showText:(b._showText!=a&&(null!=this._textblock&&(b._isTextOnly?this._textblock.text(a?b._origText:b._origText.substr(0,1)):this._textblock.html(a?b._origText:"&nbsp;").width(a?"auto":0)),this._setOption("_showText",a)),void 0)}}),c.hd[m]}),define("engine/titleparsersource",["hdmain/system","engine/interviewnodetype","engine/iterationnode","engine/repeatindices"],function(a,b,c,d){function e(a){this._interviewNode=a}var f=a.Cast,g=a.String.Format,h=a.String.IsNullOrEmpty;return a.ExtendClass(e,null,{SourceString:function(){var a,e,i,j=null;return this._interviewNode._parent.Type()==b.Iteration&&f(this._interviewNode._parent,c).IsSpreadsheetRowInSpreadsheet()?j=f(this._interviewNode._parent,c):this._interviewNode.Type()==b.Iteration&&(j=f(this._interviewNode,c)),a=this._interviewNode.Title(),null!=j?(e=this._interviewNode._dialog.name,i=j.New()?g("{0}: {1}",this._interviewNode.GetResourceString("ui_new"),h(a)?e:a):g("{0}{1}",d.ToPrefixString(this._interviewNode.Indices()),h(a)?e:a)):i=h(a)?this._interviewNode.Variable().name:a,i}}),e}),define("dialog/dialogcaptioncontrol",["hd","hdmain/system","hdmain/jq","dialog/stringformatter","engine/titleparsersource","engine/dialogupdateflags","dialog/dialogcontrol","engine/interviewnode"],function(a,b,c,d,e,f,g,h){return c.widget("hd.DialogCaptionControl",{_create:function(){this._interviewNode=this.options.node;var a=c('<td colspan="6" class="hd-dlg-title"/>').appendTo(this.element);this.ContextMenu=c("<div/>").appendTo(a).attr("title",this._interviewNode.GetResourceString("ui_mnutt")).ContextMenuControl({node:this._interviewNode,ersAll:!0}),this.ResourceImage=c("<div class='hd-img hd-rsrc hd-dlg-title-btn' />").appendTo(a).hide().attr("title",this._interviewNode.GetResourceButtonCaption()),this.LayoutRoot=c('<div id="hdDlgTitle"/>').appendTo(a),this.CaptionDiv=c("<div class='DlgTitle'/>").appendTo(this.LayoutRoot),this.CaptionText=c("<div style='width:0px'/>").appendTo(this.CaptionDiv),null!=this._interviewNode._dialog.rsrc&&(this.ResourceImage.show().css("visibility","visible").mouseup(this,this.ResourceImage_MouseLeftButtonUp),this.LayoutRoot.css("margin-right","45px"))},Update:function(a){if(a||(this._interviewNode.UpdateFlags()&f.Title)==f.Title){var c=new b.Text.StringBuilder;g.DotCodeParser().Parse(new e(this._interviewNode),new d(c,b.Windows.TextWrapping.NoWrap)),c=c.ToString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),c=h.FixAmpersands(c,!1),this.CaptionText.html(c+"&nbsp;")}},ResourceImage_MouseLeftButtonUp:function(a){if(1==a.which){var c,d=a.data;null!=d._interviewNode._dialog.rsrc&&(c=new b.Text.StringBuilder,g.AppendResource(c,d._interviewNode._dialog.rsrc,d._interviewNode,d._interviewNode._dialog,null),g.DisplayResourceWindow(c.ToString()))}}}),c.hd.DialogCaptionControl}),define("dialog/dialogerrorcontrol",["hdmain/system","hdmain/jq","engine/stringparsersource","engine/dotcodeparser","engine/htmlformatter","engine/dialogupdateflags"],function(a,b,c,d,e,f){return b.widget("hd.DialogErrorControl",{_create:function(){var a=b('<td colspan="6"/>').appendTo(this.element);this.LayoutRoot=b('<div class="hd-dialog-error"><div class="hd-img hd-error-32"/></div>').appendTo(a).hide(),this.ErrorDiv=b('<div class="hd-dialog-error-text"/>').appendTo(this.LayoutRoot),this.option(this.options)},Update:function(b){var g=this.options.node.ErrorText,h=!1;if(!b&&(h=(this.options.node.UpdateFlags()&f.HasError)==f.HasError,!h))for(var i=0;i<this.options.node._children._list.length;i++)if(this.options.node._children._list[i].UpdateFlags()&f.HasError==f.HasError){h=!0;break}if(b||h){if(a.String.IsNullOrEmpty(g))for(var i=0;i<this.options.node._children._list.length&&!this.options.node._children._list[i].IsHiddenNew()&&(g=this.options.node._children._list[i].ErrorText,a.String.IsNullOrEmpty(g));i++);if(a.String.IsNullOrEmpty(g))this.ErrorDiv.empty(),this.LayoutRoot.hide();else{var j=new a.Text.StringBuilder,k=new d;k.Parse(new c(g),new e(j)),this.ErrorDiv.html(j.ToString()),this.LayoutRoot.show()}}}}),b.hd.DialogErrorControl}),define("dialog/textblockformatter",["hdmain/system","hdmain/jq","engine/pairedcode"],function(a,b,c){function d(a,b,c){this._textBlock=a,this._fontSize=0>=b?12:b,this._required=c}return a.ExtendClass(d,null,{PreParse:function(a){this._textBlock.text(""),this._required&&this.WriteText(a,"*")},PostParse:function(){},WriteText:function(a,d){var e=b("<span/>"),f=parseFloat(this._fontSize);a.IsCodeEnabled(c.b)&&e.css("font-weight","bold"),a.IsCodeEnabled(c.i)&&e.css("font-style","italic"),a.IsCodeEnabled(c.un)&&e.css("text-decoration","underline"),a.IsCodeEnabled(c.sc)&&(f*=.75),a.IsCodeEnabled(c.fs)&&(f=a.ChangeFontSize(f)),e.css("font-size",f),e.html(d),this._textBlock.append(e)},WriteLineBreak:function(){this._textBlock.append("<br/>")},WriteWebLink:function(a,b,c){this._textBlock.append(c)}}),d}),define("dialog/idialogitemnodecontrol",["hdmain/jq"],function(a){return a.widget("hd.IDialogItemNodeControl",{DialogItemNode:function(){}}),a.hd.IDialogItemNodeControl}),define("dialog/textmetrics",["hdmain/system","hdmain/jq"],function(a,b,c){function d(){}var e={},f=document.documentMode,g="number"==typeof f&&9>f;return a.ExtendClass(d,null,{GetTextWidth:function(a){var b=e[a];return b==c&&(g?b=Math.ceil(6.7*a.length):(this._textBlock.text(a),b=e[a]=this._textBlock.outerWidth()),e[a]=b),b}}),d}),define("dialog/controlmetrics",["hdmain/system","hdmain/jq","dialog/textmetrics"],function(a,b,c){function d(a){this._textBlock=b('<span class="hd-input">5</span>').hide().appendTo("#hdMainDiv").css({"font-family":a.css("font-family"),"font-size":a.css("font-size"),"font-style":a.css("font-style"),"font-weight":a.css("font-weight")}),this.QuixelFactor=this._textBlock.width(),this.LineHeight=this._textBlock.height()}return a.ExtendClass(d,c),d}),define("engine/setanswerresult",{AnswerWasSet:0,InvalidAnswer:1,OutOfRange:2}),define("dialog/resourceupdateeventargs",["hdmain/system"],function(a){function b(a,b){this.DialogItemNode=a,this.OptionName=b}return a.ExtendClass(b,null,{Equals:function(c){var d=a.Cast(c,b);return null!=d?d.DialogItemNode==this.DialogItemNode&&d.OptionName==this.OptionName:!1}}),b}),define("dialog/promptparsersource",["hd","hdmain/system","engine/interviewnode","runtime/variable"],function(a,b,c,d){function e(a){this._dialogItemNode=a}var f="HDRequired",g="HDMarked",h="GrayText";return b.ExtendClass(e,null,{SourceString:function(){return b.String.IsNullOrEmpty(this._dialogItemNode.Prompt())?this._dialogItemNode.DialogItem()instanceof d?c.FixAmpersands(this._dialogItemNode.DialogItem().name,!1):"":c.FixAmpersands(this._dialogItemNode.Prompt(),!1)},TextColor:function(){return this._dialogItemNode.Gray()?h:this._dialogItemNode.Required()&&!this._dialogItemNode.IsAnswered()?f:this._dialogItemNode.Marked()?g:""},Required:function(){return this._dialogItemNode.Required()&&a.RequiredAsterisk}}),e}),define("dialog/inputcontrol",["hd","hdmain/jq","hdmain/system","system/jquery.hd.popup","dialog/tracehelper","engine/htmlformatter","engine/dialogupdateflags","dialog/idialogitemnodecontrol","dialog/resourceupdateeventargs","dialog/promptparsersource","dialog/dialogcontrol"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a){this.ClearAnswer(),a.preventDefault()}function m(){var a=k.GetResourceText(this._dialogItemNode,this.ResourceOptionName(),!1);k.DisplayResourceWindow(a)}var n,o,p=b.proxy,q=c.String.Format,r=c.Windows.Controls.ToolTipService.SetToolTip,s=c.Windows.Visibility,t="InputControl",u="UpdateResourceAndClearAnswerButtons",v="IsSetByDialogScript",w="IsReadOnly",x="IsGray";return function(){var a=b("<span>5</span>").hide().appendTo("body");n=a.width(),a.remove()}(),b.widget("hd."+t,h,{_create:function(){"undefined"==typeof o&&(o=new c.Text.StringBuilder),this.LayoutRoot=b("<div/>").appendTo(this.element),this.ControlGrid=b("<table/>").appendTo(this.LayoutRoot),this.ControlRow=b("<tr/>").appendTo(this.ControlGrid),this.ControlCell=b("<td/>").appendTo(this.ControlRow),this._calculatedWidth=0,this.InputControlButtons=[b('<td class="hd-cell-button"/>').appendTo(this.ControlRow),b('<td class="hd-cell-button"/>').appendTo(this.ControlRow)],this.ResourceImage=b('<div class="hd-rsrc" name="HDRsrcBtn"/>').appendTo(this.InputControlButtons[0]),this.ClearAnswerImage=b('<div class="hd-img hd-clr-ans"/>').css("visibility","hidden").appendTo(this.InputControlButtons[1]),this.ValidationError=b("<div/>").ValidationErrorControl().appendTo(this.LayoutRoot),this._dialogItemNode=this.options.node,this._prompt=b("<div/>"),this.PositionPrompt("T"==this.PromptPosition()?"T":"L"),this.element.on("GotFocus."+t,p(this.InputControl_GotFocus,this)).on("blur."+t,"input, textarea",p(this.InputControl_LostFocus,this)).on("mouseenter."+t,p(this.InputControl_MouseEnter,this)).on("mouseleave."+t,p(this.InputControl_MouseLeave,this)).on("Loaded."+t,p(this.InputControl_Loaded,this)).on("keydown."+t,p(this.OnKeyDown,this)),this._dialogItemNode.FocusEntering.unshift(p(this._dialogItemNode_FocusEntering,this)),this._dialogItemNode.FocusLeaving.unshift(p(this._dialogItemNode_FocusLeaving,this)),this._dialogItemNode.AnswerSync.unshift(p(this._dialogItemNode_AnswerSync,this))},_setOption:function(a,c){var d=this.options;switch(a){case"IsEnabled":d[a]=c,d.IsEnabledChanged&&d.IsEnabledChanged();break;case"Visibility":this.element.children()[c==s.Collapsed?"hide":"show"]();break;case"ResourceVisibility":c==s.Collapsed&&this.InputControlButtons[0].insertAfter(this.InputControlButtons[1]);break;case x:c!=d._isGray&&(this._setOption("IsEnabled",!c),this.IsResourceEnabled(!c),d._isGray=c);break;case w:c!=this._isReadOnly&&(this._isReadOnly=c);break;case v:c!=this._isSetByDialogScript&&(this._setOption("IsEnabled",!c),this._isSetByDialogScript=c);break;case"ClearAnswerVisibility":d.ClearAnswerVisibility!=c&&(c==s.Visible?this.ClearAnswerImage.css("visibility","visible").on("click",p(l,this)):this.ClearAnswerImage.css("visibility","hidden").off("click",l))}b.hd.IDialogItemNodeControl.prototype._setOption.apply(this,arguments)},OnKeyDown:function(a){13==a.which&&this.element.find("input").length>0&&a.preventDefault()},UpdateResourceButton:function(){this.DisplayResource()&&this.HasResource()?(this.option({ResourceVisibility:s.Visible}),this.ResourceImage.css("visibility",this._dialogItemNode.ShowAllResourceButtons()||this.options._isMouseOver||this.options._hasFocus?"visible":"hidden")):this.option({ResourceVisibility:s.Collapsed})},UpdateClearAnswerButton:function(){this.DisplayClearAnswer()?(this._setOption("ClearAnswerVisibility",s.Visible),this.ClearAnswerImage.css("visibility",this.options._isMouseOver||this.options._hasFocus?"visible":"hidden")):this._setOption("ClearAnswerVisibility",s.Collapsed)},UpdateResourceAndClearAnswerButtons:function(){this.UpdateResourceButton(),this.UpdateClearAnswerButton()},InputControl_MouseEnter:function(){this.options._isMouseOver=!0,this[u]()},InputControl_MouseLeave:function(){this.options._isMouseOver=!1,this[u]()},InputControl_Loaded:function(){this.element.on("focus","input, textarea",p(function(){this.element.closest(".hd-cell-input").trigger("GotFocus")},this)),this.UpdateControlWidth(),this[u](),this.IsResourceEnabled(this.DisplayResource()&&this.HasResource()&&!this._dialogItemNode.Gray()),r(this.ClearAnswerImage,this.GetResourceString("hdmnuClearAns")),r(this.ResourceImage,this._dialogItemNode._parent.GetResourceButtonCaption()),r(this.ValidationError.children("div"),this.GetResourceString("ui_err"))},PositionPrompt:function(a){"T"==a?(this._prompt.css({position:"inherit",width:"auto","text-align":"left"}).prependTo(this.LayoutRoot),this._promptCell&&this._promptCell.remove()):(this._prompt.width(this.PromptMaxWidth()),this._promptCell=b("<td/>").prependTo(this.ControlCell.parent()),this._prompt.appendTo(this._promptCell).css("text-align",this.Dialog().prmtAlgn?"left":"right")),this.options._resolvedPromptPosition=a},_prompt_LayoutUpdated:function(){var a=this.PromptPosition();"A"==a&&(a=this._prompt.height()>16?"T":"L"),a!=this.options._resolvedPromptPosition&&this.PositionPrompt(a)},Update:function(a){var b,c=this._dialogItemNode.UpdateFlags(),d=p(this._setOption,this);(a||(c&g.Hidden)==g.Hidden)&&d("Visibility",this._dialogItemNode.Hidden()?s.Collapsed:s.Visible),(a||(this._dialogItemNode.UpdateFlags()&g.ScriptAnswer)==g.ScriptAnswer)&&this.SetControlAnswer(),(a||0!=(c&(g.Gray|g.set)))&&(this._dialogItemNode.Gray()?(d(v,!1),d(w,!1),d(x,!0)):this._dialogItemNode.SetByDialogScript()?(d(x,!1),d(w,!1),d(v,!0)):this._dialogItemNode.ReadOnly()?(d(x,!1),d(v,!1),d(w,!0)):(d(x,!1),d(v,!1),d(w,!1)),(a||(c&g.Gray)==g.Gray)&&(c|=g.Prompt)),(a||0!=(c&(g.Required|g.RequiredAnswer)))&&(c|=g.Prompt),this.DisplayPrompt()?(this._prompt.show(),(a||(c&g.Prompt)==g.Prompt)&&(b=new j(this._dialogItemNode),o.Clear(),b.Required()&&o.Append("*"),k.DotCodeParser().Parse(b,new f(o),!0),this._prompt.html(o.ToString()).removeClass().addClass("hd-input-prompt "+b.TextColor()),"A"==this.PromptPosition()&&"L"!=this.options._resolvedPromptPosition&&this.PositionPrompt("L"),this._prompt_LayoutUpdated())):this._prompt.hide()},FireNavigationKeyPress:function(a){this.element.trigger("NavigationKeyPress",a)},FireResourceUpdate:function(){this.DisplayResource()&&this.element.trigger("ResourceUpdate",new i(this._dialogItemNode,this.ResourceOptionName()))},DialogItemNode:function(){return this._dialogItemNode},Dialog:function(){return this._dialogItemNode._parent._dialog},Variable:function(){return this._dialogItemNode.DialogItem()},GetResourceString:function(a){return this._dialogItemNode._parent.GetResourceString(a)},DisplayPrompt:function(){return"NONE"!=this._dialogItemNode.Prompt()},PromptPosition:function(){return 100!=this._dialogItemNode.GetWidth()?"T":this.Dialog().prmtPos},PromptMaxWidth:function(){return this.Dialog().maxPWid*n},PromptVerticalAlignment:function(){return a.VerticalAlignment.Top},DisplayClearAnswer:function(){return!this._dialogItemNode.ReadOnly()&&!this._dialogItemNode.Gray()&&!this._dialogItemNode.SetByDialogScript()},DisplayResource:function(){return!0},HasResource:function(){return null!=this._dialogItemNode.Resource()},ResourceOptionName:function(){return null},FieldWidth:function(){return this.Variable().fldWT},FieldWidthValue:function(){return this.Variable().fldWid},ExactWidth:function(){return this.FieldWidthValue()*this.QuixelFactor()+.75*this.QuixelFactor()},UpdateControlWidth:function(){var a,b,c=this.FieldWidth();"F"!=c?(a="E"==c,b=a?this.ExactWidth():this.CalculatedWidth(),this.ControlCell.width(b).addClass("hd-width-"+(a?"exact":"calc")).attr("hdwidth",b).closest("table").css("width","auto")):(this.ControlGrid.css("width","100%"),this.ControlCell.css("width","100%"))},ControlWidth:function(a){return a.outerWidth()-a.width()},ShowBorderEnabled:function(a,b){a.toggleClass("hd-input-box-disabled",!b)},IsResourceEnabled:function(a){var b=this.ResourceImage;return"boolean"!=typeof a?b.hasClass("hd-img"):((a&&!b.hasClass("hd-img")||!a&&!b.hasClass("hd-img-g"))&&(a?b.addClass("hd-img").removeClass("hd-img-g").on("click."+t,p(m,this)):b.addClass("hd-img-g").removeClass("hd-img").off("click",m)),void 0)},ClearAnswer:function(){this._dialogItemNode.ClearAnswer()},Dispose:function(a){"boolean"!=typeof a&&(a=!0),a&&(this.element.off("GotFocus."+t,this.InputControl_GotFocus).off("LostFocus."+t,this.InputControl_LostFocus),this._dialogItemNode.FocusEntering.pop(),this._dialogItemNode.FocusLeaving.pop(),this._dialogItemNode.AnswerSync.pop())},_dialogItemNode_FocusEntering:function(a,b){e.Focus(this._dialogItemNode,q("FocusEntering({0})",b.OptionName)),this.SetFocus(b.OptionName),this.options._hasFocus=!0,this[u](),this.FireResourceUpdate()},_dialogItemNode_FocusLeaving:function(){e.Focus(this._dialogItemNode,"FocusLeaving"),this.options._hasFocus=!1,this[u]()},_dialogItemNode_AnswerSync:function(){e.Focus(this._dialogItemNode,"AnswerSync"),this._dialogItemNode.ReadOnly()||this.SaveControlAnswer()},FocusOptionName:function(){return""},InputControl_GotFocus:function(){b(".hd-menu").parent().Popup("close");var a,d,f=this.FocusOptionName();for(e.Focus(this._dialogItemNode,q("GotFocus({0})",f)),this._dialogItemNode.SetFocus(f),a=this.element;null!=a&&a.length>0&&null==c.Cast(a,"DialogControl");)a=a.parent();null!=a&&a.length>0&&(d=c.Cast(a,"DialogControl"),d.ScrollFocusIntoView()),this.options._hasFocus=!0,this[u](),this.FireResourceUpdate()},InputControl_LostFocus:function(){this.options._hasFocus=!1,this[u]()}}),b.hd[t]}),define("dialog/dateinputcontrol",["hd","hdmain/jq","hdmain/system","dialog/controlmetrics","engine/setanswerresult","dialog/inputcontrol"],function(a,b,c,d,e,f,g){this.DEBUG===g&&(this.DEBUG=a.DEBUG);var h="DateInputControl",i="AnswerDatePicker",j="<div/>",k="<input/>",l=b.proxy,m=f.prototype,n="hd-input-date",o=n+"-readonly",p=new d(b(k).addClass(n)),q=new d(b(k).addClass(o));return b.widget("hd."+h,f,{_create:function(){m._create.apply(this,arguments);var a=this._dialogItemNode;this.element.attr("widget",h),this.s_calculatedWidth=0,a.ReadOnly()?(this._dateControl=b(j).AnswerTextBox({Style:o}),this._textMetrics=q):(this._dateControl=b(j)[i]({Style:n}),this._textMetrics=p,a.ChangeErrorState.push(l(this._dialogItemNode_ChangeErrorState,this)),a.AnswerReformatted.push(l(this._dialogItemNode_AnswerReformatted,this))),this._dateControl.appendTo(this.ControlCell)},_setOption:function(c,d){var e,f,g;switch(c){case"IsEnabled":this._dateControl[i]({IsEnabled:d});break;case"IsReadOnly":d!=this._isReadOnly&&(d&&(e=b(j).appendTo(this.ControlCell).AnswerTextBox({Text:this._dateControl.data("hd-"+i)?this._dateControl[i]("RawText"):this._dateControl.text(),Style:o}),this._dateControl.remove(),e.appendTo(this.ControlCell),this._dateControl=e),this._isReadOnly=d);break;case"IsSetByDialogScript":d!=this._isSetByDialogScript&&(g=this._dateControl.data("hd-"+i)?this._dateControl[i]("DisplayDate"):new Date(this._dateControl.text()),this._dateControl.remove(),d?(e=b(j).appendTo(this.ControlCell).AnswerTextBox({Text:""==g?g:a.Lc.FormatDate(g.getDate(),g.getMonth()+1,g.getFullYear()),IsReadOnly:!0,BorderThickness:0}),this._dateControl=e):(f=b(j).appendTo(this.ControlCell)[i]({SelectedDate:isNaN(g)?null:g,Style:n}),this._dateControl=f),this._isSetByDialogScript=d)}m._setOption.apply(this,arguments)},Dispose:function(a){"boolean"!=typeof a&&(a=!0),m.Dispose.call(this,a),a&&!this._dialogItemNode.ReadOnly()&&(this._dialogItemNode.ChangeErrorState.pop(),this._dialogItemNode.AnswerReformatted.pop())},PromptVerticalAlignment:function(){return"C"},QuixelFactor:function(){return this._textMetrics.QuixelFactor},CalculatedWidth:function(){if(0==this.s_calculatedWidth){var a,b=0;for(a=0;12>a;a++)b=Math.max(b,this._textMetrics.GetTextWidth(new Date(2008,a,25).toLocaleDateString()));this._dateControl.data("hd-"+i)&&(b+=29),this.s_calculatedWidth=b}return this.s_calculatedWidth},SetControlAnswer:function(){var a=this._dateControl;null!=a?(a[i]({SelectedDate:this._dialogItemNode.DateAnswer()}),null==this._dialogItemNode.DateAnswer()&&a[i]("RawText","")):this._dateControl.text(this._dialogItemNode.DateAnswer().HasValue?this._dialogItemNode.DateAnswer.Value.ToShortDateString():"")},SetFocus:function(){var a=c.Cast(this._dateControl,i);null!=a&&a.SetFocus()},SaveControlAnswer:function(){var a,b=this._dateControl;null!=b&&(a={s:null},this._dialogItemNode.SetAnswerString(b[i]("RawText"),a)!=e.AnswerWasSet)},_dialogItemNode_ChangeErrorState:function(a,b){this.ValidationError.ValidationErrorControl({Text:b.ErrorMessage,Visibility:b.IsError})},_dialogItemNode_AnswerReformatted:function(){var a=this._dateControl;null!=a&&a[i]({SelectedDate:this._dialogItemNode.DateAnswer()})}}),b.hd[h]}),define("dialog/iinterviewnodecontrol",["hdmain/jq"],function(a){return a.widget("hd.IInterviewNodeControl",{}),a.hd.IInterviewNodeControl}),define("dialog/dialoginputcontrol",["hd","hdmain/jq","dialog/textblockformatter","engine/dialogupdateflags","dialog/promptparsersource","dialog/dialogcontrol","dialog/inputcontrol"],function(a,b,c,d,e,f,g,h){this.DEBUG===h&&(this.DEBUG=a.DEBUG);var i=b.proxy,j=g.prototype,k="ChildDialogControl";return b.widget("hd.DialogInputControl",g,{_create:function(){j._create.apply(this,arguments),this.element.attr("widget","DialogInputControl"),this._childDialogControl=b("<div/>")[k]().appendTo(this.ControlCell).on("NavigateToChild",i(this._childDialogControl_NavigateToChild,this)),""!=this.Dialog().gType&&this._childDialogControl[k]({GroupType:this.Dialog().gType}).on("Checked",i(this._childDialogControl_Checked,this)).on("Unchecked",i(this._childDialogControl_Unchecked,this)),this.options.IsEnabledChanged=i(this.DialogInputControl_IsEnabledChanged,this)},_setOption:function(a,b){switch(a){case"IsEnabled":this.element.find("input,button").prop("disabled",!b);break;case"IsReadOnly":b!=this._isReadOnly&&(this.UpdateState(b),this._isReadOnly=b);break;case"IsSetByDialogScript":b!=this._isSetByDialogScript&&(this.UpdateState(b),this._isSetByDialogScript=b)}j._setOption.apply(this,arguments)},Update:function(a){if(j.Update.call(this,a),(a||(this._dialogItemNode.UpdateFlags()&d.AnsweredStatus)==d.AnsweredStatus)&&this._childDialogControl[k]({AnsweredStatus:this._dialogItemNode.AnsweredStatus()}),a||(this._dialogItemNode.UpdateFlags()&d.Prompt)==d.Prompt){var b=new e(this._dialogItemNode);f.DotCodeParser().Parse(b,new c(this._childDialogControl.data("hd-ChildDialogControl").PromptText,this._childDialogControl.data("hd-ChildDialogControl").PromptText.css("font-size"),b.Required()))}},DisplayPrompt:function(){return!1},FieldWidth:function(){return"F"},QuixelFactor:function(){return 0},CalculatedWidth:function(){return 0},DisplayClearAnswer:function(){return j.DisplayClearAnswer.apply(this)&&""!=this._childDialogControl[k]("option","GroupType")},DisplayResource:function(){return!1},_childDialogControl_NavigateToChild:function(){""!=this.Dialog().gType&&(this._dialogItemNode.BoolAnswer(!0),this.SetControlAnswer());var b,c=this._dialogItemNode._parent.Children().get(this._dialogItemNode.DialogItem().name,this._dialogItemNode._parent._template);null!=c&&(b={s:null},c.NavigateTo(!0,b,function(c){c||a.Alert(b)}))},_childDialogControl_Checked:function(){this._inUpdateControlAnswer||this._dialogItemNode.BoolAnswer(this._childDialogControl[k]("option","IsChecked"))},_childDialogControl_Unchecked:function(){this._inUpdateControlAnswer||this._dialogItemNode.BoolAnswer(this._childDialogControl[k]("option","IsChecked"))},SetControlAnswer:function(){""!=this.Dialog().gType&&(this._inUpdateControlAnswer=!0,this._childDialogControl[k]({IsChecked:this._dialogItemNode.BoolAnswer()}),this._inUpdateControlAnswer=!1)},SetFocus:function(a){this._childDialogControl[k]("SetFocus",a)},SaveControlAnswer:function(){},UpdateState:function(a){""!=this.Dialog().gType&&(a?(this._setOption("IsEnabled",this._childDialogControl[k]("option","IsChecked")),this._childDialogControl[k]({IsButtonEnabled:!1})):(this._setOption("IsEnabled",!0),this._childDialogControl[k]({IsButtonEnabled:!0})))},DialogInputControl_IsEnabledChanged:function(){this._childDialogControl[k]({IsEnabled:this.options.IsEnabled})}}),b.hd.DialogInputControl}),define("dialog/textblockmetrics",["hdmain/system","hdmain/jq","dialog/textmetrics"],function(a,b,c){function d(a){this._textBlock=b("<span>5</span>").hide().appendTo("#hdMainDiv").css("width","auto").addClass(a),this.QuixelFactor=this._textBlock.width(),this.LineHeight=this._textBlock.height()}return a.ExtendClass(d,c),d}),define("dialog/truefalseinputcontrol",["hd","hdmain/jq","hdmain/system","system/checkbox","system/radiobutton","dialog/textblockmetrics","dialog/textblockformatter","engine/dialogupdateflags","dialog/promptparsersource","dialog/dialogcontrol","dialog/inputcontrol"],function(a,b,c,d,e,f,g,h,i,j,k,l){this.DEBUG===l&&(this.DEBUG=a.DEBUG);var m=b.proxy,n=c.Windows.Input.FocusManager.GetFocusedElement,o=k.prototype,p=new f("DialogTextStyle");return b.widget("hd.TrueFalseInputControl",k,{_create:function(){o._create.apply(this,arguments),this.element.attr("widget","TrueFalseInputControl"),this._inUpdateControlAnswer=!1,this._buttons=[];var a,d,e,f;switch(a=this._dialogItemNode.ReadOnly()?"hd-input-tf-readonly":"hd-input-tf",this.Dialog().gType){case"":f=this._dialogItemNode.DialogItem().name,this.stackPanel=b('<div style="float:left; white-space:nowrap;"/>').appendTo(this.ControlCell),this.Variable().sameLine||(this._border=this.stackPanel,this.options.IsEnabledChanged=m(this.TrueFalseInputControl_IsEnabledChanged,this),this.stackPanel.addClass("hd-input-tf hd-input-tf-gb")),d=b("<label/>").text(this.GetResourceString("ui_yes")),this.Variable().sameLine&&d.css("margin-right","15px"),e=b('<input type="radio"/>').attr("name",f).appendTo(this.stackPanel).RadioButton({Style:a,Content:d}),e.on("Checked",m(this.button1_Checked,this)),this._buttons.push(e),this.Variable().sameLine||b("<br/>").appendTo(this.stackPanel),d=b("<label/>").text(this.GetResourceString("ui_no")),e=b('<input type="radio"/>').attr("name",f).appendTo(this.stackPanel).RadioButton({Style:a,Content:d}).on("Checked",m(this.button2_Checked,this)),this._buttons.push(e);break;case"S":d=b("<label/>").addClass("hd-input-prompt"),e=b('<input type="radio"/>').appendTo(this.ControlCell).RadioButton({Style:a,GroupName:c.Guid.NewGuid(),Content:d}).on("Checked",m(this.button1_Checked,this)),this._buttons.push(e);break;case"M":d=b("<label/>").addClass("hd-input-prompt"),e=b('<input type="checkbox"/>').appendTo(this.ControlCell).CheckBox({Style:a,Content:d}).on("Checked",m(this.button1_Checked,this)).on("Unchecked",m(this.button1_Unchecked,this)),this._buttons.push(e)}},_setOption:function(a,b){switch(a){case"IsEnabled":this.element.find("input,select,textarea,button").prop("disabled",!b),this.element.find(".hd-input-tf, label").toggleClass("GrayText",!b);break;case"IsReadOnly":if(b!=this._isReadOnly){if(b)for(var c=0;c<this._buttons.length;c++)this._buttons[c].prop("disabled",b);
this._isReadOnly=b}}o._setOption.apply(this,arguments)},Update:function(a){if(o.Update.call(this,a),""!=this.Dialog().gType&&o.DisplayPrompt.call(this)&&(a||(this._dialogItemNode.UpdateFlags()&h.Prompt)==h.Prompt)){var b=c.Cast(this._buttons[0],"ToggleButton").options.Content;j.DotCodeParser().Parse(new i(this._dialogItemNode),new g(b,b.FontSize,!1)),this._calculatedWidth=0,this.UpdateControlWidth()}},DisplayPrompt:function(){return""==this.Dialog().gType?o.DisplayPrompt.call(this):!1},PromptPosition:function(){return this.Variable().sameLine?o.PromptPosition.call(this):"T"},ExactWidth:function(){return""==this.Dialog().gType?this.Variable().sameLine?this.CalculatedWidth():this.FieldWidthValue()*this.QuixelFactor():this.CalculatedWidth()},QuixelFactor:function(){return p.QuixelFactor},CalculatedWidth:function(){if(0==this._calculatedWidth)switch(this.Dialog().gType){case"":this.Variable().sameLine?(this._calculatedWidth=this._buttons[0].width(),this._calculatedWidth+=a.ButtonGlyphWidth,this._calculatedWidth+=this._buttons[0].RadioButton("option","Content").width(),this._calculatedWidth+=this._buttons[1].width(),this._calculatedWidth+=a.ButtonGlyphWidth,this._calculatedWidth+=this._buttons[1].RadioButton("option","Content").width()):(this._calculatedWidth=parseInt(this.stackPanel.css("margin-left"))+parseInt(this.stackPanel.css("padding-left"))+parseInt(this.stackPanel.css("padding-right"))+parseInt(this.stackPanel.css("margin-right")),this._calculatedWidth+=this._buttons[0].width(),this._calculatedWidth+=Math.max(this._buttons[0].RadioButton("option","Content").width(),this._buttons[1].RadioButton("option","Content").width()));break;case"S":case"M":this._calculatedWidth=this._buttons[0].width(),this._calculatedWidth+=a.ButtonGlyphWidth,this._calculatedWidth+=c.Cast(this._buttons[0],"ToggleButton").options.Content.width()+this.QuixelFactor()/2}return this._calculatedWidth},button1_Checked:function(){this._inUpdateControlAnswer||this._dialogItemNode.SetAnswerBool(!0)},button1_Unchecked:function(){this._inUpdateControlAnswer||this._dialogItemNode.SetAnswerBool(!1)},button2_Checked:function(){this._inUpdateControlAnswer||this._dialogItemNode.SetAnswerBool(!1)},SetControlAnswer:function(){this._inUpdateControlAnswer=!0;var a=this._dialogItemNode.BoolAnswer();switch(this.Dialog().gType){case"":null!=a?(this._buttons[0].prop("checked",a),this._buttons[1].prop("checked",!a)):(this._buttons[0].prop("checked",!1),this._buttons[1].prop("checked",!1));break;case"S":case"M":null!=a?this._buttons[0].prop("checked",a):this._buttons[0].prop("checked",!1)}this._inUpdateControlAnswer=!1},TrueFalseInputControl_IsEnabledChanged:function(){this.ShowBorderEnabled(this._border,this.options.IsEnabled)},SetFocus:function(b){switch(this.Dialog().gType){case"":this._buttons[b==a.TrueOptionName?0:1].focus();break;case"S":case"M":this._buttons[0].focus()}},SaveControlAnswer:function(){},FocusOptionName:function(){switch(this.Dialog().gType){case"":return this._buttons[0]==n()[0]?a.TrueOptionName:a.FalseOptionName;default:return""}},OnKeyDown:function(b){if(""==this.Dialog().gType)switch(b.which){case 38:case 37:case 40:case 39:this._buttons[0][0]==n()[0]?(this._dialogItemNode.BoolAnswer(!1),this.SetFocus(a.FalseOptionName)):this._buttons[1][0]==n()[0]&&(this._dialogItemNode.BoolAnswer(!0),this.SetFocus(a.TrueOptionName)),this.SetControlAnswer(),b.preventDefault()}o.OnKeyDown.call(this,b)},SetAnswerAndFocus:function(){this._dialogItemNode.SetAnswerBool(!0),this.SetControlAnswer(),this.SetFocus(null)}}),b.hd.TrueFalseInputControl}),define("dialog/optionprompt",["hdmain/system","dialog/stringformatter","engine/stringparsersource","dialog/dialogcontrol"],function(a,b,c,d,e){function f(a,b){this._name=a,this._prompt=b}return a.ExtendClass(f,null,{Name:function(a){return a===e?this._name:(this._name=a,void 0)},Prompt:function(a){return a===e?this._prompt:(this._prompt=a,void 0)}},{ToOptionPrompt:function(e){var g=new a.Text.StringBuilder;return d.DotCodeParser().Parse(new c(e.Prompt()),new b(g,a.Windows.TextWrapping.NoWrap)),new f(e.name,g.ToString())}}),f}),define("dialog/multchoicecombobox",["hdmain/jq","hdmain/system"],function(a,b,c){return a.widget("hd.MultChoiceComboBox",{_create:function(){this.element.on("keydown",a.proxy(this.OnKeyDown,this)).addClass("hd-input-mc").css({margin:"0px",width:"100%"}),this.option(this.options)},_setOption:function(b,c){switch(b){case"ItemsSource":this.element.empty(),a("<option/>").appendTo(this.element);for(var d=0;d<c.length;d++)a("<option/>").appendTo(this.element).html(c[d].Prompt()).attr("value",c[d].Name());this.Items=c}a.Widget.prototype._setOption.apply(this,arguments)},OnKeyDown:function(a){if(this.Items&&this.Items.length>0){var c=null;if(a.which>=65&&a.which<=90?c=String.fromCharCode(a.which):a.which>=48&&a.which<=57?c=String.fromCharCode(a.which):a.which>=96&&a.which<=105&&(c=String.fromCharCode(a.which-48)),null!=c)for(var d=this.element.prop("selectedIndex")-1,e=0>d;;){if(++d,d==this.Items.length){if(e)break;d=0,e=!0}if(d==this.element.prop("selectedIndex"))break;var f=this.Items[d].Prompt();if(!b.String.IsNullOrEmpty(f)&&f[0].toUpperCase()==c[0]){this.element.prop("selectedIndex",d+1),a.Handled=!0;break}}else 13==a.which&&a.stopPropagation()}},SelectedItem:function(a){if(a===c){var b=this.element.prop("selectedIndex");return b>0?this.Items[b-1]:null}this.element.val(null==a?"":a.Name())}}),a.hd.MultChoiceComboBox}),define("dialog/multchoiceeditablecomboboxcontrol",["hdmain/jq","hdmain/system"],function(a,b,c){function d(){var a=this.Text(),c=b.List.FirstOrDefault(this[n][n]("option",o),function(b){return b.Prompt()==a});this[n][n]({SelectedItem:c})}function e(){null!=this._dropDownSelection&&(null==this._selectedOption||this._selectedOption!=this._dropDownSelection)&&(this._selectedOption=this._dropDownSelection,this.OnSelectionChanged())}function f(a,b){b.A.length>0&&(this._dropDownSelection=b.A[0])}function g(b){var c=a(b.target);c[0]!=this.element[0]&&c.closest("select")[0]!=this.opts[0]&&this._togglelist(!1)}var h=a.proxy,i=b.String.IsNullOrEmpty,j="mousedown mousewheel",k="SelectionChanged",l="DropDownOpened",m="DropDownClosed",n="EditableComboBox",o="ItemsSource";return a.widget("hd.MultChoiceEditableComboBoxControl",{_create:function(){this.element.css("position","relative"),this[n]=a('<input type="text"/>').appendTo(this.element)[n]({ValueMemberPath:"Prompt"}).on(k,h(f,this)).on(l,h(d,this)).on(m,h(e,this)),this.option(this.options)},ItemsSource:function(a){return a===c?this[n][n]("option",o):(this[n][n]({ItemsSource:a}),void 0)},OnSelectionChanged:function(){this.element.trigger(k,{})},SelectedOption:function(a){return a===c?this._selectedOption:(this._selectedOption=a,this[n][n]({Text:null!=this._selectedOption?this._selectedOption.Prompt():""}),void 0)},Text:function(a){return a===c?this[n][n]("option","Text"):(i(a)?(this[n][n]({Text:""}),this._selectedOption=null):(this._selectedOption=b.List.FirstOrDefault(this[n][n]("option",o),function(b){return b.Name()==a}),this[n][n]({Text:null!=this._selectedOption?this._selectedOption.Prompt():a})),void 0)}}),a.widget("hd."+n,{_create:function(){a.Widget.prototype._create.apply(this,arguments),this.ddVisible=!1,this.element.addClass("hd-input hd-input-mc").css({width:"100%","padding-right":"20px"}).on("blur",h(function(){var a,c,d;a=this.element.val(),""==a&&(a=null),c=b.List.FirstOrDefault(this.options[o],function(b){return b.Name()==a}),d=null!=c?c.Prompt():a,this.options.Text!=d&&(this._setOption("Text",d),this._togglelist(!1),this.element.trigger(k,{R:null,A:[d]}))},this)).on("keydown",h(function(a){var c,d,e,f;switch(a.which){case 38:case 40:return this.ddVisible?(c=this.opts.prop("selectedIndex"),this.opts.val(this.opts.children().eq(c+(38==a.which?-1:1)).prop("value")),d=this.opts.val(),e=b.List.FirstOrDefault(this.options[o],function(a){return a.Name()==d}),null!=e&&this._setOption("Text",e.Prompt()),this.element.trigger(k,{R:null,A:[e]})):this._togglelist(!0),!1;case 9:d=this.element.val(),e=b.List.FirstOrDefault(this.options[o],function(a){return a.Name()==d}),f=null!=e?e.Prompt():d,this._setOption("Text",f),this._togglelist(!1),this.element.trigger(k,{R:null,A:[null!=e?e:f]});break;default:this._togglelist(!0)}},this)),this.btn=a('<div class="hd-img hd-cmbo-arrow"/>').css({position:"absolute",top:"0px",right:"0px",height:"100%"}).on("click",h(function(){this.btn.hasClass("hd-img")&&this._togglelist()},this)).insertAfter(this.element),this.opts=a("<select/>").hide().addClass("hd-input").insertAfter(this.element).css({position:"absolute",left:0,"z-index":505}).on("click",h(function(){this._setOption("Text",this.opts.children('[value="'+this.opts.val()+'"]').text()),this._togglelist(!1),this.element.focus()},this)).on("change",h(function(){var a=this.opts.val(),c=b.List.FirstOrDefault(this.options[o],function(b){return b.Name()==a});this._setOption("Text",a),this.element.trigger(k,{R:null,A:[c]})},this)),this.option(this.options)},_setOption:function(b,c){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case o:this.opts.empty().attr("size",Math.min(c.length+1,15));for(var d=0;d<c.length;d++)a("<option/>").appendTo(this.opts).html(c[d].Prompt()).attr("value",c[d].Name());break;case"Text":i(c)?(this.element.val(""),this.opts.val("").prop("selectedindex",-1)):this.element.val(c)}},_togglelist:function(b){if(b==c&&(b=!this.ddVisible),this.element.toggleClass("active",b),this.ddVisible!=b)if(this.ddVisible=b,b){this.opts.css({height:"auto",width:this.element.outerWidth()});var d,e,f=this.opts.height(),i=this.element.offset(),k=this.element.closest(".hd-dialog-control"),n=k.height(),o=this.element.outerHeight(),p=f;i.top+this.element.outerHeight()+f>n&&(i.top-f>k.offset().top?o=-f:(d=i.top-k.offset().top,e=k.offset().top+n-i.top-this.element.outerHeight(),d>e?(o=-d,p=d):p=e)),this.element.parents(".hd-grid-cell").length>0?this.opts.css({position:"fixed","background-color":"white",left:i.left,top:o+i.top,height:p}).appendTo(document.body):this.opts.css({top:o,height:p}),this.opts.show(),this.element.trigger(l),a(document.body).on(j,h(g,this))}else this.opts.hide().insertAfter(this.element),this.element.trigger(m),a(document.body).off(j,g)}}),a.hd.MultChoiceEditableComboBoxControl}),define("dialog/multiplechoiceinputcontrol",["hd","hdmain/jq","hdmain/system","system/checkbox","system/radiobutton","dialog/controlmetrics","dialog/textblockmetrics","engine/stringparsersource","dialog/textblockformatter","dialog/optionprompt","dialog/multchoicecombobox","dialog/dialogcontrol","dialog/multchoiceeditablecomboboxcontrol","dialog/inputcontrol"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=c.Windows.Visibility,q=c.String.IsNullOrEmpty,r=c.Windows.Controls.SelectionMode;this.DEBUG===o&&(this.DEBUG=a.DEBUG);var s,t,u,v,w=b.proxy,x=n.prototype,y=c.Windows.Input.FocusManager.GetFocusedElement,z="MultipleChoiceInputControl",A="MultChoiceEditableComboBoxControl",B="NoneOfTheAboveOptionName",C=5,D="-readonly",E="hd-input-mc-btn",F=E+D,G="hd-input-mc-lb-item",H=G+D,I="hd-input hd-input-mc-tb",J=I+D;return function(){s=new g("DialogTextStyle"),t=new f(b("<input/>").addClass(J)),u=new f(b("<option/>").addClass(G)),v=new f(b("<option/>").addClass(H))}(),b.widget("hd."+z,n,{_create:function(){x._create.apply(this,arguments),this.element.attr("widget",z),this._setOption("controlID","mc"+c.Guid.NewGuid());var d,e,f,g,h,i,k,l,m,n,o,p,q,s,t,y,C=this.Variable();switch(this._listItemMetrics=this._dialogItemNode.ReadOnly()?v:u,C.style){case"RB":case"RG":case"CB":case"CG":if(this._buttons=new c.Collections.Generic.List,this._border=b('<div class="GrpBoxBox"/>'),this.options.IsEnabledChanged=w(this.MultipleChoiceInputControl_IsEnabledChanged,this),d=b("<div/>"),e=b('<table width="100%"/>'),f=b("<thead/>").appendTo(e),h=[],"RG"==C.style||"CG"==C.style){for(k=this._dialogItemNode.GetOptions().Count(),C.othr&&"CG"==C.style&&++k,this._numColumns=k>=9?3:2,l=Math.floor(k/this._numColumns)+(k%this._numColumns>0?1:0),m=0;m<this._numColumns;m++)b('<th style="width:'+100/this._numColumns+'%" />').appendTo(f);for(n=0,q=0;n<this._dialogItemNode.GetOptions().Count()&&q<this._numColumns;q++)for(i=0;n<this._dialogItemNode.GetOptions().Count()&&l>i;i++)h.length<=i&&h.push(b("<tr/>").appendTo(e)),o=this.CreateButton(C.style,this._dialogItemNode.GetOptions().GetItem(n).name,this._dialogItemNode.GetOptions().GetItem(n).Prompt(),w(this.button_Checked,this),w(this.button_Unchecked,this)),this._buttons.push(o),p=b("<td/>").appendTo(h[i]),o.appendTo(p),++n;C.othr&&"CG"==C.style&&(q=this._numColumns-1,this._noneOfTheAboveButton=this.CreateButton("CB",a[B],this.GetResourceString("ui_nota"),w(this._noneOfTheAboveButton_Checked,this),w(this._noneOfTheAboveButton_Unchecked,this)),this._buttons.push(this._noneOfTheAboveButton),h.push(b("<tr/>").appendTo(e)),p=b("<td/>").appendTo(h[i]),this._noneOfTheAboveButton.appendTo(p)),e.appendTo(d),C.othr&&"RG"==C.style&&(e=this.CreateOtherGrid(),e.appendTo(d))}else{for(this._numColumns=1,this.ControlCell.css("width","100%"),s=0;s<this._dialogItemNode.GetOptions().Count();s++)o=this.CreateButton(C.style,this._dialogItemNode.GetOptions().GetItem(s).name,this._dialogItemNode.GetOptions().GetItem(s).Prompt(),w(this.button_Checked,this),w(this.button_Unchecked,this)),this._buttons.push(o),h.push(b("<tr/>").appendTo(e)),p=b("<td/>").appendTo(h[h.length-1]),o.appendTo(p);e.appendTo(d),C.othr&&("RB"==C.style?this.CreateOtherGrid().appendTo(d):(h.push(b("<tr/>").appendTo(e)),p=b("<td/>").appendTo(h[h.length-1]),this._noneOfTheAboveButton=this.CreateButton("CB",a[B],this.GetResourceString("ui_nota"),w(this._noneOfTheAboveButton_Checked,this),w(this._noneOfTheAboveButton_Unchecked,this)),this._buttons.push(this._noneOfTheAboveButton),this._noneOfTheAboveButton.appendTo(p)))}d.appendTo(this._border),this._border.appendTo(this.ControlCell);break;case"SL":case"ML":this.ControlGrid.css("width","auto"),e=b('<table width="100%"/>'),t=0,"SL"==C.style&&C.othr&&(g=b("<tr/>").appendTo(e),p=b("<td/>").appendTo(g),this._otherTextBox=b('<input type="text" style="width:100%"/>').addClass(this._dialogItemNode.ReadOnly()?J:I),this._otherTextBox.on("keyup",w(this._otherTextBox_TextChanged,this)),this._otherTextBox.appendTo(p)),g=b("<tr/>").appendTo(e),p=b("<td/>").appendTo(g),y="SL"==C.style?r.Single:r.Extended,this._optionPromptList=this._dialogItemNode.GetOptions().Select(function(a){return j.ToOptionPrompt(a)}),y!=r.Single&&C.othr&&this._optionPromptList.push(new j(a[B],this.GetResourceString("ui_nota"))),this._listBox=b("<select/>").MultChoiceListBox({Style:this._dialogItemNode.ReadOnly()?"hd-input-mc-lb-readonly":"hd-input-mc-lb",ItemContainerStyle:this._dialogItemNode.ReadOnly()?"hd-input-mc-lb-item-readonly":"hd-input-mc-lb-item",SelectionMode:y,DisplayMemberPath:"Prompt",ItemsSource:this._optionPromptList}),this._listBox.on("change",w(this._listBox_SelectionChanged,this)).on("LayoutUpdated",w(this._listBox_LayoutUpdated,this)),this._listBox.appendTo(p),e.appendTo(this.ControlCell);break;case"CO":this._optionPromptList=this._dialogItemNode.GetOptions().Select(function(a){return j.ToOptionPrompt(a)}),this._dialogItemNode.ReadOnly()?(this._readOnlyComboTextBox=b("<div/>").addClass(J),this._readOnlyComboTextBox.appendTo(this.ControlCell)):C.othr?(this._editableComboBox=b("<div/>")[A](),this._editableComboBox[A]("ItemsSource",this._optionPromptList),this._editableComboBox.on("SelectionChanged",w(this._editableComboBox_SelectionChanged,this)).appendTo(this.ControlCell).trigger("Loaded")):(this._comboBox=b("<select/>").MultChoiceComboBox({Style:"hd-input-mc-cb",ItemContainerStyle:"hd-input-mc-cb-item",DisplayMemberPath:"Prompt",ItemsSource:this._optionPromptList}),this._comboBox.on("change",w(this._comboBox_SelectionChanged,this)),this._comboBox.appendTo(this.ControlCell))}this._hasOptionResource=null!=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return null!=a.rsrc})},_setOption:function(a,b){switch(a){case"IsEnabled":this.element.toggleClass("GrayText",!b).find("input,select,textarea,button").prop("disabled",!b),b?this.element.find(".hd-img-g").removeClass("hd-img-g").addClass("hd-img"):this.element.find(".hd-img").removeClass("hd-img").addClass("hd-img-g");break;case"IsReadOnly":if(b!=this._isReadOnly){if(b){if(null!=this._buttons)for(var c=0;c<this._buttons.length;c++)this._buttons[c].find("input").prop("disabled",b);null!=this._listBox&&this._listBox.prop("disabled",b),null!=this._otherTextBox&&this._otherTextBox.prop("disabled",b)}this._isReadOnly=b}}x._setOption.apply(this,arguments)},_listBox_LayoutUpdated:function(){if(this._listBox.Items.Count>0){var a,b=_listBox.ItemContainerGenerator.ContainerFromIndex(0);null!=b&&(a=this._listBox.Margin.Top+this._listBox.BorderThickness.Top+this._listBox.Padding.Top+b.ActualHeight*Math.min(this._optionPromptList.length,4)+this._listBox.Padding.Bottom+this._listBox.BorderThickness.Bottom+_listBox.Margin.Bottom,this._listBox.ScrollViewer.ComputedHorizontalScrollBarVisibility==p.Visible&&(a+=18),this._listBox.Height=a)}},PromptPosition:function(){switch(this.Variable().style){case"RB":case"RG":case"CB":case"CG":return"T";default:return x.PromptPosition.call(this)}},PromptVerticalAlignment:function(){return"CB"==this.Variable().style?"C":"T"},HasResource:function(){return x.HasResource.call(this)||this._hasOptionResource},ResourceOptionName:function(){return this._resourceOptionName},SetResourceOptionName:function(a){if(this.HasResource()){var b,c=q(a)?null:this._dialogItemNode.GetOptions().FirstOrDefault(function(b){return b.name==a&&null!=b.rsrc});null!=c?(this._resourceOptionName=c.name,b=!0):(this._resourceOptionName=null,b=x.HasResource.call(this)),this.IsResourceEnabled(b)}},FieldWidth:function(){var a=x.FieldWidth.call(this);if("D"==a)switch(this.Variable().style){case"RB":case"RG":case"CB":case"CG":a="F";break;default:a="C"}else"C"==a&&null!=this._otherTextBox&&(a="F");return a},ExactWidth:function(){switch(this.Variable().style){case"RB":case"CB":case"RG":case"CG":return this.FieldWidthValue()*this.QuixelFactor();default:return x.ExactWidth.call(this)}},MaxOptionPromptWidth:function(){var a,b,c=this.Variable(),d=0,e=this._optionPromptList,f=e.length;for(a=f;a--;)b=e[a].Prompt(),d=Math.max(d,this._dialogItemNode.ReadOnly()&&"CO"==c.style?t.GetTextWidth(b):this._listItemMetrics.GetTextWidth(b));return d},QuixelFactor:function(){return s.QuixelFactor},CalculatedWidth:function(){var a=this._calculatedWidth;if(0==a){var b,c,d,e=this.Variable();switch(e.style){case"RB":case"CB":case"RG":case"CG":var f=this._border;if(a=f.outerWidth()-f.width(),this._buttons.length>0){var g=this._numColumns;for(a+=this.ControlWidth(this._buttons[0]),b=0,c=0;c<this._buttons.length;c++)d=this._buttons[c],b=Math.max(b,d.outerWidth());a+=g*(b+this.QuixelFactor()/2),a+=(g-1)*C,a+=18*g}break;case"SL":case"ML":case"CO":"CO"==e.style?this._dialogItemNode.ReadOnly()?a+=this.ControlWidth(this._readOnlyComboTextBox)+this.MaxOptionPromptWidth()+t.QuixelFactor/2:e.othr?(this._editableComboBox.children("select").css("width","auto"),a=Math.max(this.ControlWidth(this._editableComboBox.children("select"))+this.MaxOptionPromptWidth()+28,45)):a=this.ControlWidth(this._comboBox)+this.MaxOptionPromptWidth()+28:a=this.ControlWidth(this._listBox)+this.MaxOptionPromptWidth()+28}this._calculatedWidth=a}return a},CreateButton:function(a,d,e,f,g){var j,k,m,n=b('<label style="float:left; text-indent: -25px; margin-left: 25px;"/>');return"RB"==a||"RG"==a?(k=this.options.controlID,j=b('<input type="radio"/>').RadioButton().attr({name:k,id:"MCOpt|"+d+"|"+k,value:d}),q(this._groupName)&&(this._groupName=c.Guid.NewGuid()),j.GroupName=this._groupName):j=b('<input type="checkbox"/>').CheckBox(),j.appendTo(n).on("focus",w(this.button_GotFocus,this)),n.addClass(this._dialogItemNode.ReadOnly()?F:E).attr("Tag",d).on("Checked",f).on("Unchecked",g),m=b("<span/>"),l.DotCodeParser().Parse(new h(e),new i(m,m.FontSize,!1)),m.appendTo(n),n},CreateOtherGrid:function(){var c,d=b('<table width="100%"/>'),e=b("<tr/>").appendTo(d);return this._otherButton=this.CreateButton("RB",a.OtherOptionName,this.GetResourceString("ui_other"),w(this._otherButton_Checked,this),w(this._otherButton_Unchecked,this)),c=b("<td/>").appendTo(e),this._otherButton.appendTo(c),this._otherButton.children("div").width("auto"),this._otherButton.css({display:"block"}),this._otherTextBox=b('<input type="text" style="width:100%"/>').addClass(this._dialogItemNode.ReadOnly()?J:I).attr("Tag",a.OtherInputName),c=b('<td style="width:100%"/>').appendTo(e),this._otherTextBox.appendTo(c),d},button_Checked:function(a){if(!this._inUpdateControlAnswer){var c,d,e=this.Variable();switch(b(a.target).parent().focus(),e.style){case"RB":case"RG":this._dialogItemNode.ListAnswer([a.target.value]);break;case"CB":case"CG":for(e.othr&&(this._inCheckedButton=!0,this._noneOfTheAboveButton.children("input").prop("checked",!1),this._inCheckedButton=!1),c=[],d=0;d<this._buttons.length;d++)this._buttons[d].children("input").prop("checked")&&c.push(this._buttons[d].attr("tag"));this._dialogItemNode.ListAnswer(c)}}},button_Unchecked:function(){if(!this._inUpdateControlAnswer){var a,b,c=this.Variable();switch(c.style){case"RB":case"RG":break;case"CB":case"CG":if(!this._inCheckedNoneOfTheAbove){for(a=[],b=0;b<this._buttons.length;b++)this._buttons[b].children("input").prop("checked")&&a.push(this._buttons[b].attr("Tag"));this._dialogItemNode.ListAnswer(a.length>0?a:null)}}}},_otherButton_Checked:function(){if(!this._inUpdateControlAnswer){var a=q(this._otherTextBox.val())?"":this._otherTextBox.val();this._dialogItemNode.ListAnswer([a])}},_otherButton_Unchecked:function(){this._inUpdateControlAnswer||this._otherTextBox.val("")},_noneOfTheAboveButton_Checked:function(){if(!this._inUpdateControlAnswer){this._inCheckedNoneOfTheAbove=!0;var b,c;for(b=0;b<this._buttons.length;b++)c=this._buttons[b],c.attr("Tag")!=a[B]&&c.children("input").prop("checked",!1);this._inCheckedNoneOfTheAbove=!1,this._dialogItemNode.ListAnswer([a.MC.nota])}},_noneOfTheAboveButton_Unchecked:function(){this._inUpdateControlAnswer||this._inCheckedButton||this._dialogItemNode.ListAnswer(null)},button_GotFocus:function(a){this.SetResourceOptionName(a.target.parentNode.getAttribute("tag")),this.element.trigger("GotFocus")},GetMatchingListBoxIndex:function(){var a,b,c=0,d=this._otherTextBox.val().toUpperCase();if(!q(d))for(a=0;a<this._optionPromptList.length;a++)if(b=this._optionPromptList[a].Prompt().toUpperCase(),0==b.indexOf(d)){c=a;break}return c},SetOtherTextBoxInternal:function(a,b){this._otherTextBox.val()!=a&&(this._ignoreNextTextChange=!0,this._ignoreNextTextChangeAndNeedFocus=b,this._otherTextBox.val(a))},_otherTextBox_TextChanged:function(){if(this._ignoreNextTextChange)return this._ignoreNextTextChange=!1,this._otherTextBox.select(),this._ignoreNextTextChangeAndNeedFocus&&(this._ignoreNextTextChangeAndNeedFocus=!1,this._otherTextBox.focus(),l.ScrollIntoView(this._otherTextBox)),void 0;if(!this._inUpdateControlAnswer){var a=this.GetMatchingListBoxIndex();this._listBox.MultChoiceListBox("SelectedItem",null),c.CallAsync(w(function(){var b=a>0&&this._listBox.children().length>0?this._listBox.height()/this._listBox.attr("size"):0;this._listBox.scrollTop(b*a),this._otherTextBox.val()==this._optionPromptList[a].Prompt()&&this._listBox.val(this._optionPromptList[a].Name())},this))}},_listBox_SelectionChanged:function(){if(!this._inUpdateControlAnswer){var b,c,d,e,f,g=this._listBox.MultChoiceListBox("SelectedItems");if(null!=g&&g.length>0)if(b=this.Variable(),"SL"==b.style)b.othr&&this.SetOtherTextBoxInternal(g[0].Prompt(),!0),this._dialogItemNode.ListAnswer([g[0].Name()]);else if(b.othr&&1==g.length&&g[0].Name()==a[B])this._dialogItemNode.ListAnswer([a.MC.nota]);else{for(c=g.length,c>1&&g[c-1].Name()==a[B]&&(this._listBox.MultChoiceListBox("SelectedItems").splice(c-1,1),c--),d=[],e=0;c>e;e++)d[e]=g[e].Name();this._dialogItemNode.ListAnswer(d)}else this._dialogItemNode.ListAnswer(null);f=this._listBox.MultChoiceListBox("SelectedItem"),null!=f&&this.SetResourceOptionName(f.Name())}},_editableComboBox_SelectionChanged:function(){if(!this._inUpdateControlAnswer){var a=this._editableComboBox[A]("SelectedOption");null!=a?("function"!=typeof a.Name&&(a=new j(a,a)),this._dialogItemNode.ListAnswer([a.Name()]),this.SetResourceOptionName(a.Name())):(this._dialogItemNode.ListAnswer(null),this.SetResourceOptionName(null))}},_comboBox_SelectionChanged:function(){if(!this._inUpdateControlAnswer){var a=this._comboBox.MultChoiceComboBox("SelectedItem");null!=a?(this._dialogItemNode.SetAnswerList([a.Name()]),this.SetResourceOptionName(a.Name())):(this._dialogItemNode.SetAnswerList(null),this.SetResourceOptionName(null))}},SetControlAnswer:function(){this._inUpdateControlAnswer=!0;var c,d,e,f=null,g=this._dialogItemNode.ListAnswer(),h=this.Variable();switch(null!=g&&g.length>0&&(f=g.slice(0)),h.style){case"RB":case"RG":if(null!=f)if(null!=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return f.indexOf(a.name)>=0})){for(c=0;c<this._buttons.length;c++)if(this._buttons[c].attr("Tag")==f[0]){this._buttons[c].children("input").prop("checked",!0);break}h.othr&&this._otherTextBox.val("")}else h.othr?(this._otherButton.children("input").prop("checked",!0),this._otherTextBox.val(f[0])):f=null;null==f&&(b.each(this._buttons,function(){b(this).find("input").prop("checked",!1)}),h.othr&&(this._otherButton.prop("checked",!1),this._otherTextBox.val("")));break;case"CB":case"CG":if(null!=f)if(this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return f.indexOf(a.name)>=0})){if(b.each(this._buttons,function(){this.children("input").prop("checked",f.indexOf(this.attr("Tag"))>=0)}),h.othr)for(c=0;c<this._buttons.length;c++)if(this._buttons[c].attr("Tag")==a[B]){this._buttons[c].children("input").prop("checked",!1);break}}else h.othr?f[0]==a.MC.nota?b.each(this._buttons,function(){this.children("input").prop("checked",this.attr("Tag")==a[B])}):f=null:f=null;null==f&&b.each(this._buttons,function(){this.children("input").prop("checked",!1)});break;case"SL":null!=f?(d=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return f.indexOf(a.name)>=0}),this._listBox.MultChoiceListBox("SelectedItem",null!=d?j.ToOptionPrompt(d):null),h.othr&&this.SetOtherTextBoxInternal(null==d?f[0]:j.ToOptionPrompt(d).Prompt(),!1)):(this._listBox.prop("selectedIndex",-1),h.othr&&this.SetOtherTextBoxInternal("",!1));break;case"ML":null!=f?(e=this._dialogItemNode.GetOptions().Where(function(a){return f.indexOf(a.name)>-1}),h.othr&&f.indexOf(a.MC.nota)>-1&&e.push(a[B]),this._listBox.val(null),this._listBox.val(e)):this._listBox.val(null);break;case"CO":this._dialogItemNode.ReadOnly()?this._readOnlyComboTextBox.text(null!=f&&f.length>0?f[0]:""):h.othr?null!=f?(d=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return f.indexOf(a.name)>=0}),null!=d?this._editableComboBox[A]("SelectedOption",j.ToOptionPrompt(d)):this._editableComboBox[A]("Text",f[0])):this._editableComboBox[A]("Text",null):null!=f?(d=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return f.indexOf(a.name)>=0}),null!=d?this._comboBox.val(d.name):this._comboBox.val(null)):this._comboBox.val(null)}this._inUpdateControlAnswer=!1},MultipleChoiceInputControl_IsEnabledChanged:function(){this.ShowBorderEnabled(this._border,this.options.IsEnabled)},SetFocus:function(b){var d,e=this.Variable(),f=l.ScrollIntoView;switch(e.style){case"RB":case"RG":if(d=c.List.FirstOrDefault(this._buttons,function(a){return a.attr("Tag")==b}),null!=d)d.children("input").focus(),f(d);else if(e.othr){if(b==a.OtherOptionName)return this._otherButton.focus(),f(this._otherButton),void 0;if(b==a.OtherInputName)return this._otherTextBox.focus(),f(this._otherTextBox),void 0}break;case"CB":case"CG":d=c.List.FirstOrDefault(this._buttons,function(a){return a.attr("Tag")==b}),null!=d&&(d.find("input").focus(),f(d));break;case"SL":e.othr?(this._otherTextBox.focus(),f(this._otherTextBox)):this._listBox.focus(),f(this._listBox);break;case"ML":this._listBox.focus(),f(this._listBox);break;case"CO":this._dialogItemNode.ReadOnly()?(this._readOnlyComboTextBox.focus(),f(_readOnlyComboTextBox)):e.othr?(this._editableComboBox.children("input").focus(),f(this._editableComboBox)):(this._comboBox.focus(),f(this._comboBox))}},SaveControlAnswer:function(){var a,b,c,d=this.Variable();switch(d.style){case"RB":case"RG":d.othr&&(q(this._otherTextBox.val())||(this._otherButton.children("input").prop("checked",!0),this._dialogItemNode.ListAnswer([this._otherTextBox.val()])));break;case"CB":case"CG":break;case"SL":d.othr&&(a=this._otherTextBox.val(),b=this._dialogItemNode.GetOptions().FirstOrDefault(function(b){return j.ToOptionPrompt(b).Prompt==a}),null==b&&(this._dialogItemNode.ListAnswer(q(this._otherTextBox.val())?null:[this._otherTextBox.val()]),this._listBox.SelectedItem=null));break;case"CO":d.othr&&(c=this._editableComboBox[A]("Text"),b=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return a.Prompt()==c}),null==b&&this._dialogItemNode.ListAnswer(q(c)?null:[c]))}},FocusOptionName:function(){var b,d,e=this.Variable();switch(e.style){case"RB":case"RG":if(b=y(),null!=b&&null!=b.parent().attr("tag")){if(e.othr){if(b.data("hd-RadioButton")&&b.parent().attr("Tag")==this._otherButton.attr("Tag"))return a.OtherOptionName;if(b.data("hd-TextBox")&&b.parent().attr("Tag")==this._otherTextBox.attr("Tag"))return a.OtherInputName}if(b.data("hd-RadioButton")&&(d=c.List.FirstOrDefault(this._buttons,function(a){return b.parent().attr("Tag")==a.attr("Tag")}),null!=d))return d.attr("Tag")}return"";case"CB":case"CG":return b=y(),null!=b&&null!=b.parent().attr("tag")&&b.data("hd-CheckBox")&&(d=c.List.FirstOrDefault(this._buttons,function(a){return b.parent().attr("Tag")==a.attr("Tag")}),null!=d)?d.attr("Tag"):"";default:return""}},ClearAnswer:function(){x.ClearAnswer.call(this),null!=this._otherTextBox&&this._otherTextBox.val(""),null!=this._editableComboBox&&this._editableComboBox.val("")},OnKeyDown:function(d){if(38==d.which||37==d.which||40==d.which||39==d.which){var e,f,g,h,i,j=this.Variable();if("RB"==j.style||"RG"==j.style){if(e=[],b.each(this._dialogItemNode.GetOptions().list,function(){e.push(this.name)}),f=e.slice(0),j.othr&&(e.push(a.OtherOptionName),f.push(this._otherTextBox.val())),g=-1,h=c.List.FirstOrDefault(this._buttons,function(a){return a.children("input")[0]==y()[0]}),null!=h?g=e.indexOf(h.attr("Tag")):j.othr&&this._otherButton.children("input")[0]==y()[0]&&(g=e.length-1),g>=0){switch(d.which){case 38:case 37:0==g?g=e.length-1:--g;break;case 40:case 39:g<e.length-1?++g:g=0}this._dialogItemNode.ListAnswer(f[g]),this.SetControlAnswer(),this.SetFocus(e[g]),d.preventDefault()}}else("SL"==j.style||"ML"==j.style)&&(40==d.which?(i=this._listBox.prop("selectedIndex"),0>i?this._listBox.prop("selectedIndex",this.GetMatchingListBoxIndex()).trigger("change"):i<this._listBox.children().length-1&&this._listBox.prop("selectedIndex",i+1).trigger("change"),d.preventDefault()):38==d.which&&(i=this._listBox.prop("selectedIndex"),0>i?this._listBox.prop("selectedIndex",this.GetMatchingListBoxIndex()).trigger("change"):i>0&&this._listBox.prop("selectedIndex",i-1).trigger("change"),d.preventDefault()))}x.OnKeyDown.call(this,d)},Update:function(a){if(x.Update.call(this,a),this._comboBox!==o&&this._comboBox.on("change",w(this._comboBox_SelectionChanged,this)),!this._resourceOptionName){var b=this._dialogItemNode.GetOptions().GetItem(0);b&&this.SetResourceOptionName(b.name)}}}),b.hd[z]}),define("dialog/dialogcontentcontrol",["hd","hdmain/system","hdmain/jq","engine/stringparsersource","dialog/textblockformatter","engine/htmlformatter","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode","engine/repeatnode","engine/focusdirection","system/jquery.hd.button","dialog/hdnavbtntype","dialog/idialogitemnodecontrol","dialog/dateinputcontrol","dialog/promptparsersource","dialog/iinterviewnodecontrol","dialog/dialogcontrol","dialog/dialoginputcontrol","dialog/truefalseinputcontrol","dialog/multiplechoiceinputcontrol","runtime/imagedialogelement"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(a,b){this.FireNavigationKeyPress(b)
}function u(a,b){this.FireResourceUpdate(b)}function v(){var b,c=this.options;return b=C(c.InterviewNode,j),b._parent.AddIteration()||a.Alert(c.InterviewNode.GetResourceString("err_cantadd")),!1}function w(){var b,d,e=this.options;return b=this.options.InterviewNode._dialog.DataSource,d=null!=b&&("CAF"==b.t||!a.TestInBrowser&&("AF"==b.t||"C"==b.t)),d?null==e._answerSourceWindow&&(e._answerSourceWindow=c("<div/>").appendTo("#hdMainDiv")[F]({node:e.InterviewNode}),this.ResizeAnswerSourceWindow(),a.HDEngine.Host.App({ContentResized:y(this.Content_Resized,this)}),e._answerSourceWindow.on("Closed",y(x,this))[F]("Show")):a.Alert(a.Locale.GetStr("err_noastest")),!1}function x(){var b=this.options;a.HDEngine.Host.App({ContentResized:null}),b._answerSourceWindow.off("Closed",x),b._answerSourceWindow[F]("DialogResult")&&null!=b._answerSourceWindow[F]("SelectedRow")&&b.InterviewNode.SetAnswersFromAnswerSourceRow(b._answerSourceWindow[F]("MappedNodes"),b._answerSourceWindow[F]("SelectedRow")),b._answerSourceWindow.remove(),b._answerSourceWindow=null}var y=c.proxy,z="NavigationKeyPress",A="ResourceUpdate",B=b.Windows.Visibility,C=b.Cast,D="TrueFalseInputControl",E="MultipleChoiceInputControl",F="AnswerSourceWindow",G=0;return c.widget("hd.DialogContentControl",r,{options:{_itemRowCount:0,_answerSourceWindow:null,sff:!1,sffEnabled:!1},_create:function(){this._updateWhenDialogContentLoaded=!1,this.LayoutRoot=this.element,this.element.on("keydown",y(this.OnKeyDown,this)),this.element.on("Loaded",y(this.DialogContentControl_Loaded,this)).on("Unloaded",y(this.DialogContentControl_Unloaded,this)),this.LayoutRoot.mousedown(this.LayoutRoot_MouseLeftButtonDown);var b,d,e,f,h,k,l,m,p,q,r,x,B,F,H=this.options,I=null,J=0,K=0,L=H.InterviewNode._itemNodes,M=L.Count();for(H.caption&&(b=c("<tr/>").DialogCaptionControl({node:H.InterviewNode}).appendTo(this.LayoutRoot),K++),c("<tr/>").DialogErrorControl({node:H.InterviewNode}).appendTo(this.LayoutRoot),K++,this.FirstItemNodeRow=K,f=0;M>f;f++){switch(e=L.get(f),0!=f&&e.IsOnPrevLine()||(I=c("<tr/>").appendTo(this.LayoutRoot),++H._itemRowCount,J=0),d=c('<td class="hd-cell-input"/>'),e.DialogItem().type){case"TX":d.TextInputControl({node:e});break;case"NU":d.NumberInputControl({node:e});break;case"DA":d.DateInputControl({node:e});break;case"TF":d[D]({node:e});break;case"MC":d[E]({node:e});break;case"DI":e.IsSpreadsheet()?d.SpreadsheetControl({node:e}):e._parent._dialog.hideCB?d.hide():d.DialogInputControl({node:e});break;case"TXL":switch(h=e.DialogItem(),k=!1,h.dspIn){case"":k=!0;break;case"S":l=e._parent,k=null!=l&&l.IsSpreadsheet();break;case"E":k=e._parent instanceof j}c("<div/>").appendTo(d),k||d.hide();break;case"HDL":c("<table><tr/></table>").appendTo(d);break;case"VSL":h=e.DialogItem(),0==G&&(m=c("<div>W</div>").hide().appendTo("#hdBodyDiv"),G=m.height(),m.remove()),c("<div/>").height(G*(h.spacing/100)).appendTo(d);break;case"SLL":case"WLL":e.DialogItem().env>1?d.LinkControl({node:e}):c("<div/>").appendTo(d).hide();break;case"IML":switch(h=e.DialogItem(),h.just){case"L":F="left";break;case"C":F="center";break;case"R":F="right"}c("<img/>").appendTo(d).attr("src",H.InterviewNode.InterviewImageUrl()+h.img).on("error",this.image_ImageFailed).css({"max-width":"100%","text-align":F})}p=Math.round(6*(e.GetWidth()/100)),d.attr("colspan",p),q=C(d,o),null!=q&&q.element.on(z,y(t,this)).on(A,y(u,this)),d.appendTo(I).trigger("Loaded"),6==d.prev().attr("colspan")&&d.prev().attr("colspan",4==p?2:p)}r=c("<tr/>"),x=c('<td class="hd-cell-input hd-btn-grid" colspan="6"/>').appendTo(r),B=0,s.DisplayAnswerSourceButton(H.InterviewNode)&&(B++,c('<button tabIndex="1"/>').Button({type:n.ImageLeft,icon:"hd-selbtn",label:i.FixAmpersands(a.Lc.GetStr("ui_select")),Tag:H.InterviewNode}).on("click",y(w,this)).appendTo(x)),H.InterviewNode.Type()==g.Iteration&&C(H.InterviewNode,j).DisplayAddButton()&&(B++,this.AddIterationButton=c('<button tabIndex="1"/>').Button({type:n.ImageLeft,icon:"hd-adit",label:i.FixAmpersands(a.Lc.GetStr("ui_select")),Tag:H.InterviewNode}).on("click",y(v,this)).appendTo(x)),B>0&&r.appendTo(this.LayoutRoot)},DialogContentControl_Loaded:function(){this._dialogContentLoaded=!0,this._updateWhenDialogContentLoaded&&(this.Update(!0),this.options.InterviewNode.ReassertFocus(l.Forward),this._updateWhenDialogContentLoaded=!1)},DialogContentControl_Unloaded:function(){this._dialogContentLoaded=!1},SetContentRowMargins:function(){},image_ImageFailed:function(a){var b=c(a.srcElement);c('<div class="hd-img hd-img-missing"/>').insertBefore(b),b.remove()},LayoutRoot_MouseLeftButtonDown:function(){},LastItemNodeRow:function(){return this.FirstItemNodeRow+this.options._itemRowCount},Update:function(d){var g,i,j,k,l,m,n,o,p,r,v,w,x,B,D,F,G,H,I,J=this.options;if(!this._dialogContentLoaded)return this._updateWhenDialogContentLoaded=!0,void 0;if(J.caption&&this.LayoutRoot.children(":first").DialogCaptionControl("Update",d),C(this.LayoutRoot.children().eq(this.FirstItemNodeRow-1),"DialogErrorControl").Update(d),d||0!=(J.InterviewNode.UpdateFlags()&h.DialogContentRelated)||0!=(J.InterviewNode.DescendantUpdateflags()&h.DialogContentRelated)){for(!J.sff&&J.sffEnabled&&(J.sffEnabled=!1,this.LayoutRoot.children(".hd-sff-row").each(function(){var a=c(this);a.children("td").appendTo(a.prev("tr")),J._itemRowCount--,a.remove()}),this.LayoutRoot.children(".hd-lff-row").children("td").each(function(){var a=c(this);a.attr("colspan",a.attr("lff-colspan")),a.children("table").width(a.attr("lff-table-width"))}),c(".hd-dlg-title").each(function(){c(this).prependTo(c(this).parent())})),g=0,i=this.FirstItemNodeRow;i<this.LastItemNodeRow();i++)for(j=this.LayoutRoot.children(":eq("+i+")"),k=0;k<j.children().length;k++){if(l=J.InterviewNode._itemNodes.get(g),m=l.UpdateFlags(),l.IsSpreadsheet()&&(m|=l.SpreadsheetNode().DescendantUpdateflags()),d||0!=(m&h.DialogContentRelated))switch(l.DialogItem().type){case"TX":case"NU":case"DA":case"TF":n=j.children().eq(k),n=n.data("hd-"+n.attr("widget")),n.Update(d);break;case"MC":o=j.children().eq(k),(m&h.AddClear)==h.AddClear&&(p=c('<td class="hd-cell-input"/>')[E]({node:l}),p.on(z,y(t,this)).on(A,y(u,this)).attr("colspan",o.attr("colspan")),o.off(z,t).off(A,u)[E]("Dispose"),j.children().eq(k).replaceWith(p),o=p,o.trigger("Loaded"),d=!0),o[E]("Update",d);break;case"DI":l.IsSpreadsheet()?(r=C(j.children().eq(k),"SpreadsheetControl"),r.Update(d)):l._parent._dialog.hideCB||(n=j.children().eq(k),n.DialogInputControl("Update",d));break;case"TXL":v=j.children().eq(k).children(),null!=v&&((d||(m&h.Hidden)==h.Hidden)&&(l.Hidden()?v.hide():v.show()),(d||0!=(m&(h.Prompt|h.Gray)))&&(w=new q(l),x=new b.Text.StringBuilder,s.DotCodeParser().Parse(w,new f(x)),v.html(x.ToString()),v.removeClass().addClass(w.TextColor())));break;case"HDL":B=j.children().eq(k).children(":first-child"),(d||(m&h.Hidden)==h.Hidden)&&(l.Hidden()?B.hide():B.show()),(d||(m&h.Prompt)==h.Prompt)&&(D=C(l.DialogItem(),a.HdDlgEl),F=b.String.IsNullOrEmpty(l.Prompt()),(0==B.find("td").length||1==B.find("td").length&&!F||B.find("td").length>1&&F)&&this.UpdateHorizontalDivider(D,F,B),F||(G="L"==D.just?0:"C"==D.just?1:1,H=B.find("td:eq("+G+")"),s.DotCodeParser().Parse(new q(l),new e(H,parseInt(H.css("font-size"))*(D.fSize/100),!1)))),(d||(m&h.Gray)==h.Gray)&&B.toggleClass("GrayText",l.Gray());break;case"VSL":(d||(m&h.Hidden)==h.Hidden)&&(I=j.children().eq(k).children(),l.Hidden()?I.hide():I.show());break;case"SLL":case"WLL":C(l.DialogItem(),a.LDlgEl).env>1?j.children().eq(k).LinkControl("Update",d):!1;break;case"IML":(d||(m&h.Hidden)==h.Hidden)&&j.children().eq(k).children()[l.Hidden()?"hide":"show"](),(d||(m&h.Gray)==h.Gray)&&j.children().eq(k).children().animate({opacity:l.Gray()?.3:1})}g++}J.sff&&!J.sffEnabled&&(J.sffEnabled=!0,this.LayoutRoot.children("tr:gt("+(this.FirstItemNodeRow-1)+"):lt("+(this.LastItemNodeRow()-2)+")").each(function(){for(var a,b=c(this).children("td"),d=b.length,e=d-1;e>=0;e--){0==e?a=c(this).addClass("hd-lff-row"):(a=c("<tr/>").addClass("hd-sff-row").insertAfter(c(this)),J._itemRowCount++);var f=b.eq(e),g=f.attr("colspan"),h=f.children("table");f.appendTo(a).attr({"lff-colspan":g,colspan:6,"lff-table-width":h.length>0?h[0].style.width:0}),f.find("table").width("100%").find(".hd-width-calc, .hd-width-exact").width("100%")}}))}},FireNavigationKeyPress:function(a){this.element.trigger(z,a)},FireResourceUpdate:function(a){this.element.trigger(A,a)},Dispose:function(b){if("boolean"!=typeof b&&(b=!0),b){this._setOption("IsEnabled",!1);var c,d,e,f,g,h,i=0;for(d=this.FirstItemNodeRow;d<this.LastItemNodeRow();d++)for(e=this.LayoutRoot.children().eq(d),f=0;f<e.children().length;f++){switch(c=null,g=this.options.InterviewNode._itemNodes.get(i),g.DialogItem().type){case"TX":case"NU":case"DA":case"TF":case"MC":c=e.children().eq(f);break;case"DI":g.IsSpreadsheet()?c=e.children().eq(f):g._parent._dialog.hideCB||(c=e.children().eq(f));break;case"SLL":case"WLL":C(g.DialogItem(),a.LDlgEl).env>1&&(c=e.children().eq(f))}null!=c&&(h=C(c,o),null!=h&&(h.element.off(z,t).off(A,u),h.Dispose())),i++}}},OnKeyDown:function(a){if(9==a.which||33==a.which||34==a.which||36==a.which||35==a.which)this.FireNavigationKeyPress(a);else if(38==a.which||37==a.which||40==a.which||39==a.which)this.OnDialogGroupingKey(a);else if(8==a.which&&"text"!=a.target.type&&"TEXTAREA"!=a.target.tagName)return!1},OnDialogGroupingKey:function(a){var d,e,f=this.options;if("S"==f.InterviewNode._dialog.gType&&"TF"==f.InterviewNode.GetFocusedItemNode().DialogItem().type&&(e=this.LayoutRoot.children().find("[widget="+D+"]"),trueFalseInputControl=b.List.FirstOrDefault(e,function(a){return c(a)[D]("option","node")==f.InterviewNode.GetFocusedItemNode()}),null!=trueFalseInputControl&&(d=e.index(trueFalseInputControl),d>=0)))switch(a.which){case 38:case 37:d>0&&(e.eq(d-1)[D]("SetAnswerAndFocus"),a.Handled=!0);break;case 40:case 39:d<e.length-1&&(e.eq(d+1)[D]("SetAnswerAndFocus"),a.Handled=!0)}},ResizeAnswerSourceWindow:function(){this.options._answerSourceWindow[F]({height:.8*c("#hdWrapper").height(),width:.8*c("#hdWrapper").width()})},Content_Resized:function(){this.ResizeAnswerSourceWindow()},UpdateAddButton:function(a){var b,c,f,g=this.options;(a||(g.InterviewNode.UpdateFlags()&h.AddButtonRefresh)==h.AddButtonRefresh)&&(b=C(g.InterviewNode,j),c=this.AddIterationButton,c[b.AddButtonVisibility()==B.Visible?"show":"hide"](),b.AddButtonIsEnabled()?c.prop("disabled",!1).children(".hd-img-g").removeClass("hd-img-g").addClass("hd-img"):c.prop("disabled",!0).children(".hd-img").removeClass("hd-img").addClass("hd-img-g"),f=c.children("span"),s.DotCodeParser().Parse(new d(b.AddButtonText()),new e(f,f.css("font-size"),!1)),f.text(s.StripAmpersand(f.text())))},UpdateHorizontalDivider:function(a,b,d){if(b)c('<td style="width:100%"><hr/></td>').appendTo(d.find("tr"));else{var e=c("<td nowrap='nowrap'/>").appendTo(d.find("tr"));switch(a.just){case"L":c('<td style="width:100%"><hr/></td>').insertAfter(e);break;case"C":c('<td style="width:50%"><hr/></td>').insertBefore(e),c('<td style="width:50%"><hr/></td>').insertAfter(e);break;default:c('<td style="width:100%"><hr/></td>').insertBefore(e)}}}}),c.hd.DialogContentControl}),define("dialog/popupinterviewwindow",["hd","hdmain/jq","dialog/customnavigationbar","system/jquery.hd.childwindow","dialog/dialogcontrol","dialog/interviewstack"],function(a,b,c,d,e,f){var g=b.proxy;return b.widget("hd.PopupInterviewWindow",d,{options:{focus:function(){b(this).find("#hdPopupInterviewDiv").DialogControl("SetNavButtonMinHeight",b(this).find("#hdNavBar"))}},_create:function(){b.hd.ChildWindow.prototype._create.apply(this,arguments),this.element.addClass("PopupInterviewDiv"),this.options.hdClose=g(this.PopupInterviewWindow_Closing,this),this._interview=this.options.interview,this._scriptLinkDialogElementName=this.options.dlgEl,this._computationVariableName=this.options.compVar,this._dialogControl=b('<div id="hdPopupInterviewDiv"/>').DialogControl({interview:this._interview}),this._dialogControl.on("blur",g(this._dialogControl_FocusLeaving,this)).on("Closed",g(this._dialogControl_Closed,this)),f.PushInterview(this),this._dialogControl.DialogControl("ApplyCustomNavigationbarButtonDefinitions",c.ButtonDefinitions()),this._dialogControl.appendTo(this.element)},_dialogControl_FocusLeaving:function(a,b){b.FocusDirection==FocusDirection.Forward?this._dialogControl.SetFocusToFirstControl():this._dialogControl.SetFocusToLastControl()},PopupInterviewWindow_Closing:function(){null==this.DialogResult()&&this.CloseInterview()},_dialogControl_Closed:function(){f.PopInterview(),this._closing=!0,this.DialogResult(!0),this._closing=!1},ScriptLinkDialogElementName:function(){return this._scriptLinkDialogElementName},ComputationVariableName:function(){return this._computationVariableName},DialogControl:function(){return this._dialogControl},CloseInterview:function(){this._dialogControl.DialogControl("Close")}}),b.hd.PopupInterviewWindow}),define("dialog/linkcontrol",["hd","hdmain/jq","hdmain/system","dialog/tracehelper","dialog/textblockformatter","engine/htmlformatter","engine/dialogupdateflags","dialog/idialogitemnodecontrol","dialog/promptparsersource","dialog/popupinterviewwindow","dialog/dialogcontrol"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){c.CallAsync(r(function(){this.ResizePopupInterviewWindow()},this))}function n(){a.HDEngine.Host.off("Resized."+u,m),this._popupInterviewWindow=null}function o(a,b){d.Focus(this._dialogItemNode,t("FocusEntering({0})",b.OptionName)),this.button.focus()}function p(){d.Focus(this._dialogItemNode,t("GotFocus({0})","")),this._dialogItemNode.SetFocus("")}this.DEBUG===l&&(this.DEBUG=a.DEBUG);var q,r=b.proxy,s=null,t=c.String.Format,u="LinkControl",v=5;return function(){var a=b("<span>5</span>").hide().appendTo("body");q=a.width(),a.remove()}(),b.widget("hd."+u,h,{_create:function(){this._dialogItemNode=this.options.node,this._dialogItemNode.FocusEntering.push(r(o,this));var d,e=c.Cast(this._dialogItemNode.DialogItem(),a.LDlgEl);this.button=b("<button/>").appendTo(this.element).on("focus."+u,r(p,this)).css("padding",v).on("click",r(this.hyperlink_Click,this)),"B"==e.dTyp?(e.bWid>0&&this.button.width(e.bWid*q),e.bHgt>0&&this.button.height(e.bHgt*q),2==e.style?(d=b("<img/>").attr("src",this._dialogItemNode._parent.InterviewImageUrl()+e.img),d.appendTo(this.button)):(this._linkTextBlock=b("<span/>"),this._linkTextBlock.appendTo(this.button))):(e.style>1&&(d=b('<img style="margin-right:5px"/>').attr("src",this._dialogItemNode._parent.InterviewImageUrl()+e.img),d.appendTo(this.button)),(1==e.style||3==e.style)&&(this._linkTextBlock=b("<span/>"),this._linkTextBlock.appendTo(this.button),this._linkTextBlock.addClass("DlgElemLnkText")),this.button.addClass("DlgElemLnk"))},Update:function(b){var d,f,h=c.Cast(this._dialogItemNode.DialogItem(),a.LDlgEl),j=this._dialogItemNode.UpdateFlags();(b||(j&g.Hidden)==g.Hidden)&&(this._dialogItemNode.Hidden()?this.button.hide():this.button.show()),(b||(j&g.Gray)==g.Gray)&&(f=this._dialogItemNode.Gray(),"H"==h.dTyp&&null!=this._linkTextBlock&&this._linkTextBlock.toggleClass("GrayText",f),this.button.prop("disabled",f).children("img").fadeTo(0,f?.3:1)),null!=this._linkTextBlock&&(b||(j&g.Prompt)==g.Prompt)&&(d=new i(this._dialogItemNode),k.DotCodeParser().Parse(d,new e(this._linkTextBlock,parseInt(this._linkTextBlock.css("font-size")),!1)))},FireNavigationKeyPress:function(a){this.element.trigger("NavigationKeyPress",a)},FireResourceUpdate:function(a){this.element.trigger("ResourceUpdate",a)},DialogItemNode:function(){return this._dialogItemNode},Dispose:function(a){"boolean"!=typeof a&&(a=!0),a&&(this.button.off("focus."+u),this._dialogItemNode.FocusEntering.pop())},hyperlink_Click:function(){var c=new Date;if(null==s||c-s>500){s=c,this.button.focus();var d,e,g,h,i=this._dialogItemNode.DialogItem();if(i instanceof a.SlDlgEl)d=this._dialogItemNode.EvaluateComputedVariable(),null!=d&&(e=i,this._popupInterviewWindow=b("<div/>").PopupInterviewWindow({interview:d,dlgEl:e.name,compVar:e.varName}).on("Closed","#hdPopupInterviewDiv",r(n,this)),this.ResizePopupInterviewWindow(),a.HDEngine.Host.on("Resized."+u,r(m,this)),this._popupInterviewWindow.PopupInterviewWindow("open"));else{g=i,h=f.MakeAbsoluteUrl(g.url,!0);try{0==h.indexOf("javascript:")?HDAPI._DoWebLinkAction(h):window.open(h,"_blank",g.openF)}catch(j){}}}return!1},ResizePopupInterviewWindow:function(){this._popupInterviewWindow.PopupInterviewWindow({height:Math.round(.8*b("#hdWrapper").height()),width:Math.round(.8*b("#hdWrapper").width())});var a=this._popupInterviewWindow.find(".hd-dlg-content"),c=b("#hdNavBar"),d=this._popupInterviewWindow.find(".hd-progress");a.height(this._popupInterviewWindow.outerHeight()-c.outerHeight(!0)-d.outerHeight(!0))}}),b.hd[u]}),define("dialog/multchoicelistbox",["hdmain/jq","hdmain/system","dialog/optionprompt"],function(a,b,c,d){return a.widget("hd.MultChoiceListBox",{options:{DisplayMemberPath:"Prompt",Style:"",ItemContainerStyle:""},_create:function(){this.option(this.options)},_setOption:function(c,d){switch(c){case"ItemsSource":this.options.Items=d;for(var e=0;e<d.length;e++)a("<option/>").appendTo(this.element).html(d[e][this.options.DisplayMemberPath]()).attr("value",d[e].Name()).addClass(this.options.ItemContainerStyle);this.element.attr("size",d.length>4?4:d.length);break;case"ItemContainerStyle":this.element.children().removeClass().addClass(d);break;case"SelectionMode":d==b.Windows.Controls.SelectionMode.Single?this.element.removeAttr("multiple"):this.element.attr("multiple","multiple");break;case"Style":this.element.removeClass().addClass("hd-input hd-input-mc "+d)}},SelectedItems:function(){var a,b=this.element.val(),d=[];if(this.element.attr("multiple")||(b=[b]),null!=b)for(a=0;a<b.length;a++)d.push(new c(b[a],this.element.children("[value='"+b[a]+"']").text()));return d},SelectedItem:function(a){if(a===d){var b=this.SelectedItems();return b.length>0?b[0]:null}this.element.val(null!=a?a.Name():null)}}),a.hd.MultChoiceListBox}),define("dialog/numberinputcontrol",["hd","hdmain/jq","hdmain/system","dialog/controlmetrics","dialog/inputcontrol"],function(a,b,c,d,e){var f=c.String.IsNullOrEmpty,g=b.proxy,h=e.prototype,i="hd-input hd-input-num",j=i+"-readonly",k="NumberInputControl",l=new d(b("<input/>").addClass(i)),m=new d(b("<input/>").addClass(j));return b.widget("hd."+k,e,{_create:function(){h._create.apply(this,arguments),this.element.attr("widget",k),this._textBox=b('<input type="text"/>').on("NavigationKeyPress."+k,g(this._textBox_NavigationKeyPress,this)).AnswerTextBox({Style:this._dialogItemNode.ReadOnly()?j:i}),a.iOS&&this._textBox.attr("pattern","[0-9]*"),this._textMetrics=this._dialogItemNode.ReadOnly()?m:l,f(this.Variable().currS)||b("<td/>").addClass("hd-input-currency").text(this.Variable().currS).insertBefore(this.ControlCell),this._dialogItemNode.ReadOnly()||(this._dialogItemNode.ChangeErrorState.push(g(this._dialogItemNode_ChangeErrorState,this)),this._dialogItemNode.AnswerReformatted.push(g(this._dialogItemNode_AnswerReformatted,this))),this._textBox.appendTo(this.ControlCell)},_setOption:function(a,b){switch(a){case"IsEnabled":this._textBox.AnswerTextBox({IsReadOnly:!b});break;case"IsReadOnly":b!=this._isReadOnly&&(b&&this._textBox.AnswerTextBox({IsReadOnly:b}),this._isReadOnly=b);break;case"IsSetByDialogScript":b!=this._isSetByDialogScript&&(b?this._textBox.AnswerTextBox({IsReadOnly:!0,BorderThickness:0,Background:"transparent"}):this._textBox.AnswerTextBox({IsReadOnly:!1,BorderThickness:"",Background:""}),this._isSetByDialogScript=b)}h._setOption.apply(this,arguments)},Dispose:function(a){"boolean"!=typeof a&&(a=!0),h.Dispose.call(this,a),a&&!this._dialogItemNode.ReadOnly()&&(this._dialogItemNode.ChangeErrorState.pop(),this._dialogItemNode.AnswerReformatted.pop())},ControlColumn:function(){return f(this.Variable().currS)?0:1},PromptVerticalAlignment:function(){return VerticalAlignment.Center},MeasureNumber:function(b,c){b=b>0?Math.floor(Math.max(99,b)):Math.ceil(Math.min(-99,b)),c>0&&(b+=(b>0?9:-9)/Math.pow(10,c)),a.PsU();var d=this._textMetrics.GetTextWidth(a.Fmt(b,""));return a.PpU(),d},QuixelFactor:function(){return this._textMetrics.QuixelFactor},CalculatedWidth:function(){if(0==this._calculatedWidth){var a=this.Variable();a.max>0&&(this._calculatedWidth=this.MeasureNumber(a.min>0?a.max:-a.max,a.decPl)),a.min<0&&(this._calculatedWidth=Math.max(this._calculatedWidth,this.MeasureNumber(a.min,a.decPl))),0==this._calculatedWidth&&(this._calculatedWidth=this.MeasureNumber(1e9,a.decPl)),this._calculatedWidth+=this.QuixelFactor()/2}return this._calculatedWidth},SetControlAnswer:function(){this._textBox.val(this._dialogItemNode.StringAnswer())},SetFocus:function(){this._textBox.focus()},SaveControlAnswer:function(){this._dialogItemNode.StringAnswer(this._textBox.val())},_textBox_NavigationKeyPress:function(a,b){this.FireNavigationKeyPress(b)},_dialogItemNode_ChangeErrorState:function(a,b){this.ValidationError.ValidationErrorControl({Text:b.ErrorMessage,Visibility:b.IsError})},_dialogItemNode_AnswerReformatted:function(a,b){this._textBox.val(b.FormattedAnswer)}}),b.hd[k]}),define("dialog/parenttitlecontrol",["hd","hdmain/system","hdmain/jq","dialog/stringformatter","engine/titleparsersource","engine/interviewnodetype","engine/dialogupdateflags","dialog/dialogcontrol"],function(a,b,c,d,e,f,g,h){return c.widget("hd.ParentTitleControl",{_create:function(){this.InitializeComponent(),this.ContextMenu.ContextMenuControl({node:this.options.node}),(null==this.options.node||this.options.node.Type()!=f.Iteration)&&this.ContextMenu.hide()},InitializeComponent:function(){this.Button=c("<button style='width:100%; padding:5px;'/>").appendTo(this.element).on("click",c.proxy(this.Button_Click,this)),this.ContextMenu=c("<div/>").css({"float":"none",position:"absolute",right:"5px"}).appendTo(this.element).ContextMenuControl(),this.Title=c("<div>&nbsp;</div>").appendTo(this.Button),this.option(this.options)},Update:function(a){var c,f=this.ContextMenu.ContextMenuControl("option","node");(a||(f.UpdateFlags()&g.Title)==g.Title)&&(c=new b.Text.StringBuilder,h.DotCodeParser().Parse(new e(f),new d(c,b.Windows.TextWrapping.NoWrap)),this.Title.text(c.ToString())),this.ContextMenu.css("top",this.element.position().top+5)},Button_Click:function(){var b={s:null};return this.ContextMenu.ContextMenuControl("option","node").NavigateTo(!0,b,function(c){c||a.Alert(b)}),!1}}),c.hd.ParentTitleControl}),define("dialog/repeatcontrol",["hd","hdmain/jq","hdmain/system","engine/dialogupdateflags","dialog/iinterviewnodecontrol"],function(a,b,c,d,e,f){this.DEBUG===f&&(this.DEBUG=a.DEBUG);var g=b.proxy,h="ResourceUpdate",i="NavigationKeyPress";return b.widget("hd.RepeatControl",e,{_create:function(){b('<tr><td colspan="6" style="padding:0px;"><table class="hd-content-grid"/></td></tr>').appendTo(this.element),this.LayoutRoot=this.element.find("table")},Dispose:function(a){if(a===f||a)for(this.disable();this.LayoutRoot.children().length>0;)this.RemoveIteration(0)},Update:function(a){var e,f,j,k,l,m=this.options.InterviewNode;if(a||(m.UpdateFlags()&d.RepeatAnswer)==d.RepeatAnswer||0!=(m.DescendantUpdateflags()&d.DialogRelated)){for(j=0;j<m.Children().Count();j++){if(e=m.Children().get(j),f=null,(e.UpdateFlags()&d.NewlyAdded)!=d.NewlyAdded){for(k=j;k<this.LayoutRoot.children().length&&c.Cast(this.LayoutRoot.children().eq(k),"IInterviewNodeControl").options.InterviewNode._id!=e._id;k++);if(k<this.LayoutRoot.children().length){for(l=j;k>l;l++)this.RemoveIteration(j);e.IsHiddenNew()?this.RemoveIteration(j):(f=this.LayoutRoot.children().eq(j),f.DialogContentControl("Update",!1))}}e.IsHiddenNew()||(null==f&&(f=b("<tbody/>").DialogContentControl({InterviewNode:e,caption:!0}),0>=j?f.prependTo(this.LayoutRoot):j>=this.LayoutRoot.children().length?f.appendTo(this.LayoutRoot):f.insertBefore(this.LayoutRoot.children().eq(j)),f.on(i,g(this.dialogContentControl_NavigationKeyPress,this)).on(h,g(this.dialogContentControl_ResourceUpdate,this)).DialogContentControl("Update",!0)),0==j)}for(;j<this.LayoutRoot.children().length;)this.RemoveIteration(j);for(j=m.Children().Count()-1;j>=0;j--)e=m.Children().get(j),e.DisplayAddButton()&&!e.IsHiddenNew()&&(f=this.LayoutRoot.children().eq(j),f.DialogContentControl("UpdateAddButton",a||(e.UpdateFlags()&d.NewlyAdded)==d.NewlyAdded))}},FireNavigationKeyPress:function(a){this.element.trigger(i,a)},FireResourceUpdate:function(a){this.element.trigger(h,a)},dialogContentControl_NavigationKeyPress:function(a,b){this.FireNavigationKeyPress(b)},dialogContentControl_ResourceUpdate:function(a,b){this.FireResourceUpdate(b)},RemoveIteration:function(a){var b=this.LayoutRoot.children().eq(a);b.off(i,this.dialogContentControl_NavigationKeyPress).off(h,this.dialogContentControl_ResourceUpdate).DialogContentControl("Dispose").remove()}}),b.hd.RepeatControl}),define("dialog/spreadsheet",["system/jq.datagrid/datagrid","hdmain/jq"],function(a,b){return b.widget("hd.Spreadsheet",a,{OnApplyTemplate:function(){a.prototype.OnApplyTemplate.apply(this,arguments)},HorizontalScrollBar:function(){return this._hScrollBar}}),b.hd.Spreadsheet}),define("dialog/variablecolumn",["hd","hdmain/system","system/textblock","hdmain/jq","system/jq.datagrid/datagridtemplatecolumn","system/radiobutton","dialog/multchoicecombobox","dialog/multchoiceeditablecomboboxcontrol"],function(a,b,c,d,e,f,g,h,i){function j(){j.baseConstructor.apply(this,arguments)}var k=b.String.Format,l=(b.String.IsNullOrEmpty,b.Windows.Data.BindingMode);return this.DEBUG===i&&(this.DEBUG=a.DEBUG),b.ExtendClass(j,e,null,{CreateTextBlockCellTemplate:function(a){var b=[{Property:"Text",Path:k("DisplayAnswer",a),Mode:l.OneWay},{Property:"Foreground",Path:k("Foreground",a),Mode:l.OneWay}];return this.CreateCellTemplate(null,"TextBlock",b,{HorizontalAlignment:"Left",VerticalAlignment:"Center",Margin:"5,5,5,5",Style:"hd-ss-text"})},CreateCellTemplate:function(b,e,f,g){var h={Type:e,Control:{Bindings:f},LoadContent:function(){var b,e=this.Type;switch(e){case c:b=d('<input type="text"/>')[e]();break;case"AnswerDatePicker":b=d("<label/>")[e]();break;case"MultChoiceEditableComboBoxControl":b=d("<div/>")[e]();break;case"MultChoiceComboBox":b=d("<select/>")[e]();break;case"ChildDialogControl":b=d('<div style="text-align:center"/>')[e]();break;case"RadioButton":b=d('<input type="radio"/>')[e]();break;case"CheckBox":b=d('<input type="checkbox"/>')[e]();break;default:b=d('<input type="text"/>')[e]().attr("autocapitalize","off"),"hd-input-num-ss"==this.Control.Class&&a.iOS&&b.attr("pattern","[0-9]*")}return b.on("keyup",function(a){d(a.target).trigger("TextChanged")}).on("Loaded.VariableColumn",function(){for(var a in g)switch(a){case"Style":b.addClass(g[a]);break;case"HorizontalAlignment":b.parent().css("text-align",g[a])}}),b}};return h}}),j}),define("dialog/textvariablecolumn",["hdmain/system","dialog/variablecolumn"],function(a,b){function c(d){c.baseConstructor.apply(this,arguments);var e=[{Property:"Text",Path:a.String.Format("Answer",d),Mode:a.Windows.Data.BindingMode.TwoWay}];this.CellTemplate=b.CreateTextBlockCellTemplate(d),this.CellEditingTemplate=b.CreateCellTemplate(null,"TextBox",e,{Style:"hd-input-text-ss"})}return a.ExtendClass(c,b),c}),define("dialog/variablecell",["hd","hdmain/system","engine/dialogupdateflags","system/exception/notimplementedexception","dialog/dialogcontrol"],function(a,b,c,d,e,f){function g(a){this._dialogItemNode=a,this._editControl=null,this.PropertyChanged=[]}b.Cast,b.String.IsNullOrEmpty;this.DEBUG===f&&(this.DEBUG=a.DEBUG);var h="hd-ss-text";return b.ExtendClass(g,null,{Answer:function(){throw new d},DisplayAnswer:function(){return this.Answer().toString()},Foreground:function(){return this._dialogItemNode.Gray()?"hd-ss-text-gray":this._dialogItemNode.SetByDialogScript()?"hd-ss-text-set":this._dialogItemNode.ReadOnly()?"hd-ss-text-readonly":h},IsEnabled:function(){return!this._dialogItemNode.Gray()&&!this._dialogItemNode.SetByDialogScript()&&!this._dialogItemNode.ReadOnly()},AnsweredStatus:function(){return this._dialogItemNode.AnsweredStatus()},DialogItemNode:function(){return this._dialogItemNode},Update:function(a){(a||(this._dialogItemNode.UpdateFlags()&c.ScriptAnswer)==c.ScriptAnswer)&&(this.OnScriptAnswerChange(),this.NotifyPropertyChanged(this.AnswerPropertyName())),(a||0!=(this._dialogItemNode.UpdateFlags()&(c.Gray|c.set)))&&(this.NotifyPropertyChanged("Foreground"),this.NotifyPropertyChanged("Background"),this.NotifyPropertyChanged("IsEnabled"))},BeginEdit:function(a){a.is("label")||a.is("div")?a.find("input").focus():a.focus(),e.ScrollIntoView(a),this._editControl=a,this.NotifyPropertyChanged(this.AnswerPropertyName())},EndEdit:function(){this._editControl&&"text"==this._editControl.attr("type")&&this._editControl.attr("disabled",!0),this._editControl=null},EditControl:function(){return this._editControl},NotifyPropertyChanged:function(a){for(var b=0;b<this.PropertyChanged.length;b++)this.PropertyChanged[b]({PropertyName:a})},OnScriptAnswerChange:function(){},AnswerPropertyName:function(){return null!==this._editControl?"Answer":"DisplayAnswer"}}),g}),define("dialog/childdialogcell",["hd","hdmain/jq","hdmain/system","engine/dialogupdateflags","engine/setanswerresult","dialog/variablecell"],function(a,b,c,d,e,f,g){function h(){h.baseConstructor.apply(this,arguments),this.NavigateToChildCommand(j(function(){this.CanNavigateToChild.apply(this,arguments)&&this.OnNavigateToChild.apply(this,arguments)},this)),this.NavigateToChild=[]}var i=c.Cast,j=(c.String.IsNullOrEmpty,b.proxy);return this.DEBUG===g&&(this.DEBUG=a.DEBUG),c.ExtendClass(h,f,{NavigateToChildCommand:function(a){return a===g?this.ntcc:(this.ntcc=a,void 0)},Answer:function(a){return a===g?null!=this._dialogItemNode.BoolAnswer()?this._dialogItemNode.BoolAnswer():!1:(this._dialogItemNode.BoolAnswer(a),void 0)},SaveAnswer:function(){},Update:function(a){h.baseclass.Update.apply(this,arguments),(a||(this._dialogItemNode.UpdateFlags()&d.AnsweredStatus)==d.AnsweredStatus)&&this.NotifyPropertyChanged("AnsweredStatus")},IsEnabled:function(){var a=!0,b=!0;return this._dialogItemNode.Gray()?(b=!1,a=!1):(this._dialogItemNode.SetByDialogScript()||this._dialogItemNode.ReadOnly())&&(b=!1,a=""!=this._dialogItemNode._parent._dialog.gType?this._dialogItemNode.BoolAnswer().GetValueOrDefault():!1),this.IsButtonEnabled(b),a},IsButtonEnabled:function(a){return"boolean"!=typeof a?this._isButtonEnabled:(a!=this._isButtonEnabled&&(this._isButtonEnabled=a,this.NotifyPropertyChanged("IsButtonEnabled")),void 0)},OnNavigateToChild:function(){for(var a=0;a<this.NavigateToChild.length;a++)this.NavigateToChild[a](this,{})},CanNavigateToChild:function(){return!0},BeginEdit:function(a,b){h.baseclass.BeginEdit.apply(this,arguments),i(a,"ChildDialogControl").SetFocus(b)},AnswerPropertyName:function(){return"Answer"}}),h}),define("dialog/optionselectedeventargs",[],function(){function a(a){this.OptionName=a}return a}),define("dialog/multiplechoicevariablecell",["hd","hdmain/jq","hdmain/system","dialog/variablecell","dialog/optionprompt","dialog/optionselectedeventargs"],function(a,b,c,d,e,f,g){function h(){h.baseConstructor.apply(this,arguments),this.OptionSelected=[]}function i(a){var c=k(b(a.target),o);null!=c.SelectedItem()?(this.Answer([c.SelectedItem().Name()]),this.OnOptionSelected(c.SelectedItem().Name())):(this.Answer(null),this.OnOptionSelected(null))}function j(a,c){var d=k(b(a.delegateTarget),n),e=c.A?c.A[0]:d.SelectedOption();if(null!=e){var f=e.Name?e.Name():e;this.Answer([f]),this.OnOptionSelected(f)}else this.Answer(null),this.OnOptionSelected(null)}var k=c.Cast,l=c.String.IsNullOrEmpty;this.DEBUG===g&&(this.DEBUG=a.DEBUG);var m=b.proxy,n="MultChoiceEditableComboBoxControl",o="MultChoiceComboBox",p="SelectionChanged";return c.ExtendClass(h,d,{Answer:function(a){return a===g?this._dialogItemNode.ListAnswer():(this._dialogItemNode.ListAnswer(null!=a?a:null),void 0)},DisplayAnswer:function(){var a,b,c=null,d=this._dialogItemNode.ListAnswer();return null!=d&&d.length>0&&(c=d.slice(0)),null==c?"":(a=this._dialogItemNode.GetOptions().FirstOrDefault(function(a){return c.indexOf(a.name)>-1
}),b=this._dialogItemNode.DialogItem(),!b.MultipleSelect()&&b.othr?null!=a?a.Prompt():c[0]:null!=a?a.Prompt():"")},SaveAnswer:function(){var a,b,c=this._dialogItemNode.DialogItem();!c.MultipleSelect()&&c.othr&&(a=k(this._editControl,n),b=this._dialogItemNode.GetOptions().FirstOrDefault(function(b){return b.Prompt()==a.Text()}),null==b?this.Answer(l(a.Text())?null:[a.Text()]):null==a.SelectedOption()&&this.Answer([b.name]))},BeginEdit:function(a){h.baseclass.BeginEdit.apply(this,arguments);var b,d,f,g,l,q=null,r=this.Answer();null!=r&&r.length>0&&(q=r.slice(0)),b=this._dialogItemNode.GetOptions().Select(function(a){return e.ToOptionPrompt(a)}),d=this._dialogItemNode.DialogItem(),!d.MultipleSelect()&&d.othr?(f=a,f[n]("ItemsSource",b),null==q?f[n]({Text:null}):(g=c.List.FirstOrDefault(b,function(a){return q.indexOf(a.Name())>-1}),null!=g?f[n]("SelectedOption",g):f[n]({Text:q[0]})),f.on(p,m(j,this))):(l=k(this._editControl,o),l._setOption("ItemsSource",b),null==q?l.SelectedItem(null):(g=c.List.FirstOrDefault(b,function(a){return q.indexOf(a.Name())>-1}),l.SelectedItem(g)),l.element.on("change."+p,m(i,this)))},EndEdit:function(){var a=this._dialogItemNode.DialogItem();!a.MultipleSelect()&&a.othr?this._editControl.off(p,j):this._editControl.off("change."+p,i),h.baseclass.EndEdit.apply(this,arguments)},OnOptionSelected:function(a){for(var b=0;b<this.OptionSelected.length;b++)this.OptionSelected[b](this,new f(a))}}),h}),define("dialog/textvariablecell",["hd","hdmain/jq","hdmain/system","engine/dialogupdateflags","engine/setanswerresult","dialog/variablecell"],function(a,b,c,d,e,f,g){function h(){h.baseConstructor.apply(this,arguments)}function i(c){if(this._skipTextChange)this._skipTextChange=!1;else{var d=j(b(c.target),"TextBox"),e={v:d.SelectionStart()},f=a.TxVar.FitTextToPattern(d.Text(),this._dialogItemNode.DialogItem().patrn,e);f!=d.Text()&&(d.Text(f),d.SelectionStart(e.v),this._skipTextChange=!0)}}var j=c.Cast,k=c.String.IsNullOrEmpty,l=b.proxy;return c.ExtendClass(h,f,{Answer:function(a){return a===g?this._dialogItemNode.StringAnswer():(this._dialogItemNode.StringAnswer(a),void 0)},SaveAnswer:function(){null!=this._editControl&&this.Answer(this._editControl.val())},BeginEdit:function(){h.baseclass.BeginEdit.apply(this,arguments);var a=this._dialogItemNode.DialogItem();k(a.patrn)?a.maxLen>0&&this._editControl.attr("maxlength",a.maxLen):(this._skipTextChange=!1,this._editControl.on("TextChanged",l(i,this)))},EndEdit:function(){var a=this._dialogItemNode.DialogItem();k(a.patrn)?a.maxLen>0&&this._editControl.removeAttr("maxlength"):this._editControl.off("TextChanged",i),h.baseclass.EndEdit.apply(this,arguments)}}),h}),define("dialog/numbervariablecell",["hdmain/system","engine/setanswerresult","dialog/variablecell"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return a.ExtendClass(e,c,{Answer:function(c){if(c===d)return a.String.IsNullOrEmpty(this._cachedAnswer)?this._dialogItemNode.StringAnswer():this._cachedAnswer;var e={s:null},f=c;this._cachedAnswer=this._dialogItemNode.SetAnswerString(f,e)==b.AnswerWasSet?null:f},SaveAnswer:function(){this.Answer(this._editControl.val())},OnScriptAnswerChange:function(){this._cachedAnswer=null}}),e}),define("dialog/datevariablecell",["hd","hdmain/jq","hdmain/system","engine/dialogupdateflags","engine/setanswerresult","dialog/variablecell"],function(a,b,c,d,e,f,g){function h(){h.baseConstructor.apply(this,arguments)}return this.DEBUG===g&&(this.DEBUG=a.DEBUG),c.ExtendClass(h,f,{Answer:function(a){if(a===g)return c.String.IsNullOrEmpty(this._cachedAnswer)?this._dialogItemNode.StringAnswer():this._cachedAnswer;var b={s:null},d=a;this._cachedAnswer=this._dialogItemNode.SetAnswerString(d,b)==e.AnswerWasSet?null:d},SaveAnswer:function(){this._editControl.parents().length>0&&this.Answer(this._editControl.AnswerDatePicker("RawText"))},OnScriptAnswerChange:function(){this._cachedAnswer=null}}),h}),define("dialog/truefalsevariablecell",["hd","hdmain/system","dialog/variablecell"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c,{Answer:function(a){return a===d?this._dialogItemNode.BoolAnswer():(this._dialogItemNode.BoolAnswer(a),void 0)},SaveAnswer:function(){},AnswerPropertyName:function(){return"Answer"}}),e}),define("dialog/childdialogcolumn",["hd","hdmain/system","dialog/variablecolumn"],function(a,b,c){function d(a,b){d.baseConstructor.apply(this,arguments);var k=[{Property:g,Path:g,Mode:e.OneWay},{Property:f,Path:f,Mode:e.OneWay},{Property:h,Path:"Answer",Mode:e.TwoWay},{Property:i,Path:i,Mode:e.OneWay},{Property:"NavigateToChildCommand",Path:"NavigateToChildCommand",Mode:e.OneWay}];this.CellTemplate=c.CreateCellTemplate("local","ChildDialogControl",k,{HorizontalAlignment:j,VerticalAlignment:j,GroupType:b}),this.IsReadOnly(!0)}var e=b.Windows.Data.BindingMode,f="AnsweredStatus",g="IsEnabled",h="IsChecked",i="IsButtonEnabled",j="Center";return b.ExtendClass(d,c),d}),define("dialog/truefalsevariablecolumn",["hd","hdmain/system","dialog/variablecolumn"],function(a,b,c){function d(a,b){d.baseConstructor.apply(this,arguments);var k="S"==b?"RadioButton":"CheckBox",l=[{Property:g,Path:e(g,a),Mode:f.OneWay},{Property:h,Path:e("Answer",a),Mode:f.TwoWay}];this.CellTemplate=c.CreateCellTemplate(null,k,l,{HorizontalAlignment:i,VerticalAlignment:i,Style:j}),this.IsReadOnly(!0)}var e=b.String.Format,f=b.Windows.Data.BindingMode,g="IsEnabled",h="IsChecked",i="Center",j="hd-input-tf-ss";return b.ExtendClass(d,c),d}),define("dialog/iterationrow",["hd","hdmain/jq","hdmain/system","system/exception","dialog/tracehelper","engine/dialogupdateflags","engine/focusdirection","dialog/multiplechoicevariablecell","dialog/textvariablecell","dialog/numbervariablecell","dialog/datevariablecell","dialog/childdialogcell","dialog/truefalsevariablecell","dialog/variablecell","engine/focusoperation","dialog/childdialogcolumn","dialog/truefalsevariablecolumn"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a,c){var e,f,g,n,o,p,q=b.hd.SpreadsheetControl.prototype,r=[];for(this.ErrorStateChanged=[],this.OptionSelected=[],this.NavigateToChild=[],this.CellEditStarted=[],this.CellEditEnded=[],this.PropertyChanged=[],this._inSettingCell=!1,this._spreadsheet=a,this._iterationNode=c,f=q.GetColumnItemNodes(this._iterationNode),g=0;g<f.length;g++){switch(n=f[g],n.FocusEntering.push(A(t,this)),n.FocusLeaving.push(A(u,this)),n.AnswerSync.push(A(v,this)),n[F].push(A(w,this)),n[G].push(A(x,this)),n.DialogItem().type){case"TX":e=new i(n);break;case"NU":e=new j(n);break;case"DA":e=new k(n);break;case"TF":e=new m(n);break;case"MC":o=new h(n),o.OptionSelected.push(A(this.mcVarCell_OptionSelected,this)),e=o;break;case"DI":p=new l(n),p.NavigateToChild.push(A(this.childDialogCell_NavigateToChild,this)),e=p;break;default:throw new d("Invalid spreadsheet column type.")}r.push(e)}this.Cells=r,this.EditColumnNumber=-1}function t(a,b){var d=a;e.Focus(d,D),c.Windows.Input.FocusManager.GetFocusedElement()!=this._spreadsheet&&this._spreadsheet.focus(),this.SetCurrentCell(this.DialogItemNodeToColumnNumber(d),!1,b.OptionName)}function u(a){e.Focus(a,E),this.EndCellEdit()}function v(){if(this.EditColumnNumber>=0){var a=this.Cells[this.EditColumnNumber];e.Focus(a.DialogItemNode(),C),a.SaveAnswer()}}function w(a,b){for(var c=0;c<this.ErrorStateChanged.length;c++)this.ErrorStateChanged[c](this,new y(this.DialogItemNodeToColumnNumber(a),this._iterationNode.IterationId(),b.IsError,b.ErrorMessage))}function x(){if(this.EditColumnNumber>=0){var a=this.Cells[this.EditColumnNumber];e.Focus(a.DialogItemNode(),G),a.Update(!0)}}function y(a,b,c,d){this.Column=a,this.IterationId=b,this.IsError=c,this.Message=d}function z(a){this.ChildDialogCell=a}this.DEBUG===r&&(this.DEBUG=a.DEBUG);var A=b.proxy,B=c.Cast,C="AnswerSync",D="FocusEntering",E="FocusLeaving",F="ChangeErrorState",G="AnswerReformatted";return c.ExtendClass(s,null,{Dispose:function(a){if("boolean"!=typeof a&&(a=!0),a){this.EndCellEdit();var b,c,d;for(b in this.Cells)isNaN(parseInt(b))||(c=B(this.Cells[b],n),d=c._dialogItemNode,d.FocusEntering.pop(),d.FocusLeaving.pop(),d.AnswerSync.pop(),d[F].pop(),d[G].pop(),"MultipleChoiceVariableCell"==c.widgetName?c.OptionSelected.pop():"ChildDialogCell"==c.widgetName&&c.NavigateToChild.pop())}},IterationNode:function(){return this._iterationNode},RowNumber:function(a){return a===r?this._rowNumber:(a!=this._rowNumber&&(this._rowNumber=a,this.OnPropertyChanged("RowNumber")),void 0)},EditControl:function(){return this.EditColumnNumber>=0?this.Cells[this.EditColumnNumber].EditControl():null},OnPropertyChanged:function(a){c.CallAsync(A(function(){for(var b=0;b<this.PropertyChanged.length;b++)this.PropertyChanged[b]({PropertyName:a})},this))},Update:function(a){var b;if(a||0!=(this._iterationNode.UpdateFlags()&(f.Gray|f.set|f.AnsweredStatus|f.ScriptAnswer)))for(b in this.Cells)isNaN(parseInt(b))||B(this.Cells[b],n).Update(a)},DialogItemNodeToColumnNumber:function(a){for(var b=0;this.Cells[b].DialogItemNode()!=a;)++b;return b},SetCurrentDialogItem:function(b){if(!this._inSettingCell){var c=B(this.Cells[b],n)._dialogItemNode;e.Focus(c,"SetCurrentDialogItem"),this._editOptionName="DI"==c.DialogItem().type?a.GroupedChildOptionName:null,c.SetFocus(this._editOptionName),c.AssertFocus(o.ReassertOnly,g.Forward,A(function(){this._spreadsheet.Spreadsheet("option","Columns").get(b)instanceof q||this._spreadsheet.Spreadsheet("option","Columns").get(b)instanceof p?this.BeginCellEdit(b,this._spreadsheet.Spreadsheet("option","Columns").get(b).GetCellContent(this)):this._spreadsheet.Spreadsheet("BeginEdit")},this))}},SetCurrentCell:function(a,b,c){if(!this._inSettingCell){this._inSettingCell=!0;var d,f,g;this.EditColumnNumber>=0&&a==this.EditColumnNumber?(d=B(this.Cells[this.EditColumnNumber],n).EditControl(),f=B(d,"ChildDialogControl"),null!=f&&f.SetFocus(c)):(g=B(this.Cells[a],n)._dialogItemNode,e.Focus(g,"SetCurrentCell"),this._spreadsheet.Spreadsheet({SelectedItem:this}),this._spreadsheet.Spreadsheet("CurrentColumn",this._spreadsheet.Spreadsheet("option","Columns").get(a)),this._spreadsheet.Spreadsheet("ScrollIntoView",this,this._spreadsheet.Spreadsheet("option","Columns").get(a)),b&&g.SetFocus(c),this._editOptionName=c,this._spreadsheet.Spreadsheet("option","Columns").get(a)instanceof q||this._spreadsheet.Spreadsheet("option","Columns").get(a)instanceof p?this.BeginCellEdit(a,this._spreadsheet.Spreadsheet("option","Columns").get(a).GetCellContent(this)):this._spreadsheet.Spreadsheet("BeginEdit")),this._inSettingCell=!1}},BeginCellEdit:function(a,b){var c,d,f;for(this.EditColumnNumber=a,c=b,d=B(this.Cells[a],n),e.Focus(d.DialogItemNode(),"BeginCellEdit"),d.DialogItemNode().SetFocus(this._editOptionName),d.BeginEdit(c,this._editOptionName),this._editOptionName=null,f=0;f<this.CellEditStarted.length;f++)this.CellEditStarted[f](this,{})},EndCellEdit:function(){var a,b;for(this.EditColumnNumber>=0&&(a=this.Cells[this.EditColumnNumber],e.Focus(a.DialogItemNode(),"EndCellEdit"),a.EndEdit(),this._spreadsheet.Spreadsheet("CommitEdit",c.Windows.Controls.DataGridEditingUnit.Cell,!0),this.EditColumnNumber=-1),b=0;b<this.CellEditEnded.length;b++)this.CellEditEnded[b](this,{})},mcVarCell_OptionSelected:function(){for(var a=0;a<this.OptionSelected.length;a++)this.OptionSelected[a](this,{})},childDialogCell_NavigateToChild:function(a){for(var b=0;b<this.NavigateToChild.length;b++)this.NavigateToChild[b](this,new z(a))}}),c.ExtendClass(y,null,{Equals:function(a){var b;return null!=b?a.IterationId==this._iterationId&&a.Column==this._column:!1}}),s}),define("dialog/multiplechoicevariablecolumn",["hdmain/system","dialog/variablecolumn"],function(a,b){function c(a,d){c.baseConstructor.apply(this,arguments),this.CellTemplate=b.CreateTextBlockCellTemplate(a),this.CellEditingTemplate="CB"!=d.style&&"CG"!=d.style&&"ML"!=d.style&&d.othr?b.CreateCellTemplate("local","MultChoiceEditableComboBoxControl",null,null):b.CreateCellTemplate("local","MultChoiceComboBox",null,{DisplayMemberPath:"Prompt",Style:"hd-input-mc-cb-ss",ItemContainerStyle:"{StaticResource SpreadsheetMultipleChoiceComboBoxItemStyle}"})}return a.ExtendClass(c,b),c}),define("dialog/datevariablecolumn",["hd","hdmain/system","dialog/variablecolumn"],function(a,b,c){function d(a){d.baseConstructor.apply(this,arguments);var b=[{Property:g,Path:e("Answer",a),Mode:f.TwoWay}];this.CellTemplate=c.CreateTextBlockCellTemplate(a),this.CellEditingTemplate=c.CreateCellTemplate(null,"AnswerDatePicker",b,{Style:h})}var e=b.String.Format,f=b.Windows.Data.BindingMode,g="RawText",h="hd-input-date-ss";return b.ExtendClass(d,c),d}),define("dialog/numbervariablecolumn",["hd","hdmain/system","dialog/variablecolumn"],function(a,b,c){function d(a){d.baseConstructor.apply(this,arguments);var b=[{Property:"Text",Path:e("Answer",a),Mode:f.TwoWay}];this.CellTemplate=c.CreateTextBlockCellTemplate(a),this.CellEditingTemplate=c.CreateCellTemplate(null,"TextBox",b,{Style:g})}var e=b.String.Format,f=b.Windows.Data.BindingMode,g="hd-input-num-ss";return b.ExtendClass(d,c),d}),define("dialog/spreadsheetcontrol",["hd","hdmain/system","dialog/commandhandler","hdmain/jq","dialog/command","system/exception","dialog/textvariablecolumn","system/jq.datagrid/datagridlength","dialog/textblockmetrics","dialog/textblockformatter","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode","engine/focusdirection","system/observablecollection","dialog/childdialogcell","dialog/variablecell","dialog/idialogitemnodecontrol","dialog/resourceupdateeventargs","dialog/promptparsersource","dialog/iterationrow","dialog/dialogcontrol","dialog/multiplechoicevariablecolumn","dialog/childdialogcolumn","dialog/datevariablecolumn","dialog/numbervariablecolumn","dialog/truefalsevariablecolumn"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){function C(a){switch(a.DialogItem().type){case"TX":case"NU":case"DA":case"TF":case"MC":case"DI":return!0}return!1}function D(a){1==a.which&&(a.Handled=!0)}function E(){this._repeatNode._dialog.hideSB||this.ToolbarGrid.css("visibility","visible"),this._hasFocus=!0,this[db]()}function F(){this.ToolbarGrid.css("visibility","hidden"),this._hasFocus=!1,this[db]()}function G(a,b){var c=b.Row.DataGridRow("option","DataContext");c.Cells[b.Column.DisplayIndex()].IsEnabled()||(b.Cancel=!0)}function H(a,b){b.Row.DataGridRow("option","DataContext").BeginCellEdit(b.Column.DisplayIndex(),b.EditingElement)}function I(a,b){var c=b.Row.DataGridRow("option","DataContext");b.Row.DataGridRow("option","Header",c),b.Row.on(jb,cb(Y,this))}function J(a,b){b.Row.off(jb,Y)}function K(){if(!this._inUpdate){var a=this[hb][hb]("option","SelectedItem");null!=a&&a.SetCurrentDialogItem(this[hb][hb]("CurrentColumn").DisplayIndex())}}function L(a){if(this._ignoreNextKeyDown)return this._ignoreNextKeyDown=!1,void 0;if(33==a.which||34==a.which||36==a.which||35==a.which)this.FireNavigationKeyPress(a);else if(13==a.which||45==a.which||46==a.which)this.OnSpreadsheetKeyPress(a);else if(40==a.which){var c,d,e,f=this[hb][hb]("option","ItemsSource"),g=this[hb].data("hd-Spreadsheet").SelectedItem;null!=g&&g==f.Last()&&g.EditColumnNumber>=0&&(c=g.EditColumnNumber,d=g.RowNumber(),e=g.Cells[c],(e.data("hd-TextVariableCell")||e.data("hd-NumberVariableCell")||e.data("hd-DateVariableCell"))&&(e.SaveAnswer(),e.DialogItemNode.IsAnswered&&(g.EndCellEdit(),b.CallAsync(cb(function(){f.Count()==d+1&&(g=f.Last(),g.SetCurrentCell(c,!0,null))},this)))))}}function M(){this._isMouseOver=!0,this[db]()}function N(){this._isMouseOver=!1,this[db]()}function O(a){var b=d(a.target),c=e[b.attr("tag")];this.IsCommandEnabled(c)&&b.addClass("hd-grid-button-hover")}function P(a){var b=d(a.target);b.removeClass("hd-grid-button-hover")}function Q(a){if(1==a.which){var b=e[d(a.target).attr("tag")];this.ExecuteCommand(b),a.preventDefault()}}function R(a){var b,c=a;null!=c.attr("Tag")&&("undefined"==typeof this._columnHeaders&&(this._columnHeaders=[]),b=parseInt(c.attr("Tag")),b>this._columnHeaders.length?this._columnHeaders.push(c):this._columnHeaders.splice(b,0,c),this._columnHeaders.length==this[hb][hb]("option","Columns").Count()&&this.Update(!0))}function S(a,b){null==this._spreadsheetErrors&&(this._spreadsheetErrors=[]);var c=this._spreadsheetErrors[b.Column],d=null;null==c&&(c=[],this._spreadsheetErrors[b.Column]=c),b.IsError?(c.push(b),1==c.length&&this.InsertError(b)):(c.pop(),this.ValidationErrorGrid.children().length&&(d=this.ValidationErrorGrid.children().eq(0)),null!=d&&this.RemoveError(d))}function T(a){var b,d,f,g,h,i,j,k=c.GetRepeatCommandImage;b=k(e.EditIteration,this.IsCommandEnabled(e.EditIteration)),this.EditRowCmd.removeClass().addClass(b),b=k(e.InsertIteration,this.IsCommandEnabled(e.InsertIteration)),this.InsertRowCmd.removeClass().addClass(b),b=k(e.DeleteIteration,this.IsCommandEnabled(e.DeleteIteration)),this.DeleteRowCmd.removeClass().addClass(b),b=k(e.MoveIterationUp,this.IsCommandEnabled(e.MoveIterationUp)),this.MoveRowUpCmd.removeClass().addClass(b),b=k(e.MoveIterationDown,this.IsCommandEnabled(e.MoveIterationDown)),this.MoveRowDownCmd.removeClass().addClass(b),d=a,this._hasResource&&(f=_(d.Cells[d.EditColumnNumber],q),g=f.DialogItemNode(),"MC"==g.DialogItem().type?(h=d.EditControl(),_(h,gb)?(i=_(h,gb),this.SetResourceOptionName(d,null!=i.options.SelectedOption?i.options.SelectedOption.Name():null)):(j=_(h,fb),this.SetResourceOptionName(d,null!=j.SelectedItem()?j.SelectedItem().Name():null))):(this.IsResourceEnabled(null!=g.Resource()),this._resourceOptionName=null,this.FireResourceUpdate(g,null)))}function U(a,b){this.SetResourceOptionName(a,b.OptionName)}function V(b,c){var d,e,f;d=c.ChildDialogCell.DialogItemNode(),""!=d._parent._dialog.gType&&c.ChildDialogCell.ChildDialogCell("Answer",!0),e=d._parent.Children().get(d.DialogItem().name,d._parent._template),null!=e&&(f={s:null},e.NavigateTo(!0,f,function(b){b||a.Alert(f)}))}function W(){this.IsResourceEnabled(!1)}function X(b){var c,d,e,f,g=_(this[hb][hb]("option","SelectedItem"),u);null==g||g.EditColumnNumber<0||(c=_(g.Cells[g.EditColumnNumber],q).DialogItemNode(),c.ClearAnswer(),"MC"==c.DialogItem().type&&(d=_(c.DialogItem(),a.McVar),!d.MultipleSelect()&&d.othr?(e=_(g.EditControl(),gb),e.Text(null)):(f=_(g.EditControl(),fb),f.SelectedItem(null))),b.preventDefault())}function Y(a){9==a.which||33==a.which||34==a.which||36==a.which||35==a.which?(this.FireNavigationKeyPress(a),this._ignoreNextKeyDown=!0):(13==a.which||45==a.which||46==a.which)&&(this.OnSpreadsheetKeyPress(a),this._ignoreNextKeyDown=!0)}function Z(){var a,b=null,c=this[hb][hb]("option","SelectedItem");null!=c&&c.EditColumnNumber>=0&&(a=c.Cells[c.EditColumnNumber].DialogItemNode(),null!=a.Resource()&&(b=v.GetResourceText(a,this._resourceOptionName,!1))),$(b)&&null!=this._dialogItemNode.Resource()&&(b=v.GetResourceText(this._dialogItemNode,null,!1)),$(b)||v.DisplayResourceWindow(b)}var $=b.String.IsNullOrEmpty,_=b.Cast,ab=b.Windows.Controls.ToolTipService.SetToolTip;this.DEBUG===B&&(this.DEBUG=a.DEBUG);var bb,cb=d.proxy,db="UpdateResourceAndClearAnswerButtons",eb="GetResourceString",fb="MultChoiceComboBox",gb="MultChoiceEditableComboBoxControl",hb="Spreadsheet",ib=b.Windows.Visibility,jb="keydown",kb="mouse",lb=kb+"enter",mb=kb+"leave",nb=kb+"down",ob=kb+"up.SpreadsheetControl",pb="CellEditStarted",qb="CellEditEnded",rb="ErrorStateChanged",sb="OptionSelected",tb="NavigateToChild",ub="FocusEntering",vb="FocusLeaving",wb="hd-img",xb="hd-img-g";return function(){bb=new i("hd-ss-text")}(),d.widget("hd.SpreadsheetControl",r,{GetColumnItemNodes:function(a){var b,c,d=[],e=a._itemNodes;for(b=0;b<e.Count();b++)c=e.get(b),C(c)&&d.push(c);return d},_create:function(){this.InitializeComponent(),this.element.on(nb,cb(D,this)),this._dialogItemNode=this.options.node,this._dialogItemNode[ub].push(cb(E,this)),this._dialogItemNode[vb].push(cb(F,this)),this._dialogItemNode.IsDialogOnParent()&&null!=this._dialogItemNode.Resource()&&(this._hasResource=!0),this._repeatNode=this._dialogItemNode.SpreadsheetNode(),!1;var b,c,e,h,i,j,k=d("<div class='hd-grid-rh'/>").hide().appendTo("#hdBodyDiv"),l=Math.max(28,k.height());for(k.remove(),this[hb][hb]({RowHeight:l}),this[hb].on("BeginningEdit",cb(G,this)).on("PreparingCellForEdit",cb(H,this)).on("LoadingRow",cb(I,this)).on("UnloadingRow",cb(J,this)).on("CurrentCellChanged",cb(K,this)).on(jb,cb(L,this)),this.element.on(lb,cb(M,this)).on(mb,cb(N,this)),e=this.GetColumnItemNodes(_(this._repeatNode.Children().get(0),m)),h=0;h<e.length;h++){switch(i=e[h],c=this[hb][hb]("option","Columns").Count(),i.DialogItem().type){case"TX":b=new g(c);break;case"NU":b=new z(c);break;case"DA":b=new y(c);break;case"TF":b=new A(c,this._dialogItemNode._parent._dialog.gType);break;case"MC":b=new w(c,_(i.DialogItem(),a.McVar));break;case"DI":b=new x(c,this._dialogItemNode._parent._dialog.gType);break;default:throw new f("Invalid spreadsheet column type.")}b.Header("&nbsp;"),this[hb][hb]("option","Columns").Add(b),null!=i.Resource()?this._hasResource=!0:"MC"==i.DialogItem().type&&(j=this,d.each(i.GetOptions().list,function(a,b){null!=b.rsrc&&(j._hasResource=!0)}))}this[hb][hb]({ItemsSource:new o}),this[db](),this.IsResourceEnabled(!1),this._repeatNode._dialog.hideSB&&this.ToolbarGrid.hide(),ab(this.ClearAnswerImage,this._repeatNode[eb]("hdmnuClearAns")),ab(this.ResourceImage,this._repeatNode.GetResourceButtonCaption()),ab(this.EditRowCmd,this._repeatNode[eb]("uitt_ssbedit")),ab(this.InsertRowCmd,this._repeatNode[eb]("uitt_ssbins")),ab(this.DeleteRowCmd,this._repeatNode[eb]("uitt_ssbdel")),ab(this.MoveRowUpCmd,this._repeatNode[eb]("hdmnuMoveRowUp")),ab(this.MoveRowDownCmd,this._repeatNode[eb]("hdmnuMoveRowDn"))},_setOption:function(a,b){switch(a){case"ClearAnswerVisibility":this.options.ClearAnswerVisibility!=b&&(b==ib.Visible?this.ClearAnswerImage.css("visibility","visible").on("click",cb(X,this)):this.ClearAnswerImage.css("visibility","hidden").off("click",X));break;case"ResourceVisibility":this.ResourceImage.css("visibility",b==ib.Visible?"visible":"hidden");break;case"Visibility":this.element[b==ib.Visible?"show":"hide"](),b==ib.Visible&&this[hb].triggerHandler("LayoutUpdated")}d.hd.IDialogItemNodeControl.prototype._setOption.apply(this,arguments)},InitializeComponent:function(){this.ControlGrid=d("<table/>").appendTo(this.element),this.ControlRow=d("<tr/>").appendTo(this.ControlGrid),this.InputCell=d('<td style="width:100%"/>').appendTo(this.ControlRow),this[hb]=d("<div/>").appendTo(this.InputCell)[hb]({ColumnHeaderLoaded:cb(R,this),CanUserSortColumns:!1}),this.InputControlButtons=[],this.InputControlButtons.push(d('<td class="hd-cell-button"/>').appendTo(this.ControlRow)),this.InputControlButtons.push(d('<td class="hd-cell-button"/>').appendTo(this.ControlRow)),this.ResourceImage=d('<div class="hd-rsrc" name="HDRsrcBtn"/>').appendTo(this.InputControlButtons[0]),this.ClearAnswerImage=d('<div class="hd-img hd-clr-ans"/>').css("visibility","hidden").appendTo(this.InputControlButtons[1]),this.ValidationErrorGrid=d('<div style="float:left; margin-top:5px;"/>').appendTo(this.InputCell),this.ToolbarGrid=d("<div/>").css("visibility","hidden").appendTo(this.InputCell),this.ImageGrid=d('<div class="hd-grid-buttongrid"/>').appendTo(this.ToolbarGrid),this.EditRowCmd=d('<div tag="EditIteration"/>').appendTo(this.ImageGrid),this.InsertRowCmd=d('<div tag="InsertIteration"/>').appendTo(this.ImageGrid),this.DeleteRowCmd=d('<div tag="DeleteIteration"/>').appendTo(this.ImageGrid),d('<div class="hd-img hd-nav-Sep" style="float:left"/>').appendTo(this.ImageGrid),this.MoveRowUpCmd=d('<div tag="MoveIterationUp"/>').appendTo(this.ImageGrid),this.MoveRowDownCmd=d('<div tag="MoveIterationDown"/>').appendTo(this.ImageGrid),this.ImageGrid.children().filter(":not(.hd-nav-Sep)").on(lb,cb(O,this)).on(mb,cb(P,this)).on(ob,cb(Q,this))},UpdateResourceButton:function(){var a=this.ResourceImage;this._hasResource?(this._setOption("ResourceVisibility",ib.Visible),this._dialogItemNode.ShowAllResourceButtons()||a.css("visibility",this._isMouseOver||this._hasFocus?"visible":"hidden")):(this._setOption("ResourceVisibility",ib.Collapsed),this.InputControlButtons[0].insertAfter(this.InputControlButtons[1]))},UpdateClearAnswerButton:function(){var a,b,c,d=this[hb][hb]("option","SelectedItem");null!=d&&(c=_(d,u),a=_(c.Cells[this[hb][hb]("CurrentColumn").DisplayIndex()],q),b=_(a,p),(null!=b?b.IsButtonEnabled():a.IsEnabled())?(this._setOption("ClearAnswerVisibility",ib.Visible),this.ClearAnswerImage.css("visibility",this._isMouseOver||this._hasFocus?"visible":"hidden")):this._setOption("ClearAnswerVisibility",ib.Collapsed))},UpdateResourceAndClearAnswerButtons:function(){this.UpdateResourceButton(),this.UpdateClearAnswerButton()},Update:function(a){var b,c,e,f,g,i,n,o,p,q,r,s,w,x,y;if(this._inUpdate=!0,(a||(this._dialogItemNode.UpdateFlags()&k.Hidden)==k.Hidden)&&this._setOption("Visibility",this._dialogItemNode.Hidden()?ib.Collapsed:ib.Visible),(a||(this._dialogItemNode.UpdateFlags()&k.Gray)==k.Gray)&&this._setOption("IsEnabled",!this._dialogItemNode.Gray()),null!=this._columnHeaders&&(a||0!=(this._repeatNode.DescendantUpdateflags()&(k.Hidden|k.Prompt|k.Required))))for(b=this.GetColumnItemNodes(_(this._repeatNode.Children().get(0),m)),y=this[hb][hb]("option","Columns"),!1,columnNumber=0;columnNumber<y.Count();columnNumber++)if(c=b[columnNumber],(a||(c.UpdateFlags()&k.Hidden)==k.Hidden)&&y.get(columnNumber).Visibility(c.Hidden()?ib.Collapsed:ib.Visible),(a||0!=(c.UpdateFlags()&(k.Prompt|k.Required)))&&(e=this._columnHeaders[columnNumber].children("span"),"NONE"!=c.Prompt()&&(promptSource=new t(c),v.DotCodeParser().Parse(promptSource,new j(e,e.FontSize,promptSource.Required())),e.text(l.TrimForUseAsTitle(e.text()))),a&&!y.get(columnNumber).Width().IsAbsolute())){if(f=0,g=c.DialogItem(),null!=g)if("E"==g.colWT)f=g.colWid;else switch(c.DialogItem().type){case"TX":f=24;break;case"NU":f=12;break;case"DA":f=10;break;case"MC":f=16}this.options.Visibility!=ib.Visible&&(e=e.clone().appendTo(d("#hdMainDiv"))),y.get(columnNumber).Width(new h(Math.max(e.outerWidth()+22,f*bb.QuixelFactor+12))),this.options.Visibility!=ib.Visible&&e.remove()}if(a||0!=(this._repeatNode.DescendantUpdateflags()&(k.ScriptAnswer|k.Gray|k.set|k.RepeatAnswer))){for(i=this[hb][hb]("option","ItemsSource"),n=i.Count(),q=0;q<this._repeatNode.Children().Count();q++){if(o=_(this._repeatNode.Children().get(q),m),p=null,(o.UpdateFlags()&k.NewlyAdded)!=k.NewlyAdded){for(r=q;r<i.Count()&&i.get(r).IterationNode()._id!=o._id;r++);if(r<i.Count()){for(s=q;r>s;s++)this.RemoveIteration(q);p=i.get(q),p.RowNumber(q+1),p.Update(!1)}}null==p&&(p=new u(this[hb],o),p.RowNumber(q+1),p[rb].push(cb(S,this)),p[pb].push(cb(T,this)),p[qb].push(cb(W,this)),p[sb].push(cb(U,this)),p[tb].push(cb(V,this)),i.Insert(q,p))}for(;q<i.Count();)this.RemoveIteration(q);if(this.Spreadsheet.Spreadsheet({EditingColumnIndex:-1}),null!=this._columnHeaders&&(a||i.Count()!=n)){for(b=this.GetColumnItemNodes(this._repeatNode.Children().get(0)),w=0,columnNumber=0;columnNumber<this[hb][hb]("option","Columns").Count();columnNumber++)b[columnNumber].Hidden()||(w=Math.max(this._columnHeaders[columnNumber].height(),w));x=Math.min(i.Count(),this._dialogItemNode.DialogItem().maxRows),this[hb][hb]({Height:Math.ceil(this[hb][hb]("option","RowHeight"))*x})}}this._inUpdate=!1},FireNavigationKeyPress:function(a){this.element.trigger("NavigationKeyPress",a)},FireResourceUpdate:function(a,b){this.element.trigger("ResourceUpdate",new s(a,b))},DialogItemNode:function(){return this._dialogItemNode},Dispose:function(a){if(a===B||a){this._dialogItemNode[ub].pop(),this._dialogItemNode[vb].pop(),this._inUpdate=!0;for(var b=this[hb][hb]("option","ItemsSource");b.Count()>0;)this.RemoveIteration(0);this._inUpdate=!1}},RemoveIteration:function(a){var b=this[hb][hb]("option","ItemsSource"),c=b.get(a);c[rb].pop(),c[pb].pop(),c[qb].pop(),c[sb].pop(),c[tb].pop(),this.DiscardRowErrors(c),c.Dispose(),b.RemoveAt(a)},InsertError:function(a){var b=d("<div/>").ValidationErrorControl({Tag:a,Text:a.Message});ab(b.children(".hd-img"),this._repeatNode[eb]("ui_err")),b.attr("row",this.ValidationErrorGrid.children().length),b.appendTo(this.ValidationErrorGrid).show()},RemoveError:function(a){a.nextAll().each(function(a,b){var c=d(b),e=c.attr("row");c.attr("row",e-1)}),columnNumber=a.ValidationErrorControl("option","Tag").Column,columnErrors=this._spreadsheetErrors[columnNumber],columnErrors.length>0&&this.InsertError(columnErrors[0]),a.remove()},DiscardRowErrors:function(a){if(null!=this._spreadsheetErrors){var b,c,d,e,f=a.IterationNode().IterationId();for(b=0;b<this._spreadsheetErrors.length;b++)if(null!=this._spreadsheetErrors[b])for(c=this._spreadsheetErrors[b],d=0;d<c.length;)c[d].IterationId==f?c.splice(d,1):d++;for(d=0;d<this.ValidationErrorGrid.children().length;d++)e=_(this.ValidationErrorGrid.children().eq(d),"ValidationErrorControl"),e.options.Tag.IterationId==f&&this.RemoveError(e.element)}},OnSpreadsheetKeyPress:function(a){switch(a.which){case 13:a.ctrlKey?(this.ExecuteCommand(e.EditIteration),a.preventDefault()):!a.shiftKey&&!a.altKey&&a.preventDefault();break;case 45:a.ctrlKey&&(this.ExecuteCommand(e.InsertIteration),a.preventDefault());break;case 46:a.ctrlKey&&(this.ExecuteCommand(e.DeleteIteration),a.preventDefault())}},IsCommandEnabled:function(a){var b=this[hb][hb]("option","SelectedItem");return null==b?!1:c.IsRepeatCommandEnabled(a,this._repeatNode,b.IterationNode().IterationNumber())},ExecuteCommand:function(a){this.IsCommandEnabled(a)&&(c.ExecuteRepeatCommand(a,this._repeatNode,this[hb][hb]("option","SelectedItem").IterationNode().IterationNumber()),a!=e.EditIteration&&this._repeatNode.AdvanceFocus(!1,n.Forward))},SetResourceOptionName:function(a,b){if(this._hasResource){var c,d=a.Cells[a.EditColumnNumber].DialogItemNode(),e=$(b)?null:null;null!=e?(this._resourceOptionName=b,c=!0):(this._resourceOptionName=null,c=!1),!c&&null!=d.Resource&&(c=!0),this.IsResourceEnabled(c),this.FireResourceUpdate(d,this._resourceOptionName)}},IsResourceEnabled:function(a){if("boolean"!=typeof a)return this.ResourceImage.hasClass(wb);var b=this._dialogItemNode.IsDialogOnParent()&&null!=this._dialogItemNode.Resource()?!0:a;b&&!this.ResourceImage.hasClass(wb)?this.ResourceImage.addClass(wb).removeClass(xb).on("click",cb(Z,this)):!b&&!this.ResourceImage.hasClass(xb)&&this.ResourceImage.addClass(xb).removeClass(wb).off("click",Z)}}),d.hd.SpreadsheetControl}),define("dialog/textinputcontrol",["hd","hdmain/jq","hdmain/system","dialog/controlmetrics","dialog/inputcontrol"],function(a,b,c,d,e){var f=c.String.IsNullOrEmpty,g=e.prototype,h=b.proxy,i="TextInputControl",j="TextInputStyle",k="TextReadOnlyStyle",l="AnswerTextBox",m=new d(b("<input/>").TextBox({Style:a.GetStyle(j)})),n=new d(b("<input/>").TextBox({Style:a.GetStyle(k)})),o="Â¶";return b.widget("hd."+i,e,{_create:function(){g._create.apply(this,arguments),this.element.attr("widget",i);var c=this.Variable();this._wrap=b('<div class="hd-input-wrapper"/>').appendTo(this.ControlCell),this._textBox=b(c.fldHgt>1?"<textarea/>":'<input type="text"/>')[l]({Style:a.GetStyle(this._dialogItemNode.ReadOnly()?k:j)}),this._textBox.on("NavigationKeyPress."+i,h(this._textBox_NavigationKeyPress,this)).appendTo(this._wrap),this._textMetrics=this._dialogItemNode.ReadOnly()?n:m,c.fldHgt>1?(this._textBox.attr({rows:c.fldHgt,wrap:"hard"}),c.maxLen>0&&this._textBox.attr("maxlength",c.maxLen)):f(c.patrn)?c.maxLen>0&&this._textBox.attr("maxlength",c.maxLen):this._dialogItemNode.ReadOnly()||(this._textBox.on("TextChanged",h(this._textBox_TextChanged,this)).attr("placeholder",c.patrn),a.iOS&&c.patrn.length>0&&/[0-9\(\)]/.test(c.patrn.substr(0,1))&&this._textBox.attr("pattern","[0-9]*"),this._dialogItemNode.AnswerReformatted.push(h(this._dialogItemNode_AnswerReformatted,this))),"absolute"==this._prompt.css("position")&&this._wrap.css("padding-left",this._prompt.width())},_setOption:function(a,b){switch(a){case"IsEnabled":this._textBox.prop("disabled",!b);break;case"IsReadOnly":b!=this._isReadOnly&&(b&&this._textBox[l]({IsReadOnly:b}),this._isReadOnly=b);
break;case"IsSetByDialogScript":b!=this._isSetByDialogScript&&(b?this._textBox[l]({IsReadOnly:!0,BorderThickness:0,Background:"transparent"}):this._textBox[l]({IsReadOnly:!1,BorderThickness:"",Background:""}),this._isSetByDialogScript=b)}g._setOption.apply(this,arguments)},_textBox_NavigationKeyPress:function(a,b){this.FireNavigationKeyPress(b)},_textBox_TextChanged:function(){if(this._skipTextChange)this._skipTextChange=!1;else{var b=c.Cast(this._textBox,l),d={v:b.SelectionStart()},e=a.TxVar.FitTextToPattern(b.Text(),this.Variable().patrn,d);e!=b.Text()&&(b.Text(e),b.SelectionStart(d.v),this._skipTextChange=!0)}},_dialogItemNode_AnswerReformatted:function(a,b){this._skipTextChange=!0,this._textBox[l]("Text",b.FormattedAnswer)},Dispose:function(a){"boolean"!=typeof a&&(a=!0),g.Dispose.call(this,a),a&&!f(this.Variable().patrn)&&!this._dialogItemNode.ReadOnly()&&this._dialogItemNode.AnswerReformatted.pop()},OnKeyDown:function(a){var b,d,e,f,h=this.Variable();13==a.which&&h.fldHgt>1&&(a.ctrlKey||h.entPar&&!a.shiftKey)&&(b=c.Cast(this._textBox,l),d=b.Text(),e=b.SelectionStart(),f=1,d=d.slice(0,e)+o+d.slice(e),a.ctrlKey&&(d=d.slice(0,e+1)+"\r\n"+d.slice(e+1),f++),b.Text(d),b.SelectionStart(e+f)),g.OnKeyDown.call(this,a)},PromptVerticalAlignment:function(){return this.Variable().fldHgt>1?"T":"C"},FieldWidth:function(){return this.Variable().fldHgt>1?"F":g.FieldWidth.call(this)},QuixelFactor:function(){return this._textMetrics.QuixelFactor},CalculatedWidth:function(){if(0==this._calculatedWidth){var a=this.Variable();this._calculatedWidth=f(a.patrn)?a.maxLen>0?a.maxLen*this.QuixelFactor():30*this.QuixelFactor():this._textMetrics.GetTextWidth(a.patrn),this._calculatedWidth+=this._textBox.width()+this.QuixelFactor()/2}return this._calculatedWidth},SetControlAnswer:function(){this._skipTextChange=!0,this._textBox.val(this._dialogItemNode.StringAnswer())},SetFocus:function(){this._textBox.focus()},SaveControlAnswer:function(){this._dialogItemNode.StringAnswer(this._textBox.val())}}),b.hd[i]}),define("dialog/validationerrorcontrol",["hdmain/jq"],function(a){var b="ValidationErrorControl";return a.widget("hd."+b,{_create:function(){a.Widget.prototype._create.apply(this,arguments),this.element.addClass("hd-validation"),this.Img=a('<div class="hd-img hd-error-16"/>').appendTo(this.element),this.Msg=a("<span/>").appendTo(this.element),this.option(this.options)},_setOption:function(b,c){switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"Text":null!=c&&this.Msg.text(c);break;case"Visibility":this.element[c?"show":"hide"](),c&&this.Img.css("margin-top",Math.max(0,(this.element.outerHeight()-this.Img.height())/2)+"px")}}}),a.hd[b]}),define("dialog",["dialog/answerdatepicker","dialog/answersourcewindow","dialog/answertextbox","dialog/childdialogcontrol","dialog/commandhandler","dialog/contextmenucontrol","dialog/customnavigationbarbutton","dialog/dialogcaptioncontrol","dialog/dialogerrorcontrol","dialog/dialogcontentcontrol","dialog/dialogcontrol","dialog/inputcontrol","dialog/linkcontrol","dialog/multchoicecombobox","dialog/multchoiceeditablecomboboxcontrol","dialog/multchoicelistbox","dialog/numberinputcontrol","dialog/optionprompt","dialog/parenttitlecontrol","dialog/promptparsersource","dialog/repeatcontrol","dialog/spreadsheet","dialog/spreadsheetcontrol","dialog/stringformatter","dialog/textinputcontrol","dialog/validationerrorcontrol"],function(){}),define("system/encoding",["hd","hdmain/system"],function(a,b,c){function d(a,b,c){var d,e,f,g,h,i,j,k=[],m=0;do d=c.call(a,m++),e=c.call(a,m++),f=c.call(a,m++),g=d>>2,h=(3&d)<<4|e>>4,i=(15&e)<<2|f>>6,j=63&f,isNaN(e)?i=j=64:isNaN(f)&&(j=64),k.push(l.charAt(g)+l.charAt(h)+l.charAt(i)+l.charAt(j));while(b>m);return k.join("")}function e(a){if(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),a.length<4)return j.None;var b,c,d,e,f,g,h;return e=l.indexOf(a.charAt(0)),f=l.indexOf(a.charAt(1)),g=l.indexOf(a.charAt(2)),h=l.indexOf(a.charAt(3)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,254==b&&255==c?j.UTF16BE:255==b&&254==c?j.UTF16LE:239==b&&187==c&&191==d?j.UTF8:j.None}function f(a){var b=a%2,c=(a-b)/2;return c>=this.length?0/0:b?255&this.charCodeAt(c):(65280&this.charCodeAt(c))>>8}function g(a){var b=a%2,c=(a-b)/2;return c>=this.length?0/0:b?(65280&this.charCodeAt(c))>>8:255&this.charCodeAt(c)}function h(a){var b=this.charCodeAt(a);return b>255&&(b=63),b}var i=String.fromCharCode,j=b.Text.Encoding,k=a.Utf8={encode:function(a){a=a.replace(/\r\n/g,"\n");var b,c,d=[],e=a.length;for(b=0;e>b;b++)c=a.charCodeAt(b),128>c?d.push(i(c)):c>127&&2048>c?(d.push(i(c>>6|192)),d.push(i(63&c|128))):(d.push(i(c>>12|224)),d.push(i(c>>6&63|128)),d.push(i(63&c|128)));return d.join("")},decode:function(a){for(var b,c,d,e=[],f=a.length,g=0;f>g;)b=a.charCodeAt(g),128>b?(e.push(i(b)),g++):b>191&&224>b?(c=a.charCodeAt(g+1),e.push(i((31&b)<<6|63&c)),g+=2):(c=a.charCodeAt(g+1),d=a.charCodeAt(g+2),e.push(i((15&b)<<12|(63&c)<<6|63&d)),g+=3);return e.join("")}},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.Base64={encode:function(a,b,e){switch(b===c&&(b=j.UTF8),"boolean"!=typeof e&&(e=b!=j.ISO88591,e&&(a=i(65279)+a)),b==j.UTF8&&(a=k.encode(a)),b){case j.UTF16LE:return d(a,2*a.length,g);case j.UTF16BE:return d(a,2*a.length,f);case j.UTF8:return d(a,a.length,String.prototype.charCodeAt);case j.ISO88591:return d(a,a.length,h)}},decode:function(a,b){b===c&&(b=j.UTF8);var d,f,g,h,m,n,o,p,q,r,s,t=e(a.substr(0,4)),u=[],v=0,w=!0;for(t!=j.None&&(b=t),q=b==j.UTF16BE,r=b==j.UTF16LE,s=q||r,a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");v<a.length;)m=l.indexOf(a.charAt(v++)),n=l.indexOf(a.charAt(v++)),o=l.indexOf(a.charAt(v++)),p=l.indexOf(a.charAt(v++)),f=m<<2|n>>4,g=(15&n)<<4|o>>2,h=(3&o)<<6|p,s?(w?(q?u.push(i(256*f+g)):u.push(i(256*g+f)),d=h):(q?u.push(i(256*d+f)):u.push(i(256*f+d)),64!=o&&(q?u.push(i(256*g+h)):u.push(i(256*h+g)))),w=!w):(u.push(i(f)),64!=o&&(u.push(i(g)),64!=p&&u.push(i(h))));return u=b==j.UTF8?k.decode(u.join("")):u.join(""),t==j.None?u:u.substr(1)}}}),define("system/jquery.caret",["hdmain/jq"],function(a){var b="length",c="createRange",d="duplicate",e="number",f="character";a.fn.caret=function(a,g){var h,i,j,k,l,m,n,o,p,q,r,s=this[0],t=document.documentMode,u=typeof t==e&&9>t;return"object"==typeof a&&typeof a.start===e&&typeof a.end===e?(h=a.start,i=a.end):typeof a===e&&typeof g===e?(h=a,i=g):"string"==typeof a?(h=s.value.indexOf(a))>-1?i=h+a[b]:h=null:"[object RegExp]"===Object.prototype.toString.call(a)&&(j=a.exec(s.value),null!==j&&(h=j.index,i=h+j[0][b])),"undefined"!=typeof h?(u?(k=this[0].createTextRange(),k.collapse(!0),k.moveStart(f,h),k.moveEnd(f,i-h),k.select()):(this[0].selectionStart=h,this[0].selectionEnd=i),this[0].focus(),this):(u?(l=document.selection,"textarea"!=this[0].tagName.toLowerCase()?(m=this.val(),p=l[c]()[d](),p.moveEnd(f,m[b]),n=""===p.text?m[b]:m.lastIndexOf(p.text),p=l[c]()[d](),p.moveStart(f,-m[b]),o=p.text[b]):(p=l[c](),q=p[d](),q.moveToElementText(this[0]),q.setEndPoint("EndToEnd",p),n=q.text[b]-p.text[b],o=n+p.text[b])):(n=s.selectionStart,o=s.selectionEnd),r=s.value.substring(n,o),{start:n,end:o,text:r,replace:function(a){return s.value.substring(0,n)+a+s.value.substring(o,s.value[b])}})}}),define("system/jquery.jqswipe",["hdmain/jq"],function(a){a.event.special.swipe={setup:function(){a(this).bind("touchstart",a.event.special.swipe.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.swipe.handler)},handler:function(b){function c(){k.removeEventListener("touchmove",d),e=f=null}function d(d){d.preventDefault();var h=e-d.touches[0].pageX,l=f-d.touches[0].pageY;return Math.abs(h)>=20?(c(),i=h>0?-1:1):Math.abs(l)>=20&&(c(),j=l>0?1:-1),b.type="swipe",g.unshift(b,i,j),(a.event.dispatch||a.event.handle).apply(k,g)}var e,f,g=[].slice.call(arguments,1),h=b.originalEvent.touches,i=0,j=0,k=this;b=a.event.fix(b),1==h.length&&(e=h[0].pageX,f=h[0].pageY,this.addEventListener("touchmove",d,!1))}}}),define("system/jquery.hd.progressbar",["hdmain/jq"],function(a){var b=a.Widget.prototype;return a.widget("hd.progressbar",{options:{val:0,max:100},_create:function(){b._create.apply(this,arguments),this.element.addClass("hd-progress"),this.bar=a("<div/>").appendTo(this.element),this.option(this.options)},_setOption:function(a,c){b._setOption.apply(this,arguments);var d=this.options;switch(a){case"Foreground":this.bar.removeClass().addClass(c);break;case"Maximum":d.max!=c&&"number"==typeof c&&c>=0&&(d.max=c,this._update());break;case"Value":d.val!=c&&"number"==typeof c&&c>=0&&(d.val=c,this._update())}},_update:function(){var a,b=this.options;b.val>b.max&&(b.val=b.max),a=0===b.max?100:Math.ceil(100*(b.val/b.max)),this.bar.width(a+"%")}}),a.hd.progressbar}),define("system/jquery.scrollintoview",["hdmain/jq"],function(a){var b={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}},c={duration:"fast",direction:"both"},d=/^(?:html)$/i,e=function(b,c){c=c||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(b,null):b.currentStyle);var d=document.defaultView&&document.defaultView.getComputedStyle?!0:!1,e={top:parseFloat(d?c.borderTopWidth:a.css(b,"borderTopWidth"))||0,left:parseFloat(d?c.borderLeftWidth:a.css(b,"borderLeftWidth"))||0,bottom:parseFloat(d?c.borderBottomWidth:a.css(b,"borderBottomWidth"))||0,right:parseFloat(d?c.borderRightWidth:a.css(b,"borderRightWidth"))||0};return{top:e.top,left:e.left,bottom:e.bottom,right:e.right,vertical:e.top+e.bottom,horizontal:e.left+e.right}},f=function(b){var c=a(window),f=d.test(b[0].nodeName);return{border:f?{top:0,left:0,bottom:0,right:0}:e(b[0]),scroll:{top:(f?c:b).scrollTop(),left:(f?c:b).scrollLeft()},scrollbar:{right:f?0:b.innerWidth()-b[0].clientWidth,bottom:f?0:b.innerHeight()-b[0].clientHeight},rect:function(){var a=b[0].getBoundingClientRect();return{top:f?0:a.top,left:f?0:a.left,bottom:f?b[0].clientHeight:a.bottom,right:f?b[0].clientWidth:a.right}}()}},g={auto:!0,scroll:!0,visible:!1,hidden:!1};a.fn.extend({scrollintoview:function(e){e=a.extend({},c,e),e.direction=b["string"==typeof e.direction&&e.direction.toLowerCase()]||b.both;var g,h,i,j,k="",l=this.eq(0);return e.direction.x===!0&&(k="horizontal"),e.direction.y===!0&&(k=k?"both":"vertical"),g=l.closest(":scrollable("+k+")"),g.length>0&&(g=g.eq(0),h={e:f(l),s:f(g)},i={top:h.e.rect.top-(h.s.rect.top+h.s.border.top),bottom:h.s.rect.bottom-h.s.border.bottom-h.s.scrollbar.bottom-h.e.rect.bottom,left:h.e.rect.left-(h.s.rect.left+h.s.border.left),right:h.s.rect.right-h.s.border.right-h.s.scrollbar.right-h.e.rect.right},j={},e.direction.y===!0&&(i.top<0?j.scrollTop=h.s.scroll.top+i.top:i.top>0&&i.bottom<0&&(j.scrollTop=h.s.scroll.top+Math.min(i.top,-i.bottom))),e.direction.x===!0&&(i.left<0?j.scrollLeft=h.s.scroll.left+i.left:i.left>0&&i.right<0&&(j.scrollLeft=h.s.scroll.left+Math.min(i.left,-i.right))),a.isEmptyObject(j)?a.isFunction(e.complete)&&e.complete.call(g[0]):(d.test(g[0].nodeName)&&(g=a("html,body")),g.animate(j,e.duration).eq(0).queue(function(b){a.isFunction(e.complete)&&e.complete.call(g[0]),b()}))),this}}),a.extend(a.expr[":"],{scrollable:function(a,c,e){var f,h=b["string"==typeof e[3]&&e[3].toLowerCase()]||b.both,i=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(a,null):a.currentStyle,j={x:g[i.overflowX.toLowerCase()]||!1,y:g[i.overflowY.toLowerCase()]||!1,isRoot:d.test(a.nodeName)};return j.x||j.y||j.isRoot?(f={height:{scroll:a.scrollHeight,client:a.clientHeight},width:{scroll:a.scrollWidth,client:a.clientWidth},scrollableX:function(){return(j.x||j.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(j.y||j.isRoot)&&this.height.scroll>this.height.client}},h.y&&f.scrollableY()||h.x&&f.scrollableX()):!1}})}),define("engine/valuenodelist",["hd","system/exception/argumentoutofrangeexception","hdmain/system","engine/valuenode"],function(a,b,c,d){function e(a){this.T=a,this._list=[],this.ms=-1}return c.ExtendClass(e,null,{SetCount:function(){return this.ms+1},Item:function(a){return this._list[a]},Insert:function(a,c){if(0>a)throw new b("index");(c.IsAns()||c.HasCh()||a<=this.ms)&&(this.PrepareForIndex(a-1),this._list.splice(a,0,c),this.ms++)},RemoveAt:function(a){if(0>a)throw new b("index");if(a>this.ms)return new d(this.T);var c=this._list[a];return this._list.splice(a,1),this.ms--,a>this.ms&&this.ResetCount(),c},PrepareForIndex:function(a){a>this.ms&&(this.ms=a);for(var b=this._list.length;a>=b;b++)this._list.push(new d(this.T))},ResetCount:function(){for(;this.ms>=0&&!this._list[this.ms].IsAns()&&!this._list[this.ms].HasCh();)this.ms--},Xml:function(a,b){var c,e;for(a.WriteStartElement("RptValue"),c=0;c<this.SetCount();c++)this._list[c].Xml(a,b);e=new d(this.T),e.Xml(a,b),a.WriteEndElement()},GetEnumerator:function(){return this._list},Add:function(a){this._list.push(a)},Clear:function(){this._list=[]},Contains:function(a){return this._list.indexOf(a)>=0},Count:function(){return this._list.length},Remove:function(a){var b=this._list.indexOf(a);return b>=0&&this._list.splice(b,1),b>=0}}),e}),define("system/misc",["hd","hdmain/system","hdmain/jq","engine/valuenodelist","engine/valuenode"],function(a,b,c,d,e,f){var g="Control";a.Styles={BaseControlStyle:{t:g,c:"hd-input hd-base-control",s:{FontSize:12}},ReadOnlyStyle:{t:g,b:"BaseControlStyle",c:"hd-readonly"},TextReadOnlyStyle:{t:"TextBox",b:"ReadOnlyStyle",c:"hd-input-text hd-text-readonly",s:{IsReadOnly:!0}},InputStyle:{t:g,b:"BaseControlStyle",c:"hd-input"},TextInputStyle:{t:"TextBox",b:"InputStyle",c:"hd-input-text"}},a.GetStyle=function(b){for(var c,d=[],e={},g=a.Styles[b];g!=f;){if(g.c&&d.push(g.c),g.s)for(c in g.s)e[c]=g.s[c];g=a.Styles[g.b]}return{c:d.join(" "),s:e}},a.ToType=function(a){return null===a||a===f?a+"":{}.toString.call(a).slice(8,-1).toLowerCase()},a.IsArray=function(a){return a?a.constructor==Array:!1},a.ToVT=function(b){if(null===b||b===f)return"UN";var c,g=b;if(b instanceof e&&(g=b.v,b.c instanceof d))for(c=0;c<b.c.Count()&&(g=b.c.Item(c).v,null===g);c++);switch(a.ToType(g)){case"string":return"TX";case"number":return"NU";case"date":return"DA";case"boolean":return"TF";case"array":return"MC";default:return"UN"}},a.IndexOfAny=function(b,c,d){if("string"!=typeof b||!a.IsArray(c))return-1;"number"!=typeof d&&(d=0);var e,f,g=-1;for(e=0;e<c.length&&(f=b.indexOf(c[e],d),f>=0&&(g=0>g?f:Math.min(g,f)),0!==g);e++);return g},Array.prototype.indexOf===f&&(Array.prototype.indexOf=function(a,b){b===f&&(b=0),0>b&&(b+=this.length),0>b&&(b=0);for(var c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1}),a.Split=function(a,b,c){var d,e,f,g=[];for(f=a.split(b),d=0;d<f.length;d++)f[d]=f[d].split(c);for(d=0;d<f.length;d++)if("string"==typeof f[d])g.push(f[d]);else for(e=0;e<f[d].length;e++)g.push(f[d][e]);return g}}),define("system",["system/encoding","system/jquery.caret","system/jquery.jqswipe","system/jquery.hd.progressbar","system/jquery.scrollintoview","system/misc"],function(){}),define("engine/variableincludemode",{TemplateMerge:0,ExplicitAsk:1,ExplicitRepeat:2,ExpressionMerge:3}),define("engine/computationinserttracker",["hd","hdmain/system"],function(a,b){function c(){}return b.ExtendClass(c,null,{IsInsertSet:function(){return!b.String.IsNullOrEmpty(this.InsertTemplateName)}}),c}),define("engine/engine_runtime",["hd","hdmain/system","engine/engine","engine/variableincludemode","engine/hotdocsintrinsicexception","engine/computationinserttracker"],function(a,b,c,d,e,f,g){function h(a,b,c){r(b)||(c&&"\r\n"==a[a.length-1]?a.splice(a.length-1,0,b):a.push(b))}function i(a){i.tknCache===g&&(i.tknCache={});var b=i.tknCache[a];return b===g&&(b=a.replace(/\\t/g,"	").replace(/\\s/g,"Â ").replace(/\\p/g,"\u2029").replace(/\\l/g,"\u2028").replace(/\\h/g,"Â­").replace(/\\\\/g,"\\"),i.tknCache[a]=b),b}function j(a,b){return"string"!=typeof a?"":b?a.replace(/\u2029/g,"Â¶\r\n").replace(/\u2028/g,"\r\n"):a.replace(/\xB6\x0D\x0A/g,"\u2029").replace(/\x0D?\x0A|\x0D/g,"\u2028")}function k(a){if("string"!=typeof a||null===a||0===a.length)return"";var b,c,d,e=0;for(b=0;b<a.length&&(c=a.charAt(b),m(c)||"."==c||"-"==c);b++)e++;if(d=parseInt(a.charAt(e-1),10)+1,10==d&&(d=0),a=a.substr(0,e-1)+d.toString()+(a.length<=e?"":a.substring(e,a.length)),0===d)for(b=e-2;b>=0;b--)if(c=a.charAt(b),"9"==c)a=a.substr(0,b)+"0"+a.substring(b+1,a.length),0===b&&(a="1"+a);else if(m(c)){a=a.substr(0,b)+Number(parseInt(a.charAt(b),10)+1).toString()+a.substring(b+1,a.length);break}for(;a.length>1&&"0"==a.charAt(0)&&"."!=a.charAt(1);)a=a.substr(1,a.length-1);return a}function l(a,b,c){if(null===a||""===a)return"";var d,e,f,g=a.toString(),h=g.split("."),i="",j=0;if(h.length>1){for(;j<h[1].length&&m(h[1].charAt(j));)j++;if(d=j,b>0)if(b>=d){if(i=h[0]+"."+h[1],e=h[0].length+1+d,c===!0)for(j=d;b>j;j++)i=i.substr(0,e)+"0"+(e>=i.length?"":i.substring(e,i.length)),e++}else i=h[0]+"."+h[1].substr(0,b)+(d<h[1].length?h[1].substring(d,h[1].length):""),f=parseInt(h[1].charAt(b),10),f>=5&&(i=k(i));else i=h[0],d<h[1].length&&(i+=h[1].substring(d,h[1].length)),parseInt(h[1].charAt(0),10)>=5&&(i=k(i))}else if(b>0){if(i=h[0],c===!0)for(i+=".",j=0;b>j;j++)i+="0"}else i=h[0];return i}function m(a){return"0"==a||"1"==a||"2"==a||"3"==a||"4"==a||"5"==a||"6"==a||"7"==a||"8"==a||"9"==a?!0:!1}var n,o,p,q=a.CurrentInterview,r=b.String.IsNullOrEmpty,s="ENG";b.ExtendClass(c,null,{AskNone:function(a){return a===g?("boolean"!=typeof n&&(n=!1),n):(n=a,void 0)}}),a.GV=function(a,b){return q().GV(a,b)},a.GVU=function(a,b){return q().GVU(a,b)},a.SV=function(a,b,c){q().DoSetVarValue(a,b,!0,c)},a.Def=function(a,b,c){q().DoSetVarValue(a,b,!1,c)},a.Inc=function(b,c){var d=q().GVImpl(b,!1,c);null!=d&&a.SV(b,d+1,c)},a.Dec=function(b,c){var d=q().GVImpl(b,!1,c);null!=d&&a.SV(b,d-1,c)},a.Mrg=function(a,b){q().IncludeVar(a,d.TemplateMerge,b)},a.Ask=function(a,b){q().IncludeVar(a,b?d.ExplicitRepeat:d.ExplicitAsk)},a.PsU=function(){q().PsU()},a.PpU=function(){q().PpU()},a.GtU=function(){return q().GtU()},a.StU=function(a){q().StU(a)},a.Ins=function(a,b){if(q().InComputationScript()&&null!=q().ComputationInsertTracker){var c=q().ComputationInsertTracker;if(c.IsInsertSet())throw new e("Only a single INSERT statement can be procesed for a computation.");return c.InsertTemplateName=a,!0}return q().ProcessScript(a,b,null)},a.InV=function(a){if(null!=a){var b=a;if(q().InComputationScript()&&null!=q().ComputationInsertTracker){var c=q().ComputationInsertTracker;if(c.IsInsertSet())throw new e("Only a single INSERT statement can be procesed for a computation.");c.InsertTemplateName=b}else q().ProcessScript(b,g,null)}},a.BeI=function(){q().ComputationInsertTracker=new f},a.EnI=function(){if(null!=q().ComputationInsertTracker){var a=q().ComputationInsertTracker;a.IsInsertSet()&&q().ProcessScript(a.InsertTemplateName,a.InsertAssemblyName,null),q().ComputationInsertTracker=null}},a.GPN=function(a){return q().GetPN(a)},a.SPN=function(a,b){q().SetPN(a,b)},a.SetLng=function(a,b,c){s=a,o=b===g?"\x00":b,p=c===g?"\x00":c},a.Lng=function(){return null!=s?s:""},a.FmV=function(a,b,c,d){return q().FormatValue(a,b,c,d)},a.DgA=function(){return a.TRN()},a.SAN=function(a){n=a},a.SUn=function(){return a.StU(!0),null},function(b){function c(a){var b=a;return"function"==typeof b.join&&(b=b.join("|")),b.toLowerCase()}b.Con=function(b,d){return a.GtU()||null==b||null==d?null:c(b).indexOf(c(d))>=0},b.Sw=function(b,d){return a.GtU()||null==b||null==d?null:0==c(b).indexOf(c(d))},b.Ew=function(b,d){if(a.GtU()||null==b||null==d)return null;var e=c(b);return e.length<d.length?!1:e.substr(e.length-d.length)==c(d)},b.IsE=function(b){return a.GtU()||null==b?null:""===c(b)},a.TX=b}(a.TX===g?{}:a.TX),function(b){b.LOR=function(b,c){return a.GtU()||null==b?null:b?b:c.call(q().CurrentTemplate().tplObj,a)},b.LAN=function(b,c){return a.GtU()||null==b?null:b?c.call(q().CurrentTemplate().tplObj,a):b},a.TF=b}(a.TF==g?{}:a.TF),a.Add=function(a,b){q().Add(a,b)},a.Clr=function(a){q().Clr(a)},a.Ers=function(a){q().Ers(a)},a.StL=function(a,b){q().StL(a,b)},a.Gry=function(a,b){q().Gry(a,b)},a.Hid=function(a,b){q().Hid(a,b)},a.Con=function(a,b){q().Con(a,b)},a.Omt=function(a,b){q().Omt(a,b)},a.Req=function(a){q().Req(a)},a.Err=function(a){q().Err(a)},a.PsR=function(){var a=q();a.PushRpt.apply(a,arguments)},a.PpR=function(){q().PpR()},a.IcR=function(){q().IcR()},a.ApRes=function(a){var b,c=q().GetRepeatPunctuation(!1);return r(c)||null==a?a:(b=[a],h(b,c,!0),b.join(""))},a.ApPre=function(a){h(a,q().GetRepeatPunctuation(!0),!1)},a.ApInt=function(a){h(a,q().GetRepeatPunctuation(!1),!0)},a.ApPst=function(a){h(a,q().GetRepeatPunctuation(!1),!0)},a.TRN=function(){return q().TRN()},a.TRC=function(){return q().TopRptCnt()},a.InR=function(){return q().InRpt()},a.PsS=function(a,b){q().PsS(a,b)},a.PpS=function(){q().PpS()},a.Abs=function(b){return a.GtU()||null===b?null:Math.abs(b)},a.Age=function(b){return a.YsF(new Date,b)},a.Ans=function(a,b){return q().Ans(a,b)},a.Cnt=function(a,b){return q().Cnt(a,b)},a.Dat=function(b,c,d){function f(a,b,c){if(isNaN(a))return!1;if(isNaN(b))return!1;if(isNaN(c))return!1;if(1e3>a)return!1;var d=new Date(a,b-1,c);return d.getMonth()+1!=b?!1:d.getDate()!=c?!1:d.getFullYear()!=a?!1:!0}if(a.GtU()||null===b||null===c||null===d)return null;if(!f(d,c,b))throw a.StU(!0),new e(a.Lc.GetStr("err_dateof"));return new Date(d,c-1,b)},a.Day=function(b){return a.GtU()||null===b?null:b.getDate()},a.DOW=function(b){return a.GtU()||null===b?null:b.getDay()+1},a.DsF=function(b,c){if(a.GtU()||null===b||null===c)return null;var d=Math.abs(Date.UTC(c.getFullYear(),c.getMonth(),c.getDate())-Date.UTC(b.getFullYear(),b.getMonth(),b.getDate()));return Math.floor(d/864e5)},a.Fst=function(b,c){return a.GtU()||null===b||null===c?null:(b=b.toString(),""===b||0>=c?"":b.substr(0,c))},a.Fmt=function(b,c){if(a.GtU()||null===b||null===c)return null;var d=[c];return q().FormatValue(b,d)},a.Int=function(b){if(a.GtU()||null===b)return null;var c=parseInt(b,10);return isNaN(c)?0:c},a.Lst=function(b,c){return a.GtU()||null===b||null===c?null:("string"!=typeof b&&(b=b.toString()),""===b||0>=c||"number"!=typeof c?"":b.substr(b.length-c))},a.Len=function(b){return a.GtU()||null===b?null:b.length},a.Max=function(b,c){return a.GtU()||null===b||null===c?null:Math.max(b,c)},a.Mid=function(b,c,d){return a.GtU()||null===b||null===c||null===d?null:b.substr(c-1,d)},a.Min=function(b,c){return a.GtU()||null===b||null===c?null:Math.min(b,c)},a.Mon=function(b){return a.GtU()||null===b?null:b.getMonth()+1},a.MsF=function(b,c){if(a.GtU()||null===b||null===c)return null;if(b>c)return this.MsF(c,b);var d=12*(c.getFullYear()-b.getFullYear())+(c.getMonth()-b.getMonth());return c.getDate()<b.getDate()&&d--,d},a.Oth=function(a,b){return q().Oth(a,b)},a.Pos=function(b,c,d){if(a.GtU()||null===b||null===c||null===d)return null;if(""===b||""===c)return 0;var e,f=b.toString().toUpperCase(),g=c.toString().toUpperCase();return d?(e=f.lastIndexOf(g),0>e&&(e=f.lastIndexOf(g.replace(/&#39;/g,"'")))):(e=f.indexOf(g),0>e&&(e=f.indexOf(g.replace(/&#39;/g,"'")))),e>=0?e+1:0},a.Pwr=function(b,c){return a.GtU()||null===b||null===c?null:Math.pow(b,c)},a.Exp=function(b){return a.GtU()||null===b?null:Math.exp(b)},a.Ln=function(b){return a.GtU()||null===b?null:Math.log(b)},a.Log=function(b){return a.GtU()||null===b?null:Math.LOG10E*Math.log(b)},a.Sqt=function(b){return a.GtU()||null===b?null:Math.sqrt(b)},a.Flr=function(b){return a.GtU()||null===b?null:Math.floor(b)},a.Cel=function(b){return a.GtU()||null===b?null:Math.ceil(b)},a.Fvl=function(b,c,d,e,f){if(a.GtU()||null===b||null===c||null===d||null===e||null===f)return null;var g=b,h=c,i=d,j=e,k=f,l=0,m=g,n=j,o=i,p=h,q=k;return 0!=q&&(q=1),l=m>0?-o*((1+m*q)/m)*(Math.pow(1+m,p)-1)-n*Math.pow(1+m,p):-(o*p+n)},a.Pvl=function(b,c,d,e,f){if(a.GtU()||null===b||null===c||null===d||null===e||null===f)return null;var g=b,h=c,i=d,j=e,k=f,l=0,m=g,n=i,o=h,p=j,q=k;return 0!=q&&(q=1),l=m>0?(-n*((1+m*q)/m)*(Math.pow(1+m,o)-1)-p)/Math.pow(1+m,o):-(n*o+p)},a.Rte=function(b,c,d,e,f){function g(a,b,c,d,e,f){var g;return g=Math.pow(1+a,d),e+b*g+c*((1+a*f)/a)*(g-1)}function h(a,b,c,d,e){var f,h,i,j,k,l,m,n=!1,o=!1,p=0,q=0,r=0,s=0,u=0,v=0;if(0==b)u=Math.pow(-d/a,1/c)-1;else if(m=0!=a||0!=e?e:1,i=b*c*m*(1-c)-a*c*(1+c),j=b*c*(1-c)-2*c*(b*m+a),k=-2*(d+b*c+a),l=Math.pow(j,2)-4*i*k,0>l)u=Math.pow(-1,.5);else{if((k=(-j+Math.sqrt(l))/(2*i))<=0&&(k=(-j-Math.sqrt(l))/(2*i)),l=2*k,i=g(k,a,b,c,d,e),j=g(l,a,b,c,d,e),i>0&&j>0||0>i&&0>j){Math.abs(i)<Math.abs(j)?(o=!0,u=k,f=i):(o=!1,u=l,f=j),0>f?(p=u,q=f):(r=u,s=f);do o?u/=2:u*=2,h=g(u,a,b,c,d,e);while(f>0&&h>0||0>f&&0>h);if(!(h<=Number.MAX_VALUE&&h>=-Number.MAX_VALUE))return h;0>f?(r=u,s=h):(p=u,q=h)}else 0>i?(p=k,q=i,r=l,s=j):(p=l,q=j,r=k,s=i);n=!1;do if(u=(r+p)/2,f=g(u,a,b,c,d,e),Math.abs(f)<t?n=!0:0>f?f>q&&(p=u,q=f):s>f&&(r=u,s=f),v++,v>=1e3)return 2*Number.MAX_VALUE;while(!n)}return u}if(a.GtU()||null===b||null===c||null===d||null===e||null===f)return null;var i=b,j=c,k=d,l=e,m=f,n=0,o=k,p=j,q=i,r=l,s=m,t=1e-4;return 0!=s&&(s=1),n=h(o,p,q,r,s),n<=Number.MAX_VALUE&&n>=-Number.MAX_VALUE?n:null},a.Ter=function(b,c,d,e,f){if(a.GtU()||null===b||null===c||null===d||null===e||null===f)return null;var g=b,h=c,i=d,j=e,k=f,l=0,m=g,n=i,o=h,p=j,q=k;if(0!=q&&(q=1),m>0)l=Math.log((o*(1+m*q)/m-p)/(o*(1+m*q)/m+n))/Math.log(m+1);else{if(!(o>0))return null;l=-(p+n)/o}return l},a.Pmt=function(b,c,d,e,f){if(a.GtU()||null===b||null===c||null===d||null===e||null===f)return null;var g=b,h=c,i=d,j=e,k=f,l=0,m=g,n=i,o=h,p=j,q=k;if(0!=q&&(q=1),m>0&&o>0&&q>=0)l=(-n*Math.pow(1+m,o)-p)/((1+m*q)/m*(Math.pow(1+m,o)-1));else{if(!(o>0))return null;l=-(p+n)/o}return l},a.Mod=function(b,c){return a.GtU()||null===b||null===c?null:0===c?(a.StU(!0),1):b%c},a.Rep=function(b,c,d,e){if(a.GtU()||null===b||null===c||null===d||null===e)return null;"number"!=typeof e&&(e=2147483647);var f,g=i(c).toLowerCase(),h=i(d),k=0,l=j(b,!1),m=l.toLowerCase(),n=0,o=g.length,p=h.length;for(f=0;e>f&&(n=m.indexOf(g,k),-1!=n);f++)k=n+p,l=l.slice(0,n)+h+l.slice(n+o),m=l.toLowerCase();return j(l,!0)},a.Rnd=function(b,c){return a.GtU()||null===b||null===c?null:(c>7&&(c=7),parseFloat(l(b,c,!1)))},a.Sel=function(a,b,c){return q().Sel(a,b,c)},a.Spc=function(b,c){return a.GtU()?null:null===b?"":null===c?(a.StU(!0),null):j(j(b,!0)+i(c),!1)},a.Stp=function(b,c,d,e){if(a.GtU()||null===b||null===c||null===d||null===e)return null;var f,g,h=j(b,!1),k=0,l=h.length;if(null===h||""===h)return"";if(f=h.toLowerCase(),g=i(c).toLowerCase(),d)for(;l>k&&-1!=g.indexOf(f.substr(k,1));)k++;if(e)for(;l>k&&-1!=g.indexOf(f.substr(l-1,1));)l--;return j(h.substr(k,l-k),!0)},a.Trm=function(b){return a.Stp(b," \\t\\l",!0,!0)},a.Sum=function(a,b){return q().Sum(a,b)},a.Tdy=function(){return a.GtU()?null:new Date},a.Trc=function(b,c){if(a.GtU()||null===b||null===c)return null;var d,e=l(b,7,!1),f=e.indexOf(".");if(-1!=f){for(d=f+1;d<e.length&&m(e.charAt(d));d++);for(;d>f&&!(c>=d-f);)e=e.substring(0,d)+(d<e.length-1?e.substring(d+1,e.length):""),d--}return parseFloat(e)},a.Uni=function(b,c,e,f){if(a.GtU())return null;var g,h,i,j,k;if(q().IncludeVar(b,d.ExpressionMerge),g=q().GVImpl(b,!1,c),q().IncludeVar(e,d.ExpressionMerge),h=q().GVImpl(e,!1,f),null==h)return null;if(null==g)return h;i=g;for(k in h)j=h[k],i.indexOf(j)<0&&i.push(j);return i},a.Val=function(b,c,d){if(a.GtU())return null;var e=q().GVImpl(b,!1,c);return null!=e?e:(null==d&&a.StU(!0),d)},a.Yer=function(b){return a.GtU()||null===b||"function"!=typeof b.getFullYear?null:b.getFullYear()},a.YsF=function(b,c){if(a.GtU()||null===b||null===c)return null;var d=b>c?c:b,e=b>c?b:c,f=e.getFullYear()-d.getFullYear();return(e.getMonth()<d.getMonth()||e.getMonth()==d.getMonth()&&e.getDate()<d.getDate())&&f--,f},a.Zro=function(b){return a.GtU()?null:null===b||"number"!=typeof b?0:b}}),define("engine/textlayoutconstraint",{AnyLength:0,NeedSingleLine:1}),define("engine/dialogitemnode",["hd","hdmain/system","system/exception","hdmain/jq","system/exception/argumentexception","engine/textlayoutconstraint","engine/formattingcontext","engine/dotcode","engine/answeredstatus","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode","engine/movefocuseventargs","engine/repeatindices","engine/repeatnode","engine/setanswerresult","engine/focusdirection","engine/focusoperation","runtime/variable","runtime/datevariable"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){function w(a,b,c){this.ChangeErrorState=[],this.AnswerReformatted=[],this.FocusEntering=[],this.FocusLeaving=[],this.AnswerSync=[],this._updateFlags=k.None,this._parent=a,this._parentIndex=b,this._varListIndex=c,this._flags=G.None,this._prompt=null,this._promptIsSingleLine=!0,this._focusedItem=-1}function x(a){this.FormattedAnswer=a}function y(a){this.IsError=null!=a&&""!=a,this.ErrorMessage=a}var z=b.String.Format;this.DEBUG===v&&(this.DEBUG=a.DEBUG);var A=d.proxy,B=b.Cast,C="TX",D="NU",E="DA",F="IsSpreadsheetRowInSpreadsheet",G={None:0,Hidden:1,Gray:2,req:4,set:8,ghs:16,omt:32,ccl:64,err:128},H=b.String.IsNullOrEmpty,I=a.NoneOfTheAboveIndex=-1,J=a.SpreadsheetIndex=-2,K=a.NoneOfTheAboveOptionName="$00NOTA",L=a.OtherOptionName="$00OTHER",M=a.OtherInputName="$00OTHERINPUT",N=a.GroupedChildOptionName="$00GROUPED",O=a.TrueOptionName="True",P=a.FalseOptionName="False";return b.ExtendClass(w,null,{OnChangeErrorState:function(a){for(var b=0;b<this.ChangeErrorState.length;b++)this.ChangeErrorState[b](this,new y(null==a?null:a.GetErrorMessage()))},OnAnswerReformatted:function(a){for(var b=0;b<this.AnswerReformatted.length;b++)this.AnswerReformatted[b](this,new x(a))},OnFocusEntering:function(a,b){for(var c=0;c<this.FocusEntering.length;c++)this.FocusEntering[c](this,new n(this,a,b))},OnFocusLeaving:function(){for(var a=0;a<this.FocusLeaving.length;a++)this.FocusLeaving[a](this,{})},OnAnswerSync:function(){var a,b=!1;if(this.AnswerSync.length>0&&this.WantsAnswer()){a=this._parent._interview.CurrentNodeId();for(var c=0;c<this.AnswerSync.length;c++)this.AnswerSync[c].call(this);a!=this._parent._interview.CurrentNodeId()&&(b=!0)}return b},NoneOfTheAbove:function(){return this._varListIndex==I},GroupNumber:function(){return this.NoneOfTheAbove()?this._parent._itemNodes.get(this._parentIndex-1).GroupNumber():this._parent._dialog.GetTrueFalseGroupNumber(this._varListIndex)},IsSpreadsheet:function(){if(this._varListIndex==J)return!0;var b=this.DialogItem();return"DI"!=b.type?!1:"S"==B(b,a.Dlg).rType&&this.IsDialogOnParent()},SpreadsheetNode:function(){return this._varListIndex==J?B(this._parent,p):B(this._parent.Children().get(this.DialogItem().name,this._parent._template),p)},IsDialogOnParent:function(){var b=this.DialogItem();return"DI"!=b.type?!1:B(b,a.Dlg).onPar?this._parent[F]()?!1:this._parent._parent.Type()!=j.Root&&B(this._parent._parent,l)[F]()?!1:this._varListIndex==J&&this._parent._parent.Type()==j.Root?!1:!0:!1},IsChildDialogButton:function(){return this._varListIndex!=J&&!this.IsDialogOnParent()},WantsAnswer:function(){var a=this.DialogItem();return a instanceof t?"DI"!=a.type?!0:""!=this._parent._dialog.gType&&this.IsChildDialogButton()?!0:!1:!1},ReadOnly:function(){if(this.NoneOfTheAbove()){if(this._parent.IsItemInProtectedGroup(this._parent._itemNodes.get(this._parentIndex-1)._varListIndex))return!0}else{var a=this._parent.VariableIsUserModifiable(B(this.DialogItem(),t));if(!a)return!0;if("S"==this._parent._dialog.gType&&this._parent.IsItemInProtectedGroup(this._varListIndex))return!0}return!1},SetUpdateFlags:function(a){this._updateFlags|=a;var b=k.AnswerRelated;""!=this._parent._dialog.gType&&!this.NoneOfTheAbove()&&"DI"==this.DialogItem().type&&(b|=k.NodeChildCount|k.ChildCount),0!=(a&b)&&this._parent.SetUpdateFlags(a&b)},ClearUpdateFlags:function(){this._updateFlags=k.None},Update:function(){var b,c,d,e=this.DialogItem(),f="";return e instanceof t?(b=B(e,t),f=b.EvPrompt(),H(f)?(this._promptIsSingleLine=!0,"DI"==b.type&&(c=B(b,a.Dlg),"R"==c.rType&&(f=c.EvRptT())),H(f)&&(f=b.EvTitle())):this._promptIsSingleLine=!1):e instanceof a.TxDlgEl?(f=B(e,a.TxDlgEl).EvText(),this._promptIsSingleLine=!1):e instanceof a.HdDlgEl?(f=B(e,a.HdDlgEl).EvCapt(),this._promptIsSingleLine=!0):e instanceof a.LDlgEl?(f=B(e,a.LDlgEl).EvCapt(),H(f)?(this._promptIsSingleLine=!0,"SLL"==e.type?f=B(e,a.SlDlgEl).varName:"WLL"==e.type&&(f=B(e,a.WlDlgEl).url)):this._promptIsSingleLine=!1):(f="",this._promptIsSingleLine=!0),this.Prompt(f),e instanceof a.McVar&&(d=this.GetOptions(),d.EvaluatePrompts(),d.HaveOptionsChanged()&&this.SetUpdateFlags(k.AddClear)),this._updateFlags
},AnsweredStatus:function(){var b,c=this.DialogItem();return c instanceof a.Dlg?(b=B(this._parent.Children().get(c.name,this._parent._template),l),null==b?i.Unanswered:b.AnsStatus().Status()):this.IsAnswered()||this.Hidden()||this.Gray()||this.SetByDialogScript()?i.Answered:i.Unanswered},IsAnswered:function(){return this.NoneOfTheAbove()?!1:this._parent.VariableHasAnswer(B(this.DialogItem(),t))},ClearAnswer:function(b){"boolean"!=typeof b&&(b=!0),!1;var c,d,e,f,g,h,i=this.DialogItem();if(i instanceof t&&this.Visible()&&!this.Gray())if(this.IsSpreadsheet()){for(c=-1!=this._focusedItem,d=this.SpreadsheetNode(),this.ClearFocus(),h=0;h<d.Children().Count();h++)d.Children().get(h).ClearAnswers(b);c&&this._parent.AdvanceFocus(!1,r.Forward)}else b&&this._parent.DoAnswerSync(),e=this.IsAnswered()&&!this.ReadOnly(),(this._parent._interview.RemoveDialogItemNodeError(this)||e)&&(this.SetUpdateFlags(k.ScriptAnswer),e?(this._parent._dialog.nota&&(f={},g={},this.GetTrueFalseGroupBounds(f,g),f.v>=0&&this._parent._itemNodes.get(g.v+1).SetUpdateFlags(k.ScriptAnswer)),this._parent._interview._engine.ClearAnswer(i.name,i.type,this._parent.Indices())):this._parent._interview.BeginDisplayUpdate(!1)),i instanceof a.Dlg&&this._parent[F]()&&this._parent.Children().get(i.name,this._parent._template).ClearAnswers(!1)},VarIsMarked:function(a){return null!=this._parent?this._parent._interview.VarIsMarked(a):!1},Marked:function(){var a=this.DialogItem();switch(a.type){case C:case D:case E:case"TF":case"MC":return this.VarIsMarked(a.name);default:return!1}},MapName:function(){return this.NoneOfTheAbove()||this._varListIndex==J?null:this._parent.GetItemMapName(this._varListIndex)},MapType:function(){return this.NoneOfTheAbove()||this._varListIndex==J?"UN":this._parent.GetItemMapType(this._varListIndex)},DialogItem:function(){return this.NoneOfTheAbove()?this._parent._interview.GetNOTAProxyForDialog(this._parent._dialog,this.GroupNumber()):this._varListIndex==J?this._parent._dialog:this._parent._dialog.vList.GetItem(this._varListIndex)},Indices:function(){return this._parent.Indices()},Parent:function(){return this._parent},Caption:function(){return this.GetCaption(f.AnyLength,h.DefaultProcessor)},IsPromptSingleLine:function(){return this._promptIsSingleLine},Prompt:function(a){return a===v?this._prompt:(this._prompt!=a&&this.SetUpdateFlags(k.Prompt),this._prompt=a,void 0)},GetCaption:function(c,d){var e,h,i,j,k,m,n;if(this._prompt){if(j=c!=f.NeedSingleLine||this._promptIsSingleLine?this._prompt:l.TrimForUseAsTitle(this._prompt),j.indexOf("Â«")>=0){for(j=j.replace("Â«Â«","ââ"),k=a.Split(j,"Â«","Â»"),m=new b.Text.StringBuilder,n=0;n<k.length;n++)n%2==0?m.Append(l.HDEscQuots(k[n],!0,!1)):(m.Append("Â«"),m.Append(k[n]),m.Append("Â»"));j=m.ToString().replace("ââ","Â«Â«")}h=d(j,g.RichText,e)}else i=this.DialogItem(),h=i instanceof t?i.name:"",h=l.HDEscQuots(h,!0,!1);return this.Required()&&a.RequiredAsterisk&&(h="NONE"==h?"*":"*"+h),h},UpdateFlags:function(){return this._updateFlags},ShowAllResourceButtons:function(){return this._parent._interview._engine.ShowAllResourceButtons},Resource:function(){switch(this.DialogItem().type){case C:case D:case E:case"TF":case"MC":case"DI":case"CO":return B(this.DialogItem(),t).rsrc;default:return null}},PrepareForScriptEvaluation:function(){this._oldFlags=this._flags,this._flags=G.None},AfterScriptEvaluation:function(){var b,c,d=this._flags^this._oldFlags;0!=(d&G.Gray)&&(this._updateFlags|=k.Gray,b=this.DialogItem(),b instanceof a.Dlg&&(c=this._parent.Children().get(b.name,this._parent._template),null!=c&&c.Active(!this.Gray()))),0!=(d&G.Hidden)&&(this._updateFlags|=k.Hidden,this.DialogItem()instanceof a.Dlg&&this._parent.Children().Count()>0&&this._parent.Children().get(this.DialogItem().name,this._parent._template).Active(!this.Hidden())),0!=(d&G.req)&&(this._updateFlags|=k.Required),0!=(d&G.err)&&(this._updateFlags|=k.HasError),0!=(d&G.set)&&(this._updateFlags|=k.set)},GetFlag:function(a){return 0!=(this._flags&a)},SetFlag:function(a,b){b?this._flags|=a:this._flags&=~a},Visible:function(){return!this.Hidden()&&!this.AutoHidden()},AutoHidden:function(){var b,c=this.DialogItem();return c instanceof a.Dlg?(b=B(this._parent.Children().get(c.name,this._parent._template),l),null==b||b.AutoHidden()):this.GetFlag(G.Hidden)&&!this.GetFlag(G.ghs)},Hidden:function(a){return a===v?this._parent.IsSpreadsheetRow()&&B(this._parent,m).IterationNumber()>0?this._parent._parent.Children().get(0)._itemNodes.get(this._parentIndex).GetFlag(G.Hidden):this.GetFlag(G.Hidden):(this._parent.IsSpreadsheetRow()&&0!=B(this._parent,m).IterationNumber()||(this.SetFlag(G.ghs,!0),this.SetFlag(G.Hidden,a)),void 0)},Gray:function(a){return a===v?this.GetFlag(G.Gray):(this.SetFlag(G.ghs,!0),this.SetFlag(G.Gray,a),void 0)},GrayOrHideSetByScript:function(a){return a===v?this.GetFlag(G.ghs):(this.SetFlag(G.ghs,a),void 0)},Required:function(a){return a===v?this.GetFlag(G.req):(this.WantsAnswer()&&this.SetFlag(G.req,a),void 0)},HasError:function(a){return a===v?this.GetFlag(G.err):(this.SetFlag(G.err,a),void 0)},SetByDialogScript:function(a){return a===v?this.GetFlag(G.set):(this.SetFlag(G.set,a),void 0)},OmittedFromAnswerSource:function(a){return a===v?this.GetFlag(G.omt):(this.SetFlag(G.omt,a),void 0)},ConcealedOnAnswerSource:function(a){return a===v?this.GetFlag(G.ccl):(this.SetFlag(G.ccl,a),void 0)},NeedsProcessing:function(){var b=this.DialogItem(),c={v:null};return b instanceof a.DlgEl?!1:"DI"!=b.type?!0:this.Gray()||this.Hidden()?!1:""==this._parent._dialog.gType||this.IsDialogOnParent()||(this.GetAnswerBool(c),c.v)?!0:!1},GetOptions:function(){var b=B(this.DialogItem(),a.McVar);if(null==b)throw new e(a.Lc.GetStr("err_retrvopt"),"itemIndex");return this._parent._interview.GetRuntimeOptionsForVariable(b,this._parent._template.name)},GetAnswerString:function(b){var c,d,e,f=B(this.DialogItem(),t);if(null!=f)switch(f.type){case C:if(c=this._parent._interview._engine.GetAnswer(f.name,C),null!=c&&(d=c.GetValue(this.Indices()),null!=d))return b.v=d,!0;break;case D:if(b.v=this._parent._interview.GetErrorValue(this),!H(b.v))return!1;if(e=B(f,a.NuVar),d=this._parent.GetVariableAnswerDouble(e),null!=d)return b.v=a.Lc.FormatNumberDef(d,e.decPl),!0;break;case E:if(b.v=this._parent._interview.GetErrorValue(this),b.v)return!1;if(d={},this._parent.GetVariableAnswerDate(B(f,u),d))return b.v=a.Lc.FormatDate(d.v.getDate(),d.v.getMonth()+1,d.v.getFullYear(),!1),!0}return b.v="",!1},SetAnswerString:function(b,c){var d,f,g,h,i,j,k=B(this.DialogItem(),t);if(null==k)throw new e(a.Lc.GetStr("err_setvar"),"itemIndex");switch(c.s="",k.type){case C:return d={v:H(b)?null:b},f=B(k,a.TxVar).ValidateText(d),this._parent._interview._engine.LoadAnswerValue("TX",k.name,d.v,k.saveAns,this.Indices()),f&&this.OnAnswerReformatted(d.v),q.AnswerWasSet;case D:return g=a.Lc.ParseNumber(b),"err"!=g?this._parent.SetVariableAnswerDouble(k,g,c)?(h=q.AnswerWasSet,this._parent._interview.RemoveDialogItemNodeError(this),j={},this.GetAnswerString(j)&&j.v!=b&&this.OnAnswerReformatted(j.v)):h=q.OutOfRange:(h=q.InvalidAnswer,c=a.Lc.GetStr("val_invnum")),h!=q.AnswerWasSet&&this._parent._interview.AddDialogItemNodeError(this,b),h;case E:return i=a.Lc.ParseDate(b),"err"!=i?(h=q.AnswerWasSet,this._parent.SetVariableAnswerDate(B(k,u),i),this._parent._interview.RemoveDialogItemNodeError(this),j={},this.GetAnswerString(j)&&j.v!=b&&this.OnAnswerReformatted(j.v)):(h=q.InvalidAnswer,c=a.Lc.GetStr("val_invdate"),this._parent._interview.AddDialogItemNodeError(this,b)),h;case"MC":return this._parent.SetVariableAnswerList(B(k,a.McVar),b),q.AnswerWasSet}return q.InvalidAnswer},GetAnswerDouble:function(b){var c=B(this.DialogItem(),a.NuVar);return null!=c?this._parent.GetVariableAnswerDouble(c):(b=Double.NaN,!1)},SetAnswerDouble:function(b,c){var d=B(this.DialogItem(),a.NuVar);if(null==d)throw new e(a.Lc.GetStr("err_setvar"),"itemIndex");return this._parent.SetVariableAnswerDouble(d,b,c)},GetAnswerDate:function(a){var b=B(this.DialogItem(),u);return null!=b?this._parent.GetVariableAnswerDate(b,a):(a.v=DateTime.MinValue,!1)},SetAnswerDate:function(b){var c=B(this.DialogItem(),u);if(null==c)throw new e(a.Lc.GetStr("err_setdat"),"itemIndex");this._parent.SetVariableAnswerDate(c,b)},GetAnswerBool:function(a){var b,c,d,e,f,g,h,i,j;if(this.NoneOfTheAbove()){for(a.v=!0,b={},c={},this.GetTrueFalseGroupBounds(b,c),g=b.v;g<=c.v;g++)if(d=this._parent._itemNodes.get(g),e=d.DialogItem(),f={v:null},("TF"==e.type||"DI"==e.type)&&(d.GetAnswerBool(f),f.v)){a.v=!1;break}return!0}return h=B(this.DialogItem(),t),null==h||(i=this._parent._interview._engine.GetAnswer(h.name,h.type),null==i||"TF"!=h.type&&"DI"!=h.type||(j=i.GetValue(this._parent.Indices()),null==j))?(a.v=!1,!1):(a.v=j,!0)},GetTrueFalseGroupBounds:function(a,b){if(this.NoneOfTheAbove()?this._parent._dialog.GetTrueFalseGroupBounds(this._parent._itemNodes.get(this._parentIndex-1)._varListIndex,a,b):this._parent._dialog.GetTrueFalseGroupBounds(this._varListIndex,a,b),a.v>=0)for(var c=this._parent._dialog.vList.GetItem(a.v).name;this._parent._itemNodes.get(a.v).DialogItem().name!=c;)a.v++,b.v++},SetAnswerBool:function(b){var c,d,f=B(this.DialogItem(),t);if(null==f||"TF"!=f.type&&"DI"!=f.type)throw new e(a.Lc.GetStr("err_settf"),"variable");c={},d={},this.GetTrueFalseGroupBounds(c,d),c.v>=0&&(this.NoneOfTheAbove()||"S"==this._parent._dialog.gType?this._parent.ClearGroupedItems(c.v,d.v,this):"M"==this._parent._dialog.gType&&this._parent._dialog.nota&&this._parent._itemNodes.get(d.v+1).SetUpdateFlags(k.ScriptAnswer)),this.NoneOfTheAbove()?this._parent._interview.Update():this._parent._interview._engine.LoadAnswerValue("TF",f.name,b,f.saveAns,this._parent.Indices())},GetAnswerList:function(b){var c=B(this.DialogItem(),a.McVar);return null!=c?this._parent.GetVariableAnswerList(c,b):(b=null,!1)},SetAnswerList:function(b){var c=B(this.DialogItem(),a.McVar);if(null==c)throw new e(a.Lc.GetStr("err_setmc"),"itemIndex");this._parent.SetVariableAnswerList(c,b)},GetAnswerOther:function(b){var c=B(this.DialogItem(),a.McVar);return null!=c?this._parent.GetVariableAnswerOther(c,b):(b=null,!1)},StringAnswer:function(a){var b,c;return a===v?(b={},this.GetAnswerString(b)?b.v:""):(c={s:null},this.SetAnswerString(a,c),void 0)},DoubleAnswer:function(a){var b,d;if(a===v)return this.GetAnswerDouble(b)?b:null;if(d={s:null},!this.SetAnswerDouble(a,d))throw new c(d);return 0},DateAnswer:function(a){if(a===v){var b={};return this.GetAnswerDate(b)?b.v:null}this.SetAnswerDate(a)},BoolAnswer:function(a){if(a===v){var b={v:null};return this.GetAnswerBool(b)?b.v:null}this.SetAnswerBool(a)},ListAnswer:function(a){if(a===v){var b=[];return this.GetAnswerList(b)?b:null}this.SetAnswerList(a)},OtherAnswer:function(){var a;return this.GetAnswerOther(a)?a:null},GetWidth:function(){return this.NoneOfTheAbove()||this._varListIndex==J?100:this._parent.GetItemWidth(this._varListIndex)},IsOnPrevLine:function(){return this.NoneOfTheAbove()||this._varListIndex==J?!1:this._parent.IsItemOnPrevLine(this._varListIndex)},EvaluateComputedVariable:function(){var b=B(this.DialogItem(),a.SlDlgEl);return null!=b?this._parent._interview.ProcessComputationScript(b.varName,this._parent.TemplateOfOrigin()):null},ClearFocus:function(){if(this.IsSpreadsheet()&&this._focusedItem>=0){var a=this.SpreadsheetNode(),b=B(a.Children().get(this._focusedItem),m);b.ClearFocusedItemNode()}this.OnFocusLeaving(),this._focusedItem=-1},SetFocus:function(b){if(!this._parent._interview.IgnoringNextFocus()){var c,d,e,f,g,h,i,k,n,o=this._parent._interview.GetFocusItem(),p=this.DialogItem(),q=null,r=null;if(o==this)return!H(b)&&"MC"==p.type&&!this._parent[F]()&&(q=B(p,a.McVar),r=this._parent._interview.GetRuntimeOptionsForVariable(q,this._parent._template.name),b==L&&0==this._focusedItem&&null!=this.OtherAnswer()||b==K&&this._focusedItem==r.Count()||b==M&&1==this._focusedItem||this._focusedItem>=0&&this._focusedItem<r.Count()&&b==r.GetItem(this._focusedItem).name),void 0;c=this._parent._interview.GetFocusItem(),d=null!=c&&c._parent[F](),e=d&&this._parent[F]()&&c._parent._parent._id==this._parent._parent._id,f=!1,null!=c&&(f=c.OnAnswerSync()),this._parent._interview.ClearFocusItem(),d&&!e&&B(c._parent,m).SpreadsheetItemNode().OnFocusLeaving(),g=this._parent,g[F]()&&(g=B(g._parent,l)),(g.Type()!=j.Iteration||!B(g,m).IsSpreadsheetRowInEditMode())&&g.IsOnParent()&&(g=B(g._parent,l)),g!=this._parent._interview.CurrentOutlineNode()&&this._parent._interview.GotoDialog(g,"",!1,!1,function(b,c){b||a.Alert(c)}),this._parent._interview.SetFocusNode(this._parent),h=1,i=!1,k=!1,"MC"!=p.type||this._parent[F]()?"TF"!=p.type||this._parent[F]()?"DI"==p.type&&!this.IsDialogOnParent()&&""!=this._parent._dialog.gType&&(k=!0,h=2):(this._parent.Type()==j.DefaultDialog||null!=this._parent._dialog&&""==this._parent._dialog.gType)&&(i=!0):(null==r&&(q=B(p,a.McVar),r=this._parent._interview.GetRuntimeOptionsForVariable(q,this._parent._template.name)),n=q.style,i="RB"==n||"RG"==n,k=!i&&("CB"==n||"CG"==n),k?(h=r.Count(),q.othr&&h++):i&&q.othr&&null!=this.OtherAnswer()&&h++),this._focusedItem=this.CanFocus()?i?"TF"==p.type?0:b==M?1:0:k?"DI"==p.type?b==N?0:1:b==K?r.Count():r.IndexOf(b):0:-1,this._parent.SetFocus(this._parentIndex)}},GetRowFocus:function(){return this._varListIndex==J&&this.IsDialogOnParent()&&!this.SpreadsheetNode().EditRowMode()?this.SpreadsheetNode().SpreadsheetItemNode().GetRowFocus():this._focusedItem},SetRowFocus:function(a){var b,c=this._focusedItem;this._focusedItem=a,0>c&&this._parent._interview.TriggerFocusEnter(this,null,r.Forward),a>=0&&(b=this._parent,b.IsOnParent()&&(b=B(b._parent,l)),b.SetFocus(this._parentIndex))},CanFocus:function(){var b=this.DialogItem(),c=b instanceof a.DlgEl;return!c||b instanceof a.LDlgEl?"DI"==b.type&&!this.IsDialogOnParent()&&this._varListIndex!=J&&this._parent._dialog.hideCB?!1:this._parent[F]()?!c&&this.Visible()&&!this.Gray()&&!this.SetByDialogScript():this.Visible()&&!this.Gray()&&!this.SetByDialogScript():!1},AssertFocus:function(b,c,d){function e(){this._focusedItem>=0&&this._focusedItem<w?f.Children().get(this._focusedItem).AdvanceFocus(b==s.Advance,c,A(function(a){return a?(-1==g&&this._parent._interview.TriggerFocusEnter(this,null,c),d(!0),void 0):(b=s.AdvanceIfNecessary,this._focusedItem+=c==r.Forward?1:-1,e.call(this),void 0)},this)):(this._focusedItem=-1,this.OnFocusLeaving(),d(!1))}d===v&&(d=function(){});var f,g,h,i,k,l,m,n,o,p,q,t,u=this.DialogItem(),w=1;if(this._varListIndex==J||this.IsDialogOnParent())return this._varListIndex==J&&this.IsDialogOnParent()&&!this.SpreadsheetNode().EditRowMode()?(this.SpreadsheetNode().SpreadsheetItemNode().AssertFocus(b,c,d),void 0):this.CanFocus()?(f=this.SpreadsheetNode(),b!=s.ReassertOnly&&(w=f.Children().Count(),g=this._focusedItem,-1==this._focusedItem?this._focusedItem=c==r.Forward?0:w-1:this._focusedItem>=w&&(this._focusedItem=w-1)),this._focusedItem>=0&&this._focusedItem<w?(e.call(this),void 0):(this._focusedItem>=0&&this._focusedItem<f.Children().Count()&&f.Children().get(this._focusedItem).ReassertFocus(r.Forward),d(!0),void 0)):(this._focusedItem=-1,d(!1),void 0);if(h=!1,i=!1,k=!1,l=null,"MC"!=u.type||this._parent[F]()?"TF"!=u.type||this._parent[F]()?"DI"==u.type&&!this.IsDialogOnParent()&&""!=this._parent._dialog.gType&&(i=!0,w=2):(this._parent.Type()==j.DefaultDialog||null!=this._parent._dialog&&""==this._parent._dialog.gType)&&(h=!0):(m=B(u,a.McVar),k=m.othr,n=m.style,h="RB"==n||"RG"==n,i=!h&&("CB"==n||"CG"==n),l=this._parent._interview.GetRuntimeOptionsForVariable(B(u,a.McVar),this._parent._template.name),i?(w=l.Count(),k&&w++):h&&k&&null!=this.OtherAnswer()?w++:("SL"==n||"ML"==n)&&0==l.Count()&&(w=0)),o=this._focusedItem,h){if("TF"==u.type){if((-1==this._focusedItem||b!=s.Advance)&&this.CanFocus())return this._focusedItem=0,p={v:null},this.GetAnswerBool(p)?this._parent._interview.TriggerFocusEnter(this,p.v?O:P,c):this._parent._interview.TriggerFocusEnter(this,c==r.Forward?O:P,c),d(!0),void 0}else if(b!=s.ReassertOnly&&(this._focusedItem=-1==this._focusedItem?c==r.Forward?0:w-1:0==this._focusedItem?c==r.Forward&&2==w?1:-1:c==r.Forward?-1:0),this._focusedItem>=0&&(l.Count()>0||k)&&this.CanFocus())return 1==this._focusedItem?q=M:(p=[],this.GetAnswerList(p)?(t=l.IndexOf(p[0]),q=t>=0?l.GetItem(t).name:L):q=c==r.Forward&&l.Count()>0?l.GetItem(0).name:k?L:l.GetItem(l.Count()-1).name),this._parent._interview.TriggerFocusEnter(this,q,c),d(!0),void 0}else if(i){if(b!=s.ReassertOnly&&(-1==this._focusedItem?this._focusedItem=c==r.Forward?0:w-1:this._focusedItem+=c==r.Forward?1:-1),this._focusedItem>=0&&this._focusedItem<w&&this.CanFocus())return null!=l&&this._focusedItem==l.Count()?this._parent._interview.TriggerFocusEnter(this,K,c):"DI"==u.type&&this._focusedItem==w-1?this._parent._interview.TriggerFocusEnter(this,null,c):this._parent._interview.TriggerFocusEnter(this,"DI"==u.type?N:l.GetItem(this._focusedItem).name,c),d(!0),void 0}else if(w>0&&b!=s.Advance&&this.CanFocus())return this._focusedItem=0,this._parent._interview.TriggerFocusEnter(this,null,c),d(!0),void 0;this._focusedItem=-1,o>=0&&this.OnFocusLeaving(),d(!1)},Serialize:function(a){a.WriteStartElement(this.DialogItem().type),a.WriteAttributeString("Name",this.DialogItem().name),this.Gray()&&a.WriteAttributeString("Gray","true"),this.Hidden()&&a.WriteAttributeString("Hidden","true"),this.Required()&&a.WriteAttributeString("Required","true"),this.SetByDialogScript()&&a.WriteAttributeString("SetByDialogScript","true");var b=this.Caption();!H(b)&&b!=this.DialogItem().name&&a.WriteElementString("Caption",b),a.WriteEndElement()},ToString:function(){return z('DialogItem Node "{0}" {1}',this.DialogItem().name,o.ToString(this._parent.Indices()))}}),w}),define("engine/defaultdialognode",["hd","hdmain/system","system/exception/argumentnullexception","engine/interviewnodetype","engine/interviewnode","engine/interviewnodelist","engine/dialogitemnodelist","runtime/variable","runtime/dialogitemlist"],function(a,b,c,d,e,f,g,h,i,j){function k(b,c){var e=[0];k.baseConstructor.call(this,b,d.DefaultDialog,b.Root(),new a.Dlg(c.name,null,null,null,null,0,0,"c",0,!0,!1,!0,"G","",""," ",0,"l",new i([c]),null,"",!1,!1,!0,null,null,10,"",!1,"T",!1,12,!0,!1,!1,!1,e,null,null),null,null),this._itemNodes=new g(1),this._itemNodes.Add(c.name,this,0),this._interview.RegisterNode(this),this.InitializeId()}var l,m=b.String.IsNullOrEmpty;return b.ExtendClass(k,e,{Variable:function(){return b.Cast(this._dialog.vList.GetItem(0),h)},DoAnsweredStatusTabulation:function(){this._answeredStatus.Reset();var a=this.Variable();this.VariableHasAnswer(a)?this._answeredStatus.IncAnswered(a.warnUna,!1,!1):this._answeredStatus.IncUnanswered(a.warnUna,!1)},EvTitle:function(){var a=this.Variable().EvTitle();return m(a)&&(a=e.TrimForUseAsTitle(this.Variable().EvPrompt()),"NONE"==a&&(a=this.Variable().name)),a},SerializeElements:function(a){this._itemNodes.get(0).Serialize(a),base.SerializeElements(a)}},{CreateOrLocate:function(a,f,g){if(null==a)throw new c("interview");if(null==f)throw new c("variable");var h=a.CurrentBuildNode()!=a._root?b.Cast(a.CurrentBuildNode(),e):null,i=b.Cast(a._root.Children().FindExisting(f.name,d.DefaultDialog,h,a.CurrentTemplate()),k);return null==i?(i=new k(a,f),g.v=!0):g.v=!1,i.InitUpdate(),i},_emptyChildren:function(){return l===j&&(l=new f(null,0)),l}}),k}),define("engine/interview_outline",["hd","hdmain/system","engine/interviewnodetype","engine/interviewnode","engine/dialognode","engine/iterationnode","engine/defaultdialognode","engine/repeatnode","hdmain/jq","engine/interview","runtime/variable","engine/hotdocsintrinsicexception","engine/rootnode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b.Cast;this.DEBUG===n&&(this.DEBUG=a.DEBUG),b.ExtendClass(j,null,{DefineInterviewNode:function(b,i,j){if(!(this._outlineStack.Count()<=0)){var k,l,n,p,q,r,s,t,u,v,w,x=this.CurrentBuildNode(),y=i&&x.Type()!=c.Root,z={v:!1};if(y&&(x=this._root),"DI"==b.type)if(l=o(b,a.Dlg),n=x.Active(),n&&!i&&(p=o(x.Type()!=c.Repeat?x:x._parent,d),null!=p&&!(p instanceof m)&&(n=p._itemNodes.get(b.name).NeedsProcessing())),""!=l.rType&&x.Type()!=c.Repeat){if(this._varInfo.SetAddedToInterview(l,this.CurrentTemplate().name),q=h.CreateOrLocate(this,x,l,z),this._outlineStack.Push(q),n&&q.EvaluateText(),a.PsR(l.name),n||!l.trimIter){for(;this.CurrentIndex()<this.TopLimitedAnswerCount();)this.DefineInterviewNode(l,!1,!1),a.IcR();l.trimIter&&q.Children().TrimUnanswered()}q.Active(n),r=q.Children().UpdatedCount(),r<this.TopMaxRptCount()&&(this.DefineInterviewNode(l,!1,!0),a.IcR()),this.TopRptCnt(r),q.AnsweredIterationCount=r,q.Limit=this.TopRptLim(),a.PpR(),this._outlineStack.Pop(),k=q}else{""!=l.rType?s=f.CreateOrLocate(this,o(x,h),j,z):(this._varInfo.SetAddedToInterview(l,this.CurrentTemplate().name),s=e.CreateOrLocate(this,x,l,z)),this._outlineStack.Push(s),n&&(this.ProcessDialogScript(s),""!=l.rType&&(t=this._varInfo.GetInfo(l,this.CurrentTemplate().name).GetLimit(s.Indices()),null!=t&&this.TopRptLim(t)),s.EvaluateText()),s.Active(n);var A=l.vList.Count();for(u=0;A>u;u++)v=l.vList.GetItem(u),"DI"==v.type&&this.DefineInterviewNode(o(v,a.Dlg),!1,!1);this._outlineStack.Pop(),k=s}else this._varInfo.SetAddedToInterview(b,this.CurrentTemplate().name),w=g.CreateOrLocate(this,b,z),this._outlineStack.Push(w),w.EvaluateText(),this._outlineStack.Pop(),k=w;k.Children().Trim(),k.TabulateAnsweredStatus(),z.v||x.Children().RemoveUntil(k),x.Children().Add(k)}},GetAnswerCount:function(c,d,e){if(e===n&&(e=null),null==e&&!c.IsRepeated())throw new l(b.String.Format("The dialog {0} is not repeated. A dialog used with REPEAT, COUNT or SUM must have a repeated style.",c.name));var f={},g=0,h=0,j=this;return i.each(c.vList.list,function(b,e){e instanceof k&&"DI"!=e.type&&a.Answers.TryGetAnswer(e.name,e.type,f)?g=f.v.GetChildCount(d):e instanceof a.Dlg&&(""==c.gType?g=j.GetAnswerCount(o(e,a.Dlg),d,c):a.Answers.TryGetAnswer(e.name,"TF",f)&&(g=f.v.GetChildCount(d))),g>h&&(h=g)}),c.trimIter,h},ProcessDialogScript:function(b){var c,d,e,g,h,i,j,l,m,n,p,q,r,s,t,u,v,w=b._dialog;for(r=b._itemNodes.Count(),c=0;r>c;c++)b._itemNodes.get(c).PrepareForScriptEvaluation();if(w.EvScr(),this._engine.AutoInterviews()){for(this.PsS(w.name,"D"),d=this._repeatStack.GetIndices(),c=0;c<w.vList.Count();c++)i=w.vList.GetItem(c),i instanceof k&&!(i instanceof a.Dlg)&&(e=o(i,k),g=this._varInfo.GetInfo(e,this.CurrentTemplate().name),h=g.GetUsed(d),"H"==e.autoIA?this.AutoHideVar(e.name,!h):"G"==e.autoIA&&this.AutoGrayVar(e.name,!h));this.PpS()}for(this.BeginBulkAnswerChange(),c=0;c<w.vList.Count();c++)s=w.vList.GetItem(c),"MC"==s.type&&(v=o(s,a.McVar),t=this._engine.GetAnswer(v.name,"MC"),null!=t&&(u={v:t.GetValue(b._indices)},v.ReconcileOptions(u,this.GetRuntimeOptionsForVariable(v,b._template.name))&&this._engine.LoadAnswerValue("MC",v.name,u.v,v.saveAns,b._indices)));for(this.EndBulkAnswerChange(!0),l=[],c=0;c<b._itemNodes.Count();c++)if(m=b._itemNodes.get(c),m.NoneOfTheAbove()){for(p=!0,q=m.GroupNumber(),j=0;j<l.length;j++)if(n=l[j],n.GroupNumber()==q&&n.Visible()){p=!1;break}m.Hidden(p),l=[]}else m.GroupNumber()>=0&&l.push(m);for(r=b._itemNodes.Count(),c=0;r>c;c++)b._itemNodes.get(c).AfterScriptEvaluation();if("R"==w.rType&&b instanceof f){var x=!0;for(c=0;r>c;c++)if(!b._itemNodes.get(c).Hidden()){x=!1;break}b.IterationHidden(x)}}})}),define("engine/interview_repeatstack",["hd","system/exception/invalidoperationexception","hdmain/stack","hdmain/system","engine/interview"],function(a,b,c,d,e,f){d.ExtendClass(e,null,{GetCurrentIndices:function(){return this._repeatStack.GetIndices()},CurrentIndex:function(c){if(0==this._repeatStack.Count())throw new b(a.Lc.GetStr("erraccrpt"));return c===f?this._repeatStack.Peek().index:(this._repeatStack.Peek().index=c,void 0)},FirstRpt:function(){for(frame in this._repeatStack)if(frame.index>0)return!1;return!0},TopRptLim:function(c){if(0==this._repeatStack.Count())throw new b(a.Lc.GetStr("erraccrpt"));return c===f?this._repeatStack.Peek().limit:(this._repeatStack.Peek().limit=c,void 0)},TopLimitedAnswerCount:function(){if(0==this._repeatStack.Count())throw new b(a.Lc.GetStr("erraccrpt"));return this._repeatStack.Peek().LimitedAnsweredCount()},TopMaxRptCount:function(){if(0==this._repeatStack.Count())throw new b(a.Lc.GetStr("erraccrpt"));return this._repeatStack.Peek().MaxCount()}})}),define("system/exception/indexoutofrangeexception",["hd","hdmain/system","system/exception/systemexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("engine/sortmapvalue",[],function(){function a(a){this.i=a}return a}),define("system/exception/memberaccessexception",["hd","hdmain/system","system/exception/systemexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("system/exception/missingmemberexception",["hd","hdmain/system","system/exception/memberaccessexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("system/exception/keynotfoundexception",["hd","hdmain/system","system/exception/systemexception"],function(a,b,c,d){function e(){e.baseConstructor.apply(this,arguments)}return this.DEBUG===d&&(this.DEBUG=a.DEBUG),b.ExtendClass(e,c),e}),define("engine/repeatstackframe",["hdmain/system"],function(a){function b(a){this.dName=a,this.index=0,this.limit=0,this.AnsweredCount=0}return a.ExtendClass(b,null,{Limit:function(a){this.limit=a>0?a:0},LimitedAnsweredCount:function(){return 0==this.limit||this.AnsweredCount<=this.limit?this.AnsweredCount:this.limit},MaxCount:function(){return 0==this.limit||this.AnsweredCount<this.limit?this.AnsweredCount+1:this.limit}}),b}),define("engine/scriptstackframe",[],function(){function a(a,b){this.vName=a,this.type=b}return a}),define("engine/interview_runtime",["hd","hdmain/jq","hdmain/system","system/exception/indexoutofrangeexception","system/exception/invalidoperationexception","system/exception/argumentoutofrangeexception","engine/sortmapvalue","system/exception/missingmemberexception","system/exception/keynotfoundexception","system/exception/argumentexception","engine/listpunctuation","engine/placeholdertype","engine/repeatstackframe","engine/scriptstackframe","engine/repeatindices","engine/interview","engine/variableincludemode","engine/variableinfostore","runtime/variable","runtime/computedvariable","engine/dialoginfo"],function(a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(a,b){a.Gray(b)}function y(a,b){a.GrayOrHideSetByScript()||(a.Gray(b),a.GrayOrHideSetByScript(!1))}function z(a,b){a.Hidden(b)}function A(a,b){a.GrayOrHideSetByScript()||(a.Hidden(b),a.GrayOrHideSetByScript(!1))}function B(a,b){a.Required(b)}function C(a,b){a.HasError(b)}function D(a,b){a.ConcealedOnAnswerSource(b)}function E(a,b){a.OmittedFromAnswerSource(b)}this.DEBUG===w&&(this.DEBUG=a.DEBUG);var F=a.Lc,G=c.Cast,H=c.String.Format,I=c.String.IsNullOrEmpty;c.ExtendClass(q,null,{GV:function(a,b){if(!this._inUsagePass&&this.GtU())return null;var c=this.GVImpl(a,!0,b);return null==c&&this.StU(!0),c},GVU:function(a,b){if(!this._inUsagePass&&this.GtU())return null;var c=this.GVImpl(a,!0,b);return c},LookupIndicesForVariable:function(a){var b,c,d,e=!1,f=this._repeatStack.Count()-1,g=[],h=null;for(c=this._repeatStack.Count()-1;c>=0;c--){if(d=this._repeatStack.a[c],e)g[f]=d.index;else if(b=this.GetComponent(d.dName),b.vList.Contains(a,!0,h)){for(e=!0,g=[];d.repeatMap.length<=d.index;)d.repeatMap.push(d.repeatMap.length);g[f]=d.repeatMap[d.index]}h=d.dName,f--}return g},GVImpl:function(b,c,d){var e,f,g,h=null,i=this.GetComponent(b);return e=null!=d&&d.length>0?this.ResolveIndices(d):this.LookupIndicesForVariable(b),null==e?h:(this._inUsagePass?this.AddToVarUsageList(i,e):c&&this._outlineStack.Count()>0&&i.autoAsk&&!this._scriptStack.InDoNotAskProperty()&&!this._scriptStack.InDlgScript()&&this.IncludeVar(b,r.TemplateMerge,d),f=this._varInfo.GetInfo(i,this.CurrentTemplate().name),this.MarkAsTrigger(f),g={},a.Answers.TryGetAnswer(b,i.type,g)&&(h=g.v.GetValue(e)),h)},DoSetVarValue:function(b,c,d,e){var f,g,h,i=this.GetComponent(b),j={};f=null!=e&&e.length>0?this.ResolveIndices(e):this.LookupIndicesForVariable(b),null!=f&&(h=a.ToVT(c),"UN"==h&&(h=i.valType),"NU"==i.type&&"TX"==h&&(c=parseFloat(c),isNaN(c)&&(c=0),h="NU"),"MC"==i.type&&"string"==typeof c?h="MC":"TX"==i.type&&"MC"==h&&(h="TX"),a.Answers.TryGetAnswer(b,h,j)||(j.v=a.Answers.CreateAnswer(h,b)),i.saveAns||(j.v.s=!1),g=j.v.GetValue(f),(d||null==g)&&("MC"==i.type&&"string"==typeof c?c=c.indexOf("|")>-1?c.split("|"):[c]:"TX"==i.type&&"TX"==h&&c instanceof Array&&(c=c.join("|")),j.v.SetValue(c,!1,f),this._engine.AskNone()||this.FlagVarAsSet(i,d,f)))},FlagVarAsSet:function(a,b,c){if(b){var d,e,f,g,h,i=this._varInfo.GetInfo(a,this.CurrentTemplate().name);if(i.WasSet(!0),d=this._scriptStack.TopDlgScript(),e=null==d?null:this.GetComponent(d),null!=e&&e.vList.Contains(a))for(f=this._varInfo.GetInfo(e,this.CurrentTemplate().name),g=0;g<f.InterviewNodes().length;g++)h=f.InterviewNodes()[g],p.AreEquivalent(c,h.Indices())&&h._itemNodes.get(a.name).SetByDialogScript(!0)}},IncludeVar:function(a,b,c){var d,e,f,g=this.GetComponent(a),h=null,i=!1;if(!(null!=c&&c.length>0&&(h=this.ResolveIndices(c),null==h))){if(this._inUsagePass)return this.AddToVarUsageList(g,null==h?this.LookupIndicesForVariable(a):h),void 0;if(this.InRebuild()){if(this._engine.AskNone()||!g.autoAsk){if(b!=r.ExplicitAsk)return;i=!0}if(d=i?null:g.parent,(null==d||""==d.rType||d.autoAsk||!this.InRpt()||d.name!=this._repeatStack.Peek().dName)&&(f=this.CurrentTemplate().name,e=this._varInfo.GetInfo(g,f),!this._varInfo.AlreadyAdded(a,e.ValueType(),f))){if("DI"!=g.type){if(e.WasSet())return;null!=d&&(g=d,e=this._varInfo.GetInfo(d,f))}if(this.IsPopup()&&e instanceof v&&(b===r.ExplicitAsk||b===r.ExplicitRepeat)&&e.AddedToInterview(!1),!e.AddedToInterview()){if(g==d)for(;null!=d.parent;)if(d=d.parent,e=this._varInfo.GetInfo(d,this.CurrentTemplate().name),e.AddedToInterview())return;this.DefineInterviewNode(g,!0,!1)}}}}},PsU:function(){this._unansStack.Push(!1)},PpU:function(){this._unansStack.Pop()},GtU:function(){return this._unansStack.Peek()},StU:function(a){this._unansStack.a[this._unansStack.a.length-1]=a},ResolveIndices:function(a){var b=p.ValuesToInts(a);return null===b&&this.StU(!0),b},GetPN:function(a){if(0>a||a>=9)throw new f(H("A paragraph level of {0} is not valid.",a));return this._paraNum[a]},SetPN:function(a,b){if(0>a||a>=9)throw new f(H("A paragraph level of {0} is not valid.",a));this._paraNum[a]=null!=b?b:0},FormatValue:function(){var a,b,c,d,e,f=arguments.length;return f>0&&(a=arguments[0]),"string"!=typeof arguments[1]?(b=arguments[1],c=f>2?arguments[2]:null,this.FormatValue1(a,b,c)):(d=arguments[1],e=arguments[2],mergeFormat=arguments[3],this.FormatValue2(a,d,e,mergeFormat))},FormatValue1:function(b,c,d){var e,f,g,h,i,j,k;if(b instanceof Array){for(e=b,f=[],g=null!=c&&c.length>1&&!I(c[1])?this.GetComponentSafe(c[1]):null,f.push(null!=g?g.text:""),h=null,null!=c&&c.length>1&&!I(c[1])&&(h=c[1],i=this.GetComponentSafe(h),null!=i&&i instanceof a.Format&&(h=i.text)),j=null!=c&&c.length>0&&!I(c[0])?this.GetComponentSafe(c[0]):null,j instanceof a.McFmt||(j=null),k=0;k<e.length;k++)null!=j&&null!=d&&k<d.length&&d[k]>=0&&d[k]<j.Count()?f.push(j.EvChoice(d[k])):f.push(e[k]);if(c=f,!I(h)){if(F.IsListFormat(h))return F.FormatList(c.slice(1),h);for(k=1;k<c.length;k++)c[k]=F.FormatTextVal(c[k],h)}return a.MC.Format(b,c)}return i=null,h=null!=c&&c.length>0?c[0]:null,null!=h&&(i=this.GetComponentSafe(h),null!=i&&(h=i.text)),"string"==typeof b?F.FormatTextVal(b,h):"number"==typeof b?F.FormatNumVal(b,h,-1):"object"==typeof b&&b.getDate?F.FormatDateVal(b,h):"boolean"==typeof b?F.FormatTFVal(b,h):""},FormatValue2:function(c,d,e,f){function g(a,c,d,e){if(!a)return"";c||(c=0),d||(d="&nbsp;"),"boolean"!=typeof e&&(e=!0);var f=b("<span />").html(a).text().length,g=c>f?Array(c-f+1).join(d):"";
return e?a+g:g+a}var h,i,j,k,l,n,o="",p=null,q=0,r=" ",s="L",t=null,u=null;if(p=this.GetComponentSafe(d),null!=c&&(null!=f?(q=f.fldW,r=f.fillCh,s=f.algn,t=f.fmt):null!=p&&(q=p.dFldW,r=p.dFillCh,s=p.dAlgn,"NU"==p.type?(h=G(p,a.NuVar),t=[h.dFmt,h.decPl.toString()]):"MC"==p.type?(i=G(p,a.McVar),t=[i.dMrg,i.dFmt]):t=[p.dFmt]),null!=p&&"MC"==p.type&&(j={v:c},i=G(p,a.McVar),k=this._varInfo.GetInfo(i,this.CurrentTemplate().name),i.ReconcileOptions(j,k.Options())&&(c=j.v),null!=c)))for(u=[],l=0;l<j.v.length;l++)u[l]=k.Options().IndexOf(j.v[l]);if(null!=c)o=this.FormatValue(c,t,u),q>0&&(o=g(o,q,r,"L"==s));else if(n=null,null!=f?n=f.uTxt:null!=p&&(n=p.dUTxt),I(n))switch(this.Engine().UnansweredPlaceholder()){case m.Nothing:o="";break;case m.Asterisks:o="***";break;case m.Underscores:o="_________________";break;case m.AsterisksAndVarName:o=H("***{0}***",I(d)?e:d);break;default:o=H("[{0}]",I(d)?e:d)}else o=n;return o=o.replace(/</g,"%%lt%%").replace(/>/g,"%%gt%%")},Add:function(b,c){var d,e,f,g,h,i,j,k,l=b.call(a.CurrentInterview().CurrentTemplate().tplObj);null!=l&&("function"!=typeof l.join||(l=l[0],l!=w))&&(d=l.indexOf("|"),e=null,d>=0&&(e=l.substr(d+1),l=l.substr(0,d)),""!=l&&(f=this.GetComponent(c),j=null,k=f.opts.IndexOf(l),k>=0&&(null==e&&(e=f.opts.GetItem(k).EvPromptImmed()),j=f.opts.GetItem(k).rsrc),g=this._varInfo.GetInfo(f,this.CurrentTemplate().name),h=I(e)?null:new a.StTx(e),i=new a.McOpt(l,h,j),g.Options().Add(i)))},Clr:function(a){var b,c=this.GetComponent(a);if(null==c)throw new e(H(F.GetStr("err_clear"),a));b=this._varInfo.GetInfo(c,this.CurrentTemplate().name),b.Options().Clear(),this._varInfo.Shadow(a,b)},Ers:function(b){var c,d,e,f=this.GetComponent(b),g={};if(null==f)throw new k(H("Variable '{0}' not found.",b),b);if(this.BeginBulkAnswerChange(),a.Answers.TryGetAnswer(b,f.type,g)&&g.v.Clear(),"DI"==f.type)for(c=f,d=0;d<c.vList.Count();d++)e=c.vList.GetItem(d),e instanceof t&&a.Answers.TryGetAnswer(e.name,e.type,g)&&g.v.Clear();else this.FlagVarAsSet(f,!0,this._repeatStack.GetIndices());this.EndBulkAnswerChange(!1)},StL:function(b,c){if(!a.GtU()&&null!==c){var d,f,g=this.GetComponent(b);if(null==g)throw new e(H(F.GetStr("err_limit"),b));d=this._varInfo.GetInfo(g,this.CurrentTemplate().name),f=this._repeatStack.GetIndices(),d.SetLimit(c,f)}},Gry:function(a,b){this.DoSetVarFlag(a,b,x)},AutoGrayVar:function(a,b){this.DoSetVarFlag(a,b,y)},Hid:function(a,b){this.DoSetVarFlag(a,b,z)},AutoHideVar:function(a,b){this.DoSetVarFlag(a,b,A)},Con:function(a,b){this.DoSetVarFlag(a,b,D)},Omt:function(a,b){this.DoSetVarFlag(a,b,E)},Req:function(a){this.DoSetVarFlag(a,!0,B)},Err:function(a){var b=this._outlineStack.Peek();b.ErrorText=a,null!=a&&this.DoSetVarFlag(this._scriptStack.CurDlgScript(),!0,C)},DoSetVarFlag:function(a,b,c){var f,g,h,i,j,k,l,m=this._scriptStack.TopDlgScript(),n=m==a,o=this.GetComponent(m);if(null==o)throw new e(H(F.GetStr("err_badscrstk"),m));if(c!=z||"S"!=o.rType||0==this.CurrentIndex()){for(f=null,g=this._repeatStack.GetIndices(),h=this._varInfo.GetInfo(o,this.CurrentTemplate().name),i=0;i<h.InterviewNodes().length;i++)j=h.InterviewNodes()[i],(p.AreEquivalent(g,j.Indices())||null!=j._parent&&0==j._parent.Type())&&(f=j);if(null==f)throw new d(H(F.GetStr("err_badrptstk"),m));if(n)for(k=f._itemNodes,i=0;i<k.Count();i++)l=k.get(i),this.DoSetVarFlagImpl(f,l,b,c);else try{this.DoSetVarFlagImpl(f,f._itemNodes.get(a),b,c)}catch(q){}}},DoSetVarFlagImpl:function(b,c,d,e){if(c.DialogItem()instanceof a.DlgEl)for(itemNodes=b._itemNodes,i=0;i<itemNodes.Count();i++)vNode=itemNodes.get(i),vNode.DialogItem().name==c.DialogItem().name&&e(vNode,d);else{if(e==z||e==A||e==x||e==y){if(c.IsDialogOnParent()&&null!=c.SpreadsheetNode())for(childNode=c.SpreadsheetNode()._children.get(0),i=0;i<childNode._itemNodes.Count();i++)dialogItemNode=childNode._itemNodes.get(i),null!=a.CurrentInterview().GetErrorValue(dialogItemNode)&&dialogItemNode.ClearAnswer(!1);null!=a.CurrentInterview().GetErrorValue(c)&&c.ClearAnswer(!1)}e(c,d)}},GetRepeatPunctuation:function(a){var b=this._repeatStack.Peek();if(a)return b.lp.GetPrePart();var c=b.lp.GetPunctuation();return b.lp.IncrementCodeIndex(),c},SortRepeatList:function(b,c,d,e){if(I(b))return!0;var f,h,i,j=this._repeatStack.Peek(),k=!1,l=[];for(f={},a.Answers.TryGetAnswer(b,this._engine.GetValueType(b),f)||(f=null),I(d)||(h={},a.Answers.TryGetAnswer(d,this._engine.GetValueType(d),h)||(h=null)),i=0;i<j.AnsweredCount;i++){var m=new g(j.repeatMap[i]);f&&(m.v1=f.v.GetValue([m.i])),h&&(m.v2=h.v.GetValue([m.i])),l.push(m)}for(l.sort(function(a,b){function d(a,b,c,d){if(a==b||I(c))return 0;var e=d?a.v1:a.v2,f=d?b.v1:b.v2,g="A"==c?1:-1;if(null==e)return null==f?a.i>b.i?g:-g:g;if(null==f)return-g;if("string"==typeof e)return e.toLowerCase()>f.toLowerCase()?g:-g;if("number"==typeof e)return e>f?g:-g;if("object"==typeof e){if(e instanceof Date)return e>f?g:-g;if(e.length)return e.join("|")>f.join("|")?g:-g}return"boolean"==typeof e?e?-g:g:0}return a.v1==b.v1&&h?d(a,b,e,!1):d(a,b,c,!0)}),i=0;i<j.AnsweredCount;i++)j.repeatMap[i]=l[i].i;return k=!0},FilterRepeatList:function(a){if(I(a))return!0;var b,c=this._repeatStack.Peek(),d=this.GetComponent(a),e=[];if(!d)return!1;for(b=0;b<c.AnsweredCount;b++)c.index=c.repeatMap[b],d.scrD()&&e.push(c.index);return c.index=0,c.repeatMap=e,c.AnsweredCount=e.length,c.lp.CodeCount(e.length),!0},PushRpt:function(a,b,c,d,e,f,g,h){var i=this.GetComponent(a),j=new n(a);j.AnsweredCount=this.GetAnswerCount(i,this._repeatStack.GetIndices()),this._inUsagePass&&j.AnsweredCount++,this._repeatStack.Push(j),j.repeatMap=[],j.lp=new l(b,j.AnsweredCount);for(var k=0;k<j.AnsweredCount;k++)j.repeatMap.push(k);j.repeatMap.length>0&&(this.PsU(),h&&this.SortRepeatList(c,d,e,f)?this.FilterRepeatList(g):this.FilterRepeatList(g)&&this.SortRepeatList(c,d,e,f),this.PpU())},PpR:function(){if(0==this._repeatStack.Count())throw new e(F.GetStr("errpoprpt"));this._repeatStack.Pop()},IcR:function(){if(0==this._repeatStack.Count())throw new e(F.GetStr("erraccrpt"));this._repeatStack.Peek().index++},DecRpt:function(){if(0==this._repeatStack.Count())throw new e(F.GetStr("erraccrpt"));if(0==this._repeatStack.Peek().index)throw new e(F.GetStr("err_decidx"));this._repeatStack.Peek().index--},TRN:function(){return 0==this._repeatStack.Count()&&this._inUpdate?1:this.CurrentIndex()+1},TopRptCnt:function(a){if(a===w){if(0==this._repeatStack.Count())throw new e(F.GetStr("erraccrpt"));return this._repeatStack.Peek().AnsweredCount}if(0==this._repeatStack.Count())throw new e(F.GetStr("erraccrpt"));this._repeatStack.Peek().AnsweredCount=null!=a?a:0},InRpt:function(){return this._repeatStack.Count()>0},PsS:function(a,b){this._scriptStack.Push(new o(a,b))},PpS:function(){this._scriptStack.Pop()},InComputationScript:function(){return this._scriptStack.InComputationScript()},VarOnDialog:function(a,c){var d,e=!1;return b.each(a.DialogItemNodes(),function(a,b){return d=b._parent._dialog,null!=d&&d.name==c?(e=!0,!1):void 0}),e},MarkAsTrigger:function(a){this._scriptStack.Count()>0&&(this._scriptStack.InDialogScriptOrCallee()&&this.VarOnDialog(a,this._scriptStack.CurDlgScript())||this._scriptStack.InAskProperty())||0==this._scriptStack.Count()&&this._inDialog?a.DialogTrigger(!0):a.InterviewTrigger(!0)},Ans:function(a,b){if(!this._inUsagePass&&this.GtU())return!1;if(b==w)return null!=a;var c,d,e=this.ResolveIndices(b);return null===e?!1:(0===e.length&&this._repeatStack.Count()>0&&(e=this.LookupIndicesForVariable(a)),c=this.GetComponent(a),d=null!=c&&this.Answered_Implementation(c,e))},Answered_Implementation:function(c,d){var e,f,g,h,i,j=!1,k="DI"==c.type?G(c,a.Dlg):null,l={};return this._inUsagePass&&this.AddToVarUsageList(c,d),null==k?(this.MarkAsTrigger(this._varInfo.GetInfo(c,this.CurrentTemplate().name)),a.Answers.TryGetAnswer(c.name,c.type,l)&&(j=l.v.IsAns(d))):(i=this,b.each(k.vList.list,function(c,k){k instanceof t&&(e=!1,f=!1,g=G(k,t),h=i._varInfo.GetInfo(g,i.CurrentTemplate().name),b.each(h.DialogItemNodes(),function(b,c){p.AreEquivalent(c.Indices(),d)&&(f=!0,!c.Gray()&&!c.Hidden()&&("DI"==k.type?e=i.Answered_Implementation(g,d):(i.MarkAsTrigger(h),!e&&a.Answers.TryGetAnswer(k.name,k.type,l)&&(e=l.v.IsAns(d)))))}),f||("DI"==k.type?e=i.Answered_Implementation(g,d):(i.MarkAsTrigger(h),!e&&a.Answers.TryGetAnswer(k.name,k.type,l)&&(e=l.v.IsAns(d)))),e&&!j&&(j=!0))})),j},Cnt:function(b,c){if(this.GtU()||null===b)return null;var d,e,f,g,h=0,i=this.GetComponent(b);switch(i.type){case"DI":d=null!=c&&c.length>0?this.ResolveIndices(c):this._repeatStack.GetIndices(),h=this.GetAnswerCount(G(i,a.Dlg),d),this._inUsagePass?this.AddToVarUsageList(i,d):this._outlineStack.Count()>0&&i.autoAsk&&!this._scriptStack.InDoNotAskProperty()&&!this._scriptStack.InDlgScript()&&this.IncludeVar(b,r.ExpressionMerge,c);break;case"MC":if(e=G(i,a.McVar),f={v:this.GV(b,c)},g=this._varInfo.GetInfo(e,this.CurrentTemplate().name),i.ReconcileOptions(f,g.Options()),null==f.v)return null;h=f.v.length,1==h&&f.v[0]==a.MC.nota&&(h=0);break;default:return null}return h},Oth:function(a,b){if(this.GtU())return null;var c,d,e;return c={v:this.GV(a,b)},null==c.v?"":(d=this.GetComponent(a),e=this._varInfo.GetInfo(d,this.CurrentTemplate().name),d.ReconcileOptions(c,e.Options()),null==c.v||1!=c.v.length||e.Options().Contains(c.v[0])?"":c.v[0])},Sel:function(a,b,c){if(this.GtU()||null===c)return null;var d="",e=this.GV(a,b);return null!=e&&null!=e&&e.length>=c&&(d=e[c-1]),d},Sum:function(b,c){if(this.GtU())return null;var d,e,f,g,h,i,j=0,k=this.ResolveIndices(c),l={};if(p.IsNullOrEmpty(k)&&(k=this.GetCurrentIndices(),c=p.IntsToValues(k)),i=this.GetComponentSafe(b),null!=k&&null!=i)if("NU"==i.type){if(f=p.Push(c),g=!0,a.Answers.TryGetAnswer(b,i.type,l))for(h=l.v.GetChildCount(k),e=0;h>e;e++)d=this.GVImpl(b,!0,f),null!=d&&(j+=d),p.Increment(f),g=!1;g&&this.GVImpl(b,!0,f)}else"CO"==i.type&&(d=G(i,u).GetSum(),null!=d&&(j=d));return j}})}),define("engine/mergeformat",["hd"],function(a){function b(a,b,c,d,e,f){this.fldW=a,this.fillCh=b,this.algn=c,this.uTxt=d,this.font=e,this.fmt=f}return a.MrgFmt=b,b}),define("engine/textevaluator",["hd","hdmain/system"],function(a,b){function c(a){this.text=a}function d(a,b){this.D=a,this.t=b}function e(a,b,c){this.D=a,this.rslt=b,this.t=c}b.ExtendClass(c,null,{toString:function(){return this.text}}),b.ExtendClass(d,null,{toString:function(){return this.D.call(this.t)}}),b.ExtendClass(e,null,{toString:function(){return this.D.call(this.t,this.rslt)}}),a.StTx=c,a.DyTx=d,a.AdTx=e}),define("engine",["engine/answer","engine/engine_runtime","engine/dialogitemnode","engine/interview_outline","engine/interview_repeatstack","engine/interview_runtime","engine/mergeformat","engine/textevaluator"],function(){});