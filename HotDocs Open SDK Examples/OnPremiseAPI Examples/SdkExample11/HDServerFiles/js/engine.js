/*
 * HotDocs Browser Interview Script - engine.js
 * Version: 11.1.140121.1229
 * Copyright © HotDocs Limited 1992 - 2014. All rights reserved.
 */
/*!
* XMLWriter - XML generator for Javascript, based on .NET's XMLTextWriter.
* Copyright (c) 2008 Ariel Flesler - aflesler(at)gmail(dot)com | http://flesler.blogspot.com
* Licensed under BSD (http://www.opensource.org/licenses/bsd-license.php)
*/
define("runtime/unansweredvalue",[],function(a){var b=HOTDOC$,c=b.UN===a?{}:b.UN;return c.Eq=function(a,b){return null==a&&null==b},c.Ne=function(a,b){return null==a&&null!=b},c.Nl=function(){return null},b.UN=c,c}),define("engine/valuenode",["hdmain/system","require","runtime/unansweredvalue"],function(a,b,c,d){function e(a,b){this.T=a,this.v=b===d?null:b,this.c=null,this.um=!0}var f=HOTDOC$;return this.DEBUG===d&&(this.DEBUG=f.DEBUG),a.ExtendClass(e,null,{GetType:function(){return this.T},IsAns:function(){return null!==this.v},HasCh:function(){return null!=this.c&&this.c.SetCount()>=0},Expand:function(a,c){var d=b("engine/valuenodelist");0>=a||(c||this.IsAns()||this.HasCh())&&(this.c?!1:(this.IsAns()?(this.c=new d(this.T,1),this.c.PrepareForIndex(0),this.c.Item(0).v=this.v,this.c.Item(0).um=this.um,this.v=null):this.c=new d(this.T),--a),0!=a&&f.jq.each(this.c.GetEnumerator(),function(b,d){d.Expand(a,c)}))},Eq:function(a){return f[f.ToVT(this.v)].Eq(this.v,a.v)},Xml:function(a,b){0==b?f[this.T].Xml(a,this.v,this.um):null!=this.c?this.c.Xml(a,--b):a.WriteElementString("RptValue",null)}}),e}),define("engine/valuechangetype",[],{None:0,Changed:1,BecameAnswered:2,BecameUnanswered:3,IndexShift:4}),define("engine/answer",["engine/valuenode","engine/valuechangetype","runtime/unansweredvalue"],function(a,b,c,d){function e(a,b){a.ClearValue(b)}function f(a,b,c){if(c===d&&(c=b,b={}),b.v=-1,null==c||0==c.length)return[];var e=c.length;if(0!=(a&o.Z))for(;e>0&&c[e-1]<=0;)e--;else for(;e>0&&c[e-1]<0;)e--;return 0!=(a&o.I)&&e>0&&(b.v=c[e-1],e--),e>0?c.slice(0,e):[]}function g(a,b,c,d,e){var f,h,i,j;if(0==e.length&&b==this.d){if(f=a,d)for(;f.HasCh();)f=f.c.Item(0);return f}if(e.length>0)h=e[0],i=e.slice(1);else{if(!d)return a;for(h=0,i=new Array(this.d-b-1),j=i.length-1;j>=0;j--)i[j]=0}if(c)a.HasCh()||a.Expand(1,!0),h>=a.c.SetCount()&&a.c.PrepareForIndex(h);else{if(!a.HasCh())return d&&0==h&&m.RepeatIndices.IsFirst(i)?a:null;if(h>=a.c.SetCount())return null}return g.call(this,a.c.Item(h),++b,c,d,i)}function h(a,b,c,d){if(b.HasCh()){var e,f;for(f=0;f<b.c.Count();f++)e=c.slice(0),e.push(f),h.call(this,a,b.c.Item(f),e,d)}else c.length==this.d&&a(d,c)}function i(a,b){var c=f(a?o.D:o.Z,b);return this.GetNode(a?p.C:p.D,c)}function j(a){k(this.v,a)}function k(a,b){if(0!=b.length){var c=b[0],d=b.slice(1);a.HasCh()&&a.c.SetCount()>c&&k(a.c.Item(c),d),a.HasCh()&&a.c.SetCount()==c+1&&a.c.ResetCount()}}function l(a,b){b.HasCh()?m.jq.each(b.c.GetEnumerator(),function(b,c){l(a,c)}):b.v=a(b.v)}var m=HOTDOC$;this.DEBUG===d&&(this.DEBUG=m.DEBUG);var n="Answer",o={D:0,Z:1,I:2},p={D:0,C:1,N:2};m.Class[n]={C:function(b,c,d){this._set=c,this.n=d,this.v=new a(b),this.d=0,this.s="string"==typeof d&&"("!=d[0],this.ue=!0},P:{VT:function(){return this.v.T},IsRep:function(){return this.v.HasCh()||this.d>0},IsAns:function(a){var b=f(o.Z,a),c=this.GetNode(p.D,b);return c?c.IsAns():!1},GetUserModifiable:function(a){var b=f(o.Z,a),c=this.GetNode(p.D,b);return null!=c?c.um:!0},GetChildCount:function(a){var b=f(o.D,a);return this.GetCount(b)},GetSiblingCount:function(a){var b=f(o.I,a);return this.GetCount(b)},GetCount:function(a){var b=this.GetNode(p.N,a);return b?b.HasCh()?b.c.SetCount():b.IsAns()?1:0:(b=this.GetNode(p.D,a),b&&b.IsAns()?1:0)},GetNode:function(a,b){var c=a==p.C,d=a!=p.N;return c&&b.length>this.d&&(this.v.Expand(b.length-this.d,!1),this.d=b.length),g.call(this,this.v,0,c,d,b)},GetValue:function(a){var b=i.call(this,!1,a);return b?b.v:null},SetValue:function(a){var c,d,e,f,g,h=!1,k=1;e="boolean"==typeof arguments[k]?arguments[k++]:!1,f="boolean"==typeof arguments[k]?arguments[k++]:!0,g=arguments[k],c=i.call(this,null!==a,g),null==c&&(c=i.call(this,!0,g),h=!0),!1,null!=c&&(d=null===a||c.IsAns()?null===a&&c.IsAns()?b.BecameUnanswered:null!==a&&c.IsAns()&&m[m.ToVT(a)].Ne(a,c.v)?b.Changed:b.None:b.BecameAnswered,c.v=a,c.um=f,(d!=b.None||h)&&(null!=g&&g.length>0&&null===a&&j.call(this,g),d!=b.None&&null!=this._set&&!e&&this._set.OnAnswerChanged(this,g,d)))},InitValue:function(a,b,c){this.SetValue(a,!0,b,c)},Clear:function(){this.EnumerateValues(this,e),this.v=new a(this.VT()),this.d=0},ClearValue:function(a){this.IsAns(a)&&this.SetValue(null,a)},ApplyValueMutator:function(a){l(a,this.v)},InsertIteration:function(c){var d,e={},g=f(o.I,e,c);e.v<0||(d=this.GetNode(p.N,g),null==d||null==d.c||e.v>=d.c.SetCount()||(d.c.Insert(e.v,new a(this.VT())),null!=this._set&&this._set.OnAnswerChanged(this,c,b.IndexShift)))},DeleteIteration:function(a){var c,d={},e=f(o.I,d,a);d.v<0||(c=this.GetNode(p.N,e),null==c||null==c.c||d.v>=c.c.SetCount()||(c.c.RemoveAt(d.v),null!=this._set&&this._set.OnAnswerChanged(this,a,b.IndexShift)))},MoveIteration:function(a,c){var d,e,g,h={},i=f(o.I,h,a);h.v<0||(d=this.GetNode(p.N,i),null==d||null==d.c||c<h.v&&c>=d.c.SetCount()||c>h.v&&h.v>=d.c.SetCount()||(e=Math.max(h.v,c),e>=d.c.SetCount()&&d.c.PrepareForIndex(e),g=d.c.RemoveAt(h.v),d.c.Insert(c,g),null!=this._set&&this._set.OnAnswerChanged(this,a,b.IndexShift)))},Xml:function(a){a.WriteStartElement(n),a.WriteAttributeString("name",m.TX.XMLEscape(this.n)),this.s||a.WriteAttributeString("save","false"),this.ue||a.WriteAttributeString("userExtendible",this.ue.toString()),this.v.Xml(a,this.d),a.WriteEndElement()},EnumerateValues:function(a,b){h.call(this,b,this.v,[],a)}},S:{Create:function(a,b,c){return new m.Answer(a,b,c)},TrimIndices:f}}}),define("engine/datasourceloader",["hdmain/jq"],function(a,b){function c(a,b){var c=!0;null!=b.Error&&(a._exception=b.Error),c&&null!=a.LoadCompleted&&a.LoadCompleted.call(a,{})}function d(b,c,d,e,g){var h={DataContext:b,Act:g};a.ajax({type:"GET",url:b.uri+"/DefineAnswerFileDataSource",data:{templateLocator:"'"+c+"'",templateName:"'"+d+"'",dataSourceId:"'"+e+"'"},complete:f,AsyncState:h})}function e(a){var c=l[a];return c===b&&(c={uri:a},l[a]=c),c}function f(b){try{var c=this.AsyncState,d=a(b.responseXML).text();c.Act(d)}catch(e){h.ExceptionAlert("err_serviceop",e)}}function g(a,b,c,d){var e=new h[j]([],a.uri+"/"+d);return m[b]=e,e}var h=HOTDOC$,i=a.proxy,j="DataSourceCollection",k="DataSourceLoader",l={},m={};h.Class[j]={C:function(a,b){this._dataCollection=a,this._query=b},P:{Rows:function(){return this._dataCollection},Load:function(){this._exception=null,a.getJSON(this._query,i(function(b){var d,e=this._dataCollection;a.each(b.value,function(b,c){d=new a.Dictionary,a.each(c,function(a,b){var c,e=a.replace("_0020"," ");0==e.indexOf("Prop")&&e.length>4&&(e=e.substr(4)),"string"==typeof b&&b.indexOf("T00:00:00")>0&&(c=new Date(b),b=h.Locale.FormatDateVal(new Date(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate(),c.getUTCHours()),"d MMM yyyy")),d.a[e]=b}),e.push(d)}),c(this,{})},this))},Error:function(){return this._exception}}},h[k]={LoadAnswerFileDataSource:function(a,b,c,f,i,j){var l=h[k].GetDataSourceCollection(f);if(null!=l)j(l);else{var m=e(a);d(m,b,c,f,function(a){l=g(m,f,i,a),l.Load(),l.LoadCompleted=function(){j(l)}})}},LoadCustomDataSource:function(a,b,c,d,f){var i=h[k].GetDataSourceCollection(c);if(null!=i)f(i);else{var j=e(a);i=g(j,c,d,b),i.Load(),i.LoadCompleted=function(){f(i)}}},GetDataSourceCollection:function(a){var c=m[a];return c===b?null:c}}}),define("system/exception",[],function(){function a(a,b){this.message=a,this.InnerException=b}return a}),define("system/exception/systemexception",["hdmain/system","system/exception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("system/exception/argumentexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("engine/textlayoutconstraint",[],{AnyLength:0,NeedSingleLine:1}),define("engine/formattingcontext",[],{PlainText:0,OutlineText:1,RichText:2}),define("system/exception/notimplementedexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),e.NotImplementedException=d,d}),define("engine/interviewnodeoutlinefontflags",[],{None:0,Bold:1,Italic:2,Underline:4}),define("engine/dotcode",["system/exception/notimplementedexception","engine/formattingcontext","engine/interviewnodeoutlinefontflags"],function(a,b,c){function d(a,d,e){return a?a.indexOf("«")<0?a:(d==b.PlainText?a=g.PreProcessForPlainText(a):d==b.OutlineText&&(e.val=c.None,a=g.PreProcessForOutlineText(a,e)),a):""}function e(b,d,e){if(e=c.None,b.indexOf("«")<0)return b;throw new a}function f(a,b){a=a.replace(/««/gi,"{{FQ}}");for(var d,e=0,f=0,g=0,h=/«\s*\.(\w{1,2})\b\s*([^»]*)»/g,i=h.exec(a);null!=i;){if(3==i.length){switch(d=!0,i[1].toLowerCase()){case"b":e++;break;case"be":e--;break;case"i":f++;break;case"ie":f--;break;case"u":g++;break;case"ue":g--;break;case"f":break;case"fe":break;case"h":break;case"he":break;case"s":break;case"se":break;case"w":break;case"we":break;case"x":break;case"xe":break;case"z":break;case"ze":break;default:d=!1}d&&(a=a.substr(0,i.index)+a.substr(i.index+i[0].length),h.lastIndex=i.index)}i=h.exec(a)}return b&&(b.val=c.None,e>0&&(b.val|=c.Bold),f>0&&(b.val|=c.Italic),g>0&&(b.val|=c.Underline)),a=a.replace(/{{FQ}}/gi,"«")}var g={DefaultProcessor:d,HTMLProcessor:e,PreProcessForPlainText:function(a){return f(a)},PreProcessForOutlineText:function(a,b){return f(a,b)}};return g}),define("engine/answeredstatus",[],{Unanswered:0,PartiallyAnswered:1,Answered:2}),define("engine/interviewnodetype",[],{Root:0,Dialog:1,DefaultDialog:2,Repeat:3,Iteration:4}),define("engine/dialogupdateflags",[],function(){var a={None:0,UserAnswer:1,ScriptAnswer:2,RequiredAnswer:4,RepeatAnswer:8,Gray:16,Hidden:32,Required:64,set:128,AddClear:256,Prompt:512,Title:1024,NodeTitle:2048,ChildCount:4096,NodeChildCount:8192,NewlyAdded:16384,NodeNewlyAdded:32768,AnsweredStatus:65536,NodeAnsStatus:131072,NodeRequired:262144,NodeEnabled:524288,Progress:1048576,AddButtonRefresh:2097152,NodeError:4194304,HasError:8388608,All:2147483647};return a.AnswerRelated=a.UserAnswer|a.ScriptAnswer|a.RequiredAnswer|a.RepeatAnswer|a.HasError,a.StatusRelated=a.NodeAnsStatus|a.NodeRequired|a.NodeError|a.NodeEnabled|a.Progress,a.OutlineRelated=a.StatusRelated|a.NodeTitle|a.NodeChildCount,a.DialogContentRelated=a.ScriptAnswer|a.RequiredAnswer|a.RepeatAnswer|a.Gray|a.Hidden|a.Required|a.set|a.AddClear|a.Prompt,a.DialogRelated=a.DialogContentRelated|a.Title|a.AddButtonRefresh|a.HasError,a.SinglePageRelated=a.DialogRelated|a.ChildCount,a.AllOutlineRelated=a.OutlineRelated|a.NodeNewlyAdded,a.AllDialogRelated=a.AnswerRelated|a.DialogRelated|a.ChildCount|a.NewlyAdded|a.AnsweredStatus,a}),define("engine/datasourceloadresult",[],function(){function a(a,b,c){this.Nodes=a,this.Rows=b,this.Error=c}return a}),define("system/exception/invalidoperationexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("system/exception/ArgumentNullException",["hdmain/system","system/exception/argumentexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("engine/answeredstatustabulator",["hdmain/system","./answeredstatus"],function(a,b){function c(){this._flags=0,this._explicitlyAnswered=0,this._implicitlyAnswered=0,this._unanswered=0}function d(a,b){a._explicitlyAnswered+=b._explicitlyAnswered,a._implicitlyAnswered+=b._implicitlyAnswered,a._flags|=b._flags&(e.O|e.I),b._unanswered>0&&(a._unanswered+=b._unanswered,b.IsUnansweredRequired()&&(a._flags|=e.D))}var e={N:0,O:1,I:2,R:4,D:8,E:16,DE:32};return a.ExtendClass(c,null,{Reset:function(){this._flags=0,this._explicitlyAnswered=this._implicitlyAnswered=this._unanswered=0},IncAnswered:function(a,b,c){a||b?c?this._implicitlyAnswered++:this._explicitlyAnswered++:this._flags|=c?e.I:e.O},IncUnanswered:function(a,b){(a||b)&&(this._unanswered++,b&&(this._flags|=e.R))},SetError:function(){this._flags|=e.E},ClearRequired:function(){this._flags&=~e.R},ClearError:function(){this._flags&=~e.E},IsAnswered:function(){return this._explicitlyAnswered>0||0!=(this._flags&e.O)},Status:function(){return 0==this._unanswered?b.Answered:this._explicitlyAnswered>0||this._implicitlyAnswered>0||0!=(this._flags&(e.O|e.I))?b.PartiallyAnswered:b.Unanswered},IsAllAnswered:function(){return 0==this._unanswered},IsUnansweredRequired:function(){return 0!=(this._flags&(e.R|e.D))},IsThisUnansweredRequired:function(){return 0!=(this._flags&e.R)},IsHasErrorText:function(){return 0!=(this._flags&(e.E|e.DE))},IsThisHasErrorText:function(){return 0!=(this._flags&e.E)},UnansweredCount:function(){return this._unanswered},AnsweredCount:function(){return this._explicitlyAnswered+this._implicitlyAnswered},TotalCount:function(){return this.AnsweredCount()+this.UnansweredCount()}},{Aggregate:d}),c}),define("engine/interviewnodelist",["hdmain/system","engine/interviewnodetype","engine/dialogupdateflags"],function(a,b,c,d){function e(a){this._list=[],this._parent=a,this._updatedCount=0}var f=HOTDOC$;return this.DEBUG===d&&(this.DEBUG=f.DEBUG),a.ExtendClass(e,null,{FindExisting:function(a,b,c,d){for(var e=null,f=this._updatedCount;f<this._list.length&&(this._list[f].Variable().name!=a||this._list[f].Owner()!=c||this._list[f].TemplateOfOrigin()!=d);)f++;return f<this._list.length&&(e=this._list[f],!1),e},PrepareToUpdate:function(a){"number"==typeof a?this._updatedCount=a:(this._updatedCount=f.jq.inArray(a,this._list),!1)},FinishUpdating:function(){this._updatedCount=this._list.length},IndexOf:function(a,b,c){if("object"==typeof a){if(b)return this._list.IndexOf(a,b,c);for(var d=0;d<this._list.length;d++)if(this._list[d]==a)return d}else if("string"==typeof a)for(d=0;d<this._list.length;d++)if(this._list[d].Variable().name==a)return d;return-1},IndexOfID:function(a){var b,c=Count;for(b=0;c>b;b++)if(this._list[b]._id==a)return b;return-1},get:function(a){return"number"==typeof a?this._list[a]:(a=this.IndexOf(a),a>=0?this._list[a]:null)},Add:function(a){(this._updatedCount==this.Count()||this.get(this._updatedCount)!=a)&&(this._list.splice(this._updatedCount,0,a),a.SetUpdateFlags(c.NewlyAdded|c.ScriptAnswer),a.NotifyParentOfChildCountChange(!1)),this._parent.Type()==b.Root?this._updatedCount>0&&!this._list[this._updatedCount-1].Enabled()&&a.Enabled(!1):this._parent.Enabled()||a.Enabled(!1),this._updatedCount++,a.SendUpdateFlagsUpstream(c.All,!1)},Insert:function(a,d){var e;if(this._list.splice(a,0,d),this._parent.Type()==b.Repeat)for(e=a+1;e<this._list.length;e++)this._list[e].OffsetIndex(1,d.Indices().length-1);d.SetUpdateFlags(c.NewlyAdded),d.NotifyParentOfChildCountChange(!1),this._updatedCount++,d.SendUpdateFlagsUpstream(c.All,!1)},Move:function(a,c){var d=this._list[a];if(this._list.splice(a,1),this._list.splice(c,0,d),d.NotifyParentOfChildCountChange(!1),this._parent.Type()==b.Repeat){this._list[c].OffsetIndex(c-a,d.Indices().length-1);for(var e=c>a?-1:1,f=c+e;f!=a+e;f+=e)this._list[f].OffsetIndex(e,d.Indices().length-1)}},Remove:function(a){if(null==a)return!1;var b=this.IndexOf(a);return-1==b?!1:(this.RemoveAt(b),!0)},RemoveAt:function(a){var c,d={startIndex:0,endIndex:0},e=this._list[a],f=e.Indices().length-1;for(e.Children().Clear(),e.FindNodesAskedImplicitly(d);d.startIndex<d.endIndex;)this._parent._interview.Root().Children().RemoveAt(d.startIndex),d.endIndex--;if(e.NotifyParentOfChildCountChange(!1),e.Type()!=b.Repeat&&this._parent._interview.UnregisterNode(e),this._list.splice(a,1),this._parent.Type()==b.Repeat)for(c=a;c<this._list.length;c++)this._list[c].OffsetIndex(-1,f);a<this._updatedCount&&this._updatedCount--},RemoveUntil:function(a){for(;this._list[this._updatedCount]!=a;)this.RemoveAt(this._updatedCount)},Trim:function(){for(;this._updatedCount<this._list.length;)this.RemoveAt(this._list.length-1)},TrimUnanswered:function(){for(;this._updatedCount>0&&!this._list[this._updatedCount-1].AnsStatus().IsAnswered();)this._updatedCount--,this._parent._interview.DecRpt()},Clear:function(){for(;this._list.length>0;)this.RemoveAt(this._list.length-1);this.ClearUpdated()},ClearUpdated:function(){this._updatedCount=0},Contains:function(a){return this.IndexOf(a)>=0},CopyTo:function(a,b){for(var c=0;c<this._list.length;c++)a.splice(b+c,0,this._list[c])},Count:function(){return this._list.length},UpdatedCount:function(){return this._updatedCount},IsReadOnly:function(){return!1},toString:function(){var b=this.Count();return a.String.Format("{0} child{1} of {2}",b.toString(),1==b?"":"ren",this._parent.toString())}}),e}),define("engine/baseinterviewnode",["hdmain/system","system/exception/notimplementedexception","system/exception/ArgumentNullException","engine/answeredstatustabulator","engine/interviewnodetype","engine/dialogupdateflags","require","engine/interviewnodelist"],function(a,b,c,d,e,f,g,h,i){function j(a,b,c){switch(this._interview=a,this._type=b,this._parent=c,this._updateFlags=f.None,this._descendantUpdateFlags=f.None,this._answeredStatus=new d,this._enabled=!0,b){case e.DefaultDialog:this._children=g("engine/defaultdialognode")._emptyChildren();break;case e.Repeat:this._children=new h(this,8);break;default:this._children=new h(this)}}function k(){var a;return a=this.Type()==e.Root?[]:k.call(this._parent),a.push(this),a}function l(b){b.WriteStartElement(a.Enum.GetName(e,this._type))}function m(a){a.WriteEndElement()}var n=HOTDOC$,o=a.Cast,p=a.String.IsNullOrEmpty;return a.ExtendClass(j,null,{DoAnswerSync:function(){this._interview.DoAnswerSync()},InitializeId:function(){this._id=this._interview.GetIdForNode(this)},Enabled:function(a){return a===i?this._enabled:(this._enabled!=a&&(this._enabled=a,this.SetUpdateFlags(f.NodeEnabled)),void 0)},InitUpdate:function(){this._children.ClearUpdated()},GetResourceString:function(a){return n.Lc.GetStr(a)},GetResourceButtonCaption:function(){var a=this._interview.PreferenceCache().ResourceButtonText();return p(a)&&(a=n.Lc.GetStr("rs_bcap")),a},InterviewImageUrl:function(){return this._interview._engine.InterviewImageUrl()},SinglePageMode:function(){return this._interview.IsSinglePage()},UpdateFlags:function(){return this._updateFlags},DescendantUpdateflags:function(){return this._descendantUpdateFlags},SetUpdateFlags:function(a){var b,c;this._updateFlags|=a,this._type==e.Repeat&&(b=a&(f.RepeatAnswer|f.ChildCount|f.NodeChildCount),0!=b&&this.SetDescendantUpdateFlags(b,!1)),c=f.AnswerRelated,this._interview.InRebuild()||(c|=f.NodeChildCount|f.ChildCount,this.SinglePageMode()&&(c|=f.AddButtonRefresh)),0!=(a&c)&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(a&c,!0)},SetUpdateFlagsCascading:function(a){var b,c;for(b=0;b<this._children.Count();b++)c=this._children.get(b),0!=(a&(f.NodeChildCount|f.ChildCount))?c.Children().Count()>0?c.SetUpdateFlagsCascading(a):c.SetUpdateFlagsCascading(a^(f.NodeChildCount|f.ChildCount)):c.SetUpdateFlagsCascading(a);this.SetUpdateFlags(a)},NotifyParentOfChildCountChange:function(a){null!=this._parent&&(this._parent.Type()==e.Repeat&&this._parent.SetUpdateFlags(f.RepeatAnswer),this._parent.SetDescendantUpdateFlags(f.NodeChildCount|f.ChildCount,a))},SendUpdateFlagsUpstream:function(a,b){var c=(this._updateFlags|this._descendantUpdateFlags)&a&~f.NewlyAdded;c!=f.None&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(c,b)},SetDescendantUpdateFlags:function(a,b){this._descendantUpdateFlags|=a,b&&null!=this._parent&&this._parent.SetDescendantUpdateFlags(a,!0)},ClearUpdateFlags:function(a){var b,c=a^f.All,d=this.Children();for(this._updateFlags&=c,this._descendantUpdateFlags&=c,b=0;b<d.Count();b++)d.get(b).ClearUpdateFlags(a)},AnsStatus:function(){return this._answeredStatus},NeedsAnsweredStatusUpdate:function(){return 0!=(this._updateFlags&(f.AnswerRelated|f.Required|f.NodeError))||0!=(this._descendantUpdateFlags&f.StatusRelated)},UpdateAnsweredStatus:function(a){var b=g("engine/interviewnode");if(a||0!=(this._descendantUpdateFlags&(f.AnswerRelated|f.Required|f.NodeError))||0!=((this._updateFlags|this._descendantUpdateFlags)&f.NodeChildCount)||!this.Enabled()&&null==this._interview.RequiredNode()||this.Enabled()&&null!=this._interview.RequiredNode()||0!=(this._updateFlags&f.AnswerRelated)&&this._type==e.Iteration){var c=this._interview;n.jq.each(this.Children()._list,function(b,d){d.UpdateAnsweredStatus(a||null!=c._reqNodeOld&&null==c.RequiredNode()&&c._reqNodeOld.IsDescendantOf(d))})}this.NeedsAnsweredStatusUpdate()&&this.TabulateAnsweredStatus(),this._answeredStatus.IsThisUnansweredRequired()&&null==this._interview.RequiredNode()?(this._interview.SetRequiredNode(o(this,b)),this.Enabled(!0)):(null!=this._interview.RequiredNode()||null!=this._interview._reqNodeOld)&&(this.Enabled(null==this._interview.RequiredNode()||this.ContainsDescendant(this._interview.RequiredNode())),this==this._interview._reqNodeOld&&null==this._interview.RequiredNode()&&this._interview.SetRequiredNode(null)),this._answeredStatus.IsThisHasErrorText()&&null==this._interview.ErrorNode()?(this._interview.SetErrorNode(o(this,b)),this.Enabled(!0)):(null!=this._interview.ErrorNode()||null!=this._interview._errNodeOld)&&(this.Enabled(null==this._interview.ErrorNode()||this.ContainsDescendant(this._interview.ErrorNode())),this==this._interview._errNodeOld&&null==this._interview.ErrorNode()&&this._interview.SetErrorNode(null)),null!=this._parent&&0!=((this._updateFlags|this._descendantUpdateFlags)&f.StatusRelated)&&this.SendUpdateFlagsUpstream(f.StatusRelated,!1)},DoAnsweredStatusTabulation:function(){throw new b},TabulateAnsweredStatus:function(){var a,b=this._answeredStatus.Status(),c=this._answeredStatus.IsUnansweredRequired(),d=this._answeredStatus.TotalCount(),e=this._answeredStatus.AnsweredCount();this.DoAnsweredStatusTabulation(),a=f.None,(b!=this._answeredStatus.Status()||c!=this._answeredStatus.IsUnansweredRequired())&&(a=f.NodeAnsStatus|f.AnsweredStatus),this._interview.WantProgressNotifications()&&(e!=this._answeredStatus.AnsweredCount()||d!=this._answeredStatus.TotalCount())&&(a|=f.Progress),a!=f.None&&this.SetUpdateFlags(a)},IsDescendantOf:function(a){if(null==a)throw new c("ancestor");if(this.Type()==e.Root)return!1;for(var b=this._parent;null!=b;){if(b==a)return!0;b=b._parent}return!1},ContainsDescendant:function(a){return a.IsDescendantOf(this)},OutlineParent:function(){var a=g("engine/interviewnode");return o(this._parent,a)},Type:function(){return this._type},Children:function(){return this._children},OutlineChildren:function(){return this._children._list},OutlineChildrenReverse:function(){var a,b=[];for(a=this._children.Count()-1;a>=0;a--)b.push(this._children.get(a));return b},New:function(){return!1},IsHiddenNew:function(){return!1},UserExtendible:function(){return!0},NewIterationNode:function(){var a=g("engine/iterationnode"),b=this,c=null;do b.Type()==e.Iteration&&b.New()&&(c=o(b,a)),b=b._parent;while(b.Type()!=e.Root);return c},AllNew:function(){for(var a=!1,b=this;b.Type()!=e.Root;){if(b.Type()==e.Iteration){if(!b.New()){a=!1;break}a=!0}b=b._parent}return a},Active:function(){return!0},AvailableForNavigation:function(){return!1},HasVisibleChildren:function(){var a,b=this.OutlineChildren();for(a=0;a<b.length;a++)if(b[a].ShowInOutline())return!0;return!1},OnSinglePage:function(){return this._parent._type==e.Root?!0:!1},HasAncestorOnSinglePage:function(a){var b,c,d=!1,e=g("engine/interviewnode");if(!this.OnSinglePage()){d=!0,b=this;do b=b._parent;while(null!=b&&!b.OnSinglePage());c=o(b,e),null!=c&&(a.v=c._id)}return d},DirtySinglePage:function(){if(this.OnSinglePage()){this.SetUpdateFlags(f.All);var a,b;for(a=0;a<this._children.Count();a++)b=this._children.get(a),b.DirtySinglePage()}},ComesAfter:function(a){if(null==a)return!1;if(this==a)return!1;for(var b,c,d=g("engine/interviewnode"),e=k.call(this),f=k.call(a),h=1,i=Math.min(e.length,f.length);i>h&&e[h]==f[h];)h++;return h==i?!1:(b=e[h-1].Children().IndexOf(o(e[h],d)),c=f[h-1].Children().IndexOf(o(f[h],d)),b>c)},Serialize:function(a){l.call(this,a),this.SerializeAttributes(a),this.SerializeElements(a),m(a)},SerializeAttributes:function(a){this._enabled||a.WriteAttributeString("Enabled",this._enabled.toString()),this._answeredStatus.IsThisUnansweredRequired()?a.WriteAttributeString("Required","true"):this._answeredStatus.IsUnansweredRequired()&&a.WriteAttributeString("Required","child"),this._answeredStatus.IsThisHasErrorText()?a.WriteAttributeString("ErrorText","true"):this._answeredStatus.IsHasErrorText()&&a.WriteAttributeString("ErrorText","child"),a.WriteAttributeString("Status",this._answeredStatus.Status().toString())},SerializeElements:function(a){var b,c;if(null!=this._children&&(b=this._children.Count(),b>0)){for(a.WriteStartElement("Children"),c=0;b>c;c++)this._children.get(c).Serialize(a);a.WriteEndElement()}},toString:function(){return a.String.Format("{0} Node",this.Type().toString())}}),j}),define("engine/interviewnode",["hdmain/jq","runtime/numbervalidationresult","hdmain/system","engine/datasourceloadresult","system/exception","system/exception/invalidoperationexception","engine/formattingcontext","engine/interviewnodeoutlinefontflags","engine/dotcode","engine/interviewnodetype","engine/baseinterviewnode","engine/dialogupdateflags","require"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b,c,d,e){o.baseConstructor.call(this,a,b,c),this._autoHidden=!1,this._active=!0,this.EmptyItemNodes=new q.DialogItemNodeList(0),this._template=a.CurrentTemplate(),this._dialog=d,this._indices=e,this._owner=a.InRebuild()&&a.CurrentBuildNode()!=c?x(a.CurrentBuildNode(),o):null,this._itemNodes=this.EmptyItemNodes,this._focusedItem=-1}function p(){}var q=HOTDOC$;this.DEBUG===n&&(this.DEBUG=q.DEBUG);var r=a.proxy,s="IsSpreadsheetRowInSpreadsheet",t=q.FocusDirection={Forward:0,Reverse:1},u=q.FocusOperation={ReassertOnly:0,AdvanceIfNecessary:1,Advance:2},v=c.String.IsNullOrEmpty,w=c.String.Format,x=c.Cast,y=q.Lc;return c.ExtendClass(o,k,{Variable:function(){return this._dialog},TemplateOfOrigin:function(){return this._template},Indices:function(){return null!=this._indices?this._indices:[]},OutlineChildren:function(){var a,b,c,d=[];for(a=0;a<this._children.Count();a++)if(c=this._children.get(a),c.IsOnParent())for(b=0;b<c.OutlineChildren().length;b++)d.push(c.OutlineChildren()[b]);else d.push(c);return d},OutlineChildrenReverse:function(){var a,b,c,d=[];for(a=this._children.Count()-1;a>=0;a--)if(c=this._children.get(a),c.IsOnParent())for(b=0;b<c.OutlineChildrenReverse().length;b++)d.push(c.OutlineChildrenReverse()[b]);else d.push(c);return d},AskedImplicitly:function(){return null!=this._owner},Owner:function(){return this._owner},IsSpreadsheetRow:function(){return this.Type()==j.Iteration&&"S"==this._dialog.rType},IsSpreadsheetRowInEditMode:function(){return this.IsSpreadsheetRow()&&this._parent.EditRowMode()},IsSpreadsheetRowInSpreadsheet:function(){return this.IsSpreadsheetRow()&&!this._parent.EditRowMode()},IsOnParent:function(){return this._dialog.onPar?this._parent.Type()==j.Root?!1:this._parent.Type()==j.Iteration&&this._parent[s]()?!1:!0:!1},OnSinglePage:function(){return this.IsOnParent()?this._parent.OnSinglePage():o.baseclass.OnSinglePage.call(this)},ClearUpdateFlags:function(a){0!=(a&l.DialogContentRelated)&&this._itemNodes.ClearUpdateFlags(),o.baseclass.ClearUpdateFlags.apply(this,arguments)},SetIndex:function(a){var b,c,d=m("engine/iterationnode");if(!q.RepeatIndices.AreRelated(a,this._indices))for((this._type==j.Iteration&&!this[s]()||this._parent.Type()==j.Iteration&&x(this._parent,d)[s]())&&this.SetUpdateFlags(l.Title|l.NodeTitle),this._indices=q.RepeatIndices.SetBaseIndices(this._indices,a),b=0;b<this._children.Count();b++)c=this._children.get(b),c.SetIndex(a)},OffsetIndex:function(a,b){var c,d=m("engine/iterationnode");for(this._indices[b]+=a,(this._type==j.Iteration&&!this[s]()||this._parent.Type()==j.Iteration&&x(this._parent,d)[s]())&&this.SetUpdateFlags(l.Title|l.NodeTitle),this._interview.OffsetIndicesForId(this._id,a,b),c=0;c<this._children.Count();c++)child=this._children.get(c),child.OffsetIndex(a,b)},GetCaption:function(a,b,c){return c=h.None,this._parent.Type()==j.Iteration&&this._parent[s]()?this._parent.New()?y.GetStr("ui_new")+": "+(v(this._title)?this._dialog.name:b(o.FixAmpersands(this._title,!1),a,c)):q.RepeatIndices.ToPrefixString(this._indices)+(v(this._title)?this._dialog.name:b(o.FixAmpersands(this._title,!1),a,c)):null==this._title||""==this._title?this.Variable().name:b(o.FixAmpersands(this._title,!1),a,c)},New:function(){var a=m("engine/iterationnode");return this._parent.Type()==j.Iteration&&x(this._parent,a)[s]()?this._parent.New():o.baseclass.New.call(this)},IsHiddenNew:function(){var a=m("engine/iterationnode");return this._parent.Type()==j.Iteration&&x(this._parent,a)[s]()?this._parent.IsHiddenNew():o.baseclass.IsHiddenNew.call(this)},RequiredAsterisk:function(){return this._interview._engine.RequiredAsterisk()},RequiredIsEnforcable:function(){if(!this.Active())return!1;if(this._type==j.Iteration){var a=m("engine/iterationnode"),b=x(this,a);if(b.New()&&b.IterationNumber()>0)return!1}return this.AllNew()&&!q.RepeatIndices.IsFirst(this._indices)?!1:this.GetIsPartOfInterview()?!0:!1},GetIsPartOfInterview:function(){var a=!0;return this._parent.Type()!=j.Root&&(a=x(this._parent,o).GetIsPartOfInterview()),a&&(a=this._parent.Children().Contains(this)),a},Caption:function(){var a;return this.GetCaption(g.PlainText,i.DefaultProcessor,a)},GetOutlineCaption:function(a){return this.GetCaption(g.OutlineText,i.DefaultProcessor,a)},Title:function(a){return a===n?this._title:(a!=this._title&&this.SetUpdateFlags(l.Title|l.NodeTitle),this._title=a,void 0)},AutoHidden:function(a){return a===n?this._autoHidden:(this._autoHidden!=a&&(this._autoHidden=a,this.Active(!a)),void 0)},Active:function(a){if(a===n)return this._active;if(this._active!=a&&(this._active=a,this._parent.SetUpdateFlags(l.NodeChildCount|l.ChildCount),!this._active))for(child in this.Children)child.Active(!1)},IsOwnedBy:function(a){if(!this.AskedImplicitly())return!1;if(this._owner==a)return!0;if(this._owner.AskedImplicitly())return this._owner.IsOwnedBy(a);if(this._owner.IsDescendantOf(a))return!0;for(var b=x(this._owner.Parent,o);null!=b&&!b.AskedImplicitly();)b=x(b.Parent,o);return null!=b?b.IsOwnedBy(a):!1},FindNodesAskedImplicitly:function(a){for(var b,c=this;c._parent.Type()!=j.Root;)c=x(c._parent,o);for(b=x(c._parent,q.RootNode),a.endIndex=b.Children().IndexOf(c),a.startIndex=a.endIndex;a.startIndex>0&&b._children.get(a.startIndex-1).AskedImplicitly();)a.startIndex--;for(;a.startIndex<a.endIndex&&!b._children.get(a.startIndex).IsOwnedBy(this);)a.startIndex++;for(;a.endIndex>a.startIndex&&b._children.get(a.endIndex-1).AskedImplicitly()&&!b._children.get(a.endIndex-1).IsOwnedBy(this);)a.endIndex--},GetNodesAskedImplicitly:function(){var a,b={startIndex:0,endIndex:0},c=[];for(this.FindNodesAskedImplicitly(b),a=b.startIndex;a<b.endIndex;a++)c.push(this._interview.Root.Children().get(a));return c},GenerateDefaultTitle:function(){var a,b,c,d=this._dialog,e=null,f=null,g=!1,h=0;for(h=0;h<d.vList.Count();h++){if(e=d.vList.GetItem(h),e instanceof q.Variable){for(a=h+1;a<d.vList.Count();a++)if(d.vList.GetItem(a)instanceof q.Variable){g=!0;break}b=e,f=b.EvTitle(),v(f)&&(f=o.TrimForUseAsTitle(b.EvPrompt()),v(f)&&(f=b.name));break}if("TXL"==e.type){if(c=e,f=o.TrimForUseAsTitle(c.EvText()),!v(f))break}else if("HDL"==e.type&&(c=e,f=c.EvCapt().replace(/^\s+|\s+$/g,""),!v(f)))break}return v(f)?f=y.GetStr("ui_emptydlg"):"NONE"==f&&(f="",g=!1),g&&(f+=y.GetStr("ui_etc")),f},EvTitle:function(){var a=this._dialog.EvTitle();return v(a)&&this._interview.PreferenceCache().GenerateDialogTitles()&&(a=this.GenerateDefaultTitle()),a},EvaluateText:function(){this.Title(this.EvTitle()),this._updateFlags|=this._itemNodes.Update()},ShowInOutline:function(){return this.AutoHidden()?!1:this.Active()&&!this.IsHiddenNew()
},AvailableForNavigation:function(){return this.ShowInOutline.call(this)},DoImplicitAnswerProcessing:function(){},ClearGroupedItems:function(a,b,c){if(this._type!=j.Dialog&&this._type!=j.Iteration)throw new f(y.GetStr("err_grptf"));if(""==this._dialog.gType&&!IsSpreadsheetRow)throw new f(y.GetStr("err_grptf_un"));this._interview.BeginBulkAnswerChange();var d,e,g,h=!1;for(d=a;b>=d;d++)e=this._itemNodes.get(d),e!=c&&(g=e.DialogItem(),("TF"==g.type||"DI"==g.type)&&(this._interview._engine.LoadAnswerValue("TF",g.name,!1,x(g,q.Variable).saveAns,this._indices),e.SetUpdateFlags(l.ScriptAnswer),h=!0));if(this._dialog.nota&&(h||a==b)){if(!this._itemNodes.get(b+1).NoneOfTheAbove())throw new f("Failed to find None of the Above item in the expected position.");this._itemNodes.get(b+1).SetUpdateFlags(l.ScriptAnswer)}this._interview.EndBulkAnswerChange(!1)},ClearAnswers:function(a){"boolean"!=typeof a&&(a=!0),this._interview.BeginBulkAnswerChange(),a&&this.DoAnswerSync();var b,c;for(b=0;b<this._itemNodes.Count();b++)c=this._itemNodes.get(b),c.ClearAnswer(!1);this.DoImplicitAnswerProcessing(),this._interview.EndBulkAnswerChange(!0)},VariableHasAnswer:function(a){if(null!=a){var b=this._interview._engine.GetAnswer(a.name);if(b!==n)return b.IsAns(this._indices)}return!1},VariableIsUserModifiable:function(a){var b,c=!1;return null!=a&&(c=!0,b=this._interview._engine.GetAnswer(a.name),null!=b&&(c=b.GetUserModifiable(this._indices),c&&this.Type()==j.Iteration&&this.New()&&!this.UserExtendible()&&(c=!1))),c},GetVariableAnswerDouble:function(a){var b,c=this._interview._engine.GetAnswer(a.name);return null!=c&&(b=c.GetValue(this._indices),null!=b)?b:null},GetVariableAnswerDate:function(a,b){var c,d=this._interview._engine.GetAnswer(a.name);return null!=d&&(c=d.GetValue(this._indices),null!=c)?(b.v=c,!0):!1},GetVariableAnswerList:function(a,b){var c,d=this._interview._engine.GetAnswer(a.name);return d===n&&a.dv&&(d=q.Answers.CreateAnswer("MC",a.name)),null!=d&&(c={v:d.GetValue(this._indices)},null==c.v&&a.dv&&(!this[s]()||0==this._indices[this._indices.length-1])&&(d.SetValue(a.dv,this._indices),c.v=d.GetValue(this._indices)),a.ReconcileOptions(c,this._interview.GetRuntimeOptionsForVariable(a)),null!=c.v)?(b.push.apply(b,c.v),!0):(b=null,!1)},GetVariableAnswerOther:function(a,b){if(a.othr&&!a.MultipleSelect()){var c,d,e=this._interview._engine.GetAnswer(a.name);if(null!=e&&(c=e.GetValue(this._indices),null!=c&&(d=this._interview.GetRuntimeOptionsForVariable(a),!d.Contains(c[0]))))return b=c[0],!0}return b=null,!1},SetVariableAnswerDouble:function(a,c,d){d.v="";var e,f=y.ParseNumber(c);switch(null!=f&&(e=Math.pow(10,a.decPl),f=Math.round(f*e)/e),a.CheckMinMax(f)){case b.Valid:return this._interview._engine.LoadAnswerValue("NU",a.name,f,a.saveAns,this._indices),!0;case b.ErrorNotANumber:d.v=y.GetStr("val_invnum");break;case b.ErrorOutOfRange:d.v=y.GetStr("val_numrng",y.FormatNumberDef(a.min,a.decPl),y.FormatNumberDef(a.max,a.decPl));break;case b.ErrorTooSmall:d.v=y.GetStr("val_numgt",y.FormatNumberDef(a.min,a.decPl));break;case b.ErrorTooBig:d.v=y.GetStr("val_numlt",y.FormatNumberDef(a.max,a.decPl))}return!1},SetVariableAnswerDate:function(a,b){var c=b?new Date(b):null;this._interview._engine.LoadAnswerValue("DA",a.name,c,a.saveAns,this._indices)},SetVariableAnswerList:function(a,b){"string"==typeof b&&(""==b&&(this[s]()||"CO"==a.style||"SL"==a.style)&&(b=null),null!=b&&(b=[b])),this._interview._engine.LoadAnswerValue("MC",a.name,b,a.saveAns,this._indices)},GetItemWidth:function(a){for(var b,c=0,d=1,e=a;e>0&&(1==this._dialog.plcmt[e]||3==this._dialog.plcmt[e]);)e--;for(this._dialog.plcmt[e]>=2&&c++,b=e+1;b<this._dialog.plcmt.length&&(1==this._dialog.plcmt[b]||3==this._dialog.plcmt[b]);)d++,this._dialog.plcmt[b]>=2&&c++,b++;switch(d){case 1:return 100;case 2:return this._dialog.plcmt[a]>=2?67:c>0?33:50;case 3:return 33;default:throw new f("Found more than 3 variables on a single line in the dialog")}},IsItemOnPrevLine:function(a){return 1==this._dialog.plcmt[a]||3==this._dialog.plcmt[a]},GetItemMapName:function(a){var b,c=this._dialog.Mappings[a];return c!==n&&null!=c?c.n:(b=x(this._itemNodes.get(a).DialogItem(),q.Variable),null!=b&&"DI"!=b.type?b.name:null)},GetItemMapType:function(a){var b,c=this._dialog.Mappings[a];return c!==n&&null!=c&&"UN"!=c.ExpectedType&&"OT"!=c.ExpectedType?c.t:(b=x(this._itemNodes.get(a).DialogItem(),q.Variable),null!=b&&"DI"!=b.type?b.valType:"UN")},IsItemInProtectedGroup:function(a){if(""==this._dialog.gType)return!1;var b,c,d,e,f=x(this._itemNodes.get(a).DialogItem(),q.Variable),g={},h={};if(null==f||"TF"!=f.type&&"DI"!=f.type)return!1;if(this._dialog.GetTrueFalseGroupBounds(a,g,h),g.v<0)return!1;for(b=g.v;b<=h.v;b++)if(c=this._dialog.vList.GetItem(b),d=this._interview._engine.GetAnswer(c.name),null!=d&&(e=d.GetValue(this.Indices()),null!=e&&e&&!d.GetUserModifiable(this.Indices())))return!0;return!1},IsAnyVariableProtected:function(){var a,b,c;for(a=0;a<this._dialog.vList.Count();a++)if(b=this._dialog.vList.GetItem(a),c=this._interview._engine.GetAnswer(b.name),null!=c&&!c.GetUserModifiable(this.Indices()))return!0;return!1},NavigateTo:function(a,b,c){this._interview.GotoDialog(this,b,a,null,c)},HasAnswerSource:function(){return!(this.Type()!=j.Dialog&&this.Type()!=j.Iteration||null==this._dialog.DataSource||"CAF"!=this._dialog.DataSource.t&&"AF"!=this._dialog.DataSource.t&&"C"!=this._dialog.DataSource.t)},AnswerSourceColumns:function(){var b=[];return a.each(this.AllAnswerSourceColumns(),function(a,c){c.ConcealedOnAnswerSource()||b.push(c)}),b},AllAnswerSourceColumns:function(){var b=[];return a.each(this._itemNodes._itemNodes,function(a,c){c.DialogItem()instanceof q.Variable&&"DI"!=c.DialogItem().type&&!c.OmittedFromAnswerSource()&&b.push(c)}),b},AnswerSourceTypeIsCompatible:function(a,b){return a==b?!0:"TX"==a&&"MC"==b||"MC"==a&&"TX"==b},GetDataSourcePropertyName:function(a){if(null==this._dialog.DataSource)throw new NullReferenceException("Cannot get a property name when there is no data source defined.");switch(this._dialog.DataSource.t){case"CAF":case"AF":case"C":return a.MapName();default:throw new e(w("The data source type '{0}' is not supported.",this._dialog.DataSource.t))}},LoadDataSourceRows:function(b){if(null==this._dialog.DataSource)throw new NullReferenceException("Cannot load data source rows when there is no data source defined.");var c,f,g,h,i,j,k,l,m,n=this._dialog.DataSource;switch(n.t){case"CAF":c=[],f=[],g=this,a.each(this.AllAnswerSourceColumns(),function(b,d){if(i=g._interview._engine.GetAnswer(d.MapName()),null!=i&&g.AnswerSourceTypeIsCompatible(i.VT(),d.MapType())){for(h=null==i?0:i.GetChildCount(),j=0;h>j;j++)j>=f.length&&f.push(new a.Dictionary),value=i.GetValue([j]),f[j].Add(d.MapName(),value);c.push(d)}}),b(new d(c,f,null));break;case"AF":k=q.DataSourceLoader.GetDataSourceCollection(n.id),null==k?(l="",p.call(this,l),q.DataSourceLoader.LoadAnswerFileDataSource(q.DataSourceAddressDict[n.n.toLowerCase()].Address,q.TemplateLocator,this._template.name,n.id,l,r(function(a){b(new d(this.AllAnswerSourceColumns(),a.Rows(),a.Error()))},this))):b(new d(this.AllAnswerSourceColumns(),k.Rows(),k.Error()));break;case"C":k=q.DataSourceLoader.GetDataSourceCollection(n.id),null==k?(l="",p.call(this,l),m=q.DataSourceAddressDict[n.n.toLowerCase()],q.DataSourceLoader.LoadCustomDataSource(m.Address,m.Name,n.id,l,r(function(a){b(new d(this.AllAnswerSourceColumns(),a.Rows(),a.Error()))},this))):b(new d(this.AllAnswerSourceColumns(),k.Rows(),k.Error()));break;default:throw new e(w("Data sources of type {0} are not supported.",this._dialog.DataSource.t))}},SetAnswersFromAnswerSourceRow:function(a,b){this._interview.BeginBulkAnswerChange();var c,d,e;for(c=0;c<a.length;c++)switch(d=a[c],e=b.TryGetValue(this.GetDataSourcePropertyName(d)),d.DialogItem().type){case"TX":null!=e?"string"==typeof e?d.StringAnswer(e):"array"==typeof e&&d.StringAnswer(e.toString()):d.StringAnswer(null);break;case"NU":null!=e?d.DoubleAnswer(e):d.DoubleAnswer(null);break;case"DA":null!=e?d.DateAnswer(e):d.DateAnswer(null);break;case"TF":null!=e?d.BoolAnswer(e):d.BoolAnswer(null);break;case"MC":null!=e?"object"==typeof e&&e.length?d.ListAnswer(e):"string"==typeof e&&d.StringAnswer(e):d.ListAnswer(null)}this._interview.EndBulkAnswerChange(!0)},GetFocusedItemNode:function(){var a,b,c=null;return this._type==j.Repeat&&x(this,q.RepeatNode).IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?c=x(this,q.RepeatNode).SpreadsheetItemNode()._parent.GetFocusedItemNode():this._focusedItem>=0&&(c=this._itemNodes.get(this._focusedItem),c.IsSpreadsheet()&&(a=c.SpreadsheetNode(),b=c.GetRowFocus(),b>=0&&b<a.Children().Count()&&(c=a.Children().get(b).GetFocusedItemNode()))),c},ClearFocusedItemNode:function(){var a=m("engine/iterationnode");this._type==j.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?this.SpreadsheetItemNode()._parent.ClearFocusedItemNode():this._focusedItem>=0&&this._itemNodes.get(this._focusedItem).ClearFocus(),this[s]()&&x(this,a).SpreadsheetItemNode().SetRowFocus(-1),this._focusedItem=-1},SetFocus:function(a){var b=m("engine/iterationnode");if(this._type==j.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode())return this.SpreadsheetItemNode()._parent.SetFocus(a),void 0;if(this._focusedItem=a,this[s]()){var c=x(this,b).SpreadsheetItemNode(),d=q.RepeatIndices.GetTopIndex(this._indices);d>=this._parent.Children().Count()&&(d=this._parent.Children().Count()-1),c.SetRowFocus(d)}},AdvanceFocus:function(a,b,c){function d(){this._focusedItem>=0&&this._focusedItem<this._itemNodes.Count()?this._itemNodes.get(this._focusedItem).AssertFocus(a?u.Advance:u.AdvanceIfNecessary,b,r(function(e){return e?(c(e),void 0):(this._focusedItem+=b==t.Forward?1:-1,a=!1,d.call(this),void 0)},this)):(this._focusedItem=-1,c(!1))}if(c===n&&(c=function(){}),this._type==j.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode())return this.SpreadsheetItemNode()._parent.AdvanceFocus(a,b,c),void 0;var e,f;return-1==this._focusedItem&&(this._focusedItem=b==t.Forward?0:this._itemNodes.Count()-1,a=!1),a&&!this[s]()&&(e=this.GetFocusedItemNode(),f=!1,null!=e&&(f=e.OnAnswerSync()),f)?(c(!1),void 0):(d.call(this),void 0)},ReassertFocus:function(a){return this._type==j.Repeat&&this.IsSpreadsheet()&&this.IsOnParent()&&!this.EditRowMode()?(this.SpreadsheetItemNode()._parent.ReassertFocus(a),void 0):(this._focusedItem>=0&&this._focusedItem<this._itemNodes.Count()&&this._itemNodes.get(this._focusedItem).AssertFocus(u.ReassertOnly,a),void 0)},GetNextFocusNode:function(a){if(!this._interview.IsSinglePage()||!this.OnSinglePage())return null;var b=this._parent.Children().IndexOf(this),c=null;return a==t.Reverse?b>0?c=this._parent.Children().get(b-1):this._parent.Type()!=j.Root&&(b=this._parent._parent.Children().IndexOf(x(this._parent,o)),b>0&&(c=this._parent._parent.Children().get(b-1))):b<this._parent.Children().Count()-1&&(this._parent.Type()!=j.Repeat||!this._parent.Children().get(b+1).IsHiddenNew())?c=this._parent.Children().get(b+1):this._parent.Type()!=j.Root&&(b=this._parent._parent.Children().IndexOf(x(this._parent,o)),b<this._parent._parent.Children().Count()-1&&(this._parent._parent.Type()!=j.Repeat||!this._parent._parent.Children().get(b+1).IsHiddenNew())&&(c=this._parent._parent.Children().get(b+1))),null!=c&&c.Type()==j.Repeat&&"S"!=c._dialog.rType&&(c=a==t.Forward?c.Children().get(0):c.Children().Count()>1&&c.Children().get(c.Children().Count()-1).IsHiddenNew()?c.Children().get(c.Children().Count()-2):c.Children().get(c.Children().Count()-1)),c},GenerateBookmark:function(){var a,b="";if(b+=this.Variable().name,this._type!=j.DefaultDialog)for(b+="|",b+=this._focusedItem>=0?this._type==j.Repeat?this.Children().get(0).ItemNodes.IndexOfName(this._itemNodes.get(this._focusedItem).DialogItem().name):this._focusedItem:"-1",a=0;a<this._indices.length;a++)b+="|",b+=this._indices[a];return b},SerializeAttributes:function(a){this._type!=j.DefaultDialog&&a.WriteAttributeString("Name",this.Variable().name),null!=this._indices&&this._indices.length>0&&a.WriteAttributeString("Indices",q.RepeatIndices.ToString(this._indices)),null!=this._owner&&a.WriteAttributeString("Owner",this._owner.Variable().name),this._active||a.WriteAttributeString("Active",this._active.toString()),this._autoHidden&&a.WriteAttributeString("AutoHidden",this._autoHidden.toString());var b=Caption;!v(b)&&b!=this.Variable().name&&a.WriteAttributeString("Caption",b),o.baseclass.SerializeAttributes(a)}},{HDEscQuots:function(a,b,c){return"boolean"!=typeof c&&(c=!0),"string"!=typeof a&&null!=typeof a.hdType&&"S"!=a.hdType?"":(b!==!1&&(b=!0),b?(a=a.replace(/&/g,"&amp;"),c&&(a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;")),a=a.replace(/\'/g,"&#39;"),a=a.replace(/\"/g,"&quot;")):(a=a.replace(/&#39;/g,"'"),a=a.replace(/&quot;/g,'"'),c&&(a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">")),a=a.replace(/&amp;/g,"&")),a)},FixAmpersands:function(a,b){"string"!=typeof a&&(a=""),"boolean"!=typeof b&&(b=!1);var c,d=b?"&amp;":"&";return a=a.replace(new RegExp("\\"+d+"\\"+d,"g"),"※⁂"),a=a.replace(new RegExp("\\"+d+"(\\s|<BR>)","g"),"※⁂$1"),c=a.indexOf(d),c>=0&&(a=a.substr(0,c)+"<u>"+a.substr(c+d.length,1)+"</u>"+a.substr(c+d.length+1)),a=a.replace(new RegExp("\\"+d,"g"),""),a=a.replace(new RegExp("※⁂","g"),d)},TrimForUseAsTitle:function(a){if(!a)return"";if(""==a)return a;a=a.replace(/<br>/gi,"\n");var b=a.search(/[^-:;,.?! \n\t]/);return b>0&&(a=a.slice(b)),b=a.search(/[\n\t]/),b>0&&(a=a.slice(0,b)),b=a.search(/[-:;.,?! ]+$/),b>0&&(a=a.slice(0,b)),a}}),q.InterviewNode=o,o}),define("system/exception/argumentnullexception",["hdmain/system","system/exception/argumentexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("engine/dialognode",["hdmain/system","system/exception/invalidoperationexception","system/exception/notimplementedexception","system/exception/argumentnullexception","engine/answeredstatustabulator","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode"],function(a,b,c,d,e,f,g,h,i){function j(a,b,c){c===i?(j.baseConstructor.call(this,a,f.Iteration,b,b._dialog,a.GetCurrentIndices()),this.SharedInit()):(j.baseConstructor.call(this,a,f.Dialog,b,c,b.Type()==f.Root?[]:a.GetCurrentIndices()),this.SharedInit(),this.InitializeId())}var k=HOTDOC$,l=a.Cast,m=a.String.IsNullOrEmpty;return this.DEBUG===i&&(this.DEBUG=k.DEBUG),a.ExtendClass(j,h,{SharedInit:function(){var a,b,c,d=this._dialog.vList.Count(),e=this._dialog.nota?this._dialog.TrueFalseGroupCount():0,f=e>0||"S"==this._dialog.gType&&this._dialog.TrueFalseGroupCount()>0,g=-1,h={v:-1},i={v:-1};for(this._itemNodes=new k.DialogItemNodeList(d+e),c=0;d>c;c++)f&&(c<=i.v?!1:i.v>=0?(this._dialog.nota&&(a=this._interview.GetNOTAProxyForDialog(this._dialog,g),this._itemNodes.Add(a.name,this,k.NoneOfTheAboveIndex)),h.v=i.v=-1):(this._dialog.GetTrueFalseGroupBounds(c,h,i),h.v>=0&&g++)),b=this._dialog.vList.GetItem(c),this._itemNodes.Add(b.name,this,c);i.v>=0&&this._dialog.nota&&(a=this._interview.GetNOTAProxyForDialog(this._dialog,g),this._itemNodes.Add(a.name,this,k.NoneOfTheAboveIndex)),this._interview.RegisterNode(this)},AutoHidden:function(a){if(a===i)return j.baseclass.AutoHidden.call(this);if(this._autoHidden!=a){j.baseclass.AutoHidden.call(this,a);var b=l(this._parent,h);null!=b&&b.Type()!=f.Repeat&&b._itemNodes.get(this.Variable().name).SetUpdateFlags(g.Hidden)}},DoAnsweredStatusTabulation:function(){var a,b,c,d,g,h,i;for(this._answeredStatus.Reset(),i=0;i<this._itemNodes.Count();i++)if(a=this._itemNodes.get(i),!(a.NoneOfTheAbove()||(b=a.DialogItem(),b instanceof k.DlgEl)))if("DI"==b.type)a.NeedsProcessing()&&(h=this._children.get(b.name),null!=h&&e.Aggregate(this._answeredStatus,h.AnsStatus()));else{if(a.Gray()||a.Hidden()||a.SetByDialogScript())continue;if(c=l(b,k.Variable),d=!1,"TF"==c.type&&(""!=this._dialog.gType||this._type==f.Iteration&&l(this,k.IterationNode).IsSpreadsheetRowInSpreadsheet())){if(g={v:null},a.GetAnswerBool(g)){this._answeredStatus.IncAnswered(c.warnUna,a.Required(),!g.v);continue}d=!0}if(!d&&a.IsAnswered()){this._answeredStatus.IncAnswered(c.warnUna,a.Required(),!1);continue}this._answeredStatus.IncUnanswered(c.warnUna,a.Required())}this._answeredStatus.IsThisUnansweredRequired()&&!this._answeredStatus.IsAnswered()&&(this.RequiredIsEnforcable()||this._answeredStatus.ClearRequired()),m(this.ErrorText)?this._answeredStatus.ClearError():this._answeredStatus.SetError(),this._answeredStatus.IsThisHasErrorText()&&!this._answeredStatus.IsAnswered()&&(this.RequiredIsEnforcable()||this._answeredStatus.ClearError())},GetRequiredVarName:function(){throw new c},DoImplicitAnswerProcessing:function(){var a,c,d,e;for(this._interview.BeginBulkAnswerChange(),a=0;a<this._dialog.vList.Count();a++)c=this._dialog.vList.GetItem(a),"MC"==c.type&&(d=l(c,k.McVar),e=this._interview._engine.GetAnswer(d.name),null!=e&&(value={v:e.GetValue(this._indices)},d.ReconcileOptions(value,this._interview.GetRuntimeOptionsForVariable(d))&&this._interview._engine.LoadAnswerValue("MC",d.name,value.v,d.saveAns,this._indices)));if(this._interview.EndBulkAnswerChange(!1),""!=this._dialog.gType||this.IsSpreadsheetRowInSpreadsheet()){if(this._type!=f.Dialog&&this._type!=f.Iteration)throw new b(k.Lc.GetStr("err_grptf"));for(this._interview.BeginBulkAnswerChange(),a=0;a<this._dialog.vList.Count();a++)c=this._dialog.vList.GetItem(a),"TF"==c.type||"DI"==c.type&&""!=this._dialog.gType&&this._itemNodes.get(c.name).IsChildDialogButton()?this.VariableHasAnswer(l(c,k.Variable))||this._interview._engine.LoadAnswerValue("TF",c.name,!1,l(c,k.Variable).saveAns,this._indices):"DI"==c.type&&this._itemNodes.get(c.name).IsDialogOnParent()&&this.Children().get(c.name).DoImplicitAnswerProcessing();this._interview.EndBulkAnswerChange(!1)}},SerializeElements:function(a){a.WriteStartElement("DialogItems");for(var b=0;b<this._itemNodes.Count();b++)this._itemNodes.get(b).Serialize(a);a.WriteEndElement(),j.baseclass.SerializeElements(a)}},{CreateOrLocate:function(a,b,c,e){var g,i;if(null==a)throw new d("interview");if(null==b)throw new d("parent");if(null==c)throw new d("dialog");return g=a.CurrentBuildNode()!=b?l(a.CurrentBuildNode(),h):null,i=l(b.Children().FindExisting(c.name,f.Dialog,g,a.CurrentTemplate()),j),null==i?(i=new j(a,b,c),e.v=!0):e.v=!1,i.InitUpdate(),i}}),j}),define("engine/iterationnode",["hdmain/system","system/exception/argumentnullexception","./interviewnodeoutlinefontflags","engine/dialogupdateflags","engine/interviewnode","engine/dialognode"],function(a,b,c,d,e,f,g){function h(a,b,c){h.baseConstructor.call(this,a,b),this._iterationId=b.NextIterationId(),this_flags=m.None,this.SetFlag(m.NewIteration,c),this.InitializeId()}var i=HOTDOC$,j=a.Cast,k=a.String.IsNullOrEmpty,l=a.Windows.Visibility;this.DEBUG===g&&(this.DEBUG=i.DEBUG);var m={None:0,NewIteration:1,Hidden:2};return a.ExtendClass(h,f,{OutlineParent:function(){return j(this._parent,i.RepeatNode).IsSpreadsheetRow()?j(this._parent._parent,e):h.baseclass.OutlineParent.call(this)},IterationId:function(){return this._iterationId},GetFlag:function(a){return 0!=(this._flags&a)},SetFlag:function(a,b){b?this._flags|=a:this._flags&=~a},New:function(){return this.GetFlag(m.NewIteration)},IsHiddenNew:function(){if(this.New()&&this.IterationNumber()>0){var a=this._interview.CurrentOutlineNode();if(a!=this&&!this.ContainsDescendant(a))return!0}return!1},UserExtendible:function(){return this._parent.UserExtendible()},AddButtonText:function(){return k(this._addButtonCaption)?i.Lc.GetStr("ui_addbtn"):this._addButtonCaption},DisplayAddButton:function(){return!this.IsSpreadsheetRowInSpreadsheet()},AddButtonVisibility:function(){if(!this._interview.IsSinglePage())return l.Visible;var a=this._parent.Children().Count(),b=this._parent.Children().get(a-1);return this==b||a>1&&b instanceof h&&j(b,h).IsHiddenNew()&&this==this._parent.Children().get(a-2)?l.Visible:l.Collapsed},AddButtonIsEnabled:function(){return this._parent.Children().get(this._parent.Children().Count()-1).New()?this._parent.Limit>0&&this.IterationNumber()==this._parent.Limit-1?!1:this.UserExtendible()?!0:!1:!1},DeleteIsEnabled:function(){return this.UserExtendible()?this.IsAnyVariableProtected()?!1:!0:!1},IterationNumber:function(){return i.RepeatIndices.GetTopIndex(this._indices)},IterationHidden:function(a){return a===g?this.GetFlag(m.Hidden):(this.IterationHidden()!=a&&(this.SetFlag(m.Hidden,a),this._parent.SetUpdateFlags(d.NodeChildCount)),void 0)},ShowInOutline:function(){return this.IsSpreadsheetRow()?!1:this.IsHiddenNew()?!1:h.baseclass.ShowInOutline.call(this)&&!this.IterationHidden()},AvailableForNavigation:function(){var a=j(this._parent,i.RepeatNode);return a.IsSpreadsheet()&&null!=a.EditingRow()&&!this.New()?!0:h.baseclass.AvailableForNavigation.call(this)},SpreadsheetItemNode:function(){if(this.IsSpreadsheetRowInSpreadsheet()){var a=j(this._parent,i.RepeatNode);return a.IsOnParent()?j(a._parent,e)._itemNodes.get(this._dialog.name):a._itemNodes.get(this._dialog.name)}return null},EndRowEdit:function(){j(this._parent,i.RepeatNode).SetEditRow(-1)},EvTitle:function(){return this._addButtonCaption=this._dialog.EvAddBC(),h.baseclass.EvTitle.call(this)},GetCaption:function(a,b,d){return d=c.None,this.New()?i.Lc.GetStr("ui_new")+": "+(""==this._title?this._dialog.name:b(e.FixAmpersands(this._title,!1),a,d)):i.RepeatIndices.ToPrefixString(this._indices)+(""==this._title?this._dialog.name:b(e.FixAmpersands(this._title,!1),a,d))},OnSinglePage:function(){return this.IsSpreadsheetRowInEditMode()?!1:this._parent.OnSinglePage()},SerializeAttributes:function(a){h.baseclass.SerializeAttributes(a),this.New()&&a.WriteAttributeString("New","true")}},{CreateOrLocate:function(a,c,e,f){if(null==a)throw new b("interview");if(null==c)throw new b("parent");var g,i,k=null;if(c.Children().Count()>c.Children().UpdatedCount()){if(k=j(c.Children().get(c.Children().UpdatedCount()),h),k.SetIndex(a.GetCurrentIndices()),k.New()!=e){if(k.SetUpdateFlags(d.Title|d.NodeTitle|d.NodeAnsStatus),k.IsSpreadsheetRowInSpreadsheet()&&k._children.Count()>0)for(i=0;i<k._children.Count();i++)g=k._children.get(i),g.SetUpdateFlags(d.Title|d.NodeTitle);k.SetFlag(m.NewIteration,e)}f.v=!1}else k=new h(a,c,e),f.v=!0;return k.InitUpdate(),k}}),h}),define("engine/movefocuseventargs",[],function(){function a(a,b,c){this.ItemNode=a,this.OptionName=b,this.Direction=c}return a}),define("engine/dialogitemnode",["hdmain/system","system/exception","hdmain/jq","system/exception/argumentexception","engine/textlayoutconstraint","engine/formattingcontext","engine/dotcode","engine/answeredstatus","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode","engine/movefocuseventargs"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){this.FormattedAnswer=a}function p(a){this.IsError=null!=a&&""!=a,this.ErrorMessage=a}var q=HOTDOC$,r=a.String.Format;this.DEBUG===n&&(this.DEBUG=q.DEBUG);var s,t=c.proxy,u=a.Cast,v="TX",w="NU",x="DA",y="IsSpreadsheetRowInSpreadsheet",z={None:0,Hidden:1,Gray:2,req:4,set:8,ghs:16,omt:32,ccl:64,err:128},A=q.Engine.SetAnswerResult={AnswerWasSet:0,InvalidAnswer:1,OutOfRange:2},B=a.String.IsNullOrEmpty,C=q.NoneOfTheAboveIndex=-1,D=q.SpreadsheetIndex=-2,E=q.NoneOfTheAboveOptionName="$00NOTA",F=q.OtherOptionName="$00OTHER",G=q.OtherInputName="$00OTHERINPUT",H=q.GroupedChildOptionName="$00GROUPED",I=q.TrueOptionName="True",J=q.FalseOptionName="False";q.Class.DialogItemNode={N:"Engine",SC:function(){s=q.FocusDirection},C:function(a,b,c){this.ChangeErrorState=[],this.AnswerReformatted=[],this.FocusEntering=[],this.FocusLeaving=[],this.AnswerSync=[],this._updateFlags=j.None,this._parent=a,this._parentIndex=b,this._varListIndex=c,this._flags=z.None,this._prompt=null,this._promptIsSingleLine=!0,this._focusedItem=-1},P:{OnChangeErrorState:function(a){for(var b=0;b<this.ChangeErrorState.length;b++)this.ChangeErrorState[b](this,new p(null==a?null:a.GetErrorMessage()))},OnAnswerReformatted:function(a){for(var b=0;b<this.AnswerReformatted.length;b++)this.AnswerReformatted[b](this,new o(a))},OnFocusEntering:function(a,b){for(var c=0;c<this.FocusEntering.length;c++)this.FocusEntering[c](this,new m(this,a,b))},OnFocusLeaving:function(){for(var a=0;a<this.FocusLeaving.length;a++)this.FocusLeaving[a](this,{})},OnAnswerSync:function(){var a,b=!1;if(this.AnswerSync.length>0&&this.WantsAnswer()){a=this._parent._interview.CurrentNodeId();for(var c=0;c<this.AnswerSync.length;c++)this.AnswerSync[c].call(this);a!=this._parent._interview.CurrentNodeId()&&(b=!0)}return b},NoneOfTheAbove:function(){return this._varListIndex==C},GroupNumber:function(){return this.NoneOfTheAbove()?this._parent._itemNodes.get(this._parentIndex-1).GroupNumber():this._parent._dialog.GetTrueFalseGroupNumber(this._varListIndex)},IsSpreadsheet:function(){if(this._varListIndex==D)return!0;var a=this.DialogItem();return"DI"!=a.type?!1:"S"==u(a,q.Dlg).rType&&this.IsDialogOnParent()},SpreadsheetNode:function(){return this._varListIndex==D?u(this._parent,q.RepeatNode):u(this._parent.Children().get(this.DialogItem().name),q.RepeatNode)},IsDialogOnParent:function(){var a=this.DialogItem();return"DI"!=a.type?!1:u(a,q.Dlg).onPar?this._parent[y]()?!1:this._parent._parent.Type()!=i.Root&&u(this._parent._parent,k)[y]()?!1:this._varListIndex==D&&this._parent._parent.Type()==i.Root?!1:!0:!1},IsChildDialogButton:function(){return this._varListIndex!=D&&!this.IsDialogOnParent()},WantsAnswer:function(){var a=this.DialogItem();return a instanceof q.Variable?"DI"!=a.type?!0:""!=this._parent._dialog.gType&&this.IsChildDialogButton()?!0:!1:!1},ReadOnly:function(){if(this.NoneOfTheAbove()){if(this._parent.IsItemInProtectedGroup(this._parent._itemNodes.get(this._parentIndex-1)._varListIndex))return!0}else{var a=this._parent.VariableIsUserModifiable(u(this.DialogItem(),q.Variable));if(!a)return!0;if("S"==this._parent._dialog.gType&&this._parent.IsItemInProtectedGroup(this._varListIndex))return!0}return!1},SetUpdateFlags:function(a){this._updateFlags|=a;var b=j.AnswerRelated;""!=this._parent._dialog.gType&&!this.NoneOfTheAbove()&&"DI"==this.DialogItem().type&&(b|=j.NodeChildCount|j.ChildCount),0!=(a&b)&&this._parent.SetUpdateFlags(a&b)},ClearUpdateFlags:function(){this._updateFlags=j.None},Update:function(){var a,b,c,d=this.DialogItem(),e="";return d instanceof q.Variable?(a=u(d,q.Variable),e=a.EvPrompt(),B(e)?(this._promptIsSingleLine=!0,"DI"==a.type&&(b=u(a,q.Dlg),"R"==b.rType&&(e=b.EvRptT())),B(e)&&(e=a.EvTitle())):this._promptIsSingleLine=!1):d instanceof q.TxDlgEl?(e=u(d,q.TxDlgEl).EvText(),this._promptIsSingleLine=!1):d instanceof q.HdDlgEl?(e=u(d,q.HdDlgEl).EvCapt(),this._promptIsSingleLine=!0):d instanceof q.LDlgEl?(e=u(d,q.LDlgEl).EvCapt(),B(e)?(this._promptIsSingleLine=!0,"SLL"==d.type?e=u(d,q.SlDlgEl).varName:"WLL"==d.type&&(e=u(d,q.WlDlgEl).url)):this._promptIsSingleLine=!1):(e="",this._promptIsSingleLine=!0),this.Prompt(e),d instanceof q.McVar&&(c=this.GetOptions(),c.EvaluatePrompts(),c.HaveOptionsChanged()&&this.SetUpdateFlags(j.AddClear)),this._updateFlags},AnsweredStatus:function(){var a,b=this.DialogItem();return b instanceof q.Dlg?(a=u(this._parent.Children().get(b.name),k),null==a?h.Unanswered:a.AnsStatus().Status()):this.IsAnswered()||this.Hidden()||this.Gray()||this.SetByDialogScript()?h.Answered:h.Unanswered},IsAnswered:function(){return this.NoneOfTheAbove()?!1:this._parent.VariableHasAnswer(u(this.DialogItem(),q.Variable))},ClearAnswer:function(a){"boolean"!=typeof a&&(a=!0),!1;var b,c,d,e,f,g,h=this.DialogItem();if(h instanceof q.Variable&&this.Visible()&&!this.Gray())if(this.IsSpreadsheet()){for(b=-1!=this._focusedItem,c=this.SpreadsheetNode(),this.ClearFocus(),g=0;g<c.Children().Count();g++)c.Children().get(g).ClearAnswers(a);b&&this._parent.AdvanceFocus(!1,s.Forward)}else a&&this._parent.DoAnswerSync(),d=this.IsAnswered()&&!this.ReadOnly(),(this._parent._interview.RemoveDialogItemNodeError(this)||d)&&(this.SetUpdateFlags(j.ScriptAnswer),d?(this._parent._dialog.nota&&(e={},f={},this.GetTrueFalseGroupBounds(e,f),e.v>=0&&this._parent._itemNodes.get(f.v+1).SetUpdateFlags(j.ScriptAnswer)),this._parent._interview._engine.ClearAnswer(h.name,this._parent.Indices())):this._parent._interview.BeginDisplayUpdate(!1)),h instanceof q.Dlg&&this._parent[y]()&&this._parent.Children().get(h.name).ClearAnswers(!1)},VarIsMarked:function(a){return null!=this._parent?this._parent._interview.VarIsMarked(a):!1},Marked:function(){var a=this.DialogItem();switch(a.type){case v:case w:case x:case"TF":case"MC":return this.VarIsMarked(a.name);default:return!1}},MapName:function(){return this.NoneOfTheAbove()||this._varListIndex==D?null:this._parent.GetItemMapName(this._varListIndex)},MapType:function(){return this.NoneOfTheAbove()||this._varListIndex==D?"UN":this._parent.GetItemMapType(this._varListIndex)},DialogItem:function(){return this.NoneOfTheAbove()?this._parent._interview.GetNOTAProxyForDialog(this._parent._dialog,this.GroupNumber()):this._varListIndex==D?this._parent._dialog:this._parent._dialog.vList.GetItem(this._varListIndex)},Indices:function(){return this._parent.Indices()},Parent:function(){return this._parent},Caption:function(){return this.GetCaption(e.AnyLength,g.DefaultProcessor)},IsPromptSingleLine:function(){return this._promptIsSingleLine},Prompt:function(a){return a===n?this._prompt:(this._prompt!=a&&this.SetUpdateFlags(j.Prompt),this._prompt=a,void 0)},GetCaption:function(b,c){var d,g,h,i,j,l,m;if(this._prompt){if(i=b!=e.NeedSingleLine||this._promptIsSingleLine?this._prompt:k.TrimForUseAsTitle(this._prompt),i.indexOf("«")>=0){for(i=i.replace("««","⅞⅞"),j=q.Split(i,"«","»"),l=new a.Text.StringBuilder,m=0;m<j.length;m++)m%2==0?l.Append(k.HDEscQuots(j[m],!0,!1)):(l.Append("«"),l.Append(j[m]),l.Append("»"));i=l.ToString().replace("⅞⅞","««")}g=c(i,f.RichText,d)}else h=this.DialogItem(),g=h instanceof q.Variable?h.name:"",g=k.HDEscQuots(g,!0,!1);return this.Required()&&q.RequiredAsterisk&&(g="NONE"==g?"*":"*"+g),g},UpdateFlags:function(){return this._updateFlags},ShowAllResourceButtons:function(){return this._parent._interview._engine.ShowAllResourceButtons},Resource:function(){switch(this.DialogItem().type){case v:case w:case x:case"TF":case"MC":case"DI":case"CO":return u(this.DialogItem(),q.Variable).rsrc;default:return null}},PrepareForScriptEvaluation:function(){this._oldFlags=this._flags,this._flags=z.None},AfterScriptEvaluation:function(){var a,b,c=this._flags^this._oldFlags;0!=(c&z.Gray)&&(this._updateFlags|=j.Gray,a=this.DialogItem(),a instanceof q.Dlg&&(b=this._parent.Children().get(a.name),null!=b&&b.Active(!this.Gray()))),0!=(c&z.Hidden)&&(this._updateFlags|=j.Hidden,this.DialogItem()instanceof q.Dlg&&this._parent.Children().Count()>0&&this._parent.Children().get(this.DialogItem().name).Active(!this.Hidden())),0!=(c&z.req)&&(this._updateFlags|=j.Required),0!=(c&z.err)&&(this._updateFlags|=j.HasError),0!=(c&z.set)&&(this._updateFlags|=j.set)},GetFlag:function(a){return 0!=(this._flags&a)},SetFlag:function(a,b){b?this._flags|=a:this._flags&=~a},Visible:function(){return!this.Hidden()&&!this.AutoHidden()},AutoHidden:function(){var a,b=this.DialogItem();return b instanceof q.Dlg?(a=u(this._parent.Children().get(b.name),k),null==a||a.AutoHidden()):this.GetFlag(z.Hidden)&&!this.GetFlag(z.ghs)},Hidden:function(a){return a===n?this._parent.IsSpreadsheetRow()&&u(this._parent,l).IterationNumber()>0?this._parent._parent.Children().get(0)._itemNodes.get(this._parentIndex).GetFlag(z.Hidden):this.GetFlag(z.Hidden):(this._parent.IsSpreadsheetRow()&&0!=u(this._parent,l).IterationNumber()||(this.SetFlag(z.ghs,!0),this.SetFlag(z.Hidden,a)),void 0)},Gray:function(a){return a===n?this.GetFlag(z.Gray):(this.SetFlag(z.ghs,!0),this.SetFlag(z.Gray,a),void 0)},GrayOrHideSetByScript:function(a){return a===n?this.GetFlag(z.ghs):(this.SetFlag(z.ghs,a),void 0)},Required:function(a){return a===n?this.GetFlag(z.req):(this.WantsAnswer()&&this.SetFlag(z.req,a),void 0)
},HasError:function(a){return a===n?this.GetFlag(z.err):(this.SetFlag(z.err,a),void 0)},SetByDialogScript:function(a){return a===n?this.GetFlag(z.set):(this.SetFlag(z.set,a),void 0)},OmittedFromAnswerSource:function(a){return a===n?this.GetFlag(z.omt):(this.SetFlag(z.omt,a),void 0)},ConcealedOnAnswerSource:function(a){return a===n?this.GetFlag(z.ccl):(this.SetFlag(z.ccl,a),void 0)},NeedsProcessing:function(){var a=this.DialogItem(),b={v:null};return a instanceof q.DlgEl?!1:"DI"!=a.type?!0:this.Gray()||this.Hidden()?!1:""==this._parent._dialog.gType||this.IsDialogOnParent()||(this.GetAnswerBool(b),b.v)?!0:!1},GetOptions:function(){var a=u(this.DialogItem(),q.McVar);if(null==a)throw new d(q.Lc.GetStr("err_retrvopt"),"itemIndex");return this._parent._interview.GetRuntimeOptionsForVariable(a)},GetAnswerString:function(a){var b,c,d,e=u(this.DialogItem(),q.Variable);if(null!=e)switch(e.type){case v:if(b=this._parent._interview._engine.GetAnswer(e.name),null!=b&&(c=b.GetValue(this.Indices()),null!=c))return a.v=c,!0;break;case w:if(a.v=this._parent._interview.GetErrorValue(this),!B(a.v))return!1;if(d=u(e,q.NuVar),c=this._parent.GetVariableAnswerDouble(d),null!=c)return a.v=q.Lc.FormatNumberDef(c,d.decPl),!0;break;case x:if(a.v=this._parent._interview.GetErrorValue(this),a.v)return!1;if(c={},this._parent.GetVariableAnswerDate(u(e,q.DaVar),c))return a.v=q.Lc.FormatDate(c.v.getDate(),c.v.getMonth()+1,c.v.getFullYear(),!1),!0}return a.v="",!1},SetAnswerString:function(a,b){var c,e,f,g,h,i,j=u(this.DialogItem(),q.Variable);if(null==j)throw new d(q.Lc.GetStr("err_setvar"),"itemIndex");switch(b.s="",j.type){case v:return c={v:B(a)?null:a},e=u(j,q.TxVar).ValidateText(c),this._parent._interview._engine.LoadAnswerValue("TX",j.name,c.v,j.saveAns,this.Indices()),e&&this.OnAnswerReformatted(c.v),A.AnswerWasSet;case w:return f=q.Lc.ParseNumber(a),"err"!=f?this._parent.SetVariableAnswerDouble(j,f,b)?(g=A.AnswerWasSet,this._parent._interview.RemoveDialogItemNodeError(this),i={},this.GetAnswerString(i)&&i.v!=a&&this.OnAnswerReformatted(i.v)):g=A.OutOfRange:(g=A.InvalidAnswer,b=q.Lc.GetStr("val_invnum")),g!=A.AnswerWasSet&&this._parent._interview.AddDialogItemNodeError(this,a),g;case x:return h=q.Lc.ParseDate(a),"err"!=h?(g=A.AnswerWasSet,this._parent.SetVariableAnswerDate(u(j,q.DaVar),h),this._parent._interview.RemoveDialogItemNodeError(this),i={},this.GetAnswerString(i)&&i.v!=a&&this.OnAnswerReformatted(i.v)):(g=A.InvalidAnswer,b=q.Lc.GetStr("val_invdate"),this._parent._interview.AddDialogItemNodeError(this,a)),g;case"MC":return this._parent.SetVariableAnswerList(u(j,q.McVar),a),A.AnswerWasSet}return A.InvalidAnswer},GetAnswerDouble:function(a){var b=u(this.DialogItem(),q.NuVar);return null!=b?this._parent.GetVariableAnswerDouble(b):(a=Double.NaN,!1)},SetAnswerDouble:function(a,b){var c=u(this.DialogItem(),q.NuVar);if(null==c)throw new d(q.Lc.GetStr("err_setvar"),"itemIndex");return this._parent.SetVariableAnswerDouble(c,a,b)},GetAnswerDate:function(a){var b=u(this.DialogItem(),q.DaVar);return null!=b?this._parent.GetVariableAnswerDate(b,a):(a.v=DateTime.MinValue,!1)},SetAnswerDate:function(a){var b=u(this.DialogItem(),q.DaVar);if(null==b)throw new d(q.Lc.GetStr("err_setdat"),"itemIndex");this._parent.SetVariableAnswerDate(b,a)},GetAnswerBool:function(a){var b,c,d,e,f,g,h,i,j;if(this.NoneOfTheAbove()){for(a.v=!0,b={},c={},this.GetTrueFalseGroupBounds(b,c),g=b.v;g<=c.v;g++)if(d=this._parent._itemNodes.get(g),e=d.DialogItem(),f={v:null},("TF"==e.type||"DI"==e.type)&&(d.GetAnswerBool(f),f.v)){a.v=!1;break}return!0}return h=u(this.DialogItem(),q.Variable),null==h||(i=this._parent._interview._engine.GetAnswer(h.name),null==i||"TF"!=h.type&&"DI"!=h.type||(j=i.GetValue(this._parent.Indices()),null==j))?(a.v=!1,!1):(a.v=j,!0)},GetTrueFalseGroupBounds:function(a,b){if(this.NoneOfTheAbove()?this._parent._dialog.GetTrueFalseGroupBounds(this._parent._itemNodes.get(this._parentIndex-1)._varListIndex,a,b):this._parent._dialog.GetTrueFalseGroupBounds(this._varListIndex,a,b),a.v>=0)for(var c=this._parent._dialog.vList.GetItem(a.v).name;this._parent._itemNodes.get(a.v).DialogItem().name!=c;)a.v++,b.v++},SetAnswerBool:function(a){var b,c,e=u(this.DialogItem(),q.Variable);if(null==e||"TF"!=e.type&&"DI"!=e.type)throw new d(q.Lc.GetStr("err_settf"),"variable");b={},c={},this.GetTrueFalseGroupBounds(b,c),b.v>=0&&(this.NoneOfTheAbove()||"S"==this._parent._dialog.gType?this._parent.ClearGroupedItems(b.v,c.v,this):"M"==this._parent._dialog.gType&&this._parent._dialog.nota&&this._parent._itemNodes.get(c.v+1).SetUpdateFlags(j.ScriptAnswer)),this.NoneOfTheAbove()?this._parent._interview.Update():this._parent._interview._engine.LoadAnswerValue("TF",e.name,a,e.saveAns,this._parent.Indices())},GetAnswerList:function(a){var b=u(this.DialogItem(),q.McVar);return null!=b?this._parent.GetVariableAnswerList(b,a):(a=null,!1)},SetAnswerList:function(a){var b=u(this.DialogItem(),q.McVar);if(null==b)throw new d(q.Lc.GetStr("err_setmc"),"itemIndex");this._parent.SetVariableAnswerList(b,a)},GetAnswerOther:function(a){var b=u(this.DialogItem(),q.McVar);return null!=b?this._parent.GetVariableAnswerOther(b,a):(a=null,!1)},StringAnswer:function(a){var b,c;return a===n?(b={},this.GetAnswerString(b)?b.v:""):(c={s:null},this.SetAnswerString(a,c),void 0)},DoubleAnswer:function(a){var c,d;if(a===n)return this.GetAnswerDouble(c)?c:null;if(d={s:null},!this.SetAnswerDouble(a,d))throw new b(d);return 0},DateAnswer:function(a){if(a===n){var b={};return this.GetAnswerDate(b)?b.v:null}this.SetAnswerDate(a)},BoolAnswer:function(a){if(a===n){var b={v:null};return this.GetAnswerBool(b)?b.v:null}this.SetAnswerBool(a)},ListAnswer:function(a){if(a===n){var b=[];return this.GetAnswerList(b)?b:null}this.SetAnswerList(a)},OtherAnswer:function(){var a;return this.GetAnswerOther(a)?a:null},GetWidth:function(){return this.NoneOfTheAbove()||this._varListIndex==D?100:this._parent.GetItemWidth(this._varListIndex)},IsOnPrevLine:function(){return this.NoneOfTheAbove()||this._varListIndex==D?!1:this._parent.IsItemOnPrevLine(this._varListIndex)},EvaluateComputedVariable:function(){var a=u(this.DialogItem(),q.SlDlgEl);return null!=a?this._parent._interview.ProcessComputationScript(a.varName,this._parent.TemplateOfOrigin()):null},ClearFocus:function(){if(this.IsSpreadsheet()&&this._focusedItem>=0){var a=this.SpreadsheetNode(),b=u(a.Children().get(this._focusedItem),l);b.ClearFocusedItemNode()}this.OnFocusLeaving(),this._focusedItem=-1},SetFocus:function(a){if(!this._parent._interview.IgnoringNextFocus()){var b,c,d,e,f,g,h,j,m,n=this._parent._interview.GetFocusItem(),o=this.DialogItem(),p=null,r=null;if(n==this)return!B(a)&&"MC"==o.type&&!this._parent[y]()&&(p=u(o,q.McVar),r=this._parent._interview.GetRuntimeOptionsForVariable(p),a==F&&0==this._focusedItem&&null!=this.OtherAnswer()||a==E&&this._focusedItem==r.Count()||a==G&&1==this._focusedItem||this._focusedItem>=0&&this._focusedItem<r.Count()&&a==r.GetItem(this._focusedItem).name),void 0;b=this._parent._interview.GetFocusItem(),c=null!=b&&b._parent[y](),d=c&&this._parent[y]()&&b._parent._parent._id==this._parent._parent._id,e=!1,null!=b&&(e=b.OnAnswerSync()),this._parent._interview.ClearFocusItem(),c&&!d&&u(b._parent,l).SpreadsheetItemNode().OnFocusLeaving(),f=this._parent,f[y]()&&(f=u(f._parent,k)),(f.Type()!=i.Iteration||!u(f,l).IsSpreadsheetRowInEditMode())&&f.IsOnParent()&&(f=u(f._parent,k)),f!=this._parent._interview.CurrentOutlineNode()&&this._parent._interview.GotoDialog(f,"",!1,!1,function(a,b){a||q.Alert(b)}),this._parent._interview.SetFocusNode(this._parent),g=1,h=!1,j=!1,"MC"!=o.type||this._parent[y]()?"TF"!=o.type||this._parent[y]()?"DI"==o.type&&!this.IsDialogOnParent()&&""!=this._parent._dialog.gType&&(j=!0,g=2):(this._parent.Type()==i.DefaultDialog||null!=this._parent._dialog&&""==this._parent._dialog.gType)&&(h=!0):(null==r&&(p=u(o,q.McVar),r=this._parent._interview.GetRuntimeOptionsForVariable(p)),m=p.style,h="RB"==m||"RG"==m,j=!h&&("CB"==m||"CG"==m),j?(g=r.Count(),p.othr&&g++):h&&p.othr&&null!=this.OtherAnswer()&&g++),this._focusedItem=this.CanFocus()?h?"TF"==o.type?0:a==G?1:0:j?"DI"==o.type?a==H?0:1:a==E?r.Count():r.IndexOf(a):0:-1,this._parent.SetFocus(this._parentIndex)}},GetRowFocus:function(){return this._varListIndex==D&&this.IsDialogOnParent()&&!this.SpreadsheetNode().EditRowMode()?this.SpreadsheetNode().SpreadsheetItemNode().GetRowFocus():this._focusedItem},SetRowFocus:function(a){var b,c=this._focusedItem;this._focusedItem=a,0>c&&this._parent._interview.TriggerFocusEnter(this,null,s.Forward),a>=0&&(b=this._parent,b.IsOnParent()&&(b=u(b._parent,k)),b.SetFocus(this._parentIndex))},CanFocus:function(){var a=this.DialogItem(),b=a instanceof q.DlgEl;return!b||a instanceof q.LDlgEl?"DI"==a.type&&!this.IsDialogOnParent()&&this._varListIndex!=D&&this._parent._dialog.hideCB?!1:this._parent[y]()?!b&&this.Visible()&&!this.Gray()&&!this.SetByDialogScript():this.Visible()&&!this.Gray()&&!this.SetByDialogScript():!1},AssertFocus:function(a,b,c){function d(){this._focusedItem>=0&&this._focusedItem<x?e.Children().get(this._focusedItem).AdvanceFocus(a==z.Advance,b,t(function(e){return e?(-1==f&&this._parent._interview.TriggerFocusEnter(this,null,b),c(!0),void 0):(a=z.AdvanceIfNecessary,this._focusedItem+=b==s.Forward?1:-1,d.call(this),void 0)},this)):(this._focusedItem=-1,this.OnFocusLeaving(),c(!1))}c===n&&(c=function(){});var e,f,g,h,j,k,l,m,o,p,r,v,w=this.DialogItem(),x=1,z=q.FocusOperation;if(this._varListIndex==D||this.IsDialogOnParent())return this._varListIndex==D&&this.IsDialogOnParent()&&!this.SpreadsheetNode().EditRowMode()?(this.SpreadsheetNode().SpreadsheetItemNode().AssertFocus(a,b,c),void 0):this.CanFocus()?(e=this.SpreadsheetNode(),a!=z.ReassertOnly&&(x=e.Children().Count(),f=this._focusedItem,-1==this._focusedItem?this._focusedItem=b==s.Forward?0:x-1:this._focusedItem>=x&&(this._focusedItem=x-1)),this._focusedItem>=0&&this._focusedItem<x?(d.call(this),void 0):(this._focusedItem>=0&&this._focusedItem<e.Children().Count()&&e.Children().get(this._focusedItem).ReassertFocus(s.Forward),c(!0),void 0)):(this._focusedItem=-1,c(!1),void 0);if(g=!1,h=!1,j=!1,k=null,"MC"!=w.type||this._parent[y]()?"TF"!=w.type||this._parent[y]()?"DI"==w.type&&!this.IsDialogOnParent()&&""!=this._parent._dialog.gType&&(h=!0,x=2):(this._parent.Type()==i.DefaultDialog||null!=this._parent._dialog&&""==this._parent._dialog.gType)&&(g=!0):(l=u(w,q.McVar),j=l.othr,m=l.style,g="RB"==m||"RG"==m,h=!g&&("CB"==m||"CG"==m),k=this._parent._interview.GetRuntimeOptionsForVariable(u(w,q.McVar)),h?(x=k.Count(),j&&x++):g&&j&&null!=this.OtherAnswer()?x++:("SL"==m||"ML"==m)&&0==k.Count()&&(x=0)),o=this._focusedItem,g){if("TF"==w.type){if((-1==this._focusedItem||a!=z.Advance)&&this.CanFocus())return this._focusedItem=0,p={v:null},this.GetAnswerBool(p)?this._parent._interview.TriggerFocusEnter(this,p.v?I:J,b):this._parent._interview.TriggerFocusEnter(this,b==s.Forward?I:J,b),c(!0),void 0}else if(a!=z.ReassertOnly&&(this._focusedItem=-1==this._focusedItem?b==s.Forward?0:x-1:0==this._focusedItem?b==s.Forward&&2==x?1:-1:b==s.Forward?-1:0),this._focusedItem>=0&&(k.Count()>0||j)&&this.CanFocus())return 1==this._focusedItem?r=G:(p=[],this.GetAnswerList(p)?(v=k.IndexOf(p[0]),r=v>=0?k.GetItem(v).name:F):r=b==s.Forward&&k.Count()>0?k.GetItem(0).name:j?F:k.GetItem(k.Count()-1).name),this._parent._interview.TriggerFocusEnter(this,r,b),c(!0),void 0}else if(h){if(a!=z.ReassertOnly&&(-1==this._focusedItem?this._focusedItem=b==s.Forward?0:x-1:this._focusedItem+=b==s.Forward?1:-1),this._focusedItem>=0&&this._focusedItem<x&&this.CanFocus())return null!=k&&this._focusedItem==k.Count()?this._parent._interview.TriggerFocusEnter(this,E,b):"DI"==w.type&&this._focusedItem==x-1?this._parent._interview.TriggerFocusEnter(this,null,b):this._parent._interview.TriggerFocusEnter(this,"DI"==w.type?H:k.GetItem(this._focusedItem).name,b),c(!0),void 0}else if(x>0&&a!=z.Advance&&this.CanFocus())return this._focusedItem=0,this._parent._interview.TriggerFocusEnter(this,null,b),c(!0),void 0;this._focusedItem=-1,o>=0&&this.OnFocusLeaving(),c(!1)},Serialize:function(a){a.WriteStartElement(this.DialogItem().type),a.WriteAttributeString("Name",this.DialogItem().name),this.Gray()&&a.WriteAttributeString("Gray","true"),this.Hidden()&&a.WriteAttributeString("Hidden","true"),this.Required()&&a.WriteAttributeString("Required","true"),this.SetByDialogScript()&&a.WriteAttributeString("SetByDialogScript","true");var b=this.Caption();!B(b)&&b!=this.DialogItem().name&&a.WriteElementString("Caption",b),a.WriteEndElement()},ToString:function(){return r('DialogItem Node "{0}" {1}',this.DialogItem().name,q.RepeatIndices.ToString(this._parent.Indices()))}}},q.Class.DialogItemNodeList={C:function(){this._itemNodes=[],this._itemIndex=[]},P:{Update:function(){var a,b=j.None;for(a=0;a<this._itemNodes.length;a++)b|=this._itemNodes[a].Update();return b},ClearUpdateFlags:function(){for(var a=0;a<this._itemNodes.length;a++)this._itemNodes[a].ClearUpdateFlags()},get:function(a){return"number"==typeof a?this._itemNodes[a]:this._itemIndex[a]},Count:function(){return this._itemNodes.length},Add:function(a,b,c){var e,f=new q.Engine.DialogItemNode(b,this._itemNodes.length,c);if(this._itemNodes.push(f),this._itemIndex[a]!==n){if(e=f.DialogItem(),!(e instanceof q.DlgEl))throw new d("DialogItem already in collection")}else this._itemIndex[a]=f},IndexOfName:function(a){return this._itemNodes.IndexOf(this._itemIndex[a])}}}}),define("system/xmlwriter",["hdmain/system"],function(a,b){function c(a,b){a&&(this.encoding=a),b&&(this.version=b)}function d(a){return null==a?"":a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")}function e(a){for(var b=a.c.length;b--;)"object"==typeof a.c[b]&&e(a.c[b]);a.n=a.a=a.c=null}function f(a,b,c,d){var e,g,h=b+"<"+a.n,i=a.c.length,j=0;for(e in a.a)h+=" "+e+'="'+a.a[e]+'"';if(h+=i?">":" />",d.push(h),i){do if(g=a.c[j++],"string"==typeof g){if(1==i)return d.push(d.pop()+g+"</"+a.n+">");d.push(b+c+g)}else"object"==typeof g&&f(g,b+c,c,d);while(i>j);d.push(b+"</"+a.n+">")}}return a.ExtendClass(c,null,{encoding:"UTF-16",version:"1.0",formatting:"indented",indentChar:"	",indentation:1,newLine:"\r\n",omitXmlDec:!1,initXml:"",WriteStartDocument:function(a){this.Close(),this.stack=[],this.standalone=a},WriteEndDocument:function(){this.active=this.root,this.stack=[]},WriteDocType:function(a){this.doctype=a},WriteStartElement:function(a,b){b&&(a=b+":"+a);var c={n:a,a:{},c:[]};this.active?(this.active.c.push(c),this.stack.push(this.active)):this.root=c,this.active=c},WriteEndElement:function(){this.active=this.stack?this.stack.pop()||this.root:this.root},WriteAttributeString:function(a,b){this.WriteStartAttribute(null,a,null),this.WriteString(b),this.WriteEndAttribute()},WriteStartAttribute:function(a,b){this.curAtt=b},WriteEndAttribute:function(){this.curAtt=null},WriteString:function(a){this.active&&(this.curAtt?this.active.a[this.curAtt]=d(a):this.active.c.push(d(a)))},WriteElementString:function(a,b,c){this.WriteStartElement(a,c),this.WriteString(b),this.WriteEndElement()},WriteCDATA:function(a){this.WriteString("<![CDATA["+a+"]]>")},WriteComment:function(a){this.WriteString("<!-- "+a+" -->")},Flush:function(){this.stack&&this.stack[0]&&this.WriteEndDocument();var a,c="",d="",e=this.indentation,g="indented"==this.formatting.toLowerCase(),h=[];if(this.omitXmlDec||(a='<?xml version="'+this.version+'" encoding="'+this.encoding+'"',this.standalone!==b&&(a+=' standalone="'+(this.standalone?"yes":"no")+'" '),a+=" ?>",h.push(a)),this.doctype&&this.root&&h.push("<!DOCTYPE "+this.root.n+" "+this.doctype+">"),g)for(;e--;)c+=this.indentChar;return this.root&&f(this.root,d,c,h),this.initXml+h.join(g?this.newLine:"")},Close:function(){this.root&&e(this.root),this.active=this.root=this.stack=null},toString:function(){return this.Flush()}},{Create:function(a,b){var d=new c;return"string"==typeof a&&(d.initXml=a),"boolean"==typeof b.OmitXmlDeclaration&&(d.omitXmlDec=b.OmitXmlDeclaration),"string"==typeof b.IndentChars&&(d.indentChar=b.IndentChars),"boolean"==typeof b.Indent&&(d.indentation=b.Indent?1:0),d}}),c}),define("engine/xmlwrappingwriter",["system/xmlwriter","hdmain/system"],function(a,b){function c(a){this.Writer=a}return b.ExtendClass(c,a,{Close:function(){this.Writer.Close()},Dispose:function(){this.Writer.Dispose()},Flush:function(){this.Writer.Flush()},LookupPrefix:function(a){return this.Writer.LookupPrefix(a)},WriteBase64:function(a,b,c){this.Writer.WriteBase64(a,b,c)},WriteCData:function(a){this.Writer.WriteCData(a)},WriteCharEntity:function(a){this.Writer.WriteCharEntity(a)},WriteChars:function(a,b,c){this.Writer.WriteChars(a,b,c)},WriteComment:function(a){this.Writer.WriteComment(a)},WriteDocType:function(a,b,c,d){this.Writer.WriteDocType(a,b,c,d)},WriteEndAttribute:function(){this.Writer.WriteEndAttribute()},WriteEndDocument:function(){this.Writer.WriteEndDocument()},WriteEndElement:function(){this.Writer.WriteEndElement()},WriteEntityRef:function(a){this.Writer.WriteEntityRef(a)},WriteFullEndElement:function(){this.Writer.WriteFullEndElement()},WriteProcessingInstruction:function(a,b){this.Writer.WriteProcessingInstruction(a,b)},WriteRaw:function(a){this.Writer.WriteRaw(a)},WriteRaw:function(a,b,c){this.Writer.WriteRaw(a,b,c)},WriteStartAttribute:function(a,b,c){this.Writer.WriteStartAttribute(a,b,c)},WriteStartDocument:function(){this.Writer.WriteStartDocument()},WriteStartDocument:function(a){this.Writer.WriteStartDocument(a)},WriteStartElement:function(a,b,c){this.Writer.WriteStartElement(a,b,c)},WriteString:function(a){this.Writer.WriteString(a)},WriteSurrogateCharEntity:function(a,b){this.Writer.WriteSurrogateCharEntity(a,b)},WriteValue:function(a){this.Writer.WriteValue(a)},WriteWhitespace:function(a){this.Writer.WriteWhitespace(a)}}),c}),define("engine/answerxmlwriter",["hdmain/system","system/xmlwriter","engine/xmlwrappingwriter"],function(a,b,c){function d(a,c,e){d.baseConstructor.call(this,b.Create(a,c)),this._forInterview=e,this._skipping=!1}return a.ExtendClass(d,c,{WriteStartAttribute:function(a,b,c){this._forInterview||"userModifiable"!=b&&"userExtendible"!=b?(this._skipping=!1,d.baseclass.WriteStartAttribute.call(this,a,b,c)):this._skipping=!0},WriteEndAttribute:function(){this._skipping?this._skipping=!1:d.baseclass.WriteEndAttribute.call(this)},WriteEndElement:function(){this._skipping=!1,d.baseclass.WriteEndElement.call(this)}}),d}),define("engine/answerchangedeventargs",[],function(){function a(a,b,c){this.v=a,this.i=b,this.t=c}return a}),define("engine/answerset",["hdmain/system","engine/answerxmlwriter","engine/answerchangedeventargs"],function(a,b,c,d){function e(){this.AnswerChanged=[],this.Clear()}var f=HOTDOC$;return a.ExtendClass(e,null,{Clear:function(){this._answers={},this.Title="",this.Version=1.1,this.DTD=null},OnAnswerChanged:function(a,b,d){for(var e=0;e<this.AnswerChanged.length;e++)this.AnswerChanged[e](a,new c(null!=a?a.n:null,b,d))},AnswerCount:function(){var a,b=0;for(a in this._answers)b++;return b},XmlAnswers:function(){var b=new a.Text.StringBuilder;return this.WriteXml(b),b.ToString()},TryGetAnswer:function(a,b){return b.v=this._answers[a],b.v!==d},CreateAnswer:function(a,b){var c=f.Answer.Create(a,this,b);return this._answers[b]=c,c},RemoveAnswer:function(a){return delete this._answers[a]},ReadXml:function(a){this.Clear(),this.OverlayXml(a)},OverlayXml:function(){},ReadValue:function(){},GetXMLString:function(b){var c=new a.Text.StringBuilder;return b&&c.Append(String.fromCharCode(65279)),this.WriteXml(c),c.ToString()},WriteXml:function(a){a.Append('<?xml version="1.0" standalone="yes"?>\r\n');var c,d,e={Indent:!0,IndentChars:"	",OmitXmlDeclaration:!0},g=!1,h=new b(a.ToString(),e,g);h.WriteStartDocument(),h.WriteStartElement("AnswerSet"),h.WriteAttributeString("title",this.Title),h.WriteAttributeString("version",this.Version.toString()),h.WriteAttributeString("useMangledNames","false");for(c in this._answers)d=this._answers[c],d instanceof f.Answer&&d.Xml(h);h.WriteEndElement(),h.WriteEndDocument(),a.Clear(),a.Append(h.Writer.Flush())}}),e}),define("system/exception/argumentoutofrangeexception",["hdmain/system","system/exception/argumentexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("runtime/component",["hdmain/system"],function(a){function b(a,b){this.name=a,this.ttlD=b}return a.ExtendClass(b,null,{eq:function(a){return a==this||a instanceof b&&a.name==this.name},EvTitle:function(){return this.ttlD?this.ttlD.toString():""}}),b}),define("runtime/preference",["hdmain/system","./component"],function(a,b){function c(a,b,d){c.baseConstructor.call(this,a,b),this.setting=null!=d?d:""}return a.ExtendClass(c,b,null,{ToString:function(a){return null==a?"":a.setting},ToInt:function(a){return null==a?0:parseInt(a.setting,10)},ToBool:function(a){return null==a?!1:"true"==a.setting.toLowerCase()},TPL_TITLE:"(TEMPLATE TITLE)",TPL_DESC:"(TEMPLATE DESCRIPTION)",POINTED_TO_CMP:"(POINTED TO CMP)",USE_SHARED_INTERVIEW_PROPS:"(USE_SHARED_INTERVIEW_PROPS)",USE_INTERVIEW_COMPUTATION:"(USE_INTERVIEW_COMPUTATION)",GENERATE_DEFAULT_INTERVIEW:"(GENERATE_DEFAULT_INTERVIEW)",HIDE_INTERVIEW_OUTLINE:"(HIDE_INTERVIEW_OUTLINE)",DISABLE_IRRELEVANT_ANSWERS:"(DISABLE_IRRELEVANT_ANSWERS)",HIDE_END_OF_INTERVIEW:"(HIDE_END_OF_INTERVIEW)",USE_DEFAULT_DLG_TITLE_ALWAYS:"(USE DEFAULT DLG TITLE ALWAYS)",HELP_BUTTON_TEXT:"(HELP BUTTON TEXT)",CUSTOM_INTERVIEW:"(CUSTOM_INTERVIEW)",ASKED_IRREL_VAR_ARCHIVE:"(ASKED_IRREL_VAR_ARCHIVE)",UNASKED_REL_VAR_ARCHIVE:"(UNASKED_REL_VAR_ARCHIVE)",IRREL_VAR_DEFAULT:"(IRREL_VAR_DEFAULT)",USE_RAGGED_PROMPTS:"(USE_RAGGED_PROMPTS)",COMBINE_DEF_DLGS:"(COMBINE_DEF_DLGS)",USE_SHARED_ASSEMBLY_PROPS:"(USE_SHARED_ASSEMBLY_PROPS)",MOVE_TO_TYPE_HERE:"(MOVE TO TYPE HERE)",NO_ANSWER_FILE:"(NO ANSWER FILE)",DEFAULT_DLG_TITLE:"(DEFAULT DLG TITLE)",USE_NAMES:"(USE NAMES)",UNANSWERED_VAR_PLACEHOLDER:"(UNANSWERED VAR PLACEHOLDER)",MAX_REPEAT_COUNT:"(MAX_REPEAT_COUNT)",MAX_STACK_DEPTH:"(MAX_STACK_DEPTH)",PROCESS_DLGS_WHILE_ASM_DOCS:"(PROCESS_DLGS_WHILE_ASM_DOCS)",MARK_ANSWER_FIELDS:"(MARK_ANSWER_FIELDS)",ENABLE_EDIT_ANSWER:"(ENABLE_EDIT_ANSWER)",UPDATE_TOC:"(UPDATE_TOC)",MACRO_TEMPLATE_FILE:"(MACRO_TEMPLATE_FILE)",COMMON_COMPONENT_FILE:"(COMMON_COMPONENT_FILE)",TEMPLATE_ID:"(TEMPLATE_ID)",ADDITIONAL_TEMPLATES:"(ADDITIONAL_TEMPLATES)",OTHER_ADDITIONAL_FILES:"(OTHER_ADDITIONAL_FILES)",USE_SHARED_HIDDENDATA_PROPS:"(USE_SHARED_HIDDENDATA_PROPS)",REMOVE_REVISION_IDS:"(REMOVE_REVISION_IDS)",REMOVE_PROPERTY_CODES:"(REMOVE_PROPERTY_CODES)",REMOVE_STYLES:"(REMOVE_STYLES)",REMOVE_METAFILES:"(REMOVE_METAFILES)",REMOVE_HD_ANSWER_MARKS:"(REMOVE_HD_ANSWER_MARKS)",REMOVE_ANNOTATIONS:"(REMOVE_ANNOTATIONS)",REMOVE_TRACKED_CHANGES:"(REMOVE_TRACKED_CHANGES)",REMOVE_CHANGE_TRACKING:"(REMOVE_CHANGE_TRACKING)",REMOVE_TITLE:"(REMOVE_TITLE)",REMOVE_SUBJECT:"(REMOVE_SUBJECT)",REMOVE_AUTHOR:"(REMOVE_AUTHOR)",REMOVE_MANAGER:"(REMOVE_MANAGER)",REMOVE_COMPANY:"(REMOVE_COMPANY)",REMOVE_CATEGORY:"(REMOVE_CATEGORY)",REMOVE_KEYWORDS:"(REMOVE_KEYWORDS)",REMOVE_COMMENTS:"(REMOVE_COMMENTS)",REMOVE_HYPERLINK_BASE:"(REMOVE_HYPERLINK_BASE)",REMOVE_STATISTICS:"(REMOVE_STATISTICS)",REMOVE_CUSTOM_PROPERTIES:"(REMOVE_CUSTOM_PROPERTIES)",REMOVE_EDITABLE_TEXT_BOOKMARKS:"(REMOVE_EDITABLE_TEXT_BOOKMARKS)",USE_SHARED_SERVER_PROPS:"(USE_SHARED_SERVER_PROPS)",ONLINE_COMPAT_MODE:"(ONLINE COMPATIBILITY MODE)",SERVER_INITIAL_INTERVIEW_OUTLINE:"(SERVER_INITIAL_INTERVIEW_OUTLINE)",SERVER_INITIAL_RESOURCE_PANE:"(SERVER_INITIAL_RESOURCE_PANE)",SERVER_INITIAL_INSTANT_UPDATE:"(SERVER_INITIAL_INSTANT_UPDATE)",SERVER_CAN_CHANGE_INTERVIEW_OUTLINE:"(SERVER_CAN_CHANGE_INTERVIEW_OUTLINE)",SERVER_CAN_CHANGE_RESOURCE_PANE:"(SERVER_CAN_CHANGE_RESOURCE_PANE)",SERVER_CAN_CHANGE_INSTANT_UPDATE:"(SERVER_CAN_CHANGE_INSTANT_UPDATE)",DISALLOW_DOCUMENT_PREVIEW:"(DISALLOW_DOCUMENT_PREVIEW)",SERVER_SINGLE_PAGE_INTERVIEW:"(SERVER_SINGLE_PAGE_INTERVIEW)",SERVER_CAN_CHANGE_SINGLE_PAGE_INTERVIEW:"(SERVER_CAN_CHANGE_SINGLE_PAGE_INTERVIEW)",USE_SHARED_ANSWERUPLOAD_PROPS:"(USE_SHARED_ANSWERUPLOAD_PROPS)",UPLOAD_URL:"(UPLOAD URL)",UPLOAD_URL_DESCRIPTION:"(UPLOAD URL DESCRIPTION)",UPLOAD_ALWAYS:"(UPLOAD ALWAYS)",PASSWORD:"(PASSWORD)",EXPIRATION:"(EXPIRATION)",CONTROL_FILE:"(CONTROL FILE)",REGISTER:"(REGISTER)",EXPIRE_MESSAGE:"(EXPIRE MESSAGE)",VIEWS_INI:"VIEWS_INI",VIEWS_COMMON_SWITCHES:"VIEWS COMMON SWITCHES",WARN_SET_AND_SAVED:"(WARN_SET_AND_SAVED)",WARN_SET_AND_ASKED:"(WARN_SET_AND_ASKED)",WARN_ASKED_TWICE:"(WARN_ASKED_TWICE)",WARN_USED_THEN_SET:"(WARN_USED_THEN_SET)",WARN_USED_THEN_ASKED:"(WARN_USED_THEN_ASKED)",WATCH_VARIABLES:"(WATCH_VARIABLES)",LIST_USED_IN_COMPONENTS:"(LIST_USED_IN_COMPONENTS)"}),HOTDOC$.Pref=c,c}),define("engine/placeholdertype",[],{Default:0,Nothing:1,Asterisks:2,Underscores:3,AsterisksAndVarName:4,BracketedVarName:5}),define("engine/preferencecache",["hdmain/system","runtime/preference","engine/placeholdertype"],function(a,b,c,d){function e(a){this._template=a}var f=HOTDOC$,g=a.String.IsNullOrEmpty,h=500,i=500,j="INTERVIEW";return a.ExtendClass(e,null,{GetString:function(a,e){var h,i;return e!==d?(h=this._template.GetPreference(a),null==h?e:h.setting):("("!=a.substr(0,1)&&"VIEWS"!=a.substr(0,5)&&(a="("+a+")"),i=this.GetString(a,""),a==b.UNANSWERED_VAR_PLACEHOLDER?g(i)&&(i=f.PlaceholderTypeToString(c.Default)):a==b.CUSTOM_INTERVIEW&&g(i)&&this.GetBool(b.USE_INTERVIEW_COMPUTATION,!1)&&(i=j),i)},GetInt:function(a,c){var d;if("number"!=typeof c)switch("("!=a.substr(0,1)&&"VIEWS"!=a.substr(0,5)&&(a="("+a+")"),c=0,a){case b.MAX_REPEAT_COUNT:c=h;break;case b.MAX_STACK_DEPTH:c=i}return d=this._template.GetPreference(a),null==d?c:b.ToInt(d)},GetBool:function(a,c){var d;if("boolean"!=typeof c)switch("("!=a.substr(0,1)&&"VIEWS"!=a.substr(0,5)&&(a="("+a+")"),c=!1,a){case b.MARK_ANSWER_FIELDS:case b.SERVER_INITIAL_INTERVIEW_OUTLINE:case b.SERVER_CAN_CHANGE_INTERVIEW_OUTLINE:case b.SERVER_CAN_CHANGE_RESOURCE_PANE:case b.SERVER_INITIAL_INSTANT_UPDATE:case b.SERVER_CAN_CHANGE_INSTANT_UPDATE:c=!0;break;case b.GENERATE_DEFAULT_INTERVIEW:c=!this.GetBool(b.USE_INTERVIEW_COMPUTATION,!1)}return d=this._template.GetPreference(a),null==d?c:b.ToBool(d)},HideInterviewOutline:function(){return"boolean"!=typeof this._hio&&(this._hio=this.GetBool(b.HIDE_INTERVIEW_OUTLINE,!1)),this._hio},HideEndOfInterview:function(){return"boolean"!=typeof this._hei&&(this._hei=this.GetBool(b.HIDE_END_OF_INTERVIEW,!1)),this._hei},GenerateDialogTitles:function(){return"boolean"!=typeof this._gdt&&(this._gdt=this.GetBool(b.USE_DEFAULT_DLG_TITLE_ALWAYS,!1)),this._gdt},ResourceButtonText:function(){return"string"!=typeof this._rbt&&(this._rbt=this.GetString(b.HELP_BUTTON_TEXT,"")),this._rbt},ProductTitle:function(){return"string"!=typeof this._pt&&(this._pt=this.GetString(b.DEFAULT_DLG_TITLE,"")),this._pt},NoAnswerFile:function(){return"boolean"!=typeof this._naf&&(this._naf=this.GetBool(b.NO_ANSWER_FILE,!1)),this._naf},VarNamesInSummaries:function(){return"boolean"!=typeof this._vns&&(this._vns=this.GetBool(b.USE_NAMES,!1)),this._vns},MarkAnswerFields:function(){return"boolean"!=typeof this._maf&&(this._maf=this.GetBool(b.MARK_ANSWER_FIELDS,!0)),this._maf},UnansweredVarPlaceholder:function(){return"number"!=typeof this._up&&(this._up=f.StringToPlaceholderType(this.GetString(b.UNANSWERED_VAR_PLACEHOLDER))),this._up},DisableIrrelevantAnswers:function(){return"boolean"!=typeof this._dia&&(this._dia=this.GetBool(b.DISABLE_IRRELEVANT_ANSWERS,!1)),this._dia},OutlineVisibleInitially:function(){return"boolean"!=typeof this._ov&&(this._ov=this.GetBool(b.SERVER_INITIAL_INTERVIEW_OUTLINE,!0)),this._ov},OutlineVisibleMod:function(){return"boolean"!=typeof this._om&&(this._om=this.GetBool(b.SERVER_CAN_CHANGE_INTERVIEW_OUTLINE,!0)),this._om},ResourcePaneVisibleInitially:function(){return"boolean"!=typeof this._rpv&&(this._rpv=this.GetBool(b.SERVER_INITIAL_RESOURCE_PANE,!1)),this._rpv},ResourcePaneVisibleMod:function(){return"boolean"!=typeof this._rpm&&(this._rpm=this.GetBool(b.SERVER_CAN_CHANGE_RESOURCE_PANE,!0)),this._rpm},InstantUpdateOnInitially:function(){return"boolean"!=typeof this._iuo&&(this._iuo=this.GetBool(b.SERVER_INITIAL_INSTANT_UPDATE,!0)),this._iuo},InstantUpdateMod:function(){return"boolean"!=typeof this._ium&&(this._ium=this.GetBool(b.SERVER_CAN_CHANGE_INSTANT_UPDATE,!0)),this._ium},SinglePageOnInitially:function(){return"boolean"!=typeof this._spo&&(this._spo=this.GetBool(b.SERVER_SINGLE_PAGE_INTERVIEW,!1)),this._spo},SinglePageMod:function(){return"boolean"!=typeof this._spm&&(this._spm=this.GetBool(b.SERVER_CAN_CHANGE_SINGLE_PAGE_INTERVIEW,!1)),this._spm}}),e}),define("engine/stringparsersource",["hdmain/system"],function(a){function b(a){this._text=a}return a.ExtendClass(b,null,{SourceString:function(){return this._text}}),b}),define("engine/templatedownloadedeventargs",[],function(){function a(a,b,c){this.TemplateName=a,this.AssemblyName=b,this.DownloadsInProgress=c}return a}),define("engine/templatemanager",["hdmain/system","hdmain/jq","./templatedownloadedeventargs"],function(a,b,c,d){function e(a,c,d){l=a,this._templateDict=new b.Dictionary,this.q=new b.Dictionary,this.nq=[],this.completed=[];var e={};this.GetTemplate(c,d,e),this.New=!1}function f(a){if(m.Templates!==d){if("object"==typeof m.Templates[a.AssemblyName])return!0;for(var b in m.Templates)if("object"==typeof m.Templates[b]&&b.toUpperCase()==a.AssemblyName.toUpperCase())return b!=a.AssemblyName&&(m.Templates[a.AssemblyName]=m.Templates[b],delete m.Templates[b]),!0}return!1}function g(a){this._templateDict.Add(a.name,a),o>0?b(this).trigger("_templateDownloaded",new c(a.name,a.AssemblyName,this.IncompleteDownloads())):this.nq.push(new c(a.name,a.AssemblyName,this.IncompleteDownloads()))}function h(a,b){var c="TEMPLATE";this.q.Remove(b.TemplateName),this.completed.push(new k(1)),g.call(this,new m.Template(b.TemplateName,b.AssemblyName,c,this._runtime)),this.Enqueue(null)}function i(){this.Template=null,this.Progress=null}function j(a,b){this.TemplateName=a,this.AssemblyName=b}function k(a,b,c){b===d&&(b=a),c===d&&(c=!1),this.started=c,this.total=a>0?a:b,this.received=b}var l,m=HOTDOC$,n=a.String.IsNullOrEmpty,o=0,p=b.proxy;return a.ExtendClass(e,null,{TemplateDownloaded:function(a,c){switch(a){case"add":o++,b(this).on("_templateDownloaded",c);for(var d=0;d<this.nq.length;d++)b(this).trigger("_templateDownloaded",this.nq[d]);this.nq=[];break;case"remove":o--,b(this).off("_templateDownloaded",c)}},IncompleteDownloads:function(){return this.q.Count()},CompletedDownloads:function(){return this.completed.length},GetTemplateInfoToDownload:function(){var a,b;for(a in this.q.a)if(b=this.q.a[a],!b.Progress)return b.Template;return null},Enqueue:function(a,c){var d,e,g=null,o=null==a;g=o?this.GetTemplateInfoToDownload():new j(a,c),null!=g&&(d=new i,d.Template=g,this.New=!0,o?this.q.a[g.TemplateName].Progress.started=!0:(d.Progress=new k(0,0,!0),this.q.Add(g.TemplateName,d)),n(l)?e="templates/"+g.TemplateName+".js":(e=l+g.TemplateName,l.indexOf("stateString")<0&&(e+=".js"),0==e.indexOf("./")&&(e=HDJavascriptPath+e)),b("#hdMainDiv").HDInterview("LoadFile",m.FileType.JavaScript,g.AssemblyName,e,f,!0,p(h,this),g))},GetTemplate:function(a,b,c){var e,h;if(c.v=this._templateDict.TryGetValue(a),null!=c.v)return!0;if(!this.q.ContainsKey(a)){if(b===d&&a!==d&&(b=a.replace(/%20/g," "),b=b.replace(/([^a-zA-Z0-9])/g,function(a){return h=a.charCodeAt(0).toString(16).toUpperCase(),"_"+"0000".substr(h.length)+h}),e=b.substr(0,1),/^\d+$/.test(e)&&(h=e.charCodeAt(0).toString(16).toUpperCase(),b="_"+"0000".substr(h.length)+h+b.substr(1)),b="Tmpl_"+b),f({AssemblyName:b}))return g.call(this,new m.Template(a,b,c,this._runtime)),!0;this.Enqueue(a,b)}return null},ResetNew:function(){this.New=!1}}),e}),define("engine/pairedcode",[],{b:0,i:1,st:2,un:3,sc:4,fs:5,ac:6,lc:7,h:8,p:9,wl:10}),define("engine/fontsizechange",[],function(){function a(a,b){this.Direction=a,this.Amount=b}return a}),define("engine/listpunctuation",["hdmain/system"],function(a,b){function c(b,c){var g,i;
for(this._codeIndex=0,this._part=new a.Text.StringBuilder,g=0;h>g;g++)this._part[g]=new a.Text.StringBuilder;if(this._codeCount=c,!d(b))for(i=0,g=0;g<b.length;g++)i<f.length&&b[g].toUpperCase()==f[i]?i++:this._part[i].Append(b[g]);this._mid1Len=this._part[e.MidPart1].Length,this._mid2Len=this._part[e.MidPart2].Length,this._mid1Char=this._mid1Len>0?this._part[e.MidPart1].s[0]:"x",this._mid2Char=this._mid2Len>0?this._part[e.MidPart2].s[0]:"x"}this.DEBUG===b&&(this.DEBUG=HOTDOC$.DEBUG);var d=a.String.IsNullOrEmpty,e={PrePart:0,MidPart1:1,MidPart2:2,PostPart:3},f="ABC",g=",;:/.-",h=e.PostPart+1;return a.ExtendClass(c,null,{IncrementCodeIndex:function(){this._codeIndex<this._codeCount&&this._codeIndex++},CodeCount:function(a){return a===b?this._codeCount:(this._codeCount=a,void 0)},GetPrePart:function(){return this._part[e.PrePart].ToString()},GetPunctuation:function(){if(this._codeCount<=0||this._codeIndex>=this._codeCount)return"";var a;return this._codeIndex==this._codeCount-1?a=this._part[e.PostPart].ToString():this._codeIndex==this._codeCount-2?(a=this._part[this._mid2Len>0?e.MidPart2:e.MidPart1].ToString(),2==this._codeCount&&this._mid2Len>0&&a.length>=3&&g.indexOf(a[0])>=0&&this._mid1Len<3&&(a=a.substr(1,a.length-1))):a=this._mid1Len<3||g.indexOf(this._mid1Char)<0||this._mid2Len>0?this._part[e.MidPart1].ToString():this._part[e.MidPart1].ToString().substring(0,2),a}}),c}),define("engine/changedirection",[],{Increase:0,Decrease:1}),define("engine/dotcodeparser",["hdmain/jq","hdmain/system","hdmain/stack","engine/pairedcode","./fontsizechange","./listpunctuation","./changedirection"],function(a,b,c,d,e,f,g,h){function i(a){return a.replace(/^\s+/,"")}function j(b,c){if(b=a.trim(b),c!==h){for(;a.inArray(b[0],c)>=0;)b=b.substr(1);for(;a.inArray(b[b.length-1],c)>=0;)b=b.substr(0,b.length-1)}return b}function k(a){return/\s/.test(a)}function l(a){return/^[a-zA-Z]+$/.test(a)}function m(){}function n(a,b){p.call(this,a),r(b)}function o(a,b){p.call(this,a),s(b)}function p(a){A.Length>0&&(a.WriteText(this,A.ToString()),A.Clear())}function q(a,b,c,e){if(c-b>0){if(!this.IsCodeEnabled(d.h))if(this.IsCodeEnabled(d.ac)||this.IsCodeEnabled(d.sc))A.Append(a.substr(b,c-b).toUpperCase());else if(this.IsCodeEnabled(d.lc))for(var f=b;c>f;f++)k(a[f])?(e.v=!0,A.Append(a[f])):e.v?(A.Append(a[f].toUpperCase()),e.v=!1):A.Append(a[f]);else A.Append(a.substr(b,c-b));A.Length>0&&(e.v=k(A.s[A.Length-1]))}}function r(a){B[a]=B[a]+1}function s(a){B[a]>0&&(B[a]=B[a]-1)}function t(a,b){A.Append(a),b.v=k(a)}function u(b,c){for(var d,e,f,g,h,j=0,l=1,m=!1,n=b.indexOf(y,c);!m&&n>=0;){if(n<b.length-1&&b[n+1]==y)c=n+2;else if(d=b.indexOf(z,++n),0>d)c=n;else{for(e=a.trim(b.substr(n,d-n)),f=0;f<e.length&&!k(e[f]);f++);switch(g=e.substr(0,f),c=d+1,g){case".p":h=f<e.length?i(e.substr(f,e.length-f)):null,w(h)?1==l&&++j:++l;break;case".pe":l>1?--l:m=!0}}n=b.indexOf(y,c)}return j}var v=HOTDOC$,w=b.String.IsNullOrEmpty;this.DEBUG===h&&(this.DEBUG=v.DEBUG);var x=d.wl+1,y="«",z="»",A=new b.Text.StringBuilder,B=[],C=new c,D=new c,E="";return b.ExtendClass(m,null,{IsCodeEnabled:function(a){return B[a]>0},ChangeFontSize:function(a){return C.Peek().Direction==g.Increase?a*=1+C.Peek().Amount/100:a-=a*C.Peek().Amount/100,a},FontSizeChange:function(){return C.Peek()},Parse:function(b,c,h){var m,F,G,H,I,J,K,L,M,N,O,P,Q;for(A.Clear(),m=0;x>m;m++)B[m]=0;for(C.Clear(),D.Clear(),F=b.SourceString(),h&&(F=F.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")),F.indexOf("\\t")>=0&&(F=F.replace(/\\t/g,"«.tc»")),F.indexOf("\\r")>=0&&(F=F.replace(/\\r/g,"«.lb»")),c.PreParse(this),G=[y,"\r"],A.Clear(),H={v:!0},I=0,J=v.IndexOfAny(F,G,I);J>=0;){if(q.call(this,F,I,J,H),"\r"==F[J])this.IsCodeEnabled(d.wl)?A.Append(" "):(p.call(this,c),c.WriteLineBreak()),I=J<F.length-1&&"\n"==F[J+1]?J+2:J+1,H=!0;else if(J<F.length-1&&F[J+1]==y)t(y,H),I=J+2;else if(K=F.indexOf(z,++J),0>K)I=J;else{for(L=j(F.substr(J,K-J)),m=0;m<L.length&&!k(L[m]);m++);if(M=L.substr(0,m),N=m<L.length?i(L.substr(m,L.length-m)):null,I=K+1,!this.IsCodeEnabled(d.wl)||".we"==M)switch(M){case".b":n.call(this,c,d.b);break;case".i":n.call(this,c,d.i);break;case".x":n.call(this,c,d.st);break;case".u":n.call(this,c,d.un);break;case".s":n.call(this,c,d.sc);break;case".z":n.call(this,c,d.fs),!w(N)&&N.length>=2&&("+"==N[0]||"-"==N[0])&&(O=parseInt(N.substr(1,N.length-1)),isNaN(O)||C.Push(new e("+"==N[0]?g.Increase:g.Decrease,O)));break;case".be":o.call(this,c,d.b);break;case".ie":o.call(this,c,d.i);break;case".xe":o.call(this,c,d.st);break;case".ue":o.call(this,c,d.un);break;case".se":o.call(this,c,d.sc);break;case".ze":o.call(this,c,d.fs),C.Count()>0&&C.Pop();break;case".h":r(d.h);break;case".a":r(d.ac);break;case".l":r(d.lc);break;case".he":s(d.h);break;case".ae":s(d.ac);break;case".le":s(d.lc);break;case".an":for(m=I;m<F.length&&k(F[m]);m++);m<F.length&&A.Append("aeiou".indexOf(F[m].toLowerCase())>=0?"an":"a"),A.Append(F.substr(I,m-I)),A.Length>0&&(H=k(A.s[A.Length-1])),I=m;break;case".c":I<F.length&&l(F[I])&&t(F[I++].toUpperCase(),H);break;case".la":t("‘",H);break;case".ra":t("’",H);break;case".lq":t("“",H);break;case".rq":t("”",H);break;case".ps":t("¶",H);break;case".ss":t("§",H);break;case".tc":t("&#160;&#160;&#160;&#160;&#160;",H);break;case".ns":t(" ",H);break;case".nh":t("‑",H);break;case".oh":t("­",H);break;case".":case",":case";":case":":case"!":case"?":for(m=Math.min(I,F.length-1);m>=0&&F[m]!=y;m--);m>0&&(P=A.ToString(),".,:;?!".indexOf(P[P.length-1])<0&&(A.Append(M),H=!1));break;case".lb":case".pm":case".pb":p.call(this,c),c.WriteLineBreak(),H=!0;break;case".w":w(N)||(E=j(N,['"']),w(E)||n.call(this,c,d.wl));break;case".we":this.IsCodeEnabled(d.wl)&&(A.Length>0&&(c.WriteWebLink(this,E,A.ToString()),A.Clear()),s(d.wl));break;case".p":w(N)?D.Count()>0&&(Q=D.Peek().GetPunctuation(),w(Q)||(A.Append(Q),H=k(A.s[A.Length-1])),D.Peek().IncrementCodeIndex()):D.Push(new f(N.replace(/^["]/,"").replace(/["]$/,""),u(F,I)));break;case".pe":D.Count()>0&&D.Pop()}}for(J=-1,m=I;m<F.length;m++)if(a.inArray(F[m],G)>=0){J=m;break}}q.call(this,F,I,F.length,H),p.call(this,c),c.PostParse(this)}}),m}),define("engine/htmlformatter",["hdmain/system","engine/pairedcode"],function(a,b){function c(a){this._text=a}function d(a){var b=a.substr(11);return b.indexOf("+")>=0&&(b=/%\d{2}?/.test(b)?/\x20|%20/.test(b)?b.replace("+","%2B"):b.replace(/\+/g,"%20"):b.replace(/\+/g,"%2B")),b=b.replace(/\x27/g,"%27").replace(/\x22/g,"%22"),b=b.replace(/\&#39;/g,"%27").replace(/\&quot;/g,"%22"),"javascript:"+b}function e(a,b){var d=c.MakeAbsoluteUrl(a,!0);return 0==d.indexOf("javascript:")?"HDAPI._DoWebLinkAction('"+d+"')":(a=d.replace(/\x27/g,"\\'"),"window.open('"+a+"', '_blank'"+(f(b)?"":", '"+b+"'")+")")}var f=a.String.IsNullOrEmpty;return a.ExtendClass(c,null,{PreParse:function(){},PostParse:function(){},WriteText:function(a,c){var d,e="";a.IsCodeEnabled(b.b)&&(e+="font-weight:bold; "),a.IsCodeEnabled(b.i)&&(e+="font-style:italic; "),a.IsCodeEnabled(b.st)&&(e+="text-decoration:line-through; "),a.IsCodeEnabled(b.un)&&(e+="text-decoration:underline; "),a.IsCodeEnabled(b.sc)&&(e+="font-variant:small-caps; "),a.IsCodeEnabled(b.fs)&&(d=a.ChangeFontSize(100),e+="font-size:"+d.toString()+"%; "),e.length>0&&(this._text.Append('<span style="'),this._text.Append(e),this._text.Append('">'));for(var f=0;f<c.length&&" "==c[f];f++)c=c.substr(0,f)+"&#160;"+c.substr(f+1),f+=5;c=c.replace("	","&#160;&#160;&#160;&#160;"),this._text.Append(c),e.length>0&&this._text.Append("</span>")},WriteLineBreak:function(){this._text.Append("<br/>")},WriteWebLink:function(a,b,c){this._text.Append('<a href="#" class="dot-w" '),this._text.Append('onclick="javascript:'),this._text.Append(e(b,null)),this._text.Append('">'),this.WriteText(a,c),this._text.Append("</a>")}},{MakeAbsoluteUrl:function(a,b){0==a.toLowerCase().indexOf("javascript:")&&(a=d(a));var c,e,g=a;return/^\w+:/.test(g)?g:(e=b&&"string"==typeof HDBaseURLForLinks?HDBaseURLForLinks:null,c=f(e)?"":e,c+g)}}),c}),define("engine/changeuistateeventargs",[],function(){function a(a,b){this.State=a,this.Message=b}return a}),define("engine/engine",["hdmain/jq","hdmain/system","./answerset","hdmain/stack","system/exception/invalidoperationexception","system/exception/argumentoutofrangeexception","./preferencecache","./stringparsersource","./templatemanager","./dotcodeparser","./htmlformatter","engine/placeholdertype","engine/valuechangetype","engine/changeuistateeventargs"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=HOTDOC$;this.DEBUG===o&&(this.DEBUG=p.DEBUG);var q,r,s,t,u,v,w,x,y,z="Engine",A="Default",B="Nothing",C="Underscores",D="Asterisks",E=D+"AndVarName",F="BracketedVarName";p.PartialClass("Engine",z,{InterviewStack:function(){return w},DoNavigatedJSAPI:function(b){a(this).trigger("NavigatedJSAPI",new p.NavigatedJSAPIEventArgs(null==b?"":b.Variable().name))},DoPreNavigateJSAPI:function(b,c,d,e){var f=new p.PreNavigateJSAPIEventArgs(b,c);a(this).trigger("PreNavigateJSAPI",[f,function(a){a.Cancel?e(!1,a.CancelMessage):e(!0,a.CancelMessage)}])},Templates:function(){return t},Navigator:function(){return q().Navigator()},DotCodeParser:function(){return v},InterviewImageUrl:function(a){return a===o?this._imageUrl:(this._imageUrl=a,void 0)},TestMode:function(a){return a===o?this._testMode:(this._testMode=a,void 0)},RootTemplateName:function(){return r},RootAssemblyName:function(){return s},PreferenceCache:function(){return u},BeginBulkAnswerChange:function(){x++},EndBulkAnswerChange:function(a){if("boolean"!=typeof a&&(a=!0),0==x)throw new e("EndBulkAnswerChange() called when Engine was not in a bulk answer change.");x--,0==x&&a&&!q().IsProcessing()&&q().Update()},InBulkAnswerChange:function(){return x>0},HasValidationErrors:function(){return q().HasValidationErrors()},GetValueType:function(a){return q().GetValueType(a)},VarIsMarked:function(a){return q().VarIsMarked(a)},SetValueType:function(a,b,c){q().SetValueType(a,b,c)},TemplateTitle:function(a){return a===o?this._templateTitle:(this._templateTitle=a,void 0)},AllTemplatesLoaded:function(){return this._allTemplatesLoaded},AutoInterviews:function(){return this._autoInterviews},TryGetTemplate:function(a,b,c){var d=t.GetTemplate(a,b,c);return d||(t.ResetNew(),p._allTemplatesLoaded=!1),d},CheckForNewInserts:function(){var a=!t.New&&0==t.IncompleteDownloads();return t.ResetNew(),this._allTemplatesLoaded=a,a},AnswerLoadingComplete:function(){var a=this;a.EndBulkAnswerChange(!1),a._initialAnswersLoaded=!0,a.TryInterviewUpdate()},LoadAnswerValue:function(a,b,c){var d,e,f,g,h={},i=3;d="boolean"==typeof arguments[i]?arguments[i++]:!0,e="boolean"==typeof arguments[i]?arguments[i++]:!0,f="boolean"==typeof arguments[i]?arguments[i++]:!0,g=arguments[i],p.Answers.TryGetAnswer(b,h)&&h.v.VT()!=a&&(p.Answers.RemoveAnswer(b),h.v=null),null==h.v&&(h.v=p.Answers.CreateAnswer(a,b)),d||(h.v.s=!1),this._initialAnswersLoaded?h.v.SetValue(c,g):(h.v.InitValue(c,f,g),e||(h.v.ue=e))},ClearAnswer:function(a,b){var c=this.GetAnswer(a);null!=c&&c.ClearValue(b)},ClearAnswers:function(){this.BeginBulkAnswerChange(),p.Answers=new c,p.Answers.OnAnswerChanged(null,null,m.BecameUnanswered),this.EndBulkAnswerChange()},GetAnswer:function(a){var b={};return p.Answers.TryGetAnswer(a,b),b.v},GetAnswerValue:function(a,b){var c=this.GetAnswer(a);return c!==o?c.GetValue(b):null},GetResourceString:function(a){return p.Lc.GetStr(a)},DefaultUnansweredText:function(a){return a===o?p.PlaceholderTypeToString(y):(y=p.StringToPlaceholderType(a),void 0)},ResolveDotCodes:function(a){var c=new b.Text.StringBuilder;return this.DotCodeParser().Parse(new h(a),new k(c)),c.ToString()},OnChangeUIState:function(b,c){b!=this._uiState&&(this._uiState=b,a(this).trigger("ChangeUIState",new n(b,c)))},OnBeforeInterviewUpdate:function(){a(this).trigger("BeforeInterviewUpdate",{})},OnAfterInterviewUpdate:function(){a(this).trigger("AfterInterviewUpdate",{})},OnInterviewComplete:function(){var b={Cancel:!1};return a(this).trigger("InterviewComplete",b),!b.Cancel},TemplateDownloaded:function(a,c){var d=this;q().InFullRebuild()||(null==u&&c.TemplateName==r&&d.InitializePreferences(),d._allTemplatesLoaded=0==c.DownloadsInProgress,b.CallAsync(function(){!d.TryInterviewUpdate()&&d._initialAnswersLoaded&&q().CanUpdate()&&q().TryProcessTemplate(c.TemplateName,c.AssemblyName)}))},InitializePreferences:function(){var a={};t.GetTemplate(r,s,a)&&(u=new g(a.v),this._autoInterviews=a.v.HasTemplateInterview()?u.DisableIrrelevantAnswers():!1)},TryInterviewUpdate:function(){return this._initialAnswersLoaded&&this._allTemplatesLoaded&&q().CanUpdate()?(q().Update(!0),!0):!1},SetError:function(a){p._errorStr=a},DoAnswerSync:function(){var a=q().GetFocusItem();null!=a&&a.OnAnswerSync()}},function(b,e,f){r=e,s=f,p.Answers=new c,this._initialAnswersLoaded=!1,this._allTemplatesLoaded=!1,x=1,u=null,this.NextFollowsOutline=!1,v=new j,w=new d,w.Push(new p[z].Interview(this,r,s,null,null)),this._templateTitle="",this.DocPreviewEnabled=!1,this.AnswerSummaryEnabled=!0,this.ProgressBarEnabled=!0,this.SaveAnswersUrl="",this.ShowAllResourceButtons=!1,t=new i(b,r,s),t.TemplateDownloaded("add",a.proxy(this.TemplateDownloaded,this)),p.TestInBrowser=window.HDTestInBrowser,p.TemplateLocator=window.HDTemplateLocator;var g,h=window.HDDataSources;if(h!=o)for(p.DataSourceAddressDict={},g=0;g<h.length;g++)p.DataSourceAddressDict[h[g].Name.toLowerCase()]=h[g]}),q=p.CurrentInterview=function(){return w.Peek()},p.Alert=function(a){var c=a?a:"";if("string"!=typeof c&&(c=a.s),!b.String.IsNullOrEmpty(c)){var d=new b.Text.StringBuilder,e=new j,f=new h(c),g=new k(d);e.Parse(f,g),HDAPI.ShowMessageBox(d.ToString())}},p.ExceptionAlert=function(a,c){var d=new b.Text.StringBuilder(p.Lc.GetStr(a));for(d.AppendLine(),d.Append(c.Message);null!=c.InnerException;)c=c.InnerException,d.AppendLine(),d.Append(c.Message);p.Alert(d.ToString())},p.ResourcePaneInitialHeight=0,p.SetAnswerDTD=function(a){p.Answers.DTD=a},p.GetXMLAnswers=function(a){return p.Answers.GetXMLString(a)},p.CurrentOutlineNode=function(){return q().CurrentOutlineNode()},p.RequiredAsterisk=!1,p.DisableFinishWarning=!1,p.StringToPlaceholderType=function(a){switch(a){case B:return l[B];case D:return l[D];case C:return l[C];case"*** Variable ***":return l[E];case"[Variable]":return l[F];default:return l[A]}},p.PlaceholderTypeToString=function(a){switch(a){case l[A]:return A;case l[B]:return B;case l[D]:return D;case l[C]:return C;case l[E]:return"*** Variable ***";case l[F]:return"[Variable]"}throw new f("value")},p.UnansweredPlaceholder=function(){var a=u.UnansweredVarPlaceholder();return a==l[A]&&(a=y!=l[A]?y:l[E]),a},p.Confirm=function(a){return window.confirm(a)},p.GetBookmark=function(){return q().GetBookmark()},p.QueuedBookmark=function(){return q().QueuedBookmark},p.GotoBookmark=function(a){q().GotoBookmark(a)},p.PushTemplate=function(a){q().PushTemplate(a)},p.PopTemplate=function(a){q().PopTemplate(a)},p.NavigatedJSAPIEventArgs=function(a){this.DialogName=a},p.PreNavigateJSAPIEventArgs=function(a,b){this.DialogName=a,this.TargetName=b,this.Cancel=!1,this.CancelMessage=""}}),define("engine/engine_runtime",["system/exception","hdmain/system"],function(a,b,c){function d(a,b,c){q(b)||(c&&"\r\n"==a[a.length-1]?a.splice(a.length-1,0,b):a.push(b))}function e(a){e.tknCache===c&&(e.tknCache={});var b=e.tknCache[a];return b===c&&(b=a.replace(/\\t/g,"	").replace(/\\s/g," ").replace(/\\p/g,"\u2029").replace(/\\l/g,"\u2028").replace(/\\h/g,"­").replace(/\\\\/g,"\\"),e.tknCache[a]=b),b}function f(a,b){return"string"!=typeof a?"":b?a.replace(/\u2029/g,"¶\r\n").replace(/\u2028/g,"\r\n"):a.replace(/\xB6\x0D\x0A/g,"\u2029").replace(/\x0D?\x0A|\x0D/g,"\u2028")}function g(a){if("string"!=typeof a||null===a||0===a.length)return"";var b,c,d,e=0;for(b=0;b<a.length&&(c=a.charAt(b),i(c)||"."==c||"-"==c);b++)e++;if(d=parseInt(a.charAt(e-1),10)+1,10==d&&(d=0),a=a.substr(0,e-1)+d.toString()+(a.length<=e?"":a.substring(e,a.length)),0===d)for(b=e-2;b>=0;b--)if(c=a.charAt(b),"9"==c)a=a.substr(0,b)+"0"+a.substring(b+1,a.length),0===b&&(a="1"+a);else if(i(c)){a=a.substr(0,b)+Number(parseInt(a.charAt(b),10)+1).toString()+a.substring(b+1,a.length);break}for(;a.length>1&&"0"==a.charAt(0)&&"."!=a.charAt(1);)a=a.substr(1,a.length-1);return a}function h(a,b,c){if(null===a||""===a)return"";var d,e,f,h=a.toString(),j=h.split("."),k="",l=0;if(j.length>1){for(;l<j[1].length&&i(j[1].charAt(l));)l++;if(d=l,b>0)if(b>=d){if(k=j[0]+"."+j[1],e=j[0].length+1+d,c===!0)for(l=d;b>l;l++)k=k.substr(0,e)+"0"+(e>=k.length?"":k.substring(e,k.length)),e++}else k=j[0]+"."+j[1].substr(0,b)+(d<j[1].length?j[1].substring(d,j[1].length):""),f=parseInt(j[1].charAt(b),10),f>=5&&(k=g(k));else k=j[0],d<j[1].length&&(k+=j[1].substring(d,j[1].length)),parseInt(j[1].charAt(0),10)>=5&&(k=g(k))}else if(b>0){if(k=j[0],c===!0)for(k+=".",l=0;b>l;l++)k+="0"}else k=j[0];return k}function i(a){return"0"==a||"1"==a||"2"==a||"3"==a||"4"==a||"5"==a||"6"==a||"7"==a||"8"==a||"9"==a?!0:!1}function j(){j.baseConstructor.apply(this,arguments)}var k,l,m,n,o,p=HOTDOC$,q=b.String.IsNullOrEmpty,r="ENG";p.PartialClass("Engine","Engine",{AskNone:function(a){return a===c?("boolean"!=typeof m&&(m=!1),m):(m=a,void 0)}},null,function(){k=p.CurrentInterview,l=p.VariableIncludeMode}),p.GV=function(a,b){return k().GV(a,b)},p.GVU=function(a,b){return k().GVU(a,b)},p.SV=function(a,b,c){k().DoSetVarValue(a,b,!0,c)},p.Def=function(a,b,c){k().DoSetVarValue(a,b,!1,c)},p.Inc=function(a,b){var c=k().GVImpl(a,!1,b);null!=c&&p.SV(a,c+1,b)},p.Dec=function(a,b){var c=k().GVImpl(a,!1,b);null!=c&&p.SV(a,c-1,b)},p.Mrg=function(a,b){k().IncludeVar(a,l.TemplateMerge,b)},p.Ask=function(a,b){k().IncludeVar(a,b?l.ExplicitRepeat:l.ExplicitAsk)},p.PsU=function(){k().PsU()},p.PpU=function(){k().PpU()},p.GtU=function(){return k().GtU()},p.StU=function(a){k().StU(a)},p.Ins=function(a,b){return k().ProcessScript(a,b,null)},p.GPN=function(a){return k().GetPN(a)},p.SPN=function(a,b){k().SetPN(a,b)},p.SetLng=function(a,b,d){r=a,n=b===c?"\x00":b,o=d===c?"\x00":d},p.Lng=function(){return null!=r?r:""},p.FmV=function(a,b,c,d){return k().FormatValue(a,b,c,d)},p.DgA=function(){return p.TRN()},p.SAN=function(a){m=a},p.SUn=function(){return p.StU(!0),null},function(a){function b(a){var b=a;return"function"==typeof b.join&&(b=b.join("|")),b.toLowerCase()}a.Con=function(a,c){return p.GtU()||null==a||null==c?null:b(a).indexOf(c.toLowerCase())>=0},a.Sw=function(a,c){return p.GtU()||null==a||null==c?null:0==b(a).indexOf(c.toLowerCase())},a.Ew=function(a,c){if(p.GtU()||null==a||null==c)return null;var d=b(a);return d.length<c.length?!1:d.substr(d.length-c.length)==c.toLowerCase()},a.IsE=function(a){return p.GtU()||null==a?null:""===b(a)},p.TX=a}(p.TX===c?{}:p.TX),function(a){a.LOR=function(a,b){return p.GtU()||null==a?null:a?a:b.call(k().CurrentTemplate().tplObj,p)},a.LAN=function(a,b){return p.GtU()||null==a?null:a?b.call(k().CurrentTemplate().tplObj,p):a},p.TF=a}(p.TF==c?{}:p.TF),p.Add=function(a,b){k().Add(a,b)},p.Clr=function(a){k().Clr(a)},p.Ers=function(a){k().Ers(a)},p.StL=function(a,b){k().StL(a,b)},p.Gry=function(a,b){k().Gry(a,b)},p.Hid=function(a,b){k().Hid(a,b)},p.Con=function(a,b){k().Con(a,b)},p.Omt=function(a,b){k().Omt(a,b)},p.Req=function(a){k().Req(a)},p.Err=function(a){k().Err(a)},p.PsR=function(){var a=k();a.PushRpt.apply(a,arguments)},p.PpR=function(){k().PpR()},p.IcR=function(){k().IcR()},p.ApRes=function(a){var b,c=k().GetRepeatPunctuation(!1);return q(c)||null==a?a:(b=[a],d(b,c,!0),b.join(""))},p.ApPre=function(a){d(a,k().GetRepeatPunctuation(!0),!1)},p.ApInt=function(a){d(a,k().GetRepeatPunctuation(!1),!0)},p.ApPst=function(a){d(a,k().GetRepeatPunctuation(!1),!0)},p.TRN=function(){return k().TRN()},p.TRC=function(){return k().TopRptCnt()},p.InR=function(){return k().InRpt()},p.PsS=function(a,b){k().PsS(a,b)},p.PpS=function(){k().PpS()},p.Abs=function(a){return p.GtU()||null===a?null:Math.abs(a)},p.Age=function(a){return p.YsF(new Date,a)},p.Ans=function(a,b){return k().Ans(a,b)},p.Cnt=function(a,b){return k().Cnt(a,b)},p.Dat=function(a,b,c){function d(a,b,c){if(isNaN(a))return!1;if(isNaN(b))return!1;if(isNaN(c))return!1;if(1e3>a)return!1;var d=new Date(a,b-1,c);return d.getMonth()+1!=b?!1:d.getDate()!=c?!1:d.getFullYear()!=a?!1:!0}if(p.GtU()||null===a||null===b||null===c)return null;if(!d(c,b,a))throw p.StU(!0),new j(p.Lc.GetStr("err_dateof"));return new Date(c,b-1,a)},p.Day=function(a){return p.GtU()||null===a?null:a.getDate()},p.DOW=function(a){return p.GtU()||null===a?null:a.getDay()+1},p.DsF=function(a,b){if(p.GtU()||null===a||null===b)return null;var c=Math.abs(Date.UTC(b.getFullYear(),b.getMonth(),b.getDate())-Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()));return Math.floor(c/864e5)},p.Fst=function(a,b){return p.GtU()||null===a||null===b?null:(a=a.toString(),""===a||0>=b?"":a.substr(0,b))},p.Fmt=function(a,b){if(p.GtU()||null===a||null===b)return null;var c=[b];return k().FormatValue(a,c)},p.Int=function(a){if(p.GtU()||null===a)return null;var b=parseInt(a,10);return isNaN(b)?0:b},p.Lst=function(a,b){return p.GtU()||null===a||null===b?null:""===a||0>=b||"number"!=typeof b?"":a.substr(a.length-b)},p.Len=function(a){return p.GtU()||null===a?null:a.length},p.Max=function(a,b){return p.GtU()||null===a||null===b?null:Math.max(a,b)},p.Mid=function(a,b,c){return p.GtU()||null===a||null===b||null===c?null:a.substr(b-1,c)},p.Min=function(a,b){return p.GtU()||null===a||null===b?null:Math.min(a,b)},p.Mon=function(a){return p.GtU()||null===a?null:a.getMonth()+1},p.MsF=function(a,b){if(p.GtU()||null===a||null===b)return null;if(a>b)return this.MsF(b,a);var c=12*(b.getFullYear()-a.getFullYear())+(b.getMonth()-a.getMonth());return b.getDate()<a.getDate()&&c--,c},p.Oth=function(a,b){return k().Oth(a,b)},p.Pos=function(a,b,c){if(p.GtU()||null===a||null===b||null===c)return null;if(""===a||""===b)return 0;var d,e=a.toString().toUpperCase(),f=b.toString().toUpperCase();return c?(d=e.lastIndexOf(f),0>d&&(d=e.lastIndexOf(f.replace(/&#39;/g,"'")))):(d=e.indexOf(f),0>d&&(d=e.indexOf(f.replace(/&#39;/g,"'")))),d>=0?d+1:0},p.Pwr=function(a,b){return p.GtU()||null===a||null===b?null:Math.pow(a,b)},p.Exp=function(a){return p.GtU()||null===a?null:Math.exp(a)},p.Ln=function(a){return p.GtU()||null===a?null:Math.log(a)},p.Log=function(a){return p.GtU()||null===a?null:Math.LOG10E*Math.log(a)},p.Sqt=function(a){return p.GtU()||null===a?null:Math.sqrt(a)},p.Flr=function(a){return p.GtU()||null===a?null:Math.floor(a)},p.Cel=function(a){return p.GtU()||null===a?null:Math.ceil(a)},p.Fvl=function(a,b,c,d,e){if(p.GtU()||null===a||null===b||null===c||null===d||null===e)return null;var f=a,g=b,h=c,i=d,j=e,k=0,l=f,m=i,n=h,o=g,q=j;return 0!=q&&(q=1),k=l>0?-n*((1+l*q)/l)*(Math.pow(1+l,o)-1)-m*Math.pow(1+l,o):-(n*o+m)},p.Pvl=function(a,b,c,d,e){if(p.GtU()||null===a||null===b||null===c||null===d||null===e)return null;var f=a,g=b,h=c,i=d,j=e,k=0,l=f,m=h,n=g,o=i,q=j;return 0!=q&&(q=1),k=l>0?(-m*((1+l*q)/l)*(Math.pow(1+l,n)-1)-o)/Math.pow(1+l,n):-(m*n+o)},p.Rte=function(a,b,c,d,e){function f(a,b,c,d,e,f){var g;return g=Math.pow(1+a,d),e+b*g+c*((1+a*f)/a)*(g-1)}function g(a,b,c,d,e){var g,h,i,j,k,l,m,n=!1,o=!1,p=0,q=0,r=0,s=0,u=0;if(0==b)u=Math.pow(-d/a,1/c)-1;else if(m=0!=a||0!=e?e:1,i=b*c*m*(1-c)-a*c*(1+c),j=b*c*(1-c)-2*c*(b*m+a),k=-2*(d+b*c+a),l=Math.pow(j,2)-4*i*k,0>l)u=Math.pow(-1,.5);else{if((k=(-j+Math.sqrt(l))/(2*i))<=0&&(k=(-j-Math.sqrt(l))/(2*i)),l=2*k,i=f(k,a,b,c,d,e),j=f(l,a,b,c,d,e),i>0&&j>0||0>i&&0>j){Math.abs(i)<Math.abs(j)?(o=!0,u=k,g=i):(o=!1,u=l,g=j),0>g?(p=u,q=g):(r=u,s=g);do o?u/=2:u*=2,h=f(u,a,b,c,d,e);while(g>0&&h>0||0>g&&0>h);0>g?(r=u,s=h):(p=u,q=h)}else 0>i?(p=k,q=i,r=l,s=j):(p=l,q=j,r=k,s=i);n=!1;do u=(r+p)/2,g=f(u,a,b,c,d,e),Math.abs(g)<t?n=!0:0>g?g>q&&(p=u,q=g):s>g&&(r=u,s=g);while(!n)}return u}if(p.GtU()||null===a||null===b||null===c||null===d||null===e)return null;var h=a,i=b,j=c,k=d,l=e,m=0,n=j,o=i,q=h,r=k,s=l,t=1e-4;return 0!=s&&(s=1),m=g(n,o,q,r,s)},p.Ter=function(a,b,c,d,e){if(p.GtU()||null===a||null===b||null===c||null===d||null===e)return null;var f=a,g=b,h=c,i=d,j=e,k=0,l=f,m=h,n=g,o=i,q=j;if(0!=q&&(q=1),l>0)k=Math.log((n*(1+l*q)/l-o)/(n*(1+l*q)/l+m))/Math.log(l+1);else{if(!(n>0))return null;k=-(o+m)/n}return k},p.Pmt=function(a,b,c,d,e){if(p.GtU()||null===a||null===b||null===c||null===d||null===e)return null;var f=a,g=b,h=c,i=d,j=e,k=0,l=f,m=h,n=g,o=i,q=j;if(0!=q&&(q=1),l>0&&n>0&&q>=0)k=(-m*Math.pow(1+l,n)-o)/((1+l*q)/l*(Math.pow(1+l,n)-1));else{if(!(n>0))return null;k=-(o+m)/n}return k},p.Mod=function(a,b){return p.GtU()||null===a||null===b?null:0===b?(p.StU(!0),1):a%b},p.Rep=function(a,b,c,d){if(p.GtU()||null===a||null===b||null===c||null===d)return null;"number"!=typeof d&&(d=2147483647);var g,h=e(b).toLowerCase(),i=e(c),j=0,k=f(a,!1),l=k.toLowerCase(),m=0,n=h.length,o=i.length;for(g=0;d>g&&(m=l.indexOf(h,j),-1!=m);g++)j=m+o,k=k.slice(0,m)+i+k.slice(m+n),l=k.toLowerCase();return f(k,!0)},p.Rnd=function(a,b){return p.GtU()||null===a||null===b?null:(b>7&&(b=7),parseFloat(h(a,b,!1)))},p.Sel=function(a,b,c){return k().Sel(a,b,c)},p.Spc=function(a,b){return p.GtU()?null:null===a?"":null===b?(p.StU(!0),null):f(f(a,!0)+e(b),!1)},p.Stp=function(a,b,c,d){if(p.GtU()||null===a||null===b||null===c||null===d)return null;var g,h,i=f(a,!1),j=0,k=i.length;if(null===i||""===i)return"";if(g=i.toLowerCase(),h=e(b).toLowerCase(),c)for(;k>j&&-1!=h.indexOf(g.substr(j,1));)j++;if(d)for(;k>j&&-1!=h.indexOf(g.substr(k-1,1));)k--;return f(i.substr(j,k-j),!0)},p.Trm=function(a){return p.Stp(a," \\t\\l",!0,!0)},p.Sum=function(a,b){return k().Sum(a,b)},p.Tdy=function(){return p.GtU()?null:new Date},p.Trc=function(a,b){if(p.GtU()||null===a||null===b)return null;var c,d=h(a,7,!1),e=d.indexOf(".");if(-1!=e){for(c=e+1;c<d.length&&i(d.charAt(c));c++);for(;c>e&&!(b>=c-e);)d=d.substring(0,c)+(c<d.length-1?d.substring(c+1,d.length):""),c--}return parseFloat(d)},p.Uni=function(a,b,c,d){if(p.GtU())return null;var e,f,g,h,i;if(k().IncludeVar(a,l.ExpressionMerge),e=k().GVImpl(a,!1,b),k().IncludeVar(c,l.ExpressionMerge),f=k().GVImpl(c,!1,d),null==f)return null;if(null==e)return f;g=e;for(i in f)h=f[i],g.indexOf(h)<0&&g.push(h);return g},p.Val=function(a,b,c){if(p.GtU())return null;var d=k().GVImpl(a,!1,b);return null!=d?d:(null==c&&p.StU(!0),c)},p.Yer=function(a){return p.GtU()||null===a||"function"!=typeof a.getFullYear?null:a.getFullYear()},p.YsF=function(a,b){if(p.GtU()||null===a||null===b)return null;var c=a>b?b:a,d=a>b?a:b,e=d.getFullYear()-c.getFullYear();return(d.getMonth()<c.getMonth()||d.getMonth()==c.getMonth()&&d.getDate()<c.getDate())&&e--,e},p.Zro=function(a){return p.GtU()?null:null===a||"number"!=typeof a?0:a},b.ExtendClass(j,a),p.HotDocsIntrinsicException=j}),define("engine/helpervalues",[],function(){function a(a){this._value=a}return HOTDOC$.BitFlagValue=a,a}),define("system/dispatchertimer",["hdmain/system"],function(a){function b(){this._intervalIDs=[],this.Interval=0,this.Tick=null}return a.ExtendClass(b,null,{IsEnabled:function(){return this._intervalIDs.length>0},Start:function(a){if("function"==typeof this.Tick){var b=this.Tick;this._intervalIDs.push(window.setInterval(function(){b.call(a)},this.Interval))}},Stop:function(){for(;this._intervalIDs.length>0;)window.clearInterval(this._intervalIDs.pop())}},{BeginInvoke:function(a,c){var d=new b;d.Tick=function(){d.Stop(),c.call(a)},d.Start()}}),b}),define("system/exception/targetinvocationexception",["hdmain/system","system/exception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("engine/indexedvariableinfoflags",[],{None:0,Used:1,Interview:0,All:-1}),define("engine/variableinfoflags",[],{None:0,InterviewTrigger:1,AddedToInterview:2,WasSet:4,DialogTrigger:16,Marked:32,AddedToParent:64,All:-1}),define("engine/variableinfo",["hdmain/jq","./helpervalues","hdmain/system","system/exception/argumentnullexception","engine/indexedvariableinfoflags","engine/variableinfoflags"],function(a,b,c,d,e,f,g){function h(a,b){b===g?i.call(this,a):j.call(this,a,b)}function i(a){this._type=a,this._flags=f.None,this._iflags=null,this._interviewNodes=[],this._dialogItemNodes=[]}function j(a,b){this._type=a._type,b?(this._flags=a._flags,this._iflags=a._iflags,this._interviewNodes=a._interviewNodes,this._dialogItemNodes=a._dialogItemNodes):(this._flags=a._flags&(f.AddedToInterview|f.Marked),0!=(this._flags&f.AddedToInterview)&&(this._flags|=f.AddedToParent),this._iflags=null,this._interviewNodes=[],this._dialogItemNodes=[])}function k(a){return 0!=(this._flags&a)}function l(a,b){b?this._flags|=a:(k.call(this,f.AddedToParent)&&(a&=~f.AddedToInterview),this._flags&=~a)}function m(a,b){if(null==this._iflags)return!1;var c=this._iflags.GetValue(b);return c=null==c?0:c._value,0!=(c&a)}function n(a,c,d){(null===this._iflags||this._iflags===g)&&(this._iflags=o.Answer.Create("BF",null,"(INDEXED RUNTIME VARIABLE INFO)"));var e=this._iflags.GetValue(d);e=null==e?0:e._value,c?e|=a:e&=~a,this._iflags.InitValue(new b(e),!0,d)}var o=HOTDOC$;return this.DEBUG===g&&(this.DEBUG=o.DEBUG),c.ExtendClass(h,null,{Reset:function(a,c){l.call(this,a,!1),null!=this._iflags&&this._iflags.ApplyValueMutator(function(a){var d=a._value;return d&=~c,new b(d)})},ValueType:function(){return this._type},InterviewNodes:function(){return this._interviewNodes},DialogItemNodes:function(){return this._dialogItemNodes},InterviewTrigger:function(a){return a===g?k.call(this,f.InterviewTrigger):(l.call(this,f.InterviewTrigger,a),void 0)},DialogTrigger:function(a){return a===g?k.call(this,f.DialogTrigger):(l.call(this,f.DialogTrigger,a),void 0)},AddedToInterview:function(a){return a===g?k.call(this,f.AddedToInterview):(l.call(this,f.AddedToInterview,a),void 0)},WasSet:function(a){return a===g?k.call(this,f.WasSet):(l.call(this,f.WasSet,a),void 0)},Marked:function(a){return a===g?k.call(this,f.Marked):(l.call(this,f.Marked,a),void 0)},GetUsed:function(a){return m.call(this,e.Used,a)},SetUsed:function(a,b){n.call(this,e.Used,a,b)},toString:function(){return this._type}}),h}),define("engine/dialoginfo",["hdmain/system","engine/indexedvariableinfoflags","engine/variableinfoflags","engine/variableinfo"],function(a,b,c,d,e){function f(a,b){var c,e,h,i=f.baseConstructor;a instanceof g.Dlg?(c=a,i.call(this,"TF"),this.Initialize(c,null)):b instanceof d?(c=a,e=b,i.call(this,e,!0),this.Initialize(c,null)):(h=a,i.call(this,h,!1),this.Initialize(null,h))}var g=HOTDOC$;return this.DEBUG===e&&(this.DEBUG=g.DEBUG),a.ExtendClass(f,d,{Initialize:function(a,b){if(this._limit=g.Answer.Create("NU",null,"(LIMIT)"),this._index=0,null!=a)if(a.nota){this._singleSelectGroups=[];for(var c=0;c<a.TrueFalseGroupCount();c++)this._singleSelectGroups.push({NOTA:new g.TfVar("$00NOTA"+(c+1)+a.name,null,a,g.Lc.GetStr("ui_nota"),null,"F",0,"C",0,!1,!1,!1,"I","",""," ",0,"L",!1)})}else this._singleSelectGroups=[];else this._singleSelectGroups=b._singleSelectGroups},Reset:function(a,b){f.baseclass.Reset.call(this,a,b),this._limit=g.Answer.Create("NU",null,"(LIMIT)"),this._index=0},Index:function(a){return a===e?this._index:(this._index=a,void 0)},GetNOTAVariable:function(a){return this._singleSelectGroups[a].NOTA},GetLimit:function(a){return a.length>0?this._limit.GetValue(g.RepeatIndices.Pop(a.slice(0))):0},SetLimit:function(a,b){b.length>0&&this._limit.SetValue(a,g.RepeatIndices.Pop(b))}}),f}),define("runtime/optionlist",["hdmain/system"],function(a,b){function c(a){a instanceof c?this.Reset(a):(this.list=a,this.RebuildIndex())}var d=HOTDOC$,e=a.String.IsNullOrEmpty;return this.DEBUG===b&&(this.DEBUG=d.DEBUG),a.ExtendClass(c,null,{Reset:function(a){this.list=a.list,this.idx=a.idx,!1},RebuildIndex:function(){this.idx={};for(var a=0;a<this.list.length;a++)this.idx[this.list[a].name.toUpperCase()]=a},IndexOf:function(a){return"string"!=typeof a&&(a=a.name),a=this.idx[a.toUpperCase()],a===b?-1:a},IndexOfPrompt:function(a){if(!e(a)){a=a.toUpperCase();for(var b=0;b<this.list.length;b++)if(this.list[b].Prompt().toUpperCase()==a)return b}return-1},GetItem:function(a){return"string"==typeof a&&(a=this.idx[a.toUpperCase()]),this.list[a]
},Contains:function(a){return"string"==typeof a?this.idx[a.toUpperCase()]!==b:this.list.indexOf(a)>=0},Count:function(){return this.list.length},FirstOrDefault:function(a){var b,c=null;for(b=0;b<this.Count();b++)if(a(this.GetItem(b))){c=this.GetItem(b);break}return c},Where:function(a){var b,c=[];for(b=0;b<this.Count();b++)a(this.GetItem(b))&&c.push(this.GetItem(b).name);return c},Select:function(a){var b,c=[];for(b=0;b<this.Count();b++)c.push(a(this.GetItem(b)));return c}}),d.McOptL=c,c}),define("engine/runtimeoptionlist",["hdmain/system","runtime/optionlist","hdmain/jq"],function(a,b,c,d){function e(a){e.baseConstructor.call(this,a),this._origOptions=a,this._usingOrig=!0,this._prOps=[],f.call(this)}function f(){var a=this;a._prOps.length>0&&(a._prOps=[]),c.each(a.list,function(b,c){a._prOps.push(c.Copy())})}return a.ExtendClass(e,b,{Reset:function(){var a=e.baseclass.Reset;arguments.length>0?a.call(this,arguments[0]):this._usingOrig||(a.call(this,this._origOptions),this._usingOrig=!0)},PrepareForMod:function(a){this.list=a?this._origOptions.list.slice(0):[],e.baseclass.RebuildIndex.call(this),this._usingOrig=!1},EvaluatePrompts:function(){for(var a=0;a<this.list.length;a++)this.list[a].EvPrompt()},HaveOptionsChanged:function(){var a,b=!1;if(this._prOps.length!=this.list.length)b=!0;else for(a=0;a<this._prOps.length;a++)if(this._prOps[a].name!=this.list[a].name||this._prOps[a].prompt!=this.list[a].prompt){b=!0;break}return b&&f.call(this),b},Add:function(a){this._usingOrig&&this.PrepareForMod(!0),this.list.push(a);var b=a.name.toUpperCase();this.idx[b]===d&&(this.idx[b]=this.list.length-1)},Clear:function(){this._usingOrig?this.PrepareForMod(!1):(this.list=[],this.idx={})},IsReadOnly:function(){return!1},CopyTo:function(a,b){for(var c=0;c<this.list.length;c++)a.splice(b+c,0,this.list[c])}}),e}),define("engine/multiplechoiceinfo",["hdmain/system","system/exception/argumentnullexception","engine/variableinfo","engine/runtimeoptionlist","runtime/optionlist"],function(a,b,c,d,e,f){function g(a){var c,h;if(a===f)g.baseConstructor.call(this,"MC"),this._options=null;else if(a instanceof e){if(c=a,g.baseConstructor.call(this,"MC"),null==c)throw new b("options");this._options=new d(c)}else h=a,g.baseConstructor.call(this,h,!1),this._options=h._options}var h=HOTDOC$;return this.DEBUG===f&&(this.DEBUG=h.DEBUG),a.ExtendClass(g,c,{Options:function(){return this._options},InitializeRuntimeOptions:function(a){this._options=new d(a)}}),g}),define("engine/variableinfostore",["hdmain/jq","hdmain/system","engine/interviewnodetype","engine/dialoginfo","engine/multiplechoiceinfo","engine/variableinfo"],function(a,b,c,d,e,f,g){function h(b){this._varInfo=new a.Dictionary,this._parent=b}function i(a){var c,g,h=this._varInfo.TryGetValue(a.name);if(null!=h)"DI"==a.type?h instanceof d||(h=new d(a,h),this._varInfo.a[a.name]=h):"MC"==a.type&&(c=b.Cast(h,e),null==c.Options()&&c.InitializeRuntimeOptions(b.Cast(a,l.McVar).opts));else if(null!=this._parent)g=this._parent.GetInfo(a),h=g instanceof d?new d(g):g instanceof e?new e(g):new f(g,!1),this._varInfo.Add(a.name,h);else{switch(a.type){case"DI":h=new d(a);break;case"MC":h=new e(a.opts);break;default:h=new f(a.valType)}this._varInfo.Add(a.name,h)}return h}function j(a){var b,c=null;return c=this._varInfo.TryGetValue(a),null!=c?c:(null!=this._parent&&(b=this._parent.GetInfo(a),null!=b&&(c=b instanceof d?new d(b):b instanceof e?new e(b):new f(b,!1))),c)}function k(c,d){var e,f=this.GetInfo(c);f.AddedToInterview(d),"DI"==c.type&&(e=this,a.each(c.vList.list,function(a,c){c instanceof l.DlgEl||k.call(e,b.Cast(c,l.Variable),d)}))}var l=HOTDOC$;return this.DEBUG===g&&(this.DEBUG=l.DEBUG),b.ExtendClass(h,null,{GetAll:function(){var b=this._varInfo,c={};return a.each(b.a,function(a,b){c[a]=b}),null!=this._parent&&a.each(this._parent.GetAll(),function(a,d){b.ContainsKey(d.Key)||(c[a]=d)}),c},Reset:function(a,b){var c,d;for(c=0;c<this._varInfo.Keys.length;c++)d=this._varInfo.a[this._varInfo.Keys[c]],d.Reset(a,b)},RegisterValueType:function(a,b){var c=this._varInfo.TryGetValue(a);if(null!=c){if(c.ValueType()!=b)return}else null!=this._parent?c=this._parent.RegisterValueType(a,b):(c="MC"==b?new e:new f(b),this._varInfo.Add(a,c));return c},GetInfo:function(a){return a instanceof l.Variable?i.call(this,a):j.call(this,a)},SetAddedToInterview:function(a){k.call(this,a,!0)},ClearAddedToInterview:function(a){if(a._type==c.Iteration){var b,d=a.Children();for(b=0;b<d.Count();b++)k.call(this,d.get(b).Variable(),!1)}else k.call(this,a.Variable(),!1)}}),h}),define("engine/interviewnodepath",["system/exception/invalidoperationexception","hdmain/system","system/exception/argumentnullexception","engine/baseinterviewnode","engine/interviewnodetype","engine/interviewnode","engine/iterationnode"],function(a,b,c,d,e,f,g,h){function i(a){if(null==a)throw new c("node");this._hash=0,a.Type()!=e.Root&&j.call(this,a,0,0)}function j(a,c,d){var h,i,k,l;if(a.Type()!=e.Root)j.call(this,a._parent,c+1,a.Type()==e.Iteration?d+1:d),a._type==e.Iteration?(k=b.Cast(a,g),l=this._indices.length-d-1,this._indices[l]=l<k._indices.length?k._indices[l]:0,i=k._iterationId,!1):i=b.Cast(a,f).Variable().name,this._path.push(i);else for(this._path=[],this._indices=[],h=0;d>h;h++)this._indices[h]=0}function k(b,c,d,e){if(null==d||b==this._path.length)return d;var f,g,h=this._path[b];if(f=parseInt(h),!isNaN(f)){if(f=this._indices[c],g=d.Children().Count(),0==g)throw new a(l.Lc.GetStr("err_zeroiter"));return f>=g?e?d.Children().get(g-1):null:k.call(this,++b,++c,d.Children().get(f),e)}return k.call(this,++b,c,d.Children().get(h),e)}var l=HOTDOC$;return this.DEBUG===h&&(this.DEBUG=l.DEBUG),b.ExtendClass(i,null,{Path:function(){return this._path},Indices:function(){return this._indices},IsEmpty:function(){return null==this._path},DialogName:function(){for(var b=this._path.length;b>0&&"number"==typeof this._path[--b];);if(b>=0)return this._path[b];throw new a(l.Lc.GetStr("err_invldloc"))},FindNode:function(a,b){if(null==a)throw new c("rootNode");return k.call(this,0,0,a,b)},OffsetIndex:function(a,b){this._indices[b]+=a},Equals:function(a){var c,d=b.Cast(a,i);if(null!=d){if(d.GetHashCode()!=this.GetHashCode())return!1;if(d.IsEmpty()||this.IsEmpty())return d.IsEmpty()&&this.IsEmpty();if(d._path.length!=this._path.length)return!1;for(c=0;c<this._path.length;c++)if(d._path[c]!=this._path[c])return!1;return!0}return this==a},GetHashCode:function(){if(0==this._hash&&null!=this._path)for(var a=0;a<this._path.length;a++)this._hash=this._hash^this._path[a].GetHashCode();return this._hash}}),i}),define("engine/dialogitemnodeerror",["hdmain/system"],function(a){function b(a,b){this.ItemNode=a,this.ErrorValue=b}var c=HOTDOC$,d=a.Cast;return a.ExtendClass(b,null,{GetErrorMessage:function(){var a,b,e,f,g=this.ItemNode.DialogItem(),h=c.Lc;if("DA"==g.type)return h.GetStr("val_invdate");if("NU"==g.type){if(a=h.ParseNumber(this.ErrorValue),isNaN(a))return h.GetStr("val_invnum");if(b=d(g,c.NuVar),e=0!=b.max,f=e||0!=b.min,e&&f)return h.GetStr("val_numrng",h.FormatNumberDef(b.min,b.decPl),h.FormatNumberDef(b.max,b.decPl));if(e)return h.GetStr("val_numlt",h.FormatNumberDef(b.max,b.decPl));if(f)return h.GetStr("val_numgt",h.FormatNumberDef(b.min,b.decPl))}return""}}),b}),define("engine/refreshinterviewprogresseventargs",[],function(){function a(a,b,c,d){this.aq=a,this.tq=b,this.ru=c,this.et=d}return a}),define("engine/navigatedeventargs",[],function(){function a(a,b){this.f=a,this.s=b}return a}),define("engine/pagemodechangingeventargs",[],function(){function a(a){this.Mode=a}return a}),define("engine/refreshintervieweventargs",[],function(){function a(a,b,c,d,e,f){this.UpdateFlags=a,this.CurrentNodeChanged=b,this.FullUpdateTime=c,this.DialogUpdateTime=d,this.UsageUpdateTime=e,this.StatusUpdateTime=f}return a}),define("engine/interview",["hdmain/system","hdmain/jq","hdmain/stack","system/exception/invalidoperationexception","system/dispatchertimer","system/exception/targetinvocationexception","system/exception/argumentnullexception","system/exception/argumentexception","engine/variableinfostore","engine/indexedvariableinfoflags","engine/variableinfoflags","engine/interviewnodepath","engine/interviewnodetype","engine/valuechangetype","engine/dialoginfo","engine/dialogitemnodeerror","engine/dialogupdateflags","engine/interviewnode","engine/dialognode","engine/iterationnode","engine/refreshinterviewprogresseventargs","engine/navigatedeventargs","engine/movefocuseventargs","engine/pagemodechangingeventargs","engine/refreshintervieweventargs"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){function A(a,b){var c,d,e,f,g,h,i,j=null,k={};if(U(b.v)||(j=this._varInfo.GetInfo(b.v)),null==this._root||null==j)return this._interviewTriggered=!0,this._dialogTriggered=!0,void 0;if(this._inInterview||(j.InterviewTrigger()||0==j.DialogItemNodes().length?this._interviewTriggered=!0:0!=(this._root.DescendantUpdateflags()&q.RepeatAnswer)&&(this._interviewTriggered=!0),this._inDialog||(j.DialogTrigger()?this._dialogTriggered=!0:j instanceof o&&(this._dialogTriggered=!0))),j.DialogItemNodes().length>0)for(c=0;c<j.DialogItemNodes().length;c++)if(d=j.DialogItemNodes()[c],O.RepeatIndices.AreEquivalent(d._parent.Indices(),b.i)&&(e=this.InRebuild()||this._scriptStack.Count()>0||this.InBulkAnswerChange()?q.ScriptAnswer:q.UserAnswer,d.Required()&&(e|=q.RequiredAnswer),d.SetUpdateFlags(e),"TF"==j.ValueType()&&j instanceof o&&(f=!1,b.t!=n.BecameUnanswered&&O.Answers.TryGetAnswer(b.v,k)&&(g=k.v.GetValue(b.Indices),null!=g&&(f=g)),d._parent.Children().Count()>0&&d._parent.Children().get(b.v).Active(f)),d._parent.Type()==m.Iteration||d._parent.Type()==m.Dialog&&d._parent.Indices().length>0)){h=null,i;do h=null==h?d._parent:S(h._parent,r),i=h.AnsStatus().IsAnswered(),h.TabulateAnsweredStatus();while(i!=h.AnsStatus().IsAnswered()&&h.Type()!=m.Iteration);h.Type()==m.Iteration&&i!=h.AnsStatus().IsAnswered()&&(this._interviewTriggered=!0)}!this.InBulkAnswerChange()&&!this.Suspended()&&0==this._templateProcessingDepth&&this.Update()}function B(a){return 0>a||a>=this._pathCache.length?null:this._pathCache[a]}function C(){var a,c;if(!this._refreshDialogTimer.IsEnabled()){for(this._focusTimer.Stop(),a=0;a<this._focusEnterQueue.length;a++)c=this._focusEnterQueue[a],c.ItemNode.OnFocusEntering(c.OptionName,c.Direction),c.ItemNode.IsSpreadsheet()||b(this).trigger("MoveFocus",c.ItemNode,c);this._focusEnterQueue=[]}}function D(a,c){b(this).trigger("Navigated",new v(a,c))}function E(){M=R.TickCount(),this._inUsagePass=!0,this._varInfo.Reset(k.None,j.Used),this.PrepareForFullUpdate();var a=this.ProcessScript(this._engine.RootTemplateName(),this._engine.RootAssemblyName(),null);return this._inUsagePass=!1,M=R.TickCount()-M,a}function F(a){var b,c,d,e,f,g,h,i,j,k;for(b=0;b<a.Children().Count();b++)c=a.Children().get(b),F.call(this,c);if(a.Type()!=m.Root&&(d=!1,a instanceof r&&(d=a._dialog.hideIfUn),d)){if(e=!0,f=a,a.Type()==m.Repeat){for(b=0;b<f.Children().Count();b++)c=f.Children().get(b),e=e&&c.AutoHidden();f.AutoHidden(e)}else{for(g=!1,b=0;b<f._itemNodes.Count()&&(h=f._itemNodes.get(b),!(h.DialogItem()instanceof O.Variable)||(g=!0,i=this._varInfo.GetInfo(h.DialogItem().name),e=e&&(h.Gray()||h.Hidden()||"DI"!=h.DialogItem().type&&!i.GetUsed(f.Indices())),e));b++);f.AutoHidden(e&&g)}f._parent instanceof s&&(j=f._parent,k=j._dialog,this._templateStack.Push(j.TemplateOfOrigin()),this.PsS(k.name,"D"),this.AutoHideVar(f._dialog.name,f.AutoHidden()),this.PpS(),this._templateStack.Pop()!=j.TemplateOfOrigin()&&!1,j._itemNodes.get(f._dialog.name).AfterScriptEvaluation())}}function G(a){if(null==a)throw new g("intNode");var b,c,e,f;for(this._templateStack.Push(a.TemplateOfOrigin()),this._templateProcessingDepth++,this._outlineStack.Push(a.AskedImplicitly()?a.Owner():a._parent),this._varInfo.ClearAddedToInterview(a),b=a._parent,b.Children().PrepareToUpdate(a),c={startIndex:0,endIndex:0},e=null,a.FindNodesAskedImplicitly(c),b.Type()!=m.Root&&(e=this._root.Children().get(c.endIndex)),this._root.Children().PrepareToUpdate(c.startIndex),f=c.startIndex;f<c.endIndex;f++)this._varInfo.ClearAddedToInterview(this._root.Children().get(f));if(this.InRpt())throw new d("Error: Repeat stack should be empty.");this.SyncRepeatStackWithNode(a),this.DefineInterviewNode(a.Variable(),a.AskedImplicitly(),a.Type()==m.Iteration&&a.New()),b.Type()!=m.Root&&this._root.Children().RemoveUntil(e),b.Children().FinishUpdating(),this._root.Children().FinishUpdating(),a.SendUpdateFlagsUpstream(q.All,!0),this.ClearRpt(),this._outlineStack.Pop(),this._templateProcessingDepth--,this._templateStack.Pop()}function H(){var a=R.TickCount();this._reqNodeOld=this._reqNode,this._errNodeOld=this._errNode,this._reqNode=null,this._reqNodeWasSet=!1,this._errNode=null,this._errNodeWasSet=!1,this._root.UpdateAnsweredStatus(!1),!this._reqNodeWasSet&&null!=this._reqNodeOld&&this._reqNodeOld.RequiredIsEnforcable()&&(this._reqNode=this._reqNodeOld),!this._errNodeWasSet&&null!=this._errNodeOld&&(this._errNode=this._errNodeOld),b(this).trigger("RefreshInterviewProgress",new u(this.AnsweredCount(),this.TotalCount(),null!=this._reqNode,null!=this._errNode)),N+=R.TickCount()-a}function I(){for(var a=0;W>a;a++)this._paraNum[a]=0}function J(){var a,b=this.FirstRootChild();return null!=b?(a=this._newNodeId<=0?b:null==this._curNode||this._curNode._id!=this._newNodeId?this.FindDialogByID(this._newNodeId,!0):this._curNode,null==a&&(a=b),a!=this._curNode&&(a.Type()==m.Repeat&&(a=S(a,O.RepeatNode).GetFirstFocusableNode()),this._curNode=a),this._newNodeId<=0&&this._curNode.DoImplicitAnswerProcessing(),this._newNodeId=this._curNode._id):this._curNode=null,null==this._curNode?(this._newNodeId=-1,this.IsPopup()||this._engine.SetError(this.GetResourceString("err_noint")),!1):!0}var K,L,M,N,O=HOTDOC$,P=b.proxy,Q="Engine",R=a.Environment,S=a.Cast,T=a.String.Format,U=a.String.IsNullOrEmpty,V=O.PageMode={NormalPaged:0,SinglePage:1},W=9;O.PartialClass("Interview",Q,{Suspended:function(){return O.CurrentInterview()!=this},IsPopup:function(){return!U(this._computationName)},Navigator:function(){return this._navigator},ProgressBarEnabled:function(){return this._engine.ProgressBarEnabled},IsFirstEnabled:function(){return this._navigator.First!=this.CurrentOutlineNode()},IsPreviousUnansEnabled:function(){return null!=this._navigator.PreviousUnanswered},IsPreviousEnabled:function(){return null!=this._navigator.Previous},IsNextEnabled:function(){return!0},IsNextUnansEnabled:function(){return null!=this._navigator.NextUnanswered},IsLastEnabled:function(){return this._navigator.Last!=this.CurrentOutlineNode()},InEditSpreadsheetRow:function(){var a=this.CurrentNode();return null!=a&&a.Type()==m.Iteration&&a.IsSpreadsheetRowInEditMode()},PreferenceCache:function(){return this._engine.PreferenceCache()},BeginBulkAnswerChange:function(){this._engine.BeginBulkAnswerChange()},EndBulkAnswerChange:function(a){this._engine.EndBulkAnswerChange(a)},InBulkAnswerChange:function(){return this._engine.InBulkAnswerChange()},IsProcessing:function(){return this._templateProcessingDepth>0},GetIdForNode:function(a){var b=new l(a),c=this._pathIndex.TryGetValue(b);return null===c&&(c=this._pathCache.length,this._pathCache.push(b),this._pathIndex.Add(b,c)),c},OffsetIndicesForId:function(a,b,c){B.call(this,a).OffsetIndex(b,c)},GetRuntimeOptionsForVariable:function(a){var b=this._varInfo.GetInfo(a);return b.Options()},GetNOTAProxyForDialog:function(a,b){var c=this._varInfo.GetInfo(a);return c.GetNOTAVariable(b)},RegisterNode:function(a){var b,c,d=this._varInfo.GetInfo(a.Variable()),e=a._dialog.vList;for(d._interviewNodes.push(a),b=0;b<e.Count();b++)c=S(e.GetItem(b),O.Variable),null!=c&&(d=this._varInfo.GetInfo(c),d._dialogItemNodes.push(a._itemNodes.get(b)))},UnregisterNode:function(a){if(null!=a){var b,c,d,e;for(c=0;c<a._dialog.vList.Count();c++)if(d=S(a._dialog.vList.GetItem(c),O.Variable),null!=d){for(e=0;e<this._validationErrors.length;e++)if(this._validationErrors[e].ItemNode==a._itemNodes.get(c)){this._validationErrors.splice(e,1);break}for(b=this._varInfo.GetInfo(d),e=0;e<b.DialogItemNodes().length;e++)if(b.DialogItemNodes()[e]==a._itemNodes.get(c)){b.DialogItemNodes().splice(e,1);break}}for(b=this._varInfo.GetInfo(a.Variable()),e=0;e<b.InterviewNodes().length;e++)if(b.InterviewNodes()[e]==a){b.InterviewNodes().splice(e,1);break}}},AddDialogItemNodeError:function(a,b){var c,d,e,f=!0;for(d=0;d<this._validationErrors.length;d++)if(c=this._validationErrors[d],c.ItemNode==a){c.ErrorValue=b,f=!1;break}f&&(e=new p(a,b),this._validationErrors.push(e),a.OnChangeErrorState(e))},RemoveDialogItemNodeError:function(a){var b,c;for(b=0;b<this._validationErrors.length;b++)if(c=this._validationErrors[b],c.ItemNode==a)return this._validationErrors.splice(b,1),a.OnChangeErrorState(null),!0;return!1},HasValidationErrors:function(){return this._validationErrors.length>0},GetErrorText:function(a,b,c){b===z&&(b=null!=this.ErrorNode()),c===z&&(c=null!=this.RequiredNode());var d="";return b&&(d+=O.Lc.GetStr("val_dlg_err"+a,this.ErrorNode().Caption(),this.ErrorNode().ErrorText)),c&&(b&&(d+="\r\n\r\n"),d+=O.Lc.GetStr("val_req"+a,this.RequiredNode().Caption())),d},GetErrorValue:function(a){for(var b=0;b<this._validationErrors.length;b++)if(this._validationErrors[b].ItemNode==a)return this._validationErrors[b].ErrorValue;return null},GetValueType:function(a){var b,c=this._varInfo.GetInfo(a),d="UN";return null==c?(b=this.GetComponentSafe(a),null!=b&&(d=b.valType)):d=c.ValueType(),d},VarIsMarked:function(a){var b=this._varInfo.GetInfo(a);return null!=b?b.Marked():!1},SetValueType:function(a,b,c){var d=this._varInfo.RegisterValueType(a,b);c&&d.Marked(!0)},ResourcePaneInitialHeight:function(){return O.ResourcePaneInitialHeight},GetResourceString:function(a){return O.Lc.GetStr(a)},Answers:function(){return this._engine.Answers},CurrentTemplate:function(){return this._templateStack.Peek()},CurrentNode:function(){return this._curNode},CurrentNodeId:function(){return this._newNodeId},CurrentOutlineNode:function(){if(null!=this._curNode){if(this._curNode.IsSpreadsheetRowInEditMode())return this._curNode;if(this._curNode.IsSpreadsheetRow())return S(this._curNode._parent,O.RepeatNode).IsOnParent()?S(this._curNode._parent._parent,r):S(this._curNode._parent,r)}return this._curNode},RequiredNode:function(){return this._reqNode},ErrorNode:function(){return this._errNode},SetRequiredNode:function(a){a!=this._reqNodeOld&&(null!=a&&a.SetUpdateFlags(q.NodeRequired),null!=this._reqNodeOld&&this._reqNodeOld.SetUpdateFlags(q.NodeRequired)),this._reqNode=a,this._reqNodeWasSet=!0},SetErrorNode:function(a){null!=a&&a.SetUpdateFlags(q.NodeError|q.HasError),a!=this._errNodeOld&&null!=this._errNodeOld&&this._errNodeOld.SetUpdateFlags(q.NodeError|q.HasError),this._errNode=a,this._errNodeWasSet=!0},CurrentBuildNode:function(){if(!this.InRebuild())throw new d(O.Lc.GetStr("err_retrvbn"));return this._outlineStack.Peek()},InRebuild:function(){return this._outlineStack.Count()>0},InFullRebuild:function(){return this._inInterview},Root:function(){return this._root},SinglePageReturnId:function(){return this._ancestorOnSinglePage.v},NextFollowsOutline:function(){return this._engine.NextFollowsOutline},TriggerFocusEnter:function(a,b,c){a.IsSpreadsheet()||this.SetFocusNode(a._parent),this._focusEnterQueue.push(new w(a,b,c)),this._focusTimer.Start(this)},SetFocusNode:function(a){(this._curNode!=a||this._newNodeId!=a._id)&&(this._prevNodeId=this._newNodeId,this._curNode=a,this._newNodeId=a._id,this._curNode.DoImplicitAnswerProcessing())},GetFocusItem:function(){var a=null,b=this.CurrentNode();return null!=b&&(a=b.GetFocusedItemNode()),a},ClearFocusItem:function(){var a=this.CurrentNode();null!=a&&a.ClearFocusedItemNode()},IgnoreNextFocus:function(){this._ignoreNextSetFocus=!0},IgnoringNextFocus:function(){return this._ignoreNextSetFocus?(this._ignoreNextSetFocus=!1,!0):!1},PrepareForFullUpdate:function(){this._templateStack.Clear(),this._unansStack.Clear(),this._scriptStack.Clear(),I.call(this),this._engine.AskNone(!1),null==this._root&&(this._root=new O.RootNode(this))},TryProcessTemplate:function(a,b){var c=this;c.PrepareForFullUpdate(),c._outlineStack.Push(c._root),c._root.Children().ClearUpdated(),window.setTimeout(function(){c.ProcessScript(a,b,null),c._outlineStack.Pop(),!1},0)},ProcessScript:function(a,b,c){var d,e=!1,f={};if(this._engine.TryGetTemplate(a,b,f)){if(f=f.v,this._templateStack.Count()>20)throw new O.HotDocsIntrinsicException(O.Lc.GetStr("err_insrtlev"));this._templateStack.Push(f),this._templateProcessingDepth++,null==c?this._inUsagePass&&f.HasTemplateInterview()?f.RunTemplateInterview():f.RunInterview():(d=this.GetComponentSafe(c),null!=d&&(this.PsU(),d.EvScr(),this.PpU())),this._templateProcessingDepth--,this._templateStack.Pop(),e=this._engine.CheckForNewInserts()}return e?this._engine.AutoInterviews()&&F.call(this,this._root):this._interviewTriggered=!0,e},CanUpdate:function(){return 0==this._templateProcessingDepth},ClearRpt:function(){for(;O.InR();)O.PpR()},Update:function(a,c){function d(){try{this._inUpdate=!0,this._engine.AutoInterviews()&&this._interviewTriggered&&E.call(this),a?window.setTimeout(P(e,this),0):e.call(this)}catch(b){h.call(this,b)}}function e(){try{this._engine.AllTemplatesLoaded()&&(i=this._interviewTriggered,this._interviewTriggered&&(K=R.TickCount(),this._varInfo.Reset(k.InterviewTrigger|k.DialogTrigger|k.AddedToInterview|k.WasSet,j.None),this.PrepareForFullUpdate(),this._curNode=null,this._inInterview=!0,this._outlineStack.Push(this._root),this._root.Children().ClearUpdated(),this.ProcessScript(this._templateName,this._assemblyName,this._computationName),this._root.Children().Trim(),this._outlineStack.Pop(),this._inInterview=!1,this._engine.AllTemplatesLoaded()?(this._interviewTriggered=!1,this._dialogTriggered=!0):this._prevNodeId>0&&(this._dialogTriggered=!1,this._curNode=this.FindDialogByID(this._prevNodeId,!0)),K=R.TickCount()-K),this._dialogTriggered&&this._engine.AllTemplatesLoaded()&&(L=R.TickCount(),J.call(this)&&(this._inDialog=!0,G.call(this,i?this.CurrentOutlineNode():this._curNode),this._inDialog=!1),this._dialogTriggered=!1,this._interviewTriggered&&!i&&(this._reTriggered=!0),L=R.TickCount()-L)),a?window.setTimeout(P(g,this),0):g.call(this)}catch(b){h.call(this,b)}}function g(){var c;try{this._inUpdate=!1,c=this._reTriggered?function(){this.Update()}:this._engine.AllTemplatesLoaded()?function(){this._engine.OnChangeUIState(p.Ready,null),H.call(this),this._navigator.Update(),null!=this._curNode&&(this._templateStack.Push(this._curNode.TemplateOfOrigin()),this.SyncRepeatStackWithNode(this._curNode)),l=null==this.CurrentOutlineNode()?-1:this.CurrentOutlineNode()._id,m=l!=this._prevOutlineNodeId,b(this).trigger("RefreshOutline",new y(this._root.UpdateFlags()|this._root.DescendantUpdateflags(),m,K,L,M,N)),this._root.ClearUpdateFlags(q.AllOutlineRelated),this.BeginDisplayUpdate(m),this._prevNodeId=this._newNodeId,null!=this._curNode&&(this._prevOutlineNodeId=l),this._engine.OnAfterInterviewUpdate()}:function(){this._engine.OnChangeUIState(p.Busy,O.Lc.GetStr("ui_wait_cmp"))},a?window.setTimeout(P(c,this),0):c.call(this)}catch(d){h.call(this,d)}}function h(a){this._inUpdate=!1,n=a,o=n.message,n instanceof O.HotDocsIntrinsicException||null!=n.InnerException&&(n=n.InnerException,n instanceof f&&null!=n.InnerException&&(n=n.InnerException),o+=" ("+n.message+")"),this._engine.OnChangeUIState(p.Error,o)}a===z&&(a=!1),c===z&&(c=!0),a=!1;var i,l,m,n,o,p=O.UIState;if(!this.Suspended()){for(this._reTriggered?this._reTriggered=!1:(this._engine.OnBeforeInterviewUpdate(),L=0,K=0,M=0,N=0),"boolean"!=typeof this._singlePageMode&&(this._singlePageMode=this._engine.InterviewStack().Count()>1?this._engine.InterviewStack().ElementAt(1).IsSinglePage():this.PreferenceCache().SinglePageOnInitially()),c&&this.ClearRpt();this._templateStack.Count()>0;)this._templateStack.Pop();a?window.setTimeout(P(d,this),0):d.call(this)}},BeginDisplayUpdate:function(a){var b=this;b._dialogRefreshEventArgs=new y(b._dialogRefreshEventArgs.UpdateFlags|b._root.UpdateFlags()|b._root.DescendantUpdateflags(),b._dialogRefreshEventArgs.CurrentNodeChanged||a,K,L,M,N),b._refreshDialogTimer.Interval=b._navigateInProgress&&(new Date-b._lastDialogRefresh).TotalMilliseconds<300?300:0,b._refreshDialogTimer.Start(b),b._lastDialogRefresh=new Date},_refreshDialogTimer_Tick:function(){this._refreshDialogTimer.Stop(),b(this).trigger("RefreshDialogContent",this._dialogRefreshEventArgs),this._dialogRefreshEventArgs.UpdateFlags=q.None,this._dialogRefreshEventArgs.CurrentNodeChanged=!1,this._root.ClearUpdateFlags(q.All),this._navigateInProgress&&D.call(this,this._moveFocus,this._performScroll),this._moveFocus=!0,this._performScroll=!0,this._navigateInProgress&&(this._navigateInProgress=!1,this._engine.DoNavigatedJSAPI(this.CurrentOutlineNode()))},AddToVarUsageList:function(a,b){this._varInfo.GetInfo(a).SetUsed(!0,b),null!=a.parent&&this._varInfo.GetInfo(a.parent).SetUsed(!0,b)},SyncRepeatStackWithNode:function(a){if(null==a)throw new g("intNode");var b=S(a._parent,r);null!=b&&this.SyncRepeatStackWithNode(b),a.Type()==m.Iteration&&(this.PushRpt(a.Variable().name),this.CurrentIndex(a.Indices()[a.Indices().length-1]))},WantProgressNotifications:function(){return this.wantsprog?!0:!1},UnansweredCount:function(){return null!=this.Root()?this.Root().AnsStatus().UnansweredCount():1},AnsweredCount:function(){return null!=this.Root()?this.Root().AnsStatus().AnsweredCount():0},TotalCount:function(){return null!=this.Root()?this.Root().AnsStatus().TotalCount():1},HasRequiredUnansweredQuestions:function(){return null!=this._reqNode},HasErrorText:function(){return null!=this._errNode},Progress:function(){return"{"+T('"Answered":{0},"Total":{1},"State":{2}',this.AnsweredCount(),this.TotalCount(),this.HasRequiredUnansweredQuestions()?2:this.AnsweredCount()>=this.TotalCount()?0:1)+"}"},FirstRootChild:function(){for(var a=null,b=0;b<this._root.Children().Count()&&(a=this._root.Children().get(b),!a.ShowInOutline());)a=null,b++;return a},FindDialogByID:function(a,b){if(null!=a){var c,d,e,f,g,h=null;if(c=B.call(this,a),d=c.DialogName(),e=this._varInfo.GetInfo(d),e instanceof o){for(g=e.InterviewNodes().length,f=0;g>f&&e.InterviewNodes()[f]._id!=a;f++);g>f&&(h=e.InterviewNodes()[f])}else 0!=e.InterviewNodes().length&&(h=e.InterviewNodes()[0]);return null==h&&(h=S(c.FindNode(this._root,b),r)),h}},SetPageMode:function(a,c,d){if(this.HasValidationErrors())return c=O.Lc.GetStr("val_err"),!1;var e=null!=this.GetFocusItem();return this._singlePageMode=a==V.SinglePage,b(this).trigger("PageModeChanging",new x(a)),a==V.SinglePage?(this._curNode.IsSpreadsheetRowInEditMode()&&(S(this._curNode,t).EndRowEdit(),d&&this.GotoDialog(S(this._curNode.Parent,O.RepeatNode),c,e,!0,function(a){return a?void 0:!1})),this._root.DirtySinglePage()):(this._curNode.SetUpdateFlags(q.All),this._curNode.SendUpdateFlagsUpstream(q.All,!0)),this.ForgetLocation(),d&&(this._navigateInProgress=!0,this._moveFocus=e),c.s="",!0},ForgetLocation:function(){this._prevOutlineNodeId=-1},IsSinglePage:function(){return"boolean"==typeof this._singlePageMode?this._singlePageMode:!1},DoAnswerSync:function(){this._engine.DoAnswerSync()},GotoNext:function(a,c){var d=this.CurrentOutlineNode(),e=O.Lc;return a={s:a},null!=this.Navigator().Next&&!this.Navigator().CanProceedToNext(a)||null==this.Navigator().Next&&!this.Navigator().CanProceedToLast(a)?(c(!1,a.s),void 0):d!=this.Navigator().Last||this.IsRowEdit()?(this.GotoDialog(this.Navigator().Next,a,!0,null,c),void 0):this.IsPopup()?(this.Finish(a.s,c),void 0):this.HasValidationErrors()?(a.s=e.GetStr("val_err"),c(!1,a.s),void 0):null!=this.RequiredNode()||null!=this.ErrorNode()?(a.s=this.GetErrorText("p"),c(!1,a.s),void 0):((O.DisableFinishWarning||O.Confirm((this.AnsweredCount()<this.TotalCount()?e.GetStr("nav_warnfin_unans",this.TotalCount()-this.AnsweredCount()):e.GetStr("nav_warnfin"))+"\r\n"+e.GetStr("nav_warnfin_ok")))&&this._engine.OnInterviewComplete()&&b(this).trigger("Closing",{}),c(!0,""),void 0)},GotoPrev:function(a,b){null!=this.Navigator().Previous&&this.GotoDialog(this._engine.Navigator().Previous,"",!0,null,b)},GotoNextUnans:function(a,b){this.Navigator().CanProceedToNextUnanswered(a)?this.GotoDialog(this.Navigator().NextUnanswered,a,!0,null,b):(a.s=this._engine.ResolveDotCodes(a.s),b(!1,a.s))},GotoPrevUnans:function(a,b){this.GotoDialog(this.Navigator().PreviousUnanswered,a,!0,null,b)},GotoFirst:function(a,b){this.GotoDialog(this.Navigator().First,a,!0,null,b)},GotoLast:function(a,b){this.Navigator().CanProceedToLast(a)?this.GotoDialog(this.Navigator().Last,a,!0,null,b):(a.s=this._engine.ResolveDotCodes(a.s),b(!1,a.s))},Finish:function(a,c,d){var e,f,g,h,i=O.Lc.GetStr;if("boolean"==typeof a?(e=a,f=c,g=d):(e=!1,f=a,g=c),this.IsPopup()){if(!e){if(this.HasValidationErrors())return f.s=i("val_err"),g(!1,f.s),void 0;if(null!=this.RequiredNode()||null!=this.ErrorNode())return f.s=this.GetErrorText("p"),g(!1,f.s),void 0}return b(this).trigger("Closing",{}),O.Answers.AnswerChanged.pop(),this._engine.InterviewStack().Pop(),O.CurrentInterview().Update(),g(!0,""),void 0}return h=this.CurrentOutlineNode(),null!=h&&h.Type()==m.Iteration&&h.IsSpreadsheetRowInEditMode()?(h=h._parent.ShowInOutline()?S(h._parent,r):S(h._parent._parent,r),this.GotoDialog(h,f.s,!0,null,g),void 0):!O.DisableFinishWarning&&this.AnsweredCount()<this.TotalCount()&&!O.Confirm(i("nav_warnfin_unans",this.TotalCount()-this.AnsweredCount())+"\r\n"+i("nav_warnfin_ok"))?(g(!1,""),void 0):(this._engine.DoPreNavigateJSAPI(null!=h?h.Variable().name:"","{Finish Button}",f.s,P(function(a,c){if(f={s:c},a){if(null!=h){if(null!=this.RequiredNode()||null!=this.ErrorNode())return f.s=this.GetErrorText("g"),g(!1,f.s),void 0;if(!this.Navigator().CanProceedToLast(f))return g(!1,this._engine.ResolveDotCodes(f.s)),void 0}this._engine.OnInterviewComplete()&&b(this).trigger("Closing",{}),g(!0,"")}else g(!1,f.s)},this)),void 0)},IsRowEdit:function(){var a=this.CurrentNode();if(null!=a){if(a.Type()==m.Iteration&&S(a,t).IsSpreadsheetRowInEditMode())return!0;if(a.Type()==m.Repeat&&S(a,O.RepeatNode).IsSpreadsheet())return S(a,O.RepeatNode).EditRowMode()}return!1},GotoDialog:function(a,b,c,d,e){if("boolean"!=typeof d&&(d=!0),a===z)throw new g("target");var f,h,i,j=this.CurrentOutlineNode();return j!==z&&this.DoAnswerSync(),!this.HasValidationErrors()||this.IsSinglePage()&&(j===z||j.OnSinglePage()&&a.OnSinglePage())?(this._engine.DoPreNavigateJSAPI(j.Variable().name,a.Variable().name,b,P(function(g,k){if(!g)return e(!1,k),void 0;if(j!==z&&(j.ClearFocusedItemNode(),j.Type()==m.Iteration&&a._parent!=j._parent&&S(j._parent,O.RepeatNode).EditRowMode()&&S(j._parent,O.RepeatNode).ClearEditRowMode()),a.Type()==m.Repeat?a=S(a,O.RepeatNode).GetFirstFocusableNode():a.Type()==m.Iteration&&S(a._parent,O.RepeatNode).EditRowMode()&&S(a._parent,O.RepeatNode).SetEditRow(S(a,t).IterationNumber()),this._newNodeId=a._id,this.IsSinglePage()){if(a.HasAncestorOnSinglePage(this._ancestorOnSinglePage)&&!this.SetPageMode(V.NormalPaged,b,!1))return e(!1),void 0}else if(0!=this._ancestorOnSinglePage.v&&(f=!0,a.ID!=this._ancestorOnSinglePage.v&&a.HasAncestorOnSinglePage(this._ancestorOnSinglePage)&&(f=!1),f)){if(!this.SetPageMode(V.SinglePage,b,!1))return e(!1),void 0;this._ancestorOnSinglePage.v=0}this._newNodeId!=this._prevNodeId&&(this._navigateInProgress=!0,this._dialogTriggered=!0,a.DoImplicitAnswerProcessing(),h=j.NewIterationNode(),null!=h?(h.IterationNumber()>0?(h.NotifyParentOfChildCountChange(!0),i=h._parent.Children().get(h._parent.Children().Count()-2)):i=h,i.SetUpdateFlags(q.AddButtonRefresh)):null==h&&j.Type()==m.Iteration&&S(j,t).IterationNumber()>=j._parent.Children().Count()&&(j._parent.Children().get(j._parent.Children().Count()-1).SetUpdateFlags(q.AddButtonRefresh),j.NotifyParentOfChildCountChange(!0)),a.IsHiddenNew()&&(a.SetUpdateFlagsCascading(q.NewlyAdded|q.NodeChildCount|q.ChildCount),a.NotifyParentOfChildCountChange(!0),a.Type()==m.Iteration&&S(a,t).IterationNumber()>0&&a._parent.Children().get(a._parent.Children().Count()-2).SetUpdateFlags(q.AddButtonRefresh))),this._moveFocus=c,this._performScroll=d,this.Update(),b.s="",e.call(this.CurrentNode(),!0)
},this)),void 0):(b.s=O.Lc.GetStr("val_err"),e(!1),void 0)},GetBookmark:function(){var a=this.CurrentOutlineNode(),b=a.GetFocusedItemNode();return null!=b?b._parent.GenerateBookmark():a.GenerateBookmark()},GotoBookmark:function(a){if(!this.refrshevt)return this.QueuedBookmark=a,void 0;if(this.QueuedBookmark=null,!U(a)){var c,d,e,f,g,h,i,j,k=a.split("|"),l=this._varInfo.GetInfo(k[0]);if(null!=l){if(e=!1,c=parseInt(k[1]),k.length>1&&!isNaN(c))for(d=[],f=2;f<k.length;f++)d[f-2]=parseInt(k[f]),isNaN(d[f-2])&&(e=!0);else c=-1,d=[];e||(g=null,b.each(l.InterviewNodes(),function(a,b){O.RepeatIndices.AreEquivalent(d,b.Indices())&&(g=b)}),null!=g&&(h=g.IsOnParent(),i=c>=0&&c<g._itemNodes.Count(),j={s:null},this.GotoDialog(h?S(g._parent,r):g,j,!i,null,P(function(a){a?i&&this.TriggerFocusEnter(g._itemNodes.get(c),null,O.FocusDirection.Forward):O.Alert(j)},this))))}}},ProcessComputationScript:function(a,b){this.BeginBulkAnswerChange();var c=new O[Q].Interview(this._engine,b.name,b.AssemblyName,a,this._varInfo);return c._repeatStack=this._repeatStack,this._engine.InterviewStack().Push(c),c.Update(!1,!1),null==c.CurrentOutlineNode()?(this._engine.InterviewStack().Pop(),c=null,this._dialogTriggered=!0,this.EndBulkAnswerChange(!1),this.Update()):(this.EndBulkAnswerChange(!1),this._interviewTriggered=!0),c},Close:function(){if(this.IsPopup()){var a={s:null};this.Finish(!0,a,function(){})}},GetComponent:function(a){var b=this.GetComponentSafe(a);if(null==b)throw new h(T(O.Lc.GetStr("err_nocmp"),a));return b},GetComponentSafe:function(a){var b,c=null;for(b=0;b<this._templateStack.a.length&&(c=this._templateStack.a[b].GetComponentSafe(a),null==c);b++);return c},PushTemplate:function(a){this._templateStack.Push(a)},PopTemplate:function(){this._templateStack.Pop()}},function(b,d,f,g,h){this._itvID=a.Guid.NewGuid(),this._engine=b,O.Answers.AnswerChanged.push(P(A,this)),this._templateName=d,this._assemblyName=f,this._computationName=g,this._interviewTriggered=!0,this._dialogTriggered=!1,this._reTriggered=!1,this._newNodeId=this._prevNodeId=this._prevOutlineNodeId=-1,this._curNode=this._reqNode=this._errNode=null,this._reqNodeWasSet=!1,this._errNodeWasSet=!1,this._varInfo=new i(h),this._validationErrors=[],this._pathCache=[],this._pathIndex=new O.jq.Dictionary,this._templateStack=new c,this._unansStack=new c,this._scriptStack=new O.ScriptStack,this._repeatStack=new O.RepeatStack,this._outlineStack=new c,this._paraNum=[],this._ancestorOnSinglePage={v:0},this._navigator=new O.Navigator(this),this._refreshDialogTimer=new e,this._refreshDialogTimer.Tick=this._refreshDialogTimer_Tick,this._moveFocus=!0,this._performScroll=!0,this._navigateInProgress=!0,this._dialogRefreshEventArgs=new y(q.None,!1,0,0,0,0),this._focusTimer=new e,this._focusTimer.Tick=P(C,this),this._focusEnterQueue=[],this._templateProcessingDepth=0},function(){})}),define("engine/InterviewNodeType",[],{Root:0,Dialog:1,DefaultDialog:2,Repeat:3,Iteration:4}),define("engine/defaultdialognode",["hdmain/system","system/exception/argumentnullexception","engine/interviewnodetype","engine/interviewnode","engine/interviewnodelist"],function(a,b,c,d,e,f){function g(a,b){var d=[0];g.baseConstructor.call(this,a,c.DefaultDialog,a.Root(),new i.Dlg(b.name,null,null,null,null,0,0,"c",0,!0,!1,!0,"G","",""," ",0,"l",new i.DiList([b]),null,"",!1,!1,!0,null,null,10,"",!1,"T",!1,12,!0,!1,!1,!1,d,null,null),null,null),this._itemNodes=new i.DialogItemNodeList(1),this._itemNodes.Add(b.name,this,0),this._interview.RegisterNode(this),this.InitializeId()}var h,i=HOTDOC$,j=a.String.IsNullOrEmpty;return a.ExtendClass(g,d,{Variable:function(){return a.Cast(this._dialog.vList.GetItem(0),i.Variable)},DoAnsweredStatusTabulation:function(){this._answeredStatus.Reset();var a=this.Variable();this.VariableHasAnswer(a)?this._answeredStatus.IncAnswered(a.warnUna,!1,!1):this._answeredStatus.IncUnanswered(a.warnUna,!1)},EvTitle:function(){var a=this.Variable().EvTitle();return j(a)&&(a=d.TrimForUseAsTitle(this.Variable().EvPrompt()),"NONE"==a&&(a=this.Variable().name)),a},SerializeElements:function(a){this._itemNodes.get(0).Serialize(a),base.SerializeElements(a)}},{CreateOrLocate:function(e,f,h){if(null==e)throw new b("interview");if(null==f)throw new b("variable");var i=e.CurrentBuildNode()!=e._root?a.Cast(e.CurrentBuildNode(),d):null,j=a.Cast(e._root.Children().FindExisting(f.name,c.DefaultDialog,i,e.CurrentTemplate()),g);return null==j?(j=new g(e,f),h.v=!0):h.v=!1,j.InitUpdate(),j},_emptyChildren:function(){return h===f&&(h=new e(null,0)),h}}),g}),define("engine/interview_outline",["hdmain/system","./InterviewNodeType","engine/interviewnode","engine/dialognode","engine/iterationnode","engine/defaultdialognode"],function(a,b,c,d,e,f,g){var h=HOTDOC$,i=a.Cast;this.DEBUG===g&&(this.DEBUG=h.DEBUG),h.PartialClass("Interview","Engine",{DefineInterviewNode:function(a,g,j){if(!(this._outlineStack.Count()<=0)){var k,l,m,n,o,p,q,r,s,t,u,v=this.CurrentBuildNode(),w=g&&v.Type()!=b.Root,x={v:!1};if(w&&(v=this._root),"DI"==a.type)if(l=i(a,h.Dlg),m=v.Active(),m&&!g&&(n=i(v.Type()!=b.Repeat?v:v._parent,c),null!=n&&!(n instanceof h.RootNode)&&(m=n._itemNodes.get(a.name).NeedsProcessing())),""!=l.rType&&v.Type()!=b.Repeat){if(this._varInfo.SetAddedToInterview(l),o=h.RepeatNode.CreateOrLocate(this,v,l,x),this._outlineStack.Push(o),m&&o.EvaluateText(),h.PsR(l.name),m||!l.trimIter){for(;this.CurrentIndex()<this.TopLimitedAnswerCount();)this.DefineInterviewNode(l,!1,!1),h.IcR();l.trimIter&&o.Children().TrimUnanswered()}o.Active(m),p=o.Children().UpdatedCount(),p<this.TopMaxRptCount()&&(this.DefineInterviewNode(l,!1,!0),h.IcR()),this.TopRptCnt(p),o.AnsweredIterationCount=p,o.Limit=this.TopRptLim(),h.PpR(),this._outlineStack.Pop(),k=o}else{for(""!=l.rType?q=e.CreateOrLocate(this,i(v,h.RepeatNode),j,x):(this._varInfo.SetAddedToInterview(l),q=d.CreateOrLocate(this,v,l,x)),this._outlineStack.Push(q),m&&(this.ProcessDialogScript(q),""!=l.rType&&(r=this._varInfo.GetInfo(l).GetLimit(q.Indices()),null!=r&&this.TopRptLim(r)),q.EvaluateText()),q.Active(m),s=0;s<l.vList.Count();s++)t=l.vList.GetItem(s),"DI"==t.type&&this.DefineInterviewNode(i(t,h.Dlg),!1,!1);this._outlineStack.Pop(),k=q}else this._varInfo.SetAddedToInterview(a),u=f.CreateOrLocate(this,a,x),this._outlineStack.Push(u),u.EvaluateText(),this._outlineStack.Pop(),k=u;k.Children().Trim(),k.TabulateAnsweredStatus(),x.v||v.Children().RemoveUntil(k),v.Children().Add(k)}},GetAnswerCount:function(b,c,d){if(d===g&&(d=null),null==d&&!b.IsRepeated())throw new h.HotDocsIntrinsicException(a.String.Format("The dialog {0} is not repeated. A dialog used with REPEAT, COUNT or SUM must have a repeated style.",b.name));var e={},f=0,j=0,k=this;return h.jq.each(b.vList.list,function(a,d){d instanceof h.Variable&&"DI"!=d.type&&h.Answers.TryGetAnswer(d.name,e)?f=e.v.GetChildCount(c):d instanceof h.Dlg&&(""==b.gType?f=k.GetAnswerCount(i(d,h.Dlg),c,b):h.Answers.TryGetAnswer(d.name,e)&&(f=e.v.GetChildCount(c))),f>j&&(j=f)}),b.trimIter,j},ProcessDialogScript:function(a){var b,c,d,f,g,j,k=a._dialog;for(b=0;b<a._itemNodes.Count();b++)a._itemNodes.get(b).PrepareForScriptEvaluation();if(k.EvScr(),this._engine.AutoInterviews()){for(this.PsS(k.name,"D"),c=this._repeatStack.GetIndices(),b=0;b<k.vList.Count();b++)j=k.vList.GetItem(b),j instanceof h.Variable&&!(j instanceof h.Dlg)&&(d=i(j,h.Variable),f=this._varInfo.GetInfo(d),g=f.GetUsed(c),"H"==d.autoIA?this.AutoHideVar(d.name,!g):"G"==d.autoIA&&this.AutoGrayVar(d.name,!g));this.PpS()}for(b=0;b<a._itemNodes.Count();b++)a._itemNodes.get(b).AfterScriptEvaluation();if("R"==k.rType&&a instanceof e){var l=!0;for(b=0;b<a._itemNodes.Count();b++)if(!a._itemNodes.get(b).Hidden()){l=!1;break}a.IterationHidden(l)}}})}),define("engine/interview_repeatstack",["system/exception/invalidoperationexception"],function(a,b){var c=HOTDOC$;c.PartialClass("Interview","Engine",{GetCurrentIndices:function(){return this._repeatStack.GetIndices()},CurrentIndex:function(d){if(0==this._repeatStack.Count())throw new a(c.Lc.GetStr("erraccrpt"));return d===b?this._repeatStack.Peek().index:(this._repeatStack.Peek().index=d,void 0)},FirstRpt:function(){for(frame in this._repeatStack)if(frame.index>0)return!1;return!0},TopRptLim:function(d){if(0==this._repeatStack.Count())throw new a(c.Lc.GetStr("erraccrpt"));return d===b?this._repeatStack.Peek().limit:(this._repeatStack.Peek().limit=d,void 0)},TopLimitedAnswerCount:function(){if(0==this._repeatStack.Count())throw new a(c.Lc.GetStr("erraccrpt"));return this._repeatStack.Peek().LimitedAnsweredCount()},TopMaxRptCount:function(){if(0==this._repeatStack.Count())throw new a(c.Lc.GetStr("erraccrpt"));return this._repeatStack.Peek().MaxCount()}}),c.Class.RepeatStack={B:"Stack",C:function(){c.RepeatStack.baseConstructor.call(this)},P:{GetIndices:function(){var a,b=[];for(a=0;a<this.a.length;a++)b[a]=this.a[a].index;return b}}}}),define("system/exception/indexoutofrangeexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),d}),define("engine/sortmapvalue",[],function(){function a(a){this.i=a}return a}),define("system/exception/memberaccessexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),e.MemberAccessException=d,d}),define("system/exception/missingmemberexception",["hdmain/system","system/exception/memberaccessexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),e.MissingMemberException=d,d}),define("system/exception/keynotfoundexception",["hdmain/system","system/exception/systemexception"],function(a,b,c){function d(){d.baseConstructor.apply(this,arguments)}var e=HOTDOC$;return this.DEBUG===c&&(this.DEBUG=e.DEBUG),a.ExtendClass(d,b),e.KeyNotFoundException=d,d}),define("engine/repeatstackframe",["hdmain/system"],function(a){function b(a){this.dName=a,this.index=0,this.limit=0,this.AnsweredCount=0}return a.ExtendClass(b,null,{Limit:function(a){this.limit=a>0?a:0},LimitedAnsweredCount:function(){return 0==this.limit||this.AnsweredCount<=this.limit?this.AnsweredCount:this.limit},MaxCount:function(){return 0==this.limit||this.AnsweredCount<this.limit?this.AnsweredCount+1:this.limit}}),b}),define("engine/interview_runtime",["hdmain/jq","hdmain/system","system/exception/indexoutofrangeexception","system/exception/invalidoperationexception","system/exception/argumentoutofrangeexception","engine/sortmapvalue","system/exception/missingmemberexception","system/exception/keynotfoundexception","system/exception/argumentexception","./listpunctuation","engine/placeholdertype","engine/repeatstackframe"],function(a,b,c,d,e,f,g,h,j,k,l,m,n){function o(a,b){a.Gray(b)}function p(a,b){a.GrayOrHideSetByScript()||(a.Gray(b),a.GrayOrHideSetByScript(!1))}function q(a,b){a.Hidden(b)}function r(a,b){a.GrayOrHideSetByScript()||(a.Hidden(b),a.GrayOrHideSetByScript(!1))}function s(a,b){a.Required(b)}function t(a,b){a.HasError(b)}function u(a,b){a.ConcealedOnAnswerSource(b)}function v(a,b){a.OmittedFromAnswerSource(b)}var w=HOTDOC$;this.DEBUG===n&&(this.DEBUG=w.DEBUG);var x,y=b.Cast,z=b.String.Format,A=b.String.IsNullOrEmpty,B=w.VariableIncludeMode={TemplateMerge:0,ExplicitAsk:1,ExplicitRepeat:2,ExpressionMerge:3};w.PartialClass("Interview","Engine",{GV:function(a,b){if(!this._inUsagePass&&this.GtU())return null;var c=this.GVImpl(a,!0,b);return null==c&&this.StU(!0),c},GVU:function(a,b){if(!this._inUsagePass&&this.GtU())return null;var c=this.GVImpl(a,!0,b);return c},LookupIndicesForVariable:function(a){var b,c,d,e=!1,f=this._repeatStack.Count()-1,g=[],h=null;for(c=this._repeatStack.Count()-1;c>=0;c--){if(d=this._repeatStack.a[c],e)g[f]=d.index;else if(b=this.GetComponent(d.dName),b.vList.Contains(a,!0,h)){for(e=!0,g=[];d.repeatMap.length<=d.index;)d.repeatMap.push(0);g[f]=d.repeatMap[d.index]}h=d.dName,f--}return g},GVImpl:function(a,b,c){var d,e,f,g=null,h=this.GetComponent(a);return d=null!=c&&c.length>0?this.ResolveIndices(c):this.LookupIndicesForVariable(a),null==d?g:(this._inUsagePass?this.AddToVarUsageList(h,d):b&&this._outlineStack.Count()>0&&h.autoAsk&&!this._scriptStack.InDoNotAskProperty()&&!this._scriptStack.InDlgScript()&&this.IncludeVar(a,B.TemplateMerge,c),e=this._varInfo.GetInfo(h),this.MarkAsTrigger(e),f={},w.Answers.TryGetAnswer(a,f)&&(g=f.v.GetValue(d)),g)},DoSetVarValue:function(a,b,c,d){var e,f,g,h=this.GetComponent(a),i={};e=null!=d&&d.length>0?this.ResolveIndices(d):this.LookupIndicesForVariable(a),null!=e&&(g=w.ToVT(b),"UN"==g&&(g=h.valType),"MC"==h.type&&"string"==typeof b&&(g="MC"),w.Answers.TryGetAnswer(a,i)&&i.v.VT()!=g&&(w.Answers.RemoveAnswer(a),i.v=null),null==i.v&&(i.v=w.Answers.CreateAnswer(g,a)),h.saveAns||(i.v.s=!1),f=i.v.GetValue(e),(c||null==f)&&("MC"==h.type&&"string"==typeof b&&(b=b.indexOf("|")>-1?b.split("|"):[b]),i.v.SetValue(b,!1,e),this._engine.AskNone()||this.FlagVarAsSet(h,c,e)))},FlagVarAsSet:function(a,b,c){if(b){var d,e,f,g,h,i=this._varInfo.GetInfo(a);if(i.WasSet(!0),d=this._scriptStack.TopDlgScript(),e=null==d?null:this.GetComponent(d),null!=e&&e.vList.Contains(a))for(f=this._varInfo.GetInfo(e),g=0;g<f.InterviewNodes().length;g++)h=f.InterviewNodes()[g],w.RepeatIndices.AreEquivalent(c,h.Indices())&&h._itemNodes.get(a.name).SetByDialogScript(!0)}},IncludeVar:function(a,b,c){var d,e,f=this.GetComponent(a),g=null,h=!1;if(!(null!=c&&c.length>0&&(g=this.ResolveIndices(c),null==g))){if(this._inUsagePass)return this.AddToVarUsageList(f,null==g?this.LookupIndicesForVariable(a):g),void 0;if(this.InRebuild()){if(this._engine.AskNone()||!f.autoAsk){if(b!=B.ExplicitAsk)return;h=!0}if(d=h?null:f.parent,null==d||""==d.rType||d.autoAsk||!this.InRpt()||d.name!=this._repeatStack.Peek().dName){if(e=this._varInfo.GetInfo(f),"DI"!=f.type){if(e.WasSet())return;null!=d&&(f=d,e=this._varInfo.GetInfo(d))}if(!e.AddedToInterview()){if(f==d)for(;null!=d.parent;)if(d=d.parent,e=this._varInfo.GetInfo(d),e.AddedToInterview())return;this.DefineInterviewNode(f,!0,!1)}}}}},PsU:function(){this._unansStack.Push(!1)},PpU:function(){this._unansStack.Pop()},GtU:function(){return this._unansStack.Peek()},StU:function(a){this._unansStack.a[this._unansStack.a.length-1]=a},ResolveIndices:function(a){var b=w.RepeatIndices.ValuesToInts(a);return null===b&&this.StU(!0),b},GetPN:function(a){if(0>a||a>=9)throw new e(z("A paragraph level of {0} is not valid.",a));return this._paraNum[a]},SetPN:function(a,b){if(0>a||a>=9)throw new e(z("A paragraph level of {0} is not valid.",a));this._paraNum[a]=null!=b?b:0},FormatValue:function(){var a,b,c,d,e,f=arguments.length;return f>0&&(a=arguments[0]),"string"!=typeof arguments[1]?(b=arguments[1],c=f>2?arguments[2]:null,this.FormatValue1(a,b,c)):(d=arguments[1],e=arguments[2],mergeFormat=arguments[3],this.FormatValue2(a,d,e,mergeFormat))},FormatValue1:function(a,b,c){var d,e,f,g,h,i,j;if(a instanceof Array){for(d=a,e=[],f=null!=b&&b.length>1&&!A(b[1])?this.GetComponentSafe(b[1]):null,e.push(null!=f?f.text:""),g=null,null!=b&&b.length>1&&!A(b[1])&&(g=b[1],h=this.GetComponentSafe(g),null!=h&&(g=h.text)),i=null!=b&&b.length>0&&!A(b[0])?this.GetComponentSafe(b[0]):null,j=0;j<d.length;j++)null!=i&&null!=c&&j<c.length&&c[j]>=0&&c[j]<i.Count()?e.push(i.EvChoice(c[j])):e.push(d[j]);if(b=e,!A(g)){if(x.IsListFormat(g))return x.FormatList(b.slice(1),g);for(j=1;j<b.length;j++)b[j]=x.FormatTextVal(b[j],g)}return w.MC.Format(a,b)}return h=null,g=null!=b&&b.length>0?b[0]:null,null!=g&&(h=this.GetComponentSafe(g),null!=h&&(g=h.text)),"string"==typeof a?x.FormatTextVal(a,g):"number"==typeof a?x.FormatNumVal(a,g,-1):"object"==typeof a&&a.getDate?x.FormatDateVal(a,g):"boolean"==typeof a?x.FormatTFVal(a,g):""},FormatValue2:function(a,b,c,d){var e,f,g,h,i,j,k="",m=null,n=0,o=" ",p="L",q=null,r=null;if(m=this.GetComponentSafe(b),null!=a&&(null!=d?(n=d.fldW,o=d.fillCh,p=d.algn,q=d.fmt):null!=m&&(n=m.dFldW,o=m.dFillCh,p=m.dAlgn,"NU"==m.type?(e=y(m,w.NuVar),q=[e.dFmt,e.decPl.toString()]):"MC"==m.type?(f=y(m,w.McVar),q=[f.dMrg,f.dFmt]):q=[m.dFmt]),null!=m&&"MC"==m.type&&(g={v:a},f=y(m,w.McVar),h=this._varInfo.GetInfo(f),f.ReconcileOptions(g,h.Options())&&(a=g.v),null!=a)))for(r=[],i=0;i<g.v.length;i++)r[i]=h.Options().IndexOf(g.v[i]);if(null!=a)k=this.FormatValue(a,q,r),n>0&&(k=p==MergeAlignment.Left?k.PadRight(n,o):k.PadLeft(n,o));else if(j=null,null!=d?j=d.uTxt:null!=m&&(j=m.dUTxt),A(j))switch(w.UnansweredPlaceholder()){case l.Nothing:k="";break;case l.Asterisks:k="***";break;case l.Underscores:k="_________________";break;case l.AsterisksAndVarName:k=z("***{0}***",A(b)?c:b);break;default:k=z("[{0}]",A(b)?c:b)}else k=j;return k},Add:function(a,b){var c,d,e,f,g,h,i,j,k=a.call(w.CurrentInterview().CurrentTemplate().tplObj);null!=k&&("function"!=typeof k.join||(k=k[0],k!=n))&&(c=k.indexOf("|"),d=null,c>=0&&(d=k.substr(c+1),k=k.substr(0,c)),""!=k&&(e=this.GetComponent(b),i=null,j=e.opts.IndexOf(k),j>=0&&(null==d&&(d=e.opts.GetItem(j).EvPromptImmed()),i=e.opts.GetItem(j).rsrc),f=this._varInfo.GetInfo(e),g=A(d)?null:new w.StTx(d),h=new w.McOpt(k,g,i),f.Options().Add(h)))},Clr:function(a){var b,c=this.GetComponent(a);if(null==c)throw new d(z(x.GetStr("err_clear"),a));b=this._varInfo.GetInfo(c),b.Options().Clear()},Ers:function(a){var b,c,d,e=this.GetComponent(a),f={};if(null==e)throw new j(z("Variable '{0}' not found.",a),a);if(this.BeginBulkAnswerChange(),"DI"==e.type){for(b=e,c=0;c<b.vList.Count();c++)d=b.vList.GetItem(c),d instanceof w.Variable&&w.Answers.TryGetAnswer(d.name,f)&&f.v.Clear();w.Answers.TryGetAnswer(a,f)&&f.v.Clear()}else w.Answers.TryGetAnswer(a,f)&&f.v.Clear(),this.FlagVarAsSet(e,!0,this._repeatStack.GetIndices());this.EndBulkAnswerChange(!1)},StL:function(a,b){if(!w.GtU()&&null!==b){var c,e,f=this.GetComponent(a);if(null==f)throw new d(z(x.GetStr("err_limit"),a));c=this._varInfo.GetInfo(f),e=this._repeatStack.GetIndices(),c.SetLimit(b,e)}},Gry:function(a,b){this.DoSetVarFlag(a,b,o)},AutoGrayVar:function(a,b){this.DoSetVarFlag(a,b,p)},Hid:function(a,b){this.DoSetVarFlag(a,b,q)},AutoHideVar:function(a,b){this.DoSetVarFlag(a,b,r)},Con:function(a,b){this.DoSetVarFlag(a,b,u)},Omt:function(a,b){this.DoSetVarFlag(a,b,v)},Req:function(a){this.DoSetVarFlag(a,!0,s)},Err:function(a){var b=this.CurrentNode();null==b&&(b=this._outlineStack.Peek()),b.ErrorText=a,null!=a&&this.DoSetVarFlag(this._scriptStack.CurDlgScript(),!0,t)},DoSetVarFlag:function(a,b,e){var f,g,h,i,j,k,l,m=this._scriptStack.TopDlgScript(),n=m==a,o=this.GetComponent(m);if(null==o)throw new d(z(x.GetStr("err_badscrstk"),m));if(e!=q||"S"!=o.rType||0==this.CurrentIndex()){for(f=null,g=this._repeatStack.GetIndices(),h=this._varInfo.GetInfo(o),i=0;i<h.InterviewNodes().length;i++)j=h.InterviewNodes()[i],(w.RepeatIndices.AreEquivalent(g,j.Indices())||null!=j._parent&&0==j._parent.Type())&&(f=j);if(null==f)throw new c(z(x.GetStr("err_badrptstk"),m));if(n)for(k=f._itemNodes,i=0;i<k.Count();i++)l=k.get(i),this.DoSetVarFlagImpl(f,l,b,e);else try{this.DoSetVarFlagImpl(f,f._itemNodes.get(a),b,e)}catch(p){}}},DoSetVarFlagImpl:function(a,b,c,d){if(b.DialogItem()instanceof w.DlgEl)for(itemNodes=a._itemNodes,i=0;i<itemNodes.Count();i++)vNode=itemNodes.get(i),vNode.DialogItem().name==b.DialogItem().name&&d(vNode,c);else{if(d==q||d==r||d==o||d==p){if(b.IsDialogOnParent()&&null!=b.SpreadsheetNode())for(childNode=b.SpreadsheetNode()._children.get(0),i=0;i<childNode._itemNodes.Count();i++)dialogItemNode=childNode._itemNodes.get(i),null!=w.CurrentInterview().GetErrorValue(dialogItemNode)&&dialogItemNode.ClearAnswer(!1);null!=w.CurrentInterview().GetErrorValue(b)&&b.ClearAnswer(!1)}d(b,c)}},GetRepeatPunctuation:function(a){var b=this._repeatStack.Peek();if(a)return b.lp.GetPrePart();var c=b.lp.GetPunctuation();return b.lp.IncrementCodeIndex(),c},SortRepeatList:function(a,b,c,d){if(A(a))return!0;var e,g,h,i=this._repeatStack.Peek(),j=!1,k=[];for(e={},w.Answers.TryGetAnswer(a,e)||(e=null),A(c)||(g={},w.Answers.TryGetAnswer(c,g)||(g=null)),h=0;h<i.AnsweredCount;h++){var l=new f(i.repeatMap[h]);e&&(l.v1=e.v.GetValue([l.i])),g&&(l.v2=g.v.GetValue([l.i])),k.push(l)}for(k.sort(function(a,c){function e(a,b,c,d){if(a==b||A(c))return 0;var e=d?a.v1:a.v2,f=d?b.v1:b.v2,g="A"==c?1:-1;if(null==e)return null==f?a.i>b.i?g:-g:g;if(null==f)return-g;if("string"==typeof e)return e.toLowerCase()>f.toLowerCase()?g:-g;if("number"==typeof e)return e>f?g:-g;if("object"==typeof e){if(e instanceof Date)return e>f?g:-g;if(e.length)return e.join("|")>f.join("|")?g:-g}return"boolean"==typeof e?e?-g:g:0}return a.v1==c.v1&&g?e(a,c,d,!1):e(a,c,b,!0)}),h=0;h<i.AnsweredCount;h++)i.repeatMap[h]=k[h].i;return j=!0},FilterRepeatList:function(a){if(A(a))return!0;var b,c=this._repeatStack.Peek(),d=this.GetComponent(a),e=[];if(!d)return!1;for(b=0;b<c.AnsweredCount;b++)c.index=c.repeatMap[b],d.scrD()&&e.push(c.index);return c.index=0,c.repeatMap=e,c.AnsweredCount=e.length,c.lp.CodeCount(e.length),!0},PushRpt:function(a,b,c,d,e,f,g,h){var i=this.GetComponent(a),j=new m(a);j.AnsweredCount=this.GetAnswerCount(i,this._repeatStack.GetIndices()),this._inUsagePass&&j.AnsweredCount++,this._repeatStack.Push(j),j.repeatMap=[],j.lp=new k(b,j.AnsweredCount);for(var l=0;l<j.AnsweredCount;l++)j.repeatMap.push(l);j.repeatMap.length>0&&(h&&this.SortRepeatList(c,d,e,f)?this.FilterRepeatList(g):this.FilterRepeatList(g)&&this.SortRepeatList(c,d,e,f))},PpR:function(){if(0==this._repeatStack.Count())throw new d(x.GetStr("errpoprpt"));this._repeatStack.Pop()},IcR:function(){if(0==this._repeatStack.Count())throw new d(x.GetStr("erraccrpt"));this._repeatStack.Peek().index++},DecRpt:function(){if(0==this._repeatStack.Count())throw new d(x.GetStr("erraccrpt"));if(0==this._repeatStack.Peek().index)throw new d(x.GetStr("err_decidx"));this._repeatStack.Peek().index--},TRN:function(){return 0==this._repeatStack.Count()&&this._inUpdate?1:this.CurrentIndex()+1},TopRptCnt:function(a){if(a===n){if(0==this._repeatStack.Count())throw new d(x.GetStr("erraccrpt"));return this._repeatStack.Peek().AnsweredCount}if(0==this._repeatStack.Count())throw new d(x.GetStr("erraccrpt"));this._repeatStack.Peek().AnsweredCount=null!=a?a:0},InRpt:function(){return this._repeatStack.Count()>0},PsS:function(a,b){this._scriptStack.Push(new w.ScriptFrame(a,b))},PpS:function(){this._scriptStack.Pop()},VarOnDialog:function(b,c){var d,e=!1;return a.each(b.DialogItemNodes(),function(a,b){return d=b._parent._dialog,null!=d&&d.name==c?(e=!0,!1):void 0}),e},MarkAsTrigger:function(a){this._scriptStack.Count()>0&&(this._scriptStack.InDialogScriptOrCallee()&&this.VarOnDialog(a,this._scriptStack.CurDlgScript())||this._scriptStack.InAskProperty())||0==this._scriptStack.Count()&&this._inDialog?a.DialogTrigger(!0):a.InterviewTrigger(!0)},Ans:function(a,b){if(!this._inUsagePass&&this.GtU())return!1;if("string"!=typeof a)return null!=a;var c,d,e=this.ResolveIndices(b);return null===e?!1:(0===e.length&&this._repeatStack.Count()>0&&(e=this.LookupIndicesForVariable(a)),c=this.GetComponent(a),d=null!=c&&this.Answered_Implementation(c,e))},Answered_Implementation:function(b,c){var d,e,f,g,h,i=!1,j="DI"==b.type?y(b,w.Dlg):null,k={};return this._inUsagePass&&this.AddToVarUsageList(b,c),null==j?(this.MarkAsTrigger(this._varInfo.GetInfo(b)),w.Answers.TryGetAnswer(b.name,k)&&(i=k.v.IsAns(c))):(h=this,a.each(j.vList.list,function(b,j){j instanceof w.Variable&&(d=!1,e=!1,f=y(j,w.Variable),g=h._varInfo.GetInfo(f),a.each(g.DialogItemNodes(),function(a,b){w.RepeatIndices.AreEquivalent(b.Indices(),c)&&(e=!0,!b.Gray()&&!b.Hidden()&&("DI"==j.type?d=h.Answered_Implementation(f,c):(h.MarkAsTrigger(g),!d&&w.Answers.TryGetAnswer(j.name,k)&&(d=k.v.IsAns(c)))))}),e||("DI"==j.type?d=h.Answered_Implementation(f,c):(h.MarkAsTrigger(g),!d&&w.Answers.TryGetAnswer(j.name,k)&&(d=k.v.IsAns(c)))),d&&!i&&(i=!0))})),i},Cnt:function(a,b){if(this.GtU()||null===a)return null;var c,d,e,f,g=0,h=this.GetComponent(a);switch(h.type){case"DI":c=null!=b&&b.length>0?this.ResolveIndices(b):this._repeatStack.GetIndices(),g=this.GetAnswerCount(y(h,w.Dlg),c),this._inUsagePass?this.AddToVarUsageList(h,c):this._outlineStack.Count()>0&&h.autoAsk&&!this._scriptStack.InDoNotAskProperty()&&!this._scriptStack.InDlgScript()&&this.IncludeVar(a,B.ExpressionMerge,b);break;case"MC":if(d=y(h,w.McVar),e={v:this.GV(a,b)},f=this._varInfo.GetInfo(d),h.ReconcileOptions(e,f.Options()),null==e.v)return null;g=e.v.length,1==g&&e.v[0]==w.MC.nota&&(g=0);break;default:return null}return g},Oth:function(a,b){if(this.GtU())return null;var c,d,e;return c={v:this.GV(a,b)},null==c.v?"":(d=this.GetComponent(a),e=this._varInfo.GetInfo(d),d.ReconcileOptions(c,e.Options()),null==c.v||1!=c.v.length||e.Options().Contains(c.v[0])?"":c.v[0])},Sel:function(a,b,c){if(this.GtU()||null===c)return null;var d="",e=this.GV(a,b);return null!=e&&null!=e&&e.length>=c&&(d=e[c-1]),d},Sum:function(a,b){if(this.GtU())return null;var c,d,e,f,g,h,i=0,j=this.ResolveIndices(b),k={};if(w.RepeatIndices.IsNullOrEmpty(j)&&(j=this.GetCurrentIndices(),b=w.RepeatIndices.IntsToValues(j)),h=this.GetComponentSafe(a),null!=j&&null!=h)if("NU"==h.type){if(e=w.RepeatIndices.Push(b),f=!0,w.Answers.TryGetAnswer(a,k))for(g=k.v.GetChildCount(j),d=0;g>d;d++)c=this.GVImpl(a,!0,e),null!=c&&(i+=c),w.RepeatIndices.Increment(e),f=!1;f&&this.GVImpl(a,!0,e)}else"CO"==h.type&&(c=y(h,w.CoVar).GetSum(),null!=c&&(i=c));return i}},null,function(){x=w.Lc})}),define("engine/interview_scriptstack",[],function(){var a=HOTDOC$;a.ScriptFrame=function(a,b){this.vName=a,this.type=b},a.Class.ScriptStack={B:"Stack",C:function(){a.ScriptStack.baseConstructor.call(this)},P:{TopDlgScript:function(){return this.Count()>0&&"D"==this.Peek().type?this.Peek().vName:null},InDlgScript:function(){return null!==this.TopDlgScript()},CurDlgScript:function(){var a,b;for(a=this.a.length-1;a>=0;a--)if(b=this.a[a],"D"==b.type)return b.vName;return null},InDialogScriptOrCallee:function(){return null!==this.CurDlgScript()},InDoNotAskProperty:function(){for(var a=this.a.length-1;a>=0;a--)if("N"==this.a[a].type)return!0;return!1},InAskProperty:function(){var a,b;for(a=this.a.length-1;a>=0;a--){if(b=this.a[a],"N"==b.type)return!1;if("A"==b.type)return!0}return!1}}}}),define("engine/mergeformat",[],function(){function a(a,b,c,d,e,f){this.fldW=a,this.fillCh=b,this.algn=c,this.uTxt=d,this.font=e,this.fmt=f}return HOTDOC$.MrgFmt=a,a}),define("engine/navigator",["system/exception/invalidoperationexception","hdmain/system","system/exception/argumentnullexception","engine/interviewnodetype","engine/interviewnode","engine/iterationnode"],function(a,b,c,d,e,f){var g=HOTDOC$,h=b.Cast,i="AvailableForNavigation";g.Class.Navigator={C:function(a){this._interview=a},P:{Update:function(){if(0==this._interview.Root().Children().Count()||null==this._interview.FirstRootChild())return this.First=null,this.Last=null,this.PreviousUnanswered=null,this.NextUnanswered=null,this.Previous=null,this.Next=null,void 0;if(null==this._interview.CurrentOutlineNode())throw new a(g.Lc.GetStr("err_navstate"));this.First=this.FindFirst(),this.Last=this.FindLast(),this.PreviousUnanswered=this.FindPreviousUnanswered(),this.NextUnanswered=this.FindNextUnanswered(),this.Previous=this.FindPrevious(),this.Next=this.FindNext()},CanProceedToNext:function(a){return this.CanProceedToNode(this.Next,a)},CanProceedToNextUnanswered:function(a){return this.CanProceedToNode(this.NextUnanswered,a)},CanProceedToLast:function(a){return this.CanProceedToNode(this.Last,a)},CanProceedToNode:function(a,b){return this._interview.HasValidationErrors()?(b.s=g.Lc.GetStr("val_err"),!1):null!=a&&(b.s=this._interview.GetErrorText("d",a.ComesAfter(this._interview.ErrorNode()),a.ComesAfter(this._interview.RequiredNode())),""!=b.s)?!1:(b.s="",!0)},FindFirst:function(){var a=null;return this._interview.Root().Children().Count()>0&&(a=this._interview.CurrentOutlineNode(),null!=a&&a.Type()==d.Iteration&&h(a,f).IsSpreadsheetRowInEditMode()?a=a._parent.Children().get(0):(a=this._interview.FirstRootChild(),null!=a&&a.Type()==d.Repeat&&"S"==h(a,g.RepeatNode)._dialog.rType&&(a=a.Children().get(0)))),a},FindPreviousUnanswered:function(){var a=null;if(this._interview.Root().Children().Count()>0)for(a=this.GetPreviousNodeInTreeOrder(this._interview.CurrentOutlineNode());null!=a&&a.AnsStatus().IsAllAnswered();)a=this.GetPreviousNodeInTreeOrder(a);return a},FindPrevious:function(){var a=null;return this._interview.Root().Children().Count()>0&&(a=this._interview.CurrentOutlineNode(),a=this.GetPreviousNode(a,this._interview.NextFollowsOutline())),a},FindNext:function(){var a=null;return this._interview.Root().Children().Count()>0&&(a=this._interview.CurrentOutlineNode(),a=this.GetNextNode(a,this._interview.NextFollowsOutline())),a},FindNextUnanswered:function(){var a=null;if(this._interview.Root().Children().Count()>0)for(a=this.GetNextNodeInTreeOrder(this._interview.CurrentOutlineNode());null!=a&&a.AnsStatus().IsAllAnswered();)a=this.GetNextNodeInTreeOrder(a);return a},FindLast:function(){var a,b=null;return this._interview.Root().Children().Count()>0&&(b=this._interview.CurrentOutlineNode(),null!=b&&b.Type()==d.Iteration&&h(b,f).IsSpreadsheetRowInEditMode()?(a=b._parent.Children().Count()-1,a>0&&b._parent.Children().get(a).IsHiddenNew()&&a--,b=b._parent.Children().get(a)):b=this.GetLastChild(this._interview.Root())),b},GetLastChild:function(a){var b,c,e,f=a.OutlineChildrenReverse(),j=null;for(b=0;b<f.length;b++)if(f[b].ShowInOutline()){j=f[b];break}return null!=j&&j.Type()==d.Repeat&&!h(j,g.RepeatNode).IsSpreadsheet()&&(c=j.Children().Count()-1,c>0&&!j.Children().get(c)[i]()&&c--,j=j.Children().get(c)),this._interview.NextFollowsOutline()&&null!=j&&(e=this.GetLastChild(j),null!=e)?e:j},GetNextNode:function(a,b){if(null==a)throw new c("node");return b?this.GetNextNodeInTreeOrder(a):this.GetNextNodeInTraditionalOrder(a)},GetNextNodeInTraditionalOrder:function(a){var b,c=a,j=!1;if(c.Type()==d.Iteration)if(b=c._parent.Children().IndexOf(c)+1,b>=0&&b<c._parent.Children().Count()&&c._parent.Children().get(b)[i]())c=c._parent.Children().get(b);else if(h(c,f).IsSpreadsheetRowInEditMode())c=c._parent[i]()?h(c._parent,e):h(c._parent._parent,e);else{for(;c._parent.Type()!=d.Root;)if(c=h(c._parent,e),!c[i]()&&c._parent.Type()!=d.Root){c=h(c._parent,e);break}c.Type()==d.Repeat&&"R"==h(c,g.RepeatNode)._dialog.rType&&(j=!0)}else if(c._parent.Type()!=d.Root)for(c=h(c._parent,e);c.Type()!=d.Root&&!c[i]();)c=h(c._parent,e);else j=!0;if(null!=c&&j)if(b=c._parent.Children().IndexOf(c)+1,b>=0&&b<this._interview.Root().Children().Count())for(c=this._interview.Root().Children().get(b);!c.ShowInOutline()&&++b<this._interview.Root().Children().Count();)c=this._interview.Root().Children().get(b);else c=null;return c},GetNextNodeInTreeOrder:function(a){var b,c=a,f=-1;do if(c.HasVisibleChildren())c=c.Children().get(0),f=0;else if(-1==f?f=c._parent.Children().IndexOf(c)+1:f++,f>=0&&f<c._parent.Children().Count())c=c._parent.Children().get(f);else if(c.Type()==d.Iteration&&h(c._parent,g.RepeatNode).EditRowMode())c=c._parent[i]()?h(c._parent,e):h(c._parent._parent,e);else{for(;c._parent.Type()!=d.Root;)if(c=h(c._parent,e),f=c._parent.Children().IndexOf(c)+1,f<c._parent.Children().Count()&&(b=c._parent.Children().get(f),b.Type()!=d.Iteration||!b.IsHiddenNew())){c=b;break}f>=c._parent.Children().Count()&&(c=null)}while(null!=c&&!c[i]());return c},GetPreviousNode:function(a,b){if(null==a)throw new c("node");return b?this.GetPreviousNodeInTreeOrder(a):this.GetPreviousNodeInTraditionalOrder(a)},GetPreviousNodeInTraditionalOrder:function(a){var b,c=a;if(bAdvToSib=!1,c.Type()==d.Iteration)if(b=c._parent.Children().IndexOf(c)-1,b>=0)c=c._parent.Children().get(b);else if(h(c,f).IsSpreadsheetRowInEditMode())c=c._parent[i]()?h(c._parent,e):h(c._parent._parent,e);else{for(;c._parent.Type()!=d.Root;)if(c=h(c._parent,e),c.Type()==d.Repeat&&"R"==h(c,g.RepeatNode)._dialog.rType&&c._parent.Type()!=d.Root){c=h(c._parent,e);
break}c.Type()==d.Repeat&&"R"==h(c,g.RepeatNode)._dialog.rType&&(bAdvToSib=!0)}else c._parent.Type()!=d.Root?c=h(c._parent,e):bAdvToSib=!0;if(null!=c&&bAdvToSib)if(b=c._parent.Children().IndexOf(c)-1,b>=0){for(c=this._interview.Root().Children().get(b);!c.ShowInOutline()&&--b>=0;)c=this._interview.Root().Children().get(b);c.Type()==d.Repeat&&(b=c.Children().Count()-1,c.Children().get(b).IsHiddenNew()&&b--,c=c.Children().get(b))}else c=null;return c},GetPreviousNodeInTreeOrder:function(a){var b=a,c=-1;do if(-1==c?c=b._parent.Children().IndexOf(b)-1:c--,c>=0)for(b=b._parent.Children().get(c);b.HasVisibleChildren();){if(c=b.Children().Count()-1,b.Children().get(c).Type()==d.Iteration)for(;c>0&&b.Children().get(c).IsHiddenNew();)c--;b=b.Children().get(c)}else b._parent.Type()!=d.Root?(b=b.Type()==d.Iteration&&h(b,f).IsSpreadsheetRowInEditMode()?b._parent[i]()?h(b._parent,e):h(b._parent._parent,e):h(b._parent,e),c=b._parent.Children().IndexOf(b)):b=null;while(null!=b&&!b[i]());return b}}}}),define("engine/repeatindices",["system/exception/argumentnullexception","system/exception/argumentexception"],function(a,b){function c(c,e){if(null==c)throw new a(f);if(0==c.length)throw new b(d.GetStr("err_emptyrptstk"),f);c[c.length-1]+=e}var d,e=HOTDOC$,f="indices";e.Class.RepeatIndices={SC:function(){d=e.Lc},S:{IsNullOrEmpty:function(a){return null==a||0==a.length},Push:function(a){return this.PushIndex(a,0)},PushIndex:function(b,c){if(null==b)throw new a(f);var d=b.slice(0);return d.push(c),d},Pop:function(c){if(null==c)throw new a(f);if(0==c.length)throw new b(d.GetStr("errpoprpt"),f);return c.slice(0,c.length-1)},GetTopIndex:function(c){if(null==c)throw new a(f);if(0==c.length)throw new b("Cannot peek empty repeat stack",f);return c[c.length-1]},SetTopIndex:function(c,d){if(null==c)throw new a(f);if(0==c.length)throw new b("Cannot set empty repeat stack",f);c[c.length-1]=d},SetBaseIndices:function(a,c){if(null!=c&&0!=c.length){if(null==a&&(a=[]),c.length>a.length)throw new b("Invalid base indices.","newBaseIndices");var d,e=[];for(d=0;d<c.length;d++)e[d]=c[d];for(d=c.length;d<a.length;d++)e[d]=a[d];return e}},Increment:function(a){c(a,1)},Decrement:function(a){c(a,-1)},IsFirst:function(a){var b;for(b=0;b<a.length;b++)if(a[b]>0)return!1;return!0},ToString:function(a){if(null==a)return"";var b=a.length,c="",d=0;for(c+="[";b>d;)c+=a[d++],b>d&&(c+=",");return c+="]"},ValuesToInts:function(a){var b,c;if(this.IsNullOrEmpty(a))b=[];else for(b=[],c=0;c<a.length;c++){if("number"!=typeof a[c]){b=null;break}b[c]=a[c]-1}return b},IntsToValues:function(a){var b,c;if(this.IsNullOrEmpty(a))b=[];else for(b=[],c=0;c<a.length;c++)b[c]=a[c]+1;return b},AreEquivalent:function(a,b){if(null==a&&(a=[]),null==b&&(b=[]),0==a.length&&0==b.length)return!0;for(var c=b.length>a.length?b:a,d=b.length>a.length?a:b,e=0;e<d.length;e++)if(d[e]!=c[e]&&(d[e]>0||c[e]>0))return!1;for(;e<c.length;e++)if(c[e]>0)return!1;return!0},AreRelated:function(a,b){if(null==a&&(a=[]),null==b&&(b=[]),0==a.length&&0==b.length)return!0;var c,d=Math.min(a.length,b.length);for(c=0;d>c;c++)if(a[c]!=b[c])return!1;return!0},ToPrefixString:function(a){if(null==a)return"";var b,c="";for(b=0;b<a.length;b++)c+=a[b]+1,c+=":";return c.length>0&&(c+=" "),c}}}}),define("engine/repeatnode",["hdmain/system","system/exception/argumentnullexception","system/exception/argumentexception","engine/answeredstatustabulator","engine/interviewnodetype","engine/dialogupdateflags","engine/interviewnode","engine/iterationnode"],function(a,b,c,d,e,f,g,h,i){var j=HOTDOC$,k=a.Cast,l=a.String.IsNullOrEmpty;this.DEBUG===i&&(this.DEBUG=j.DEBUG);var m,n,o="RepeatNode";j.Class[o]={B:"InterviewNode",SC:function(){m=j.FocusDirection,n=j[o].baseclass},C:function(a,b,c){j[o].baseConstructor.call(this,a,e.Repeat,b,c,a.GetCurrentIndices()),this.AnsweredIterationCount=0,this.Limit=0,this._editingRow=-1,this._iterationTally=0,this._userExtendible=this.GetUserExtendible(),this.InitializeId(),this.IsSpreadsheet()&&this.BuildItemNodes()},P:{BuildItemNodes:function(){var a,b,c,d=0,e=0;for(this.IsOnParent()||(a=!0,j.jq.each(this._dialog.vList,function(b,c){c instanceof j.DlgEl?c instanceof j.TxDlgEl&&"E"==k(c,j.TxDlgEl).dspIn||(a?d++:e++):a=!1})),this._itemNodes=new j.DialogItemNodeList(d+e+1),b=0;d>b;b++)this._itemNodes.Add(this._dialog.vList.GetItem(b).name,this,b);for(this._itemNodes.Add(this._dialog.name,this,j.SpreadsheetIndex),b=d+1;b<this._dialog.vList.Count();b++)c=this._dialog.vList.GetItem(b),c instanceof j.DlgEl&&(!(c instanceof j.TxDlgEl)||"E"!=k(c,j.TxDlgEl).dspIn)&&this._itemNodes.Add(c.name,this,b)},GetUserExtendible:function(){for(var a=!0,b=0;b<this._dialog.vList.Count();b++){var c=this._dialog.vList.GetItem(b);if(c instanceof j.Variable){var d=this._interview._engine.GetAnswer(c.name);if(null!=d&&!d.ue){a=!1;break}}}return a},AddingIterationsIsEnabled:function(){return this._userExtendible&&(0==this.Limit||this.AnsweredIterationCount<this.Limit)},IsSpreadsheet:function(){return"S"==this._dialog.rType},SpreadsheetItemNode:function(){return this.IsSpreadsheet()&&!this.EditRowMode()?this.IsOnParent()?k(this._parent,g)._itemNodes.get(this._dialog.name):this._itemNodes.get(this._dialog.name):null},EditRowMode:function(){return this._editingRow>=0&&this._editingRow<this._children.Count()},EditingRow:function(){return this.EditRowMode()?k(this._children.get(this._editingRow),h):null},NewIteration:function(){var a=k(this.Children().get(this.Children().Count()-1),h);return a.New()?a:null},OutlineChildren:function(){var a,b,c,d=[];for(a=0;a<this._children.Count();a++)if(b=k(this._children.get(a),h),this.IsSpreadsheet())for(c=0;c<b.Children().Count();c++)d.push(b.Children().get(c));else d.push(b);return d},OutlineChildrenReverse:function(){var a,b,c,d=[];for(a=this._children.Count()-1;a>=0;a--)if(b=k(this._children.get(a),h),this.IsSpreadsheet())for(c=b.Children().Count()-1;c>=0;c--)d.push(b.Children().get(c));else d.push(b);return d},UserExtendible:function(){return this._userExtendible},AllIterationsAreHidden:function(){var a,b,c=!0;for(a=0;a<this.Children().Count();a++)if(b=this.Children().get(a),b.ShowInOutline()){c=!1;break}return c},ShowInOutline:function(){return this.IsSpreadsheet()&&this.IsOnParent()?!1:n.ShowInOutline.call(this)&&(this.IsSpreadsheet()||!this.AllIterationsAreHidden())},AvailableForNavigation:function(){return"R"==this._dialog.rType?!1:n.AvailableForNavigation.call(this)},NextIterationId:function(){return++this._iterationTally},SetEditRow:function(a){!this._interview.HasValidationErrors()&&this.IsSpreadsheet()&&(this._editingRow=a,this._interview.ForgetLocation())},ClearEditRowMode:function(){this._interview.HasValidationErrors()||(this.ClearFocusedItemNode(),this.SetEditRow(-1))},EvTitle:function(){var a=this._dialog.EvRptT();return l(a)&&(a=this._dialog.EvTitle()),a},DoAnsweredStatusTabulation:function(){var a,b;for(this._answeredStatus.Reset(),a=0;a<this._children.Count();a++)b=this._children.get(a),(!b.New()||0==a)&&d.Aggregate(this._answeredStatus,b.AnsStatus())},DoImplicitAnswerProcessing:function(){if(this.IsSpreadsheet()){var a,b;for(a=0;a<this._children.Count();a++)b=this._children.get(a),b.New()||b.DoImplicitAnswerProcessing()}},IterationIsAnswered:function(a){return this._children.get(a).AnsStatus().IsAnswered()},GetFirstFocusableNode:function(){return!this.IsSpreadsheet()||this.IsOnParent()?this._children.get(0):this},AddIteration:function(){var a=this._interview.GetFocusItem();return null!=a&&a.OnAnswerSync(),this._interview.CurrentOutlineNode()==this.NewIteration()?!1:(this._interview.ClearFocusItem(),this._interview.IsSinglePage()&&this._interview.IgnoreNextFocus(),this.GotoNewIteration(!0),!0)},EditIteration:function(a,b,c){var d=this.GetFocusedItemNode();null!=d&&(d.OnAnswerSync(),d=null),this.SetEditRow(a),this._interview.GotoDialog(this.Children().get(a),b,!0,null,j.jq.proxy(function(a){a?(b.s="",c(!0)):(this.SetEditRow(-1),c(!1))},this))},InsertIteration:function(a){if(0>a)throw new c(j.Lc.GetStr("err_idxgt0"),"atIndex");if(a>this.AnsweredIterationCount)throw new c(j.Lc.GetStr("err_idxexceeds"),"atIndex");var b,d,e,f=this.GetFocusedItemNode();return null!=f&&(f.OnAnswerSync(),f=null),this._children.get(a).New()?(this._children.get(a).AdvanceFocus(!1,m.Forward),void 0):(this.AddingIterationsIsEnabled()&&(this.ClearFocusedItemNode(),this._interview.ClearRpt(),this._interview.SyncRepeatStackWithNode(this),this._interview.PushRpt(this._dialog.name),this._interview.CurrentIndex(a),this.Children().Insert(a,new h(this._interview,this,!1)),this.AnsweredIterationCount++,(!this.IsSpreadsheet()||this.EditRowMode())&&this._interview.ForgetLocation(),b=j.RepeatIndices.PushIndex(this._indices,a),this._interview.BeginBulkAnswerChange(),this.InsertOrDeleteIterationAnswers(this._dialog,!1,b),this._interview.EndBulkAnswerChange(!1),this.IsSpreadsheet()&&!this.EditRowMode()?(d=this.SpreadsheetItemNode(),d.SetRowFocus(a),this._interview.TriggerFocusEnter(d,null,m.Forward),d.AssertFocus(j.FocusOperation.AdvanceIfNecessary,m.Forward,j.jq.proxy(function(){this._interview.InBulkAnswerChange()||this._interview.Update()},this))):(e={s:null},this._interview.GotoDialog(this.Children().get(a),e,!0,null,function(a){a||j.Alert(e),this._interview.InBulkAnswerChange()||this._interview.Update()}))),void 0)},DeleteIteration:function(a){if(0>a)throw new c(j.Lc.GetStr("err_idxgt0"),"atIndex");if(this._children.get(a).New())return this._children.get(a).AdvanceFocus(!1,m.Forward),void 0;var b,d,e,g,h=!1;if(a>0&&!this.IsSpreadsheet()&&(a==this._children.Count()-1?h=!0:a==this._children.Count()-2&&this._children.get(a+1).New()&&(h=!0)),this.IsSpreadsheet()&&this.ClearFocusedItemNode(),this.Children().RemoveAt(a),this.AnsweredIterationCount>0&&this.AnsweredIterationCount--,(!this.IsSpreadsheet()||this.EditRowMode())&&this._interview.ForgetLocation(),b=j.RepeatIndices.PushIndex(this._indices,a),this._interview.BeginBulkAnswerChange(),this.InsertOrDeleteIterationAnswers(this._dialog,!0,b),this._interview.EndBulkAnswerChange(!h),h){for(d=a-1;d>0&&!this._children.get(d).AnsStatus().IsAnswered();)d--;this._children.get(d).SetUpdateFlags(f.AddButtonRefresh),e={s:null},this._interview.GotoDialog(this._children.get(d),e,!0,null,function(a){a||j.Alert(e)})}else this.IsSpreadsheet()&&!this.EditRowMode()&&(g=a<this.Children().Count()?a:this.Children().Count()-1,this.SpreadsheetItemNode().SetRowFocus(g))},InsertOrDeleteIterationAnswers:function(a,b,c){var d,e,g;for(this.SetUpdateFlags(f.RepeatAnswer),d=0;d<a.vList.Count();d++)e=a.vList.GetItem(d),e instanceof j.Variable&&(g=this._interview._engine.GetAnswer(e.name),null!=g&&(b?g.DeleteIteration(c):g.InsertIteration(c)),e instanceof j.Dlg&&this.InsertOrDeleteIterationAnswers(k(e,j.Dlg),b,c))},MoveIteration:function(a,b){if(0>a||0>b)throw new c(j.Lc.GetStr("err_idxgt0"),0>a?"atIndex":"toIndex");if(a!=b){var d,e,g,h,i,k,l,m=this.GetFocusedItemNode();for(null!=m&&(m.OnAnswerSync(),m=null),d=this.IsSpreadsheet()&&!this.EditRowMode(),e=d?this.Children().get(a).GetFocusedItemNode().DialogItem().name:null,this.Children().Move(a,b),d&&this.SpreadsheetItemNode().SetRowFocus(b),this.SetUpdateFlags(f.RepeatAnswer|f.NodeChildCount|f.ChildCount),d||this._interview.ForgetLocation(),g=j.RepeatIndices.PushIndex(this._indices,a),this._interview.BeginBulkAnswerChange(),k=0;k<this._dialog.vList.Count();k++)l=this._dialog.vList.GetItem(k),l instanceof j.Variable&&(h=this._interview._engine.GetAnswer(l.name),null!=h&&h.MoveIteration(g,b));this._interview.EndBulkAnswerChange(),d?this.Children().get(b)._itemNodes.get(e).SetFocus(null):(i={s:null},this._interview.GotoDialog(this.Children().get(b),i,!0,null,function(a){a||j.Alert(i)}))}},GotoNewIteration:function(a){var b=this.NewIteration(),c={s:null};null!=b&&this._interview.GotoDialog(b,c,!0,null,function(d){d?a&&b.AdvanceFocus(!1,m.Forward):j.Alert(c)})},SerializeAttributes:function(a){a.WriteAttributeString("Type",this._dialog.rType.toString()),n.SerializeAttributes(a),a.WriteAttributeString("Count",this.AnsweredIterationCount.toString()),this.Limit>0&&a.WriteAttributeString("Limit",this.Limit.toString()),this._editingRow>=0&&a.WriteAttributeString("EditingRow",this._editingRow.toString())}},S:{CreateOrLocate:function(a,c,d,f){var h,i;if(null==a)throw new b("interview");if(null==c)throw new b("parent");if(null==d)throw new b("dialog");return h=a.CurrentBuildNode()!=c?k(a.CurrentBuildNode(),g):null,i=k(c.Children().FindExisting(d.name,e.Repeat,h,a.CurrentTemplate()),j[o]),null==i?(i=new j[o](a,c,d),f.v=!0):f.v=!1,i.InitUpdate(),i}}}}),define("engine/rootnode",["engine/answeredstatustabulator","engine/interviewnodetype","hdmain/system","engine/baseinterviewnode","hdmain/jq"],function(a,b,c,d,e){function f(a){f.baseConstructor.call(this,a,b.Root,null),this.InitializeId()}return c.ExtendClass(f,d,{DoAnsweredStatusTabulation:function(){this._answeredStatus.Reset();var b=this;e.each(this._children._list,function(c,d){a.Aggregate(b._answeredStatus,d.AnsStatus())})},OnSinglePage:function(){return!0},DirtySinglePage:function(){f.baseclass.DirtySinglePage.call(this)}}),HOTDOC$.RootNode=f,f}),define("runtime/resource",["hdmain/system"],function(a,b){function c(a,c,d){a===b&&(a="T"),this.type=a,this.loc=c,this.txtD=d}var d=HOTDOC$;return a.ExtendClass(c,null,{EvText:function(){return this.txtD?this.txtD.toString():""},IsDyn:function(){return this.txtD&&this.txtD instanceof d.DyTx}}),d.Rsrc=c,c}),define("engine/template",["hdmain/system","system/exception","system/exception/targetinvocationexception","system/exception/argumentexception","runtime/resource"],function(a,b,c,d,e,f){var g=HOTDOC$,h=a.String.Format,i=a.String.IsNullOrEmpty;this.DEBUG===f&&(this.DEBUG=g.DEBUG),g.Class.Template={C:function(a,b,c){this._templateName=a,this._assemblyName=b,this._templateType=c,this.name=this._templateName,this.AssemblyName=this._assemblyName,this.tplObj=g.Templates[b],this.interviewMethod=this.tplObj.Interview,this._templateInterviewMethod=this.tplObj.TemplateInterview,this.compDict={},this.TranslateComponents(this.tplObj.DefineComponents())},P:{TE:function(a){return a===f||null===a?null:"string"==typeof a?new g.StTx(a):"function"==typeof a?new g.DyTx(a,this.tplObj):a},RS:function(a){return a===f||null===a?null:new e(a.t,a.l,this.TE(a.r))},DefineCmp:function(a){var b,c,d,e,f,h,i;if(b=this.compDict[a.n],!b){switch(a.t){case"VTX":b=new g.TxVar(a.n,this.TE(a.tl),null,this.TE(a.p),this.RS(a.r),a.fw,a.fx,a.cw,a.cx,a.aa,a.sa,a.wu,a.ai,a.df,a.du,a.dc,a.dw,a.da,a.h,a.ml,a.pt,a.ep);break;case"VNU":b=new g.NuVar(a.n,this.TE(a.tl),null,this.TE(a.p),this.RS(a.r),a.fw,a.fx,a.cw,a.cx,a.aa,a.sa,a.wu,a.ai,a.df,a.du,a.dc,a.dw,a.da,a.dp,a.cs,a.mn,a.mx);break;case"VDA":b=new g.DaVar(a.n,this.TE(a.tl),null,this.TE(a.p),this.RS(a.r),a.fw,a.fx,a.cw,a.cx,a.aa,a.sa,a.wu,a.ai,a.df,a.du,a.dc,a.dw,a.da);break;case"VTF":b=new g.TfVar(a.n,this.TE(a.tl),null,this.TE(a.p),this.RS(a.r),a.fw,a.fx,a.cw,a.cx,a.aa,a.sa,a.wu,a.ai,a.df,a.du,a.dc,a.dw,a.da,a.sl);break;case"VMC":for(f=a.l?a.l.length:0,c=new Array(f),d=0;f>d;d++)e=a.l[d],c[d]=new g.McOpt(e.n,this.TE(e.p),this.RS(e.r));b=new g.McVar(a.n,this.TE(a.tl),null,this.TE(a.p),this.RS(a.r),a.fw,a.fx,a.cw,a.cx,a.aa,a.sa,a.wu,a.ai,a.df,a.du,a.dc,a.dw,a.da,c,a.s,a.ot,a.dm,a.dv);break;case"VCO":b=new g.CoVar(a.n,this.TE(a.tl),null,this.TE(a.p),this.RS(a.r),a.fw,a.fx,a.cw,a.cx,a.aa,a.sa,a.wu,a.ai,a.df,a.du,a.dc,a.dw,a.da,a.y,a.s,a.sd,this.tplObj);break;case"VDI":for(f=a.l.length,h=[],d=0;f>d;d++)h.push(this.DefineCmp(a.l[d])),e&&(e[d]=0);c=new g.DiList(h),a.pl||(e=new Array(f)),b=new g.Dlg(a.n,this.TE(a.tl),null,this.TE(a.p),this.RS(a.r),a.fw,a.fx,a.cw,a.cx,a.aa,a.sa,a.wu,a.ai,a.df,a.du,a.dc,a.dw,a.da,c,a.s,a.rp,a.op,a.lv,a.al,a.rt,a.ac,a.mr,a.g,a.na,a.pp,a.pa,a.mp,a.hu,a.hc,a.hs,a.ti,e?e:a.pl,a.ds,a.m,this.tplObj);break;case"LTX":b=new g.TxDlgEl(a.n,null,this.TE(a.c),a.di);break;case"LHD":b=new g.HdDlgEl(a.n,null,this.TE(a.c),a.fs,a.j);break;case"LVS":b=new g.VsDlgEl(a.n,null,a.s);break;case"LSL":b=new g.SlDlgEl(a.n,null,a.dt,a.ds,a.de,a.w,a.h,a.i,this.TE(a.c),a.v);break;case"LWL":b=new g.WlDlgEl(a.n,null,a.dt,a.ds,a.de,a.w,a.h,a.i,this.TE(a.c),a.u,a.o);break;case"LIM":b=new g.ImDlgEl(a.n,null,a.i,a.j);break;case"FTX":b=new g.TxFmt(a.n,null,a.f);break;case"FNU":b=new g.NuFmt(a.n,null,a.f);break;case"FDA":b=new g.DaFmt(a.n,null,a.f);break;case"FTF":b=new g.TfFmt(a.n,null,a.f);break;case"FMC":for(i=[],d=0;d<a.m.length;d++)i.push(null===a.m[d]?null:new this.TE(a.m[d].t));b=new g.McFmt(a.n,null,a.f,i);break;case"FGR":b=new g.GrFmt(a.n,null,a.f);break;case"PRF":b=new g.Pref(a.n,null,a.s)}this.compDict[a.n]=b}return b},TranslateComponents:function(a){var b;for(b in a)this.DefineCmp(a[b])},RunInterview:function(){if(this.interviewMethod)try{this.interviewMethod.call(this.tplObj)}catch(a){throw a instanceof c&&null!=a.InnerException&&!i(a.InnerException.Message)?a.InnerException:new b(h(g.Lc.GetStr("err_proc"),"Interview",this.name),null==a.InnerException?a:a.InnerException)}else this.RunTemplateInterview()},HasTemplateInterview:function(){return null!=this._templateInterviewMethod},RunTemplateInterview:function(){try{this._templateInterviewMethod.call(this.tplObj)}catch(a){throw a instanceof c&&null!=a.InnerException&&!i(a.InnerException.Message)?a.InnerException:new b(h(g.Lc.GetStr("err_proc"),"TemplateInterview",this.name),null==a.InnerException?a:a.InnerException)}},GetComponent:function(a){var b=this.GetComponentSafe(a);if(null===b||b===f)throw new d(h(g.Lc.GetStr("err_nocmp"),a));return b},GetComponentSafe:function(a){var b=this.compDict[a];return b!=f?b:null},GetPreference:function(a){return"("!=a.charAt(0)&&"VIEWS"!=a.substr(0,5)&&(a="("+a+")"),this.GetComponentSafe(a)}}}}),define("engine/textevaluator",["hdmain/system"],function(a){function b(a){this.text=a}function c(a,b){this.D=a,this.t=b}function d(a,b,c){this.D=a,this.rslt=b,this.t=c}var e=HOTDOC$;a.ExtendClass(b,null,{toString:function(){return this.text}}),a.ExtendClass(c,null,{toString:function(){return this.D.call(this.t)}}),a.ExtendClass(d,null,{toString:function(){return this.D.call(this.t,this.rslt)}}),e.StTx=b,e.DyTx=c,e.AdTx=d}),define("engine",["engine/answer","engine/datasourceloader","engine/dialogitemnode","engine/engine","engine/engine_runtime","engine/helpervalues","engine/interview","engine/interview_outline","engine/interview_repeatstack","engine/interview_runtime","engine/interview_scriptstack","engine/mergeformat","engine/navigator","engine/repeatindices","engine/repeatnode","engine/rootnode","engine/template","engine/textevaluator"],function(){});